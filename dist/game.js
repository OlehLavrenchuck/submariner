/*! For license information please see game.js.LICENSE.txt */
(()=>{var t={924:(t,e,r)=>{"use strict";var n=r(210),s=r(559),i=s(n("String.prototype.indexOf"));t.exports=function(t,e){var r=n(t,!!e);return"function"==typeof r&&i(t,".prototype.")>-1?s(r):r}},559:(t,e,r)=>{"use strict";var n=r(612),s=r(210),i=r(771),o=s("%TypeError%"),a=s("%Function.prototype.apply%"),h=s("%Function.prototype.call%"),l=s("%Reflect.apply%",!0)||n.call(h,a),c=s("%Object.defineProperty%",!0),u=s("%Math.max%");if(c)try{c({},"a",{value:1})}catch(t){c=null}t.exports=function(t){if("function"!=typeof t)throw new o("a function is required");var e=l(n,h,arguments);return i(e,1+u(0,t.length-(arguments.length-1)),!0)};var d=function(){return l(n,a,arguments)};c?c(t.exports,"apply",{value:d}):t.exports.apply=d},982:(t,e,r)=>{"use strict";r.d(e,{Z:()=>a});var n=r(81),s=r.n(n),i=r(645),o=r.n(i)()(s());o.push([t.id,"canvas {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n}\n\nbody {\n    margin: 0;\n    padding: 0;\n    overflow: hidden\n}",""]);const a=o},645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",n=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),n&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),n&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,n,s,i){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(n)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);n&&o[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),s&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=s):c[4]="".concat(s)),e.push(c))}},e}},81:t=>{"use strict";t.exports=function(t){return t[1]}},296:(t,e,r)=>{"use strict";var n=r(44)(),s=r(210),i=n&&s("%Object.defineProperty%",!0);if(i)try{i({},"a",{value:1})}catch(t){i=!1}var o=s("%SyntaxError%"),a=s("%TypeError%"),h=r(275);t.exports=function(t,e,r){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new a("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new a("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,c=arguments.length>6&&arguments[6],u=!!h&&h(t,e);if(i)i(t,e,{configurable:null===l&&u?u.configurable:!l,enumerable:null===n&&u?u.enumerable:!n,value:r,writable:null===s&&u?u.writable:!s});else{if(!c&&(n||s||l))throw new o("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=r}}},187:t=>{"use strict";function e(t,e,n){n=n||2;var i,o,a,h,u,d,p,m=e&&e.length,g=m?e[0]*n:t.length,y=r(t,0,g,n,!0),b=[];if(!y||y.next===y.prev)return b;if(m&&(y=function(t,e,n,s){var i,o,a,h=[];for(i=0,o=e.length;i<o;i++)(a=r(t,e[i]*s,i<o-1?e[i+1]*s:t.length,s,!1))===a.next&&(a.steiner=!0),h.push(f(a));for(h.sort(l),i=0;i<h.length;i++)n=c(h[i],n);return n}(t,e,y,n)),t.length>80*n){i=a=t[0],o=h=t[1];for(var x=n;x<g;x+=n)(u=t[x])<i&&(i=u),(d=t[x+1])<o&&(o=d),u>a&&(a=u),d>h&&(h=d);p=0!==(p=Math.max(a-i,h-o))?32767/p:0}return s(y,b,n,i,o,p,0),b}function r(t,e,r,n,s){var i,o;if(s===S(t,e,r,n)>0)for(i=e;i<r;i+=n)o=E(i,t[i],t[i+1],o);else for(i=r-n;i>=e;i-=n)o=E(i,t[i],t[i+1],o);return o&&y(o,o.next)&&(T(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!y(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(T(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function s(t,e,r,l,c,u,f){if(t){!f&&u&&function(t,e,r,n){var s=t;do{0===s.z&&(s.z=d(s.x,s.y,e,r,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){var e,r,n,s,i,o,a,h,l=1;do{for(r=t,t=null,i=null,o=0;r;){for(o++,n=r,a=0,e=0;e<l&&(a++,n=n.nextZ);e++);for(h=l;a>0||h>0&&n;)0!==a&&(0===h||!n||r.z<=n.z)?(s=r,r=r.nextZ,a--):(s=n,n=n.nextZ,h--),i?i.nextZ=s:t=s,s.prevZ=i,i=s;r=n}i.nextZ=null,l*=2}while(o>1)}(s)}(t,l,c,u);for(var p,m,g=t;t.prev!==t.next;)if(p=t.prev,m=t.next,u?o(t,l,c,u):i(t))e.push(p.i/r|0),e.push(t.i/r|0),e.push(m.i/r|0),T(t),t=m.next,g=m.next;else if((t=m)===g){f?1===f?s(t=a(n(t),e,r),e,r,l,c,u,2):2===f&&h(t,e,r,l,c,u):s(n(t),e,r,l,c,u,1);break}}}function i(t){var e=t.prev,r=t,n=t.next;if(g(e,r,n)>=0)return!1;for(var s=e.x,i=r.x,o=n.x,a=e.y,h=r.y,l=n.y,c=s<i?s<o?s:o:i<o?i:o,u=a<h?a<l?a:l:h<l?h:l,d=s>i?s>o?s:o:i>o?i:o,f=a>h?a>l?a:l:h>l?h:l,m=n.next;m!==e;){if(m.x>=c&&m.x<=d&&m.y>=u&&m.y<=f&&p(s,a,i,h,o,l,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function o(t,e,r,n){var s=t.prev,i=t,o=t.next;if(g(s,i,o)>=0)return!1;for(var a=s.x,h=i.x,l=o.x,c=s.y,u=i.y,f=o.y,m=a<h?a<l?a:l:h<l?h:l,y=c<u?c<f?c:f:u<f?u:f,b=a>h?a>l?a:l:h>l?h:l,x=c>u?c>f?c:f:u>f?u:f,_=d(m,y,e,r,n),v=d(b,x,e,r,n),w=t.prevZ,E=t.nextZ;w&&w.z>=_&&E&&E.z<=v;){if(w.x>=m&&w.x<=b&&w.y>=y&&w.y<=x&&w!==s&&w!==o&&p(a,c,h,u,l,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,E.x>=m&&E.x<=b&&E.y>=y&&E.y<=x&&E!==s&&E!==o&&p(a,c,h,u,l,f,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;w&&w.z>=_;){if(w.x>=m&&w.x<=b&&w.y>=y&&w.y<=x&&w!==s&&w!==o&&p(a,c,h,u,l,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=v;){if(E.x>=m&&E.x<=b&&E.y>=y&&E.y<=x&&E!==s&&E!==o&&p(a,c,h,u,l,f,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function a(t,e,r){var s=t;do{var i=s.prev,o=s.next.next;!y(i,o)&&b(i,s,s.next,o)&&v(i,o)&&v(o,i)&&(e.push(i.i/r|0),e.push(s.i/r|0),e.push(o.i/r|0),T(s),T(s.next),s=t=o),s=s.next}while(s!==t);return n(s)}function h(t,e,r,i,o,a){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&m(h,l)){var c=w(h,l);return h=n(h,h.next),c=n(c,c.next),s(h,e,r,i,o,a,0),void s(c,e,r,i,o,a,0)}l=l.next}h=h.next}while(h!==t)}function l(t,e){return t.x-e.x}function c(t,e){var r=function(t,e){var r,n=e,s=t.x,i=t.y,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=s&&a>o&&(o=a,r=n.x<n.next.x?n:n.next,a===s))return r}n=n.next}while(n!==e);if(!r)return null;var h,l=r,c=r.x,d=r.y,f=1/0;n=r;do{s>=n.x&&n.x>=c&&s!==n.x&&p(i<d?s:o,i,c,d,i<d?o:s,i,n.x,n.y)&&(h=Math.abs(i-n.y)/(s-n.x),v(n,t)&&(h<f||h===f&&(n.x>r.x||n.x===r.x&&u(r,n)))&&(r=n,f=h)),n=n.next}while(n!==l);return r}(t,e);if(!r)return e;var s=w(r,t);return n(s,s.next),n(r,r.next)}function u(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function d(t,e,r,n,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function p(t,e,r,n,s,i,o,a){return(s-o)*(e-a)>=(t-o)*(i-a)&&(t-o)*(n-a)>=(r-o)*(e-a)&&(r-o)*(i-a)>=(s-o)*(n-a)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&b(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(v(t,e)&&v(e,t)&&function(t,e){var r=t,n=!1,s=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&s<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||y(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,r,n){var s=_(g(t,e,r)),i=_(g(t,e,n)),o=_(g(r,n,t)),a=_(g(r,n,e));return s!==i&&o!==a||!(0!==s||!x(t,r,e))||!(0!==i||!x(t,n,e))||!(0!==o||!x(r,t,n))||!(0!==a||!x(r,e,n))}function x(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function _(t){return t>0?1:t<0?-1:0}function v(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function w(t,e){var r=new A(t.i,t.x,t.y),n=new A(e.i,e.x,e.y),s=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=s,s.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function E(t,e,r,n){var s=new A(t,e,r);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function A(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(t,e,r,n){for(var s=0,i=e,o=r-n;i<r;i+=n)s+=(t[o]-t[i])*(t[i+1]+t[o+1]),o=i;return s}t.exports=e,t.exports.default=e,e.deviation=function(t,e,r,n){var s=e&&e.length,i=s?e[0]*r:t.length,o=Math.abs(S(t,0,i,r));if(s)for(var a=0,h=e.length;a<h;a++){var l=e[a]*r,c=a<h-1?e[a+1]*r:t.length;o-=Math.abs(S(t,l,c,r))}var u=0;for(a=0;a<n.length;a+=3){var d=n[a]*r,f=n[a+1]*r,p=n[a+2]*r;u+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},e.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,s=0;s<t.length;s++){for(var i=0;i<t[s].length;i++)for(var o=0;o<e;o++)r.vertices.push(t[s][i][o]);s>0&&(n+=t[s-1].length,r.holes.push(n))}return r}},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,r="~";function n(){}function s(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function i(t,e,n,i,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,i||t,o),h=r?r+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,n,s=[];if(0===this._eventsCount)return s;for(n in t=this._events)e.call(t,n)&&s.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,o=new Array(i);s<i;s++)o[s]=n[s].fn;return o},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,s,i,o){var a=r?r+t:t;if(!this._events[a])return!1;var h,l,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,s),!0;case 5:return c.fn.call(c.context,e,n,s,i),!0;case 6:return c.fn.call(c.context,e,n,s,i,o),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,n);break;case 4:c[l].fn.call(c[l].context,e,n,s);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},a.prototype.on=function(t,e,r){return i(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return i(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,n,s){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return o(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||s&&!a.once||n&&a.context!==n||o(this,i);else{for(var h=0,l=[],c=a.length;h<c;h++)(a[h].fn!==e||s&&!a[h].once||n&&a[h].context!==n)&&l.push(a[h]);l.length?this._events[i]=1===l.length?l[0]:l:o(this,i)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a},648:t=>{"use strict";var e=Object.prototype.toString,r=Math.max,n=function(t,e){for(var r=[],n=0;n<t.length;n+=1)r[n]=t[n];for(var s=0;s<e.length;s+=1)r[s+t.length]=e[s];return r};t.exports=function(t){var s=this;if("function"!=typeof s||"[object Function]"!==e.apply(s))throw new TypeError("Function.prototype.bind called on incompatible "+s);for(var i,o=function(t,e){for(var r=[],n=1,s=0;n<t.length;n+=1,s+=1)r[s]=t[n];return r}(arguments),a=r(0,s.length-o.length),h=[],l=0;l<a;l++)h[l]="$"+l;if(i=Function("binder","return function ("+function(t,e){for(var r="",n=0;n<t.length;n+=1)r+=t[n],n+1<t.length&&(r+=",");return r}(h)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var e=s.apply(this,n(o,arguments));return Object(e)===e?e:this}return s.apply(t,n(o,arguments))})),s.prototype){var c=function(){};c.prototype=s.prototype,i.prototype=new c,c.prototype=null}return i}},612:(t,e,r)=>{"use strict";var n=r(648);t.exports=Function.prototype.bind||n},210:(t,e,r)=>{"use strict";var n,s=SyntaxError,i=Function,o=TypeError,a=function(t){try{return i('"use strict"; return ('+t+").constructor;")()}catch(t){}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch(t){h=null}var l=function(){throw new o},c=h?function(){try{return l}catch(t){try{return h(arguments,"callee").get}catch(t){return l}}}():l,u=r(405)(),d=r(185)(),f=Object.getPrototypeOf||(d?function(t){return t.__proto__}:null),p={},m="undefined"!=typeof Uint8Array&&f?f(Uint8Array):n,g={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":u&&f?f([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":i,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u&&f?f(f([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u&&f?f((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u&&f?f((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u&&f?f(""[Symbol.iterator]()):n,"%Symbol%":u?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":c,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(f)try{null.error}catch(t){var y=f(f(t));g["%Error.prototype%"]=y}var b=function t(e){var r;if("%AsyncFunction%"===e)r=a("async function () {}");else if("%GeneratorFunction%"===e)r=a("function* () {}");else if("%AsyncGeneratorFunction%"===e)r=a("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var s=t("%AsyncGenerator%");s&&f&&(r=f(s.prototype))}return g[e]=r,r},x={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_=r(612),v=r(824),w=_.call(Function.call,Array.prototype.concat),E=_.call(Function.apply,Array.prototype.splice),T=_.call(Function.call,String.prototype.replace),A=_.call(Function.call,String.prototype.slice),S=_.call(Function.call,RegExp.prototype.exec),R=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,I=/\\(\\)?/g,M=function(t,e){var r,n=t;if(v(x,n)&&(n="%"+(r=x[n])[0]+"%"),v(g,n)){var i=g[n];if(i===p&&(i=b(n)),void 0===i&&!e)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new s("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new o('"allowMissing" argument must be a boolean');if(null===S(/^%?[^%]*%?$/,t))throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(t){var e=A(t,0,1),r=A(t,-1);if("%"===e&&"%"!==r)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new s("invalid intrinsic syntax, expected opening `%`");var n=[];return T(t,R,(function(t,e,r,s){n[n.length]=r?T(s,I,"$1"):e||t})),n}(t),n=r.length>0?r[0]:"",i=M("%"+n+"%",e),a=i.name,l=i.value,c=!1,u=i.alias;u&&(n=u[0],E(r,w([0,1],u)));for(var d=1,f=!0;d<r.length;d+=1){var p=r[d],m=A(p,0,1),y=A(p,-1);if(('"'===m||"'"===m||"`"===m||'"'===y||"'"===y||"`"===y)&&m!==y)throw new s("property names with quotes must have matching quotes");if("constructor"!==p&&f||(c=!0),v(g,a="%"+(n+="."+p)+"%"))l=g[a];else if(null!=l){if(!(p in l)){if(!e)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(h&&d+1>=r.length){var b=h(l,p);l=(f=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:l[p]}else f=v(l,p),l=l[p];f&&!c&&(g[a]=l)}}return l}},275:(t,e,r)=>{"use strict";var n=r(210)("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(t){n=null}t.exports=n},44:(t,e,r)=>{"use strict";var n=r(210)("%Object.defineProperty%",!0),s=function(){if(n)try{return n({},"a",{value:1}),!0}catch(t){return!1}return!1};s.hasArrayLengthDefineBug=function(){if(!s())return null;try{return 1!==n([],"length",{value:1}).length}catch(t){return!0}},t.exports=s},185:t=>{"use strict";var e={foo:{}},r=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!({__proto__:null}instanceof r)}},405:(t,e,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,s=r(419);t.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&s()}},419:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(t,e);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},824:(t,e,r)=>{"use strict";var n=Function.prototype.call,s=Object.prototype.hasOwnProperty,i=r(612);t.exports=i.call(n,s)},631:(t,e,r)=>{var n="function"==typeof Map&&Map.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,i=n&&s&&"function"==typeof s.get?s.get:null,o=n&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,h=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=a&&h&&"function"==typeof h.get?h.get:null,c=a&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,f="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,b=String.prototype.slice,x=String.prototype.replace,_=String.prototype.toUpperCase,v=String.prototype.toLowerCase,w=RegExp.prototype.test,E=Array.prototype.concat,T=Array.prototype.join,A=Array.prototype.slice,S=Math.floor,R="function"==typeof BigInt?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"==typeof Symbol&&"object"==typeof Symbol.iterator,C="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,k=Object.prototype.propertyIsEnumerable,O=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function F(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||w.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var n=t<0?-S(-t):S(t);if(n!==t){var s=String(n),i=b.call(e,s.length+1);return x.call(s,r,"$&_")+"."+x.call(x.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return x.call(e,r,"$&_")}var N=r(654),B=N.custom,D=j(B)?B:null;function L(t,e,r){var n="double"===(r.quoteStyle||e)?'"':"'";return n+t+n}function V(t){return x.call(String(t),/"/g,"&quot;")}function U(t){return!("[object Array]"!==W(t)||C&&"object"==typeof t&&C in t)}function X(t){return!("[object RegExp]"!==W(t)||C&&"object"==typeof t&&C in t)}function j(t){if(P)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!M)return!1;try{return M.call(t),!0}catch(t){}return!1}t.exports=function t(e,n,s,a){var h=n||{};if(G(h,"quoteStyle")&&"single"!==h.quoteStyle&&"double"!==h.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(G(h,"maxStringLength")&&("number"==typeof h.maxStringLength?h.maxStringLength<0&&h.maxStringLength!==1/0:null!==h.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var m=!G(h,"customInspect")||h.customInspect;if("boolean"!=typeof m&&"symbol"!==m)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(G(h,"indent")&&null!==h.indent&&"\t"!==h.indent&&!(parseInt(h.indent,10)===h.indent&&h.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(G(h,"numericSeparator")&&"boolean"!=typeof h.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var _=h.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return $(e,h);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var w=String(e);return _?F(e,w):w}if("bigint"==typeof e){var S=String(e)+"n";return _?F(e,S):S}var I=void 0===h.depth?5:h.depth;if(void 0===s&&(s=0),s>=I&&I>0&&"object"==typeof e)return U(e)?"[Array]":"[Object]";var B,Y=function(t,e){var r;if("\t"===t.indent)r="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;r=T.call(Array(t.indent+1)," ")}return{base:r,prev:T.call(Array(e+1),r)}}(h,s);if(void 0===a)a=[];else if(H(a,e)>=0)return"[Circular]";function z(e,r,n){if(r&&(a=A.call(a)).push(r),n){var i={depth:h.depth};return G(h,"quoteStyle")&&(i.quoteStyle=h.quoteStyle),t(e,i,s+1,a)}return t(e,h,s+1,a)}if("function"==typeof e&&!X(e)){var tt=function(t){if(t.name)return t.name;var e=y.call(g.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),et=J(e,z);return"[Function"+(tt?": "+tt:" (anonymous)")+"]"+(et.length>0?" { "+T.call(et,", ")+" }":"")}if(j(e)){var rt=P?x.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):M.call(e);return"object"!=typeof e||P?rt:q(rt)}if((B=e)&&"object"==typeof B&&("undefined"!=typeof HTMLElement&&B instanceof HTMLElement||"string"==typeof B.nodeName&&"function"==typeof B.getAttribute)){for(var nt="<"+v.call(String(e.nodeName)),st=e.attributes||[],it=0;it<st.length;it++)nt+=" "+st[it].name+"="+L(V(st[it].value),"double",h);return nt+=">",e.childNodes&&e.childNodes.length&&(nt+="..."),nt+"</"+v.call(String(e.nodeName))+">"}if(U(e)){if(0===e.length)return"[]";var ot=J(e,z);return Y&&!function(t){for(var e=0;e<t.length;e++)if(H(t[e],"\n")>=0)return!1;return!0}(ot)?"["+Q(ot,Y)+"]":"[ "+T.call(ot,", ")+" ]"}if(function(t){return!("[object Error]"!==W(t)||C&&"object"==typeof t&&C in t)}(e)){var at=J(e,z);return"cause"in Error.prototype||!("cause"in e)||k.call(e,"cause")?0===at.length?"["+String(e)+"]":"{ ["+String(e)+"] "+T.call(at,", ")+" }":"{ ["+String(e)+"] "+T.call(E.call("[cause]: "+z(e.cause),at),", ")+" }"}if("object"==typeof e&&m){if(D&&"function"==typeof e[D]&&N)return N(e,{depth:I-s});if("symbol"!==m&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!i||!t||"object"!=typeof t)return!1;try{i.call(t);try{l.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}(e)){var ht=[];return o&&o.call(e,(function(t,r){ht.push(z(r,e,!0)+" => "+z(t,e))})),Z("Map",i.call(e),ht,Y)}if(function(t){if(!l||!t||"object"!=typeof t)return!1;try{l.call(t);try{i.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}(e)){var lt=[];return c&&c.call(e,(function(t){lt.push(z(t,e))})),Z("Set",l.call(e),lt,Y)}if(function(t){if(!u||!t||"object"!=typeof t)return!1;try{u.call(t,u);try{d.call(t,d)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}(e))return K("WeakMap");if(function(t){if(!d||!t||"object"!=typeof t)return!1;try{d.call(t,d);try{u.call(t,u)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}(e))return K("WeakSet");if(function(t){if(!f||!t||"object"!=typeof t)return!1;try{return f.call(t),!0}catch(t){}return!1}(e))return K("WeakRef");if(function(t){return!("[object Number]"!==W(t)||C&&"object"==typeof t&&C in t)}(e))return q(z(Number(e)));if(function(t){if(!t||"object"!=typeof t||!R)return!1;try{return R.call(t),!0}catch(t){}return!1}(e))return q(z(R.call(e)));if(function(t){return!("[object Boolean]"!==W(t)||C&&"object"==typeof t&&C in t)}(e))return q(p.call(e));if(function(t){return!("[object String]"!==W(t)||C&&"object"==typeof t&&C in t)}(e))return q(z(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if(e===r.g)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==W(t)||C&&"object"==typeof t&&C in t)}(e)&&!X(e)){var ct=J(e,z),ut=O?O(e)===Object.prototype:e instanceof Object||e.constructor===Object,dt=e instanceof Object?"":"null prototype",ft=!ut&&C&&Object(e)===e&&C in e?b.call(W(e),8,-1):dt?"Object":"",pt=(ut||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(ft||dt?"["+T.call(E.call([],ft||[],dt||[]),": ")+"] ":"");return 0===ct.length?pt+"{}":Y?pt+"{"+Q(ct,Y)+"}":pt+"{ "+T.call(ct,", ")+" }"}return String(e)};var Y=Object.prototype.hasOwnProperty||function(t){return t in this};function G(t,e){return Y.call(t,e)}function W(t){return m.call(t)}function H(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function $(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return $(b.call(t,0,e.maxStringLength),e)+n}return L(x.call(x.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,z),"single",e)}function z(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+_.call(e.toString(16))}function q(t){return"Object("+t+")"}function K(t){return t+" { ? }"}function Z(t,e,r,n){return t+" ("+e+") {"+(n?Q(r,n):T.call(r,", "))+"}"}function Q(t,e){if(0===t.length)return"";var r="\n"+e.prev+e.base;return r+T.call(t,","+r)+"\n"+e.prev}function J(t,e){var r=U(t),n=[];if(r){n.length=t.length;for(var s=0;s<t.length;s++)n[s]=G(t,s)?e(t[s],t):""}var i,o="function"==typeof I?I(t):[];if(P){i={};for(var a=0;a<o.length;a++)i["$"+o[a]]=o[a]}for(var h in t)G(t,h)&&(r&&String(Number(h))===h&&h<t.length||P&&i["$"+h]instanceof Symbol||(w.call(/[^\w$]/,h)?n.push(e(h,t)+": "+e(t[h],t)):n.push(h+": "+e(t[h],t))));if("function"==typeof I)for(var l=0;l<o.length;l++)k.call(t,o[l])&&n.push("["+e(o[l])+"]: "+e(t[o[l]],t));return n}},771:(t,e,r)=>{"use strict";var n=r(210),s=r(296),i=r(44)(),o=r(275),a=n("%TypeError%"),h=n("%Math.floor%");t.exports=function(t,e){if("function"!=typeof t)throw new a("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||h(e)!==e)throw new a("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,l=!0;if("length"in t&&o){var c=o(t,"length");c&&!c.configurable&&(n=!1),c&&!c.writable&&(l=!1)}return(n||l||!r)&&(i?s(t,"length",e,!0,!0):s(t,"length",e)),t}},478:(t,e,r)=>{"use strict";var n=r(210),s=r(924),i=r(631),o=n("%TypeError%"),a=n("%WeakMap%",!0),h=n("%Map%",!0),l=s("WeakMap.prototype.get",!0),c=s("WeakMap.prototype.set",!0),u=s("WeakMap.prototype.has",!0),d=s("Map.prototype.get",!0),f=s("Map.prototype.set",!0),p=s("Map.prototype.has",!0),m=function(t,e){for(var r,n=t;null!==(r=n.next);n=r)if(r.key===e)return n.next=r.next,r.next=t.next,t.next=r,r};t.exports=function(){var t,e,r,n={assert:function(t){if(!n.has(t))throw new o("Side channel does not contain "+i(t))},get:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(t)return l(t,n)}else if(h){if(e)return d(e,n)}else if(r)return function(t,e){var r=m(t,e);return r&&r.value}(r,n)},has:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(t)return u(t,n)}else if(h){if(e)return p(e,n)}else if(r)return function(t,e){return!!m(t,e)}(r,n);return!1},set:function(n,s){a&&n&&("object"==typeof n||"function"==typeof n)?(t||(t=new a),c(t,n,s)):h?(e||(e=new h),f(e,n,s)):(r||(r={key:{},next:null}),function(t,e,r){var n=m(t,e);n?n.value=r:t.next={key:e,next:t.next,value:r}}(r,n,s))}};return n}},379:t=>{"use strict";var e=[];function r(t){for(var r=-1,n=0;n<e.length;n++)if(e[n].identifier===t){r=n;break}return r}function n(t,n){for(var i={},o=[],a=0;a<t.length;a++){var h=t[a],l=n.base?h[0]+n.base:h[0],c=i[l]||0,u="".concat(l," ").concat(c);i[l]=c+1;var d=r(u),f={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==d)e[d].references++,e[d].updater(f);else{var p=s(f,n);n.byIndex=a,e.splice(a,0,{identifier:u,updater:p,references:1})}o.push(u)}return o}function s(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,s){var i=n(t=t||[],s=s||{});return function(t){t=t||[];for(var o=0;o<i.length;o++){var a=r(i[o]);e[a].references--}for(var h=n(t,s),l=0;l<i.length;l++){var c=r(i[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}i=h}}},569:t=>{"use strict";var e={};t.exports=function(t,r){var n=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,r)=>{"use strict";t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},795:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var s=void 0!==r.layer;s&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,s&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var i=r.sourceMap;i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},511:function(t,e,r){var n;t=r.nmd(t),function(s){e&&e.nodeType,t&&t.nodeType;var i="object"==typeof r.g&&r.g;i.global!==i&&i.window!==i&&i.self;var o,a=2147483647,h=36,l=26,c=38,u=700,d=/^xn--/,f=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},g=h-1,y=Math.floor,b=String.fromCharCode;function x(t){throw new RangeError(m[t])}function _(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function v(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+_((t=t.replace(p,".")).split("."),e).join(".")}function w(t){for(var e,r,n=[],s=0,i=t.length;s<i;)(e=t.charCodeAt(s++))>=55296&&e<=56319&&s<i?56320==(64512&(r=t.charCodeAt(s++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),s--):n.push(e);return n}function E(t){return _(t,(function(t){var e="";return t>65535&&(e+=b((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+b(t)})).join("")}function T(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function A(t,e,r){var n=0;for(t=r?y(t/u):t>>1,t+=y(t/e);t>g*l>>1;n+=h)t=y(t/g);return y(n+(g+1)*t/(t+c))}function S(t){var e,r,n,s,i,o,c,u,d,f,p,m=[],g=t.length,b=0,_=128,v=72;for((r=t.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&x("not-basic"),m.push(t.charCodeAt(n));for(s=r>0?r+1:0;s<g;){for(i=b,o=1,c=h;s>=g&&x("invalid-input"),((u=(p=t.charCodeAt(s++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:h)>=h||u>y((a-b)/o))&&x("overflow"),b+=u*o,!(u<(d=c<=v?1:c>=v+l?l:c-v));c+=h)o>y(a/(f=h-d))&&x("overflow"),o*=f;v=A(b-i,e=m.length+1,0==i),y(b/e)>a-_&&x("overflow"),_+=y(b/e),b%=e,m.splice(b++,0,_)}return E(m)}function R(t){var e,r,n,s,i,o,c,u,d,f,p,m,g,_,v,E=[];for(m=(t=w(t)).length,e=128,r=0,i=72,o=0;o<m;++o)(p=t[o])<128&&E.push(b(p));for(n=s=E.length,s&&E.push("-");n<m;){for(c=a,o=0;o<m;++o)(p=t[o])>=e&&p<c&&(c=p);for(c-e>y((a-r)/(g=n+1))&&x("overflow"),r+=(c-e)*g,e=c,o=0;o<m;++o)if((p=t[o])<e&&++r>a&&x("overflow"),p==e){for(u=r,d=h;!(u<(f=d<=i?1:d>=i+l?l:d-i));d+=h)v=u-f,_=h-f,E.push(b(T(f+v%_,0))),u=y(v/_);E.push(b(T(u,0))),i=A(r,g,n==s),r=0,++n}++r,++e}return E.join("")}o={version:"1.4.1",ucs2:{decode:w,encode:E},decode:S,encode:R,toASCII:function(t){return v(t,(function(t){return f.test(t)?"xn--"+R(t):t}))},toUnicode:function(t){return v(t,(function(t){return d.test(t)?S(t.slice(4).toLowerCase()):t}))}},void 0===(n=function(){return o}.call(e,r,e,t))||(t.exports=n)}()},532:t=>{"use strict";var e=String.prototype.replace,r=/%20/g,n="RFC3986";t.exports={default:n,formatters:{RFC1738:function(t){return e.call(t,r,"+")},RFC3986:function(t){return String(t)}},RFC1738:"RFC1738",RFC3986:n}},984:(t,e,r)=>{"use strict";var n=r(730),s=r(325),i=r(532);t.exports={formats:i,parse:s,stringify:n}},325:(t,e,r)=>{"use strict";var n=r(368),s=Object.prototype.hasOwnProperty,i=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},h=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},l=function(t,e,r,n){if(t){var i=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/g,a=r.depth>0&&/(\[[^[\]]*])/.exec(i),l=a?i.slice(0,a.index):i,c=[];if(l){if(!r.plainObjects&&s.call(Object.prototype,l)&&!r.allowPrototypes)return;c.push(l)}for(var u=0;r.depth>0&&null!==(a=o.exec(i))&&u<r.depth;){if(u+=1,!r.plainObjects&&s.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+i.slice(a.index)+"]"),function(t,e,r,n){for(var s=n?e:h(e,r),i=t.length-1;i>=0;--i){var o,a=t[i];if("[]"===a&&r.parseArrays)o=[].concat(s);else{o=r.plainObjects?Object.create(null):{};var l="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(l,10);r.parseArrays||""!==l?!isNaN(c)&&a!==l&&String(c)===l&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(o=[])[c]=s:"__proto__"!==l&&(o[l]=s):o={0:s}}s=o}return s}(c,e,r,n)}};t.exports=function(t,e){var r=function(t){if(!t)return o;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?o.charset:t.charset;return{allowDots:void 0===t.allowDots?o.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:o.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:o.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:o.comma,decoder:"function"==typeof t.decoder?t.decoder:o.decoder,delimiter:"string"==typeof t.delimiter||n.isRegExp(t.delimiter)?t.delimiter:o.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:o.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:o.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:o.strictNullHandling}}(e);if(""===t||null==t)return r.plainObjects?Object.create(null):{};for(var c="string"==typeof t?function(t,e){var r,l={__proto__:null},c=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,u=e.parameterLimit===1/0?void 0:e.parameterLimit,d=c.split(e.delimiter,u),f=-1,p=e.charset;if(e.charsetSentinel)for(r=0;r<d.length;++r)0===d[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[r]?p="utf-8":"utf8=%26%2310003%3B"===d[r]&&(p="iso-8859-1"),f=r,r=d.length);for(r=0;r<d.length;++r)if(r!==f){var m,g,y=d[r],b=y.indexOf("]="),x=-1===b?y.indexOf("="):b+1;-1===x?(m=e.decoder(y,o.decoder,p,"key"),g=e.strictNullHandling?null:""):(m=e.decoder(y.slice(0,x),o.decoder,p,"key"),g=n.maybeMap(h(y.slice(x+1),e),(function(t){return e.decoder(t,o.decoder,p,"value")}))),g&&e.interpretNumericEntities&&"iso-8859-1"===p&&(g=a(g)),y.indexOf("[]=")>-1&&(g=i(g)?[g]:g),s.call(l,m)?l[m]=n.combine(l[m],g):l[m]=g}return l}(t,r):t,u=r.plainObjects?Object.create(null):{},d=Object.keys(c),f=0;f<d.length;++f){var p=d[f],m=l(p,c[p],r,"string"==typeof t);u=n.merge(u,m,r)}return!0===r.allowSparse?u:n.compact(u)}},730:(t,e,r)=>{"use strict";var n=r(478),s=r(368),i=r(532),o=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},h=Array.isArray,l=Array.prototype.push,c=function(t,e){l.apply(t,h(e)?e:[e])},u=Date.prototype.toISOString,d=i.default,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:s.encode,encodeValuesOnly:!1,format:d,formatter:i.formatters[d],indices:!1,serializeDate:function(t){return u.call(t)},skipNulls:!1,strictNullHandling:!1},p={},m=function t(e,r,i,o,a,l,u,d,m,g,y,b,x,_,v,w){for(var E,T=e,A=w,S=0,R=!1;void 0!==(A=A.get(p))&&!R;){var I=A.get(e);if(S+=1,void 0!==I){if(I===S)throw new RangeError("Cyclic object value");R=!0}void 0===A.get(p)&&(S=0)}if("function"==typeof d?T=d(r,T):T instanceof Date?T=y(T):"comma"===i&&h(T)&&(T=s.maybeMap(T,(function(t){return t instanceof Date?y(t):t}))),null===T){if(a)return u&&!_?u(r,f.encoder,v,"key",b):r;T=""}if("string"==typeof(E=T)||"number"==typeof E||"boolean"==typeof E||"symbol"==typeof E||"bigint"==typeof E||s.isBuffer(T))return u?[x(_?r:u(r,f.encoder,v,"key",b))+"="+x(u(T,f.encoder,v,"value",b))]:[x(r)+"="+x(String(T))];var M,P=[];if(void 0===T)return P;if("comma"===i&&h(T))_&&u&&(T=s.maybeMap(T,u)),M=[{value:T.length>0?T.join(",")||null:void 0}];else if(h(d))M=d;else{var C=Object.keys(T);M=m?C.sort(m):C}for(var k=o&&h(T)&&1===T.length?r+"[]":r,O=0;O<M.length;++O){var F=M[O],N="object"==typeof F&&void 0!==F.value?F.value:T[F];if(!l||null!==N){var B=h(T)?"function"==typeof i?i(k,F):k:k+(g?"."+F:"["+F+"]");w.set(e,S);var D=n();D.set(p,w),c(P,t(N,B,i,o,a,l,"comma"===i&&_&&h(T)?null:u,d,m,g,y,b,x,_,v,D))}}return P};t.exports=function(t,e){var r,s=t,l=function(t){if(!t)return f;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||f.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=i.default;if(void 0!==t.format){if(!o.call(i.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var n=i.formatters[r],s=f.filter;return("function"==typeof t.filter||h(t.filter))&&(s=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:f.addQueryPrefix,allowDots:void 0===t.allowDots?f.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:f.charsetSentinel,delimiter:void 0===t.delimiter?f.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:f.encode,encoder:"function"==typeof t.encoder?t.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:f.encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:f.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:f.strictNullHandling}}(e);"function"==typeof l.filter?s=(0,l.filter)("",s):h(l.filter)&&(r=l.filter);var u,d=[];if("object"!=typeof s||null===s)return"";u=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var p=a[u];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var g="comma"===p&&e&&e.commaRoundTrip;r||(r=Object.keys(s)),l.sort&&r.sort(l.sort);for(var y=n(),b=0;b<r.length;++b){var x=r[b];l.skipNulls&&null===s[x]||c(d,m(s[x],x,p,g,l.strictNullHandling,l.skipNulls,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,y))}var _=d.join(l.delimiter),v=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),_.length>0?v+_:""}},368:(t,e,r)=>{"use strict";var n=r(532),s=Object.prototype.hasOwnProperty,i=Array.isArray,o=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)void 0!==t[n]&&(r[n]=t[n]);return r};t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,r){return t[r]=e[r],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var s=e[n],o=s.obj[s.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],c=o[l];"object"==typeof c&&null!==c&&-1===r.indexOf(c)&&(e.push({obj:o,prop:l}),r.push(c))}return function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(i(r)){for(var n=[],s=0;s<r.length;++s)void 0!==r[s]&&n.push(r[s]);e.obj[e.prop]=n}}}(e),t},decode:function(t,e,r){var n=t.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},encode:function(t,e,r,s,i){if(0===t.length)return t;var a=t;if("symbol"==typeof t?a=Symbol.prototype.toString.call(t):"string"!=typeof t&&(a=String(t)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var h="",l=0;l<a.length;++l){var c=a.charCodeAt(l);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||i===n.RFC1738&&(40===c||41===c)?h+=a.charAt(l):c<128?h+=o[c]:c<2048?h+=o[192|c>>6]+o[128|63&c]:c<55296||c>=57344?h+=o[224|c>>12]+o[128|c>>6&63]+o[128|63&c]:(l+=1,c=65536+((1023&c)<<10|1023&a.charCodeAt(l)),h+=o[240|c>>18]+o[128|c>>12&63]+o[128|c>>6&63]+o[128|63&c])}return h},isBuffer:function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(i(t)){for(var r=[],n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)},merge:function t(e,r,n){if(!r)return e;if("object"!=typeof r){if(i(e))e.push(r);else{if(!e||"object"!=typeof e)return[e,r];(n&&(n.plainObjects||n.allowPrototypes)||!s.call(Object.prototype,r))&&(e[r]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(r);var o=e;return i(e)&&!i(r)&&(o=a(e,n)),i(e)&&i(r)?(r.forEach((function(r,i){if(s.call(e,i)){var o=e[i];o&&"object"==typeof o&&r&&"object"==typeof r?e[i]=t(o,r,n):e.push(r)}else e[i]=r})),e):Object.keys(r).reduce((function(e,i){var o=r[i];return s.call(e,i)?e[i]=t(e[i],o,n):e[i]=o,e}),o)}}},575:(t,e,r)=>{"use strict";var n=r(511);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var i=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(h),c=["%","/","?",";","#"].concat(l),u=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=r(984);function b(t,e,r){if(t&&"object"==typeof t&&t instanceof s)return t;var n=new s;return n.parse(t,e,r),n}s.prototype.parse=function(t,e,r){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var s=t.indexOf("?"),o=-1!==s&&s<t.indexOf("#")?"?":"#",h=t.split(o);h[0]=h[0].replace(/\\/g,"/");var b=t=h.join(o);if(b=b.trim(),!r&&1===t.split("#").length){var x=a.exec(b);if(x)return this.path=b,this.href=b,this.pathname=x[1],x[2]?(this.search=x[2],this.query=e?y.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var _=i.exec(b);if(_){var v=(_=_[0]).toLowerCase();this.protocol=v,b=b.substr(_.length)}if(r||_||b.match(/^\/\/[^@/]+@[^@/]+/)){var w="//"===b.substr(0,2);!w||_&&m[_]||(b=b.substr(2),this.slashes=!0)}if(!m[_]&&(w||_&&!g[_])){for(var E,T,A=-1,S=0;S<u.length;S++)-1!==(R=b.indexOf(u[S]))&&(-1===A||R<A)&&(A=R);for(-1!==(T=-1===A?b.lastIndexOf("@"):b.lastIndexOf("@",A))&&(E=b.slice(0,T),b=b.slice(T+1),this.auth=decodeURIComponent(E)),A=-1,S=0;S<c.length;S++){var R;-1!==(R=b.indexOf(c[S]))&&(-1===A||R<A)&&(A=R)}-1===A&&(A=b.length),this.host=b.slice(0,A),b=b.slice(A),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var M=this.hostname.split(/\./),P=(S=0,M.length);S<P;S++){var C=M[S];if(C&&!C.match(d)){for(var k="",O=0,F=C.length;O<F;O++)C.charCodeAt(O)>127?k+="x":k+=C[O];if(!k.match(d)){var N=M.slice(0,S),B=M.slice(S+1),D=C.match(f);D&&(N.push(D[1]),B.unshift(D[2])),B.length&&(b="/"+B.join(".")+b),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=n.toASCII(this.hostname));var L=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+L,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!p[v])for(S=0,P=l.length;S<P;S++){var U=l[S];if(-1!==b.indexOf(U)){var X=encodeURIComponent(U);X===U&&(X=escape(U)),b=b.split(U).join(X)}}var j=b.indexOf("#");-1!==j&&(this.hash=b.substr(j),b=b.slice(0,j));var Y=b.indexOf("?");if(-1!==Y?(this.search=b.substr(Y),this.query=b.substr(Y+1),e&&(this.query=y.parse(this.query)),b=b.slice(0,Y)):e&&(this.search="",this.query={}),b&&(this.pathname=b),g[v]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){L=this.pathname||"";var G=this.search||"";this.path=L+G}return this.href=this.format(),this},s.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",s=!1,i="";this.host?s=t+this.host:this.hostname&&(s=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(i=y.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||i&&"?"+i||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==s?(s="//"+(s||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):s||(s=""),n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),e+s+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+n},s.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},s.prototype.resolveObject=function(t){if("string"==typeof t){var e=new s;e.parse(t,!1,!0),t=e}for(var r=new s,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];r[o]=this[o]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),h=0;h<a.length;h++){var l=a[h];"protocol"!==l&&(r[l]=t[l])}return g[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!g[t.protocol]){for(var c=Object.keys(t),u=0;u<c.length;u++){var d=c[u];r[d]=t[d]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||m[t.protocol])r.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var p=r.pathname||"",y=r.search||"";r.path=p+y}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var b=r.pathname&&"/"===r.pathname.charAt(0),x=t.host||t.pathname&&"/"===t.pathname.charAt(0),_=x||b||r.host&&t.pathname,v=_,w=r.pathname&&r.pathname.split("/")||[],E=(f=t.pathname&&t.pathname.split("/")||[],r.protocol&&!g[r.protocol]);if(E&&(r.hostname="",r.port=null,r.host&&(""===w[0]?w[0]=r.host:w.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),_=_&&(""===f[0]||""===w[0])),x)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,w=f;else if(f.length)w||(w=[]),w.pop(),w=w.concat(f),r.search=t.search,r.query=t.query;else if(null!=t.search)return E&&(r.host=w.shift(),r.hostname=r.host,(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.hostname=I.shift(),r.host=r.hostname)),r.search=t.search,r.query=t.query,null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!w.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var T=w.slice(-1)[0],A=(r.host||t.host||w.length>1)&&("."===T||".."===T)||""===T,S=0,R=w.length;R>=0;R--)"."===(T=w[R])?w.splice(R,1):".."===T?(w.splice(R,1),S++):S&&(w.splice(R,1),S--);if(!_&&!v)for(;S--;S)w.unshift("..");!_||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),A&&"/"!==w.join("/").substr(-1)&&w.push("");var I,M=""===w[0]||w[0]&&"/"===w[0].charAt(0);return E&&(r.hostname=M?"":w.length?w.shift():"",r.host=r.hostname,(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.hostname=I.shift(),r.host=r.hostname)),(_=_||r.host&&w.length)&&!M&&w.unshift(""),w.length>0?r.pathname=w.join("/"):(r.pathname=null,r.path=null),null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},s.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},e.Qc=b,e.DB=function(t,e){return b(t,!1,!0).resolve(e)},e.WU=function(t){return"string"==typeof t&&(t=b(t)),t instanceof s?t.format():s.prototype.format.call(t)}},870:(t,e)=>{"use strict";e.F7=function(t=1,e=null,r=1e3){return new Promise((n=>{!function(t=1,e=null,r=null,n=1e3){setTimeout((()=>{e&&e(r)}),t*n)}(t,(t=>{n(t)}),e,r)}))}},654:()=>{}},e={};function r(n){var s=e[n];if(void 0!==s)return s.exports;var i=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),r.nc=void 0,(()=>{"use strict";var t={};r.r(t),r.d(t,{Animation:()=>ol,AnimationState:()=>Nl,AnimationStateAdapter:()=>Xl,AnimationStateData:()=>Yl,AtlasAttachmentLoader:()=>Gl,Attachment:()=>Hh,AttachmentTimeline:()=>_l,Bone:()=>Wl,BoneData:()=>Hl,BoundingBoxAttachment:()=>qh,ClippingAttachment:()=>Kh,ColorTimeline:()=>yl,ConstraintData:()=>$l,CurveTimeline:()=>ll,DeformTimeline:()=>wl,DrawOrderTimeline:()=>Tl,Event:()=>zl,EventData:()=>ql,EventQueue:()=>Vl,EventTimeline:()=>El,EventType:()=>Ul,IkConstraint:()=>Kl,IkConstraintData:()=>Zl,IkConstraintTimeline:()=>Sl,JitterEffect:()=>nl,MeshAttachment:()=>Zh,PathAttachment:()=>Qh,PathConstraint:()=>ec,PathConstraintData:()=>Ql,PathConstraintMixTimeline:()=>Ol,PathConstraintPositionTimeline:()=>Pl,PathConstraintSpacingTimeline:()=>Cl,PointAttachment:()=>Jh,RegionAttachment:()=>rl,RotateTimeline:()=>ul,ScaleTimeline:()=>pl,ShearTimeline:()=>ml,Skeleton:()=>sc,SkeletonBinary:()=>uc,SkeletonBounds:()=>pc,SkeletonData:()=>ic,SkeletonJson:()=>mc,Skin:()=>lc,SkinEntry:()=>hc,Slot:()=>tl,SlotData:()=>oc,SpacingMode:()=>Jl,Spine:()=>yc,SwirlEffect:()=>il,TimelineType:()=>al,TrackEntry:()=>Dl,TransformConstraint:()=>rc,TransformConstraintData:()=>ac,TransformConstraintTimeline:()=>Il,TranslateTimeline:()=>fl,TwoColorTimeline:()=>xl,VertexAttachment:()=>zh});var e={};r.r(e),r.d(e,{Animation:()=>kc,AnimationState:()=>au,AnimationStateAdapter2:()=>fu,AnimationStateData:()=>mu,AtlasAttachmentLoader:()=>gu,Attachment:()=>bc,AttachmentTimeline:()=>Hc,Bone:()=>yu,BoneData:()=>bu,BoundingBoxAttachment:()=>vc,ClippingAttachment:()=>wc,ColorTimeline:()=>Yc,CurveTimeline:()=>Nc,DeformTimeline:()=>zc,DrawOrderTimeline:()=>Kc,Event:()=>xu,EventData:()=>_u,EventQueue:()=>uu,EventTimeline:()=>qc,EventType:()=>du,IkConstraint:()=>vu,IkConstraintData:()=>wu,IkConstraintTimeline:()=>Qc,JitterEffect:()=>Mc,MeshAttachment:()=>Ec,PathAttachment:()=>Tc,PathConstraint:()=>Su,PathConstraintData:()=>Eu,PathConstraintMixTimeline:()=>iu,PathConstraintPositionTimeline:()=>ru,PathConstraintSpacingTimeline:()=>nu,PointAttachment:()=>Ac,RegionAttachment:()=>Ic,RotateTimeline:()=>Dc,ScaleTimeline:()=>Uc,ShearTimeline:()=>Xc,Skeleton:()=>Mu,SkeletonBounds:()=>Pu,SkeletonData:()=>Cu,SkeletonJson:()=>Nu,Skin:()=>Fu,Slot:()=>Sc,SlotData:()=>ku,SpacingMode:()=>Tu,Spine:()=>Du,SwirlEffect:()=>Cc,TimelineType:()=>Oc,TrackEntry:()=>lu,TransformConstraint:()=>Ru,TransformConstraintData:()=>Ou,TransformConstraintTimeline:()=>tu,TranslateTimeline:()=>Vc,TwoColorTimeline:()=>Wc,VertexAttachment:()=>_c});var n={};r.r(n),r.d(n,{AlphaTimeline:()=>md,Animation:()=>Qu,AnimationState:()=>kd,AnimationStateAdapter:()=>Dd,AnimationStateData:()=>Wd,AtlasAttachmentLoader:()=>Hd,Attachment:()=>Lu,AttachmentTimeline:()=>bd,Bone:()=>$d,BoneData:()=>zd,BoundingBoxAttachment:()=>Xu,ClippingAttachment:()=>ju,ConstraintData:()=>qd,CurveTimeline:()=>td,CurveTimeline1:()=>ed,CurveTimeline2:()=>rd,DeformTimeline:()=>xd,DrawOrderTimeline:()=>Ed,Event:()=>Kd,EventData:()=>Zd,EventQueue:()=>Nd,EventTimeline:()=>vd,EventType:()=>Bd,IkConstraint:()=>Qd,IkConstraintData:()=>Jd,IkConstraintTimeline:()=>Td,MeshAttachment:()=>Yu,PathAttachment:()=>Gu,PathConstraint:()=>nf,PathConstraintData:()=>tf,PathConstraintMixTimeline:()=>Id,PathConstraintPositionTimeline:()=>Sd,PathConstraintSpacingTimeline:()=>Rd,PointAttachment:()=>Wu,RGB2Timeline:()=>yd,RGBA2Timeline:()=>gd,RGBATimeline:()=>fd,RGBTimeline:()=>pd,RegionAttachment:()=>$u,RotateTimeline:()=>nd,ScaleTimeline:()=>ad,ScaleXTimeline:()=>hd,ScaleYTimeline:()=>ld,Sequence:()=>qu,SequenceMode:()=>Ku,SequenceModeValues:()=>Zu,SequenceTimeline:()=>Pd,ShearTimeline:()=>cd,ShearXTimeline:()=>ud,ShearYTimeline:()=>dd,Skeleton:()=>hf,SkeletonBinary:()=>pf,SkeletonBounds:()=>Yf,SkeletonData:()=>lf,SkeletonJson:()=>Gf,Skin:()=>ff,SkinEntry:()=>df,Slot:()=>sf,SlotData:()=>cf,SpacingMode:()=>ef,Spine:()=>Kf,Timeline:()=>Ju,TrackEntry:()=>Fd,TransformConstraint:()=>of,TransformConstraintData:()=>uf,TransformConstraintTimeline:()=>Ad,TranslateTimeline:()=>sd,TranslateXTimeline:()=>id,TranslateYTimeline:()=>od,VertexAttachment:()=>Uu});var s=r(379),i=r.n(s),o=r(795),a=r.n(o),h=r(569),l=r.n(h),c=r(565),u=r.n(c),d=r(216),f=r.n(d),p=r(589),m=r.n(p),g=r(982),y={};y.styleTagTransform=m(),y.setAttributes=u(),y.insert=l().bind(null,"head"),y.domAPI=a(),y.insertStyleElement=f(),i()(g.Z,y),g.Z&&g.Z.locals&&g.Z.locals;var b=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(b||{}),x=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(x||{}),_=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(_||{}),v=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(v||{}),w=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(w||{}),E=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(E||{}),T=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(T||{}),A=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(A||{}),S=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(S||{}),R=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(R||{}),I=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(I||{}),M=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(M||{}),P=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(P||{}),C=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(C||{}),k=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(k||{}),O=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(O||{}),F=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(F||{}),N=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(N||{}),B=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(B||{});const D={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},L={ADAPTER:D,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var V=/iPhone/i,U=/iPod/i,X=/iPad/i,j=/\biOS-universal(?:.+)Mac\b/i,Y=/\bAndroid(?:.+)Mobile\b/i,G=/Android/i,W=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,H=/Silk/i,$=/Windows Phone/i,z=/\bWindows(?:.+)ARM\b/i,q=/BlackBerry/i,K=/BB10/i,Z=/Opera Mini/i,Q=/\b(CriOS|Chrome)(?:.+)Mobile/i,J=/Mobile(?:.+)Firefox\b/i,tt=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function et(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,n=r.split("[FBAN");void 0!==n[1]&&(r=n[0]),void 0!==(n=r.split("Twitter"))[1]&&(r=n[0]);var s=function(t){return function(e){return e.test(t)}}(r),i={apple:{phone:s(V)&&!s($),ipod:s(U),tablet:!s(V)&&(s(X)||tt(e))&&!s($),universal:s(j),device:(s(V)||s(U)||s(X)||s(j)||tt(e))&&!s($)},amazon:{phone:s(W),tablet:!s(W)&&s(H),device:s(W)||s(H)},android:{phone:!s($)&&s(W)||!s($)&&s(Y),tablet:!s($)&&!s(W)&&!s(Y)&&(s(H)||s(G)),device:!s($)&&(s(W)||s(H)||s(Y)||s(G))||s(/\bokhttp\b/i)},windows:{phone:s($),tablet:s(z),device:s($)||s(z)},other:{blackberry:s(q),blackberry10:s(K),opera:s(Z),firefox:s(J),chrome:s(Q),device:s(q)||s(K)||s(Z)||s(J)||s(Q)},any:!1,phone:!1,tablet:!1};return i.any=i.apple.device||i.android.device||i.windows.device||i.other.device,i.phone=i.apple.phone||i.android.phone||i.windows.phone,i.tablet=i.apple.tablet||i.android.tablet||i.windows.tablet,i}const rt=(et.default??et)(globalThis.navigator);L.RETINA_PREFIX=/@([0-9\.]+)x/,L.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var nt=r(729),st=r(187);r(575);const it={};function ot(t,e,r=3){if(it[e])return;let n=(new Error).stack;typeof n>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(n=n.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(n))),it[e]=!0}function at(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function ht(t){return t.split("?")[0].split("#")[0]}const lt={toPosix:t=>("\\","/",t.replace(new RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/")),isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),isBlobUrl:t=>t.startsWith("blob:"),hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){at(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const r=/^[^/:]+:\/{0,2}/.exec(t);return r?r[0]:""},toAbsolute(t,e,r){if(at(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const n=ht(this.toPosix(e??L.ADAPTER.getBaseUrl())),s=ht(this.toPosix(r??this.rootname(n)));return(t=this.toPosix(t)).startsWith("/")?lt.join(s,t.slice(1)):this.isAbsolute(t)?t:this.join(n,t)},normalize(t){if(at(t),0===t.length)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;let e="";const r=(t=this.toPosix(t)).startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const n=t.endsWith("/");return t=function(t,e){let r="",n=0,s=-1,i=0,o=-1;for(let e=0;e<=t.length;++e){if(e<t.length)o=t.charCodeAt(e);else{if(47===o)break;o=47}if(47===o){if(s!==e-1&&1!==i)if(s!==e-1&&2===i){if(r.length<2||2!==n||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){const t=r.lastIndexOf("/");if(t!==r.length-1){-1===t?(r="",n=0):(r=r.slice(0,t),n=r.length-1-r.lastIndexOf("/")),s=e,i=0;continue}}else if(2===r.length||1===r.length){r="",n=0,s=e,i=0;continue}}else r.length>0?r+=`/${t.slice(s+1,e)}`:r=t.slice(s+1,e),n=e-s-1;s=e,i=0}else 46===o&&-1!==i?++i:i=-1}return r}(t),t.length>0&&n&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return at(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let r=0;r<t.length;++r){const n=t[r];if(at(n),n.length>0)if(void 0===e)e=n;else{const s=t[r-1]??"";this.extname(s)?e+=`/../${n}`:e+=`/${n}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(at(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const r=47===e;let n=-1,s=!0;const i=this.getProtocol(t),o=t;for(let r=(t=t.slice(i.length)).length-1;r>=1;--r)if(e=t.charCodeAt(r),47===e){if(!s){n=r;break}}else s=!1;return-1===n?r?"/":this.isUrl(o)?i+t:i:r&&1===n?"//":i+t.slice(0,n)},rootname(t){at(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);e=-1!==r?t.slice(0,r):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){at(t),e&&at(e),t=ht(this.toPosix(t));let r,n=0,s=-1,i=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=0;--r){const h=t.charCodeAt(r);if(47===h){if(!i){n=r+1;break}}else-1===a&&(i=!1,a=r+1),o>=0&&(h===e.charCodeAt(o)?-1==--o&&(s=r):(o=-1,s=a))}return n===s?s=a:-1===s&&(s=t.length),t.slice(n,s)}for(r=t.length-1;r>=0;--r)if(47===t.charCodeAt(r)){if(!i){n=r+1;break}}else-1===s&&(i=!1,s=r+1);return-1===s?"":t.slice(n,s)},extname(t){at(t);let e=-1,r=0,n=-1,s=!0,i=0;for(let o=(t=ht(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===n&&(s=!1,n=o+1),46===a?-1===e?e=o:1!==i&&(i=1):-1!==e&&(i=-1);else if(!s){r=o+1;break}}return-1===e||-1===n||0===i||1===i&&e===n-1&&e===r+1?"":t.slice(e,n)},parse(t){at(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let r=(t=ht(this.toPosix(t))).charCodeAt(0);const n=this.isAbsolute(t);let s;e.root=this.rootname(t),s=n||this.hasProtocol(t)?1:0;let i=-1,o=0,a=-1,h=!0,l=t.length-1,c=0;for(;l>=s;--l)if(r=t.charCodeAt(l),47!==r)-1===a&&(h=!1,a=l+1),46===r?-1===i?i=l:1!==c&&(c=1):-1!==i&&(c=-1);else if(!h){o=l+1;break}return-1===i||-1===a||0===c||1===c&&i===a-1&&i===o+1?-1!==a&&(e.base=e.name=0===o&&n?t.slice(1,a):t.slice(o,a)):(0===o&&n?(e.name=t.slice(1,i),e.base=t.slice(1,a)):(e.name=t.slice(o,i),e.base=t.slice(o,a)),e.ext=t.slice(i,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"};let ct,ut;async function dt(){return ct??(ct=(async()=>{const t=document.createElement("canvas").getContext("webgl");if(!t)return P.UNPACK;const e=await new Promise((t=>{const e=document.createElement("video");e.onloadeddata=()=>t(e),e.onerror=()=>t(null),e.autoplay=!1,e.crossOrigin="anonymous",e.preload="auto",e.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",e.load()}));if(!e)return P.UNPACK;const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const s=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,s),t.deleteFramebuffer(n),t.deleteTexture(r),t.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?P.PMA:P.UNPACK})()),ct}var ft={grad:.9,turn:360,rad:360/(2*Math.PI)},pt=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},mt=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},gt=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),t>r?r:t>e?t:e},yt=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},bt=function(t){return{r:gt(t.r,0,255),g:gt(t.g,0,255),b:gt(t.b,0,255),a:gt(t.a)}},xt=function(t){return{r:mt(t.r),g:mt(t.g),b:mt(t.b),a:mt(t.a,3)}},_t=/^#([0-9a-f]{3,8})$/i,vt=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},wt=function(t){var e=t.r,r=t.g,n=t.b,s=t.a,i=Math.max(e,r,n),o=i-Math.min(e,r,n),a=o?i===e?(r-n)/o:i===r?2+(n-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:i?o/i*100:0,v:i/255*100,a:s}},Et=function(t){var e=t.h,r=t.s,n=t.v,s=t.a;e=e/360*6,r/=100,n/=100;var i=Math.floor(e),o=n*(1-r),a=n*(1-(e-i)*r),h=n*(1-(1-e+i)*r),l=i%6;return{r:255*[n,a,o,o,h,n][l],g:255*[h,n,n,a,o,o][l],b:255*[o,o,h,n,n,a][l],a:s}},Tt=function(t){return{h:yt(t.h),s:gt(t.s,0,100),l:gt(t.l,0,100),a:gt(t.a)}},At=function(t){return{h:mt(t.h),s:mt(t.s),l:mt(t.l),a:mt(t.a,3)}},St=function(t){return Et((r=(e=t).s,{h:e.h,s:(r*=((n=e.l)<50?n:100-n)/100)>0?2*r/(n+r)*100:0,v:n+r,a:e.a}));var e,r,n},Rt=function(t){return{h:(e=wt(t)).h,s:(s=(200-(r=e.s))*(n=e.v)/100)>0&&s<200?r*n/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,r,n,s},It=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Mt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Pt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ct=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,kt={string:[[function(t){var e=_t.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?mt(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?mt(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=Pt.exec(t)||Ct.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:bt({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=It.exec(t)||Mt.exec(t);if(!e)return null;var r,n,s=Tt({h:(r=e[1],n=e[2],void 0===n&&(n="deg"),Number(r)*(ft[n]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return St(s)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,n=t.b,s=t.a,i=void 0===s?1:s;return pt(e)&&pt(r)&&pt(n)?bt({r:Number(e),g:Number(r),b:Number(n),a:Number(i)}):null},"rgb"],[function(t){var e=t.h,r=t.s,n=t.l,s=t.a,i=void 0===s?1:s;if(!pt(e)||!pt(r)||!pt(n))return null;var o=Tt({h:Number(e),s:Number(r),l:Number(n),a:Number(i)});return St(o)},"hsl"],[function(t){var e=t.h,r=t.s,n=t.v,s=t.a,i=void 0===s?1:s;if(!pt(e)||!pt(r)||!pt(n))return null;var o=function(t){return{h:yt(t.h),s:gt(t.s,0,100),v:gt(t.v,0,100),a:gt(t.a)}}({h:Number(e),s:Number(r),v:Number(n),a:Number(i)});return Et(o)},"hsv"]]},Ot=function(t,e){for(var r=0;r<e.length;r++){var n=e[r][0](t);if(n)return[n,e[r][1]]}return[null,void 0]},Ft=function(t,e){var r=Rt(t);return{h:r.h,s:gt(r.s+100*e,0,100),l:r.l,a:r.a}},Nt=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Bt=function(t,e){var r=Rt(t);return{h:r.h,s:r.s,l:gt(r.l+100*e,0,100),a:r.a}},Dt=function(){function t(t){this.parsed=function(t){return"string"==typeof t?Ot(t.trim(),kt.string):"object"==typeof t&&null!==t?Ot(t,kt.object):[null,void 0]}(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return mt(Nt(this.rgba),2)},t.prototype.isDark=function(){return Nt(this.rgba)<.5},t.prototype.isLight=function(){return Nt(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=xt(this.rgba)).r,r=t.g,n=t.b,i=(s=t.a)<1?vt(mt(255*s)):"","#"+vt(e)+vt(r)+vt(n)+i;var t,e,r,n,s,i},t.prototype.toRgb=function(){return xt(this.rgba)},t.prototype.toRgbString=function(){return e=(t=xt(this.rgba)).r,r=t.g,n=t.b,(s=t.a)<1?"rgba("+e+", "+r+", "+n+", "+s+")":"rgb("+e+", "+r+", "+n+")";var t,e,r,n,s},t.prototype.toHsl=function(){return At(Rt(this.rgba))},t.prototype.toHslString=function(){return e=(t=At(Rt(this.rgba))).h,r=t.s,n=t.l,(s=t.a)<1?"hsla("+e+", "+r+"%, "+n+"%, "+s+")":"hsl("+e+", "+r+"%, "+n+"%)";var t,e,r,n,s},t.prototype.toHsv=function(){return t=wt(this.rgba),{h:mt(t.h),s:mt(t.s),v:mt(t.v),a:mt(t.a,3)};var t},t.prototype.invert=function(){return Lt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Lt(Ft(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Lt(Ft(this.rgba,-t))},t.prototype.grayscale=function(){return Lt(Ft(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Lt(Bt(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Lt(Bt(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Lt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):mt(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=Rt(this.rgba);return"number"==typeof t?Lt({h:t,s:e.s,l:e.l,a:e.a}):mt(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Lt(t).toHex()},t}(),Lt=function(t){return t instanceof Dt?t:new Dt(t)},Vt=[];!function(t){t.forEach((function(t){Vt.indexOf(t)<0&&(t(Dt,kt),Vt.push(t))}))}([function(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var s in r)n[r[s]]=s;var i={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var s,o,a=n[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,c="black";if(!i.length)for(var u in r)i[u]=new t(r[u]).toRgb();for(var d in r){var f=(s=h,o=i[d],Math.pow(s.r-o.r,2)+Math.pow(s.g-o.g,2)+Math.pow(s.b-o.b,2));f<l&&(l=f,c=d)}return c}},e.string.push([function(e){var n=e.toLowerCase(),s="transparent"===n?"#0000":r[n];return s?new t(s).toRgb():null},"name"])}]);const Ut=class t{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(e){if(e instanceof t)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(null===e)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if("number"===r||"string"===r||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,r)=>t===e[r]));if(null!==t&&null!==e){const r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every((r=>t[r]===e[r]))}return t===e}toRgba(){const[t,e,r,n]=this._components;return{r:t,g:e,b:r,a:n}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,n]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*r),t[2]=Math.round(255*n),t}toRgbArray(t){t=t??[];const[e,r,n]=this._components;return t[0]=e,t[1]=r,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(e){const[r,n,s,i]=t.temp.setValue(e)._components;return this._components[0]*=r,this._components[1]*=n,this._components[2]*=s,this._components[3]*=i,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,s=255&this._int;return e&&(r=r*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(255*t<<24)+(r<<16)+(n<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,n,s]=this._components;return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}normalize(e){let r,n,s,i;if(("number"==typeof e||e instanceof Number)&&e>=0&&e<=16777215)r=(e>>16&255)/255,n=(e>>8&255)/255,s=(255&e)/255,i=1;else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[r,n,s,i=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[r,n,s,i=255]=e,r/=255,n/=255,s/=255,i/=255;else if("string"==typeof e||"object"==typeof e){if("string"==typeof e){const r=t.HEX_PATTERN.exec(e);r&&(e=`#${r[2]}`)}const o=Lt(e);o.isValid()&&(({r,g:n,b:s,a:i}=o.rgba),r/=255,n/=255,s/=255)}if(void 0===r)throw new Error(`Unable to convert color ${e}`);this._components[0]=r,this._components[1]=n,this._components[2]=s,this._components[3]=i,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*r|0)}_clamp(t,e=0,r=1){return"number"==typeof t?Math.min(Math.max(t,e),r):(t.forEach(((n,s)=>{t[s]=Math.min(Math.max(n,e),r)})),t)}};Ut.shared=new Ut,Ut.temp=new Ut,Ut.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Xt=Ut;function jt(t){return ot("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Xt.shared.setValue(t).toNumber()}const Yt=function(){const t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[v.NORMAL_NPM]=v.NORMAL,t[v.ADD_NPM]=v.ADD,t[v.SCREEN_NPM]=v.SCREEN,e[v.NORMAL]=v.NORMAL_NPM,e[v.ADD]=v.ADD_NPM,e[v.SCREEN]=v.SCREEN_NPM;const r=[];return r.push(e),r.push(t),r}();function Gt(t,e){return Yt[e?1:0][t]}function Wt(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function Ht(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}function $t(t){return!(t&t-1||!t)}function zt(t){let e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,r=((t>>>=r)>15?1:0)<<2,e|=r,r=((t>>>=r)>3?1:0)<<1,e|=r,e|(t>>>=r)>>1}function qt(t,e,r){const n=t.length;let s;if(e>=n||0===r)return;const i=n-(r=e+r>n?n-e:r);for(s=e;s<i;++s)t[s]=t[s+r];t.length=i}function Kt(t){return 0===t?0:t<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let Zt=0;function Qt(){return++Zt}const Jt=class{constructor(t,e,r,n){this.left=t,this.top=e,this.right=r,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Jt.EMPTY=new Jt(0,0,0,0);let te=Jt;const ee={},re=Object.create(null),ne=Object.create(null);class se{constructor(t,e,r){this._canvas=L.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||L.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function ie(t,e,r){for(let n=0,s=4*r*e;n<e;++n,s+=4)if(0!==t[s+3])return!1;return!0}function oe(t,e,r,n,s){const i=4*e;for(let e=n,o=n*i+4*r;e<=s;++e,o+=i)if(0!==t[o+3])return!1;return!0}function ae(t,e=1){const r=L.RETINA_PREFIX?.exec(t);return r?parseFloat(r[1]):e}var he=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(he||{});const le=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},ce=(t,e)=>le(t).priority??e,ue={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(le).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(le).forEach((t=>{t.type.forEach((e=>{const r=this._addHandlers,n=this._queue;r[e]?r[e](t):(n[e]=n[e]||[],n[e].push(t))}))})),this},handle(t,e,r){const n=this._addHandlers,s=this._removeHandlers;if(n[t]||s[t])throw new Error(`Extension type ${t} already has a handler`);n[t]=e,s[t]=r;const i=this._queue;return i[t]&&(i[t].forEach((t=>e(t))),delete i[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,r=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>ce(e,r)-ce(t,r))))}),(t=>{const r=e.indexOf(t.ref);-1!==r&&e.splice(r,1)}))}};class de{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const fe=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function pe(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}class me{constructor(){this.data=0,this.blendMode=v.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==v.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new me;return t.depthTest=!1,t.blend=!0,t}}me.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const ge=[];function ye(t,e){if(!t)return null;let r="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(r=e[1].toLowerCase())}for(let n=ge.length-1;n>=0;--n){const s=ge[n];if(s.test&&s.test(t,r))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class be{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,n,s,i,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let c=0,u=l.length;c<u;c++)l[c][h](t,e,r,n,s,i,o,a);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(be.prototype,{dispatch:{value:be.prototype.emit},run:{value:be.prototype.emit}});class xe{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new be("setRealSize"),this.onUpdate=new be("update"),this.onError=new be("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class _e extends xe{constructor(t,e){const{width:r,height:n}=e||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===P.UNPACK);const s=e.realWidth,i=e.realHeight;return r.width===s&&r.height===i?n.texSubImage2D(e.target,0,0,0,s,i,e.format,r.type,this.data):(r.width=s,r.height=i,n.texImage2D(e.target,0,r.internalFormat,s,i,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return null===t||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const ve={scaleMode:R.NEAREST,alphaMode:P.NPM},we=class t extends nt{constructor(e=null,r=null){super(),r=Object.assign({},t.defaultOptions,r);const{alphaMode:n,mipmap:s,anisotropicLevel:i,scaleMode:o,width:a,height:h,wrapMode:l,format:c,type:u,target:d,resolution:f,resourceOptions:p}=r;e&&!(e instanceof xe)&&((e=ye(e,p)).internal=!0),this.resolution=f||L.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=i,this._wrapMode=l,this._scaleMode=o,this.format=c,this.type=u,this.target=d,this.alphaMode=n,this.uid=Qt(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=$t(this.realWidth)&&$t(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ne[this.cacheId],delete re[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,r,n=L.STRICT_TEXTURE_CACHE){const s="string"==typeof e;let i=null;if(s)i=e;else{if(!e._pixiId){const t=r?.pixiIdPrefix||"pixiid";e._pixiId=`${t}_${Qt()}`}i=e._pixiId}let o=ne[i];if(s&&n&&!o)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return o||(o=new t(e,r),o.cacheId=i,t.addToCache(o,i)),o}static fromBuffer(e,r,n,s){e=e||new Float32Array(r*n*4);const i=new _e(e,{width:r,height:n,...s?.resourceOptions});let o,a;return e instanceof Float32Array?(o=E.RGBA,a=A.FLOAT):e instanceof Int32Array?(o=E.RGBA_INTEGER,a=A.INT):e instanceof Uint32Array?(o=E.RGBA_INTEGER,a=A.UNSIGNED_INT):e instanceof Int16Array?(o=E.RGBA_INTEGER,a=A.SHORT):e instanceof Uint16Array?(o=E.RGBA_INTEGER,a=A.UNSIGNED_SHORT):e instanceof Int8Array?(o=E.RGBA,a=A.BYTE):(o=E.RGBA,a=A.UNSIGNED_BYTE),i.internal=!0,new t(i,Object.assign({},ve,{type:a,format:o},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ne[e]&&ne[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),ne[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=ne[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete ne[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete ne[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};we.defaultOptions={mipmap:M.POW2,anisotropicLevel:0,scaleMode:R.LINEAR,wrapMode:I.CLAMP,alphaMode:P.UNPACK,target:T.TEXTURE_2D,format:E.RGBA,type:A.UNSIGNED_BYTE},we._globalBatch=0;let Ee=we;class Te{constructor(){this.texArray=null,this.blend=0,this.type=w.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Ae=0;class Se{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=Ae++,this.disposeRunner=new be("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?B.ELEMENT_ARRAY_BUFFER:B.ARRAY_BUFFER}get index(){return this.type===B.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Se(t)}}class Re{constructor(t,e=0,r=!1,n=A.FLOAT,s,i,o,a=1){this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=s,this.start=i,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,r,n,s){return new Re(t,e,r,n,s)}}const Ie={Float32Array,Uint32Array,Int32Array,Uint8Array},Me={5126:4,5123:2,5121:1};let Pe=0;const Ce={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class ke{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Pe++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new be("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,n=!1,s,i,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Se||(e instanceof Array&&(e=new Float32Array(e)),e=new Se(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,r,n,s);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new Re(l,r,n,s,i,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Se||(t instanceof Array&&(t=new Uint16Array(t)),t=new Se(t)),t.type=B.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],r=new Se;let n;for(n in this.attributes){const r=this.attributes[n],s=this.buffers[r.buffer];t.push(s.data),e.push(r.size*Me[r.type]/4),r.buffer=0}for(r.data=function(t,e){let r=0,n=0;const s={};for(let s=0;s<t.length;s++)n+=e[s],r+=t[s].length;const i=new ArrayBuffer(4*r);let o=null,a=0;for(let r=0;r<t.length;r++){const h=e[r],l=t[r],c=Wt(l);s[c]||(s[c]=new Ie[c](i)),o=s[c];for(let t=0;t<l.length;t++)o[(t/h|0)*n+a+t%h]=l[t];a+=h}return new Float32Array(i)}(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new ke;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Se(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new Re(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=B.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new ke,r=[],n=[],s=[];let i;for(let e=0;e<t.length;e++){i=t[e];for(let t=0;t<i.buffers.length;t++)n[t]=n[t]||0,n[t]+=i.buffers[t].data.length,s[t]=0}for(let t=0;t<i.buffers.length;t++)r[t]=new(Ce[Wt(i.buffers[t].data)])(n[t]),e.buffers[t]=new Se(r[t]);for(let e=0;e<t.length;e++){i=t[e];for(let t=0;t<i.buffers.length;t++)r[t].set(i.buffers[t].data,s[t]),s[t]+=i.buffers[t].data.length}if(e.attributes=i.attributes,i.indexBuffer){e.indexBuffer=e.buffers[i.buffers.indexOf(i.indexBuffer)],e.indexBuffer.type=B.ELEMENT_ARRAY_BUFFER;let r=0,n=0,s=0,o=0;for(let t=0;t<i.buffers.length;t++)if(i.buffers[t]!==i.indexBuffer){o=t;break}for(const t in i.attributes){const e=i.attributes[t];(0|e.buffer)===o&&(n+=e.size*Me[e.type]/4)}for(let i=0;i<t.length;i++){const a=t[i].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+s]+=r;r+=t[i].buffers[o].data.length/n,s+=a.length}}return e}}class Oe extends ke{constructor(t=!1){super(),this._buffer=new Se(null,t,!1),this._indexBuffer=new Se(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,A.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,A.FLOAT).addAttribute("aColor",this._buffer,4,!0,A.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,A.FLOAT).addIndex(this._indexBuffer)}}const Fe=2*Math.PI,Ne=180/Math.PI,Be=Math.PI/180;var De=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(De||{});class Le{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Le(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}Le.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Ve=[new Le,new Le,new Le,new Le];class Ue{constructor(t=0,e=0,r=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=De.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Ue(0,0,0,0)}clone(){return new Ue(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const r=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>r}const r=this.left,n=this.right,s=this.top,i=this.bottom;if(n<=r||i<=s)return!1;const o=Ve[0].set(t.left,t.top),a=Ve[1].set(t.left,t.bottom),h=Ve[2].set(t.right,t.top),l=Ve[3].set(t.right,t.bottom);if(h.x<=o.x||a.y<=o.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c||(e.apply(o,o),e.apply(a,a),e.apply(h,h),e.apply(l,l),Math.max(o.x,a.x,h.x,l.x)<=r||Math.min(o.x,a.x,h.x,l.x)>=n||Math.max(o.y,a.y,h.y,l.y)<=s||Math.min(o.y,a.y,h.y,l.y)>=i))return!1;const u=c*(a.y-o.y),d=c*(o.x-a.x),f=u*r+d*s,p=u*n+d*s,m=u*r+d*i,g=u*n+d*i;if(Math.max(f,p,m,g)<=u*o.x+d*o.y||Math.min(f,p,m,g)>=u*l.x+d*l.y)return!1;const y=c*(o.y-h.y),b=c*(h.x-o.x),x=y*r+b*s,_=y*n+b*s,v=y*r+b*i,w=y*n+b*i;return!(Math.max(x,_,v,w)<=y*o.x+b*o.y||Math.min(x,_,v,w)>=y*l.x+b*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=s-n,this}}Ue.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Xe{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=De.CIRC}clone(){return new Xe(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=r}getBounds(){return new Ue(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}Xe.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class je{constructor(t=0,e=0,r=0,n=0){this.x=t,this.y=e,this.width=r,this.height=n,this.type=De.ELIP}clone(){return new je(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new Ue(this.x-this.width,this.y-this.height,this.width,this.height)}}je.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Ye{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r].x,e[r].y);e=t}this.points=e,this.type=De.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Ye(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let s=0,i=n-1;s<n;i=s++){const n=this.points[2*s],o=this.points[2*s+1],a=this.points[2*i],h=this.points[2*i+1];o>e!=h>e&&t<(e-o)/(h-o)*(a-n)+n&&(r=!r)}return r}}Ye.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`};class Ge{constructor(t=0,e=0,r=0,n=0,s=20){this.x=t,this.y=e,this.width=r,this.height=n,this.radius=s,this.type=De.RREC}clone(){return new Ge(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),s=e-(this.y+r);const i=r*r;if(n*n+s*s<=i||(n=t-(this.x+this.width-r),n*n+s*s<=i)||(s=e-(this.y+this.height-r),n*n+s*s<=i)||(n=t-(this.x+r),n*n+s*s<=i))return!0}return!1}}Ge.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class We{constructor(t=1,e=0,r=0,n=1,s=0,i=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=i}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,s,i){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=i,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Le;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new Le;const r=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*r*n+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*s+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,s=this.c,i=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=i*e-this.ty*r,this.ty=i*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this}setTransform(t,e,r,n,s,i,o,a,h){return this.a=Math.cos(o+h)*s,this.b=Math.sin(o+h)*s,this.c=-Math.sin(o-a)*i,this.d=Math.cos(o-a)*i,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,r=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,s=this.d,i=t.pivot,o=-Math.atan2(-n,s),a=Math.atan2(r,e),h=Math.abs(o+a);return h<1e-5||Math.abs(Fe-h)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(i.x*e+i.y*n),t.position.y=this.ty+(i.x*r+i.y*s),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,s=this.tx,i=t*n-e*r;return this.a=n/i,this.b=-e/i,this.c=-r/i,this.d=t/i,this.tx=(r*this.ty-n*s)/i,this.ty=-(t*this.ty-e*s)/i,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new We;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new We}static get TEMP_MATRIX(){return new We}}We.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const He=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],$e=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ze=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],qe=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Ke=[],Ze=[],Qe=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];Ke.push(e);for(let r=0;r<16;r++){const n=Qe(He[t]*He[r]+ze[t]*$e[r]),s=Qe($e[t]*He[r]+qe[t]*$e[r]),i=Qe(He[t]*ze[r]+ze[t]*qe[r]),o=Qe($e[t]*ze[r]+qe[t]*qe[r]);for(let t=0;t<16;t++)if(He[t]===n&&$e[t]===s&&ze[t]===i&&qe[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new We;e.set(He[t],$e[t],ze[t],qe[t],0,0),Ze.push(e)}}();const Je={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>He[t],uY:t=>$e[t],vX:t=>ze[t],vY:t=>qe[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>Ke[t][e],sub:(t,e)=>Ke[t][Je.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?Je.S:Je.N:2*Math.abs(e)<=Math.abs(t)?t>0?Je.E:Je.W:e>0?t>0?Je.SE:Je.SW:t>0?Je.NE:Je.NW,matrixAppendRotationInv:(t,e,r=0,n=0)=>{const s=Ze[Je.inv(e)];s.tx=r,s.ty=n,t.append(s)}};class tr{constructor(t,e,r=0,n=0){this._x=r,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new tr(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}tr.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const er=class{constructor(){this.worldTransform=new We,this.localTransform=new We,this.position=new tr(this.onChange,this,0,0),this.scale=new tr(this.onChange,this,1,1),this.pivot=new tr(this.onChange,this,0,0),this.skew=new tr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const r=t.worldTransform,n=this.worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};er.IDENTITY=new er;let rr=er;rr.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};const nr=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],sr={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},ir={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},or={};let ar,hr=or;const lr={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function cr(t){return lr[t]}let ur=null;const dr={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function fr(t,e){if(!ur){const e=Object.keys(dr);ur={};for(let r=0;r<e.length;++r){const n=e[r];ur[t[n]]=dr[n]}}return ur[e]}function pr(t,e,r){if("precision"!==t.substring(0,9)){let n=e;return e===O.HIGH&&r!==O.HIGH&&(n=O.MEDIUM),`precision ${n} float;\n${t}`}return r!==O.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let mr=0;const gr={},yr=class t{constructor(e,r,n="pixi-shader",s={}){this.extra={},this.id=mr++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=r||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),gr[n]?(gr[n]++,n+=`-${gr[n]}`):gr[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}\n${this.fragmentSrc}`,this.vertexSrc=pr(this.vertexSrc,t.defaultVertexPrecision,O.HIGH),this.fragmentSrc=pr(this.fragmentSrc,t.defaultFragmentPrecision,function(){if(!ar){ar=O.MEDIUM;const t=function(){if(hr===or||hr?.isContextLost()){const t=L.ADAPTER.createCanvas();let e;L.PREFER_ENV>=b.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),hr=e}return hr}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);e&&(ar=e.precision?O.HIGH:O.MEDIUM)}}return ar}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(e,r,n){const s=e+r;let i=ee[s];return i||(ee[s]=i=new t(e,r,n)),i}};yr.defaultVertexPrecision=O.HIGH,yr.defaultFragmentPrecision=rt.apple.device?O.HIGH:O.MEDIUM;let br=yr,xr=0;class _r{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=xr++,this.static=!!e,this.ubo=!!r,t instanceof Se?(this.buffer=t,this.buffer.type=B.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Se(new Float32Array(1)),this.buffer.type=B.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new _r(e,r)}static from(t,e,r){return new _r(t,e,r)}static uboFrom(t,e){return new _r(t,e??!0,!0)}}class vr{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof _r?e:new _r(e):new _r({}),this.disposeRunner=new be("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const n=e.uniforms[r];if(!0===n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const n=br.from(t,e);return new vr(n,r)}}class wr{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=_r.from({uSamplers:e},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new br(this.vertexSrc,r)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new We,default:this.defaultGroupCache[t]};return new vr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${r}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class Er{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Tr{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const Ar=class t extends Tr{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Oe,this.vertexSize=6,this.state=me.for2d(),this.size=4*t.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const r=L.ADAPTER.getNavigator();if(rt.tablet||rt.phone){if(rt.apple.device){const t=r.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(rt.android.device){const t=r.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?32:4}(),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!rt.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return ot("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:e=t.defaultVertexSrc,fragment:r=t.defaultFragmentTemplate}={}){this.shaderGenerator=new wr(e,r)}contextChange(){const e=this.renderer.gl;L.PREFER_ENV===b.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),t.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);for(;;){const n=fe.replace(/%forloop%/gi,pe(t));if(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:r}=t,n=this.size/4,s=Math.floor(n/this.maxTextures)+1;for(;e.length<n;)e.push(new Te);for(;r.length<s;)r.push(new Er);for(let t=0;t<this.maxTextures;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:r}=this,n=t._textureArrayPool,s=this.renderer.batch,i=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++Ee._globalBatch,h=0,l=n[0],c=0;s.copyBoundTextures(i,r);for(let t=0;t<this._bufferSize;++t){const u=e[t];e[t]=null,u._batchEnabled!==a&&(l.count>=r&&(s.boundArray(l,i,a,r),this.buildDrawCalls(l,c,t),c=t,l=n[++h],++a),u._batchEnabled=a,u.touched=o,l.elements[l.count++]=u)}l.count>0&&(s.boundArray(l,i,a,r),this.buildDrawCalls(l,c,this._bufferSize),++h,++a);for(let t=0;t<i.length;t++)i[t]=null;Ee._globalBatch=a}buildDrawCalls(e,r,n){const{_bufferedElements:s,_attributeBuffer:i,_indexBuffer:o,vertexSize:a}=this,h=t._drawCallPool;let l=this._dcIndex,c=this._aIndex,u=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=e;for(let t=r;t<n;++t){const n=s[t],f=n._texture.baseTexture,p=Yt[f.alphaMode?1:0][n.blendMode];s[t]=null,r<t&&d.blend!==p&&(d.size=u-d.start,r=t,d=h[++l],d.texArray=e,d.start=u),this.packInterleavedGeometry(n,i,o,c,u),c+=n.vertexData.length/2*a,u+=n.indices.length,d.blend=p}r<n&&(d.size=u-d.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=u}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:r,_indexBuffer:n}=this;t.canUploadSameBuffer?(e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:r,state:n}=this.renderer,s=t._drawCallPool;let i=null;for(let t=0;t<e;t++){const{texArray:e,type:o,size:a,start:h,blend:l}=s[t];i!==e&&(i=e,this.bindAndClearTexArray(e)),this.state.blendMode=l,n.set(this.state),r.drawElements(o,a,r.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),t.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Ht(Math.ceil(t/8)),r=zt(e),n=8*e;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._aBuffers[n];return s||(this._aBuffers[n]=s=new de(n*this.vertexSize*4)),s}getIndexBuffer(t){const e=Ht(Math.ceil(t/12)),r=zt(e),n=12*e;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._iBuffers[r];return s||(this._iBuffers[r]=s=new Uint16Array(n)),s}packInterleavedGeometry(t,e,r,n,s){const{uint32View:i,float32View:o}=e,a=n/this.vertexSize,h=t.uvs,l=t.indices,c=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=Xt.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let t=0;t<c.length;t+=2)o[n++]=c[t],o[n++]=c[t+1],o[n++]=h[t],o[n++]=h[t+1],i[n++]=f,o[n++]=u;for(let t=0;t<l.length;t++)r[s++]=a+l[t]}};Ar.defaultBatchSize=4096,Ar.extension={name:"batch",type:he.RendererPlugin},Ar._drawCallPool=[],Ar._textureArrayPool=[];let Sr=Ar;ue.add(Sr);const Rr=class t extends vr{constructor(e,r,n){super(br.from(e||t.defaultVertexSrc,r||t.defaultFragmentSrc),n),this.padding=0,this.resolution=t.defaultResolution,this.multisample=t.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new me}apply(t,e,r,n,s){t.applyFilter(this,e,r,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};Rr.defaultResolution=1,Rr.defaultMultisample=N.NONE;let Ir=Rr;class Mr{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Xt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:n}=t,s=r??e;void 0!==s&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Mr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Mr.extension={type:[he.RendererSystem,he.CanvasRendererSystem],name:"background"},ue.add(Mr);class Pr{constructor(t){this.renderer=t,this.emptyRenderer=new Tr(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,r,n){const{elements:s,ids:i,count:o}=t;let a=0;for(let t=0;t<o;t++){const o=s[t],h=o._batchLocation;if(h>=0&&h<n&&e[h]===o)i[t]=h;else for(;a<n;){const n=e[a];if(!n||n._batchEnabled!==r||n._batchLocation!==a){i[t]=a,o._batchLocation=a,e[a]=o;break}a++}}}destroy(){this.renderer=null}}Pr.extension={type:he.RendererSystem,name:"batch"},ue.add(Pr);let Cr=0;class kr{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Cr++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Cr++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(L.PREFER_ENV>=b.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}kr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},kr.extension={type:he.RendererSystem,name:"context"},ue.add(kr);class Or{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new be("disposeFramebuffer"),this.multisample=N.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Ee(null,{scaleMode:R.NEAREST,resolution:1,mipmap:M.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Ee(null,{scaleMode:R.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:M.OFF,format:E.DEPTH_COMPONENT,type:A.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Fr extends Ee{constructor(t={}){"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=N.NONE),super(null,t),this.mipmap=M.OFF,this.valid=!0,this._clear=new Xt([0,0,0,0]),this.framebuffer=new Or(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Nr extends xe{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){void 0!==r||e.startsWith("data:")?!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location;const r=new URL(t,document.baseURI);return r.hostname!==e.hostname||r.port!==e.port||r.protocol!==e.protocol?"anonymous":""}(e)}upload(t,e,r,n){const s=t.gl,i=e.realWidth,o=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||0===n.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===P.UNPACK),this.noSubImage||e.target!==s.TEXTURE_2D||r.width!==i||r.height!==o?(r.width=i,r.height=o,s.texImage2D(e.target,0,r.internalFormat,e.format,r.type,n)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,r.type,n),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class Br extends Nr{constructor(t,e){if(e=e||{},"string"==typeof t){const r=new Image;Nr.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??L.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const r=this.source;this.url=r.src;const n=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};r.complete&&r.src?n():(r.onload=n,r.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then((t=>t.blob())).then((r=>e(r,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===P.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,r){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let t=!0;const n=e._glTextures;for(const s in n){const i=n[s];if(i!==r&&i.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&("string"==typeof t||t instanceof HTMLImageElement)}}class Dr{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const n=e.width,s=e.height;if(r){const e=t.width/2/n,i=t.height/2/s,o=t.x/n+e,a=t.y/s+i;r=Je.add(r,Je.NW),this.x0=o+e*Je.uX(r),this.y0=a+i*Je.uY(r),r=Je.add(r,2),this.x1=o+e*Je.uX(r),this.y1=a+i*Je.uY(r),r=Je.add(r,2),this.x2=o+e*Je.uX(r),this.y2=a+i*Je.uY(r),r=Je.add(r,2),this.x3=o+e*Je.uX(r),this.y3=a+i*Je.uY(r)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Dr.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Lr=new Dr;function Vr(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Ur extends nt{constructor(t,e,r,n,s,i,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Ue(0,0,1,1)),t instanceof Ur&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=Lr,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=i?new Le(i.x,i.y):new Le(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&re[t.url]&&Ur.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Ur.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new Ur(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===Lr&&(this._uvs=new Dr),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=L.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let s=null;if(n)s=t;else if(t instanceof Ee){if(!t.cacheId){const r=e?.pixiIdPrefix||"pixiid";t.cacheId=`${r}-${Qt()}`,Ee.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const r=e?.pixiIdPrefix||"pixiid";t._pixiId=`${r}_${Qt()}`}s=t._pixiId}let i=re[s];if(n&&r&&!i)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return i||t instanceof Ee?!i&&t instanceof Ee&&(i=new Ur(t),Ur.addToCache(i,s)):(e.resolution||(e.resolution=ae(t)),i=new Ur(new Ee(t,e)),i.baseTexture.cacheId=s,Ee.addToCache(i.baseTexture,s),Ur.addToCache(i,s)),i}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),n=Ur.from(t,Object.assign({resourceOptions:r},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then((()=>Promise.resolve(n)))}static fromBuffer(t,e,r,n){return new Ur(Ee.fromBuffer(t,e,r,n))}static fromLoader(t,e,r,n){const s=new Ee(t,Object.assign({scaleMode:Ee.defaultOptions.scaleMode,resolution:ae(e)},n)),{resource:i}=s;i instanceof Br&&(i.url=e);const o=new Ur(s);return r||(r=e),Ee.addToCache(o.baseTexture,r),Ur.addToCache(o,r),r!==e&&(Ee.addToCache(o.baseTexture,e),Ur.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),re[e]&&re[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),re[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=re[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete re[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)re[t.textureCacheIds[e]]===t&&delete re[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:n,height:s}=t,i=e+n>this.baseTexture.width,o=r+s>this.baseTexture.height;if(i||o){const t=i&&o?"and":"or",a=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,h=`Y: ${r} + ${s} = ${r+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${h}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Ur._EMPTY||(Ur._EMPTY=new Ur(new Ee),Vr(Ur._EMPTY),Vr(Ur._EMPTY.baseTexture)),Ur._EMPTY}static get WHITE(){if(!Ur._WHITE){const t=L.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Ur._WHITE=new Ur(Ee.from(t)),Vr(Ur._WHITE),Vr(Ur._WHITE.baseTexture)}return Ur._WHITE}}class Xr extends Ur{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,i=Math.round(e*n)/n;this.valid=s>0&&i>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=i,r&&this.baseTexture.resize(s,i),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Xr(new Fr(t))}}class jr{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=N.NONE){const n=new Fr(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new Xr(n)}getOptimalTexture(t,e,r=1,n=N.NONE){let s;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?s=n>1?-n:-1:(s=((65535&(t=Ht(t)))<<16|65535&(e=Ht(e)))>>>0,n>1&&(s+=4294967296*n)),this.texturePool[s]||(this.texturePool[s]=[]);let i=this.texturePool[s].pop();return i||(i=this.createTexture(t,e,n)),i.filterPoolKey=s,i.setResolution(r),i}getFilterTexture(t,e,r){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||N.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}jr.SCREEN_KEY=-1;class Yr extends ke{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Gr extends ke{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Se(this.vertices),this.uvBuffer=new Se(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Wr{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=N.NONE,this.sourceFrame=new Ue,this.destinationFrame=new Ue,this.bindingSourceFrame=new Ue,this.bindingDestinationFrame=new Ue,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Hr=[new Le,new Le,new Le,new Le],$r=new We;class zr{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new jr,this.statePool=[],this.quad=new Yr,this.quadUv=new Gr,this.tempRect=new Ue,this.activeState={},this.globalUniforms=new _r({outputFrame:new Ue,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new Wr,i=r.renderTexture;let o,a;if(i.current){const t=i.current;o=t.resolution,a=t.multisample}else o=r.resolution,a=r.multisample;let h=e[0].resolution||o,l=e[0].multisample??a,c=e[0].padding,u=e[0].autoFit,d=e[0].legacy??!0;for(let t=1;t<e.length;t++){const r=e[t];h=Math.min(h,r.resolution||o),l=Math.min(l,r.multisample??a),c=this.useMaxPadding?Math.max(c,r.padding):c+r.padding,u=u&&r.autoFit,d=d||(r.legacy??!0)}1===n.length&&(this.defaultFilterStack[0].renderTexture=i.current),n.push(s),s.resolution=h,s.multisample=l,s.legacy=d,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(c);const f=this.tempRect.copyFrom(i.sourceFrame);r.projection.transform&&this.transformAABB($r.copyFrom(r.projection.transform).invert(),f),u?(s.sourceFrame.fit(f),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(f)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,i.current?i.current.resolution:r.resolution,i.sourceFrame,i.destinationFrame,r.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,h,l),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const p=this.tempRect;p.x=0,p.y=0,p.width=s.sourceFrame.width,p.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(i.sourceFrame),s.bindingDestinationFrame.copyFrom(i.destinationFrame),s.transform=r.projection.transform,r.projection.transform=null,i.bind(s.renderTexture,s.sourceFrame,p),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,i=n.inputPixel,o=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],i[0]=Math.round(s[0]*e.resolution),i[1]=Math.round(s[1]*e.resolution),i[2]=1/i[0],i[3]=1/i[1],o[0]=.5*i[2],o[1]=.5*i[3],o[2]=e.sourceFrame.width*s[2]-.5*i[2],o[3]=e.sourceFrame.height*s[3]-.5*i[3],e.legacy){const t=n.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,e.renderTexture,a.renderTexture,C.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,n=this.getOptimalFilterTexture(t.width,t.height,e.resolution);n.filterFrame=t.filterFrame;let s=0;for(s=0;s<r.length-1;++s){1===s&&e.multisample>1&&(n=this.getOptimalFilterTexture(t.width,t.height,e.resolution),n.filterFrame=t.filterFrame),r[s].apply(this,t,n,C.CLEAR,e);const i=t;t=n,n=i}r[s].apply(this,t,a.renderTexture,C.BLEND,e),s>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(n)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=C.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,r.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=1&n.stateId||this.forceClear;(e===C.CLEAR||e===C.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(w.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(w.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:s}=e._texture,i=t.set(n.width,0,0,n.height,r.x,r.y),o=e.worldTransform.copyTo(We.TEMP_MATRIX);return o.invert(),i.prepend(o),i.scale(1/s.width,1/s.height),i.translate(e.anchor.x,e.anchor.y),i}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,n=N.NONE){return this.texturePool.getOptimalTexture(t,e,r,n)}getFilterTexture(t,e,r){if("number"==typeof t){const r=t;t=e,e=r}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||N.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=Hr[0],n=Hr[1],s=Hr[2],i=Hr[3];r.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),i.set(e.right,e.bottom),t.apply(r,r),t.apply(n,n),t.apply(s,s),t.apply(i,i);const o=Math.min(r.x,n.x,s.x,i.x),a=Math.min(r.y,n.y,s.y,i.y),h=Math.max(r.x,n.x,s.x,i.x),l=Math.max(r.y,n.y,s.y,i.y);e.x=o,e.y=a,e.width=h-o,e.height=l-a}roundFrame(t,e,r,n,s){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(s){const{a:t,b:e,c:r,d:n}=s;if((Math.abs(e)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4))return}(s=s?$r.copyFrom(s):$r.identity()).translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}zr.extension={type:he.RendererSystem,name:"filter"},ue.add(zr);class qr{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=N.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Kr=new Ue;class Zr{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Or(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Ue,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;L.PREFER_ENV===b.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=r),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const r=t.colorTextures[e];this.renderer.texture.unbind(r.parentTextureArray||r)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>r,n=e.height>>r,s=t/e.width;this.setViewport(e.x*s,e.y*s,t,n)}else{const e=t.width>>r,n=t.height>>r;this.setViewport(0,0,e,n)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),(s.width!==r||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=r,s.height=n,this.gl.viewport(t,e,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,n,s=_.COLOR|_.DEPTH){const{gl:i}=this;i.clearColor(t,e,r,n),i.clear(s)}initFramebuffer(t){const{gl:e}=this,r=new qr(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){let n;e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),n=1===this.renderer.context.webGLVersion?e.DEPTH_STENCIL:t.depth&&t.stencil?e.DEPTH24_STENCIL8:t.depth?e.DEPTH_COMPONENT24:e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,n,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,n,t.width,t.height)}const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let i=0;i<s;i++){const s=n[i],o=s.parentTextureArray||s;this.renderer.texture.bind(o,0),0===i&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let i=s.length;r.drawBuffers||(i=Math.min(i,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const o=[];for(let a=0;a<i;a++){const i=s[a],h=i.parentTextureArray||i;this.renderer.texture.bind(h,0),0===a&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+a,i.target,h._glTextures[this.CONTEXT_UID].texture,e),o.push(r.COLOR_ATTACHMENT0+a))}if(o.length>1&&r.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const n=t.depthTexture;this.renderer.texture.bind(n,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n._glTextures[this.CONTEXT_UID].texture,e)}if(!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture)n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null);else{let e,s;n.stencil=n.stencil||r.createRenderbuffer(),1===this.renderer.context.webGLVersion?(e=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH_STENCIL):t.depth&&t.stencil?(e=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH24_STENCIL8):t.depth?(e=r.DEPTH_ATTACHMENT,s=r.DEPTH_COMPONENT24):(e=r.STENCIL_ATTACHMENT,s=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,s,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,s,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,e,r.RENDERBUFFER,n.stencil)}}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=N.NONE;if(t<=1||null===e)return r;for(let n=0;n<e.length;n++)if(e[n]<=t){r=e[n];break}return 1===r&&(r=N.NONE),r}blit(t,e,r){const{current:n,renderer:s,gl:i,CONTEXT_UID:o}=this;if(2!==s.context.webGLVersion||!n)return;const a=n.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=n.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new Or(n.width,n.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||((e=Kr).width=n.width,e.height=n.height),r||(r=e);const h=e.width===r.width&&e.height===r.height;this.bind(t),i.bindFramebuffer(i.READ_FRAMEBUFFER,a.framebuffer),i.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,i.COLOR_BUFFER_BIT,h?i.NEAREST:i.LINEAR),i.bindFramebuffer(i.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,n=t.height,s=this.gl,i=e.stencil=s.createRenderbuffer();let o,a;s.bindRenderbuffer(s.RENDERBUFFER,i),1===this.renderer.context.webGLVersion?(o=s.DEPTH_STENCIL_ATTACHMENT,a=s.DEPTH_STENCIL):t.depth?(o=s.DEPTH_STENCIL_ATTACHMENT,a=s.DEPTH24_STENCIL8):(o=s.STENCIL_ATTACHMENT,a=s.STENCIL_INDEX8),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,a,r,n):s.renderbufferStorage(s.RENDERBUFFER,a,r,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,o,s.RENDERBUFFER,i)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Ue}destroy(){this.renderer=null}}Zr.extension={type:he.RendererSystem,name:"framebuffer"},ue.add(Zr);const Qr={5126:4,5123:2,5121:1};class Jr{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;L.PREFER_ENV===b.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,r)=>e.vertexAttribDivisorANGLE(t,r),t.drawElementsInstanced=(t,r,n,s,i)=>e.drawElementsInstancedANGLE(t,r,n,s,i),t.drawArraysInstanced=(t,r,n,s)=>e.drawArraysInstancedANGLE(t,r,n,s)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const i=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==i&&(this._activeVao=i,this.hasVao?r.bindVertexArray(i):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];e.update(n)}}checkCompatibility(t,e){const r=t.attributes,n=e.attributeData;for(const t in n)if(!r[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const r=t.attributes,n=e.attributeData,s=["g",t.id];for(const t in r)n[t]&&s.push(t,n[t].location);return s.join("-")}initGeometryVao(t,e,r=!0){const n=this.gl,s=this.CONTEXT_UID,i=this.renderer.buffer,o=e.program;o.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[a];if(l)return h[o.id]=l,l;const c=t.buffers,u=t.attributes,d={},f={};for(const t in c)d[t]=0,f[t]=0;for(const t in u)!u[t].size&&o.attributeData[t]?u[t].size=o.attributeData[t].size:u[t].size||console.warn(`PIXI Geometry attribute '${t}' size cannot be determined (likely the bound shader does not have the attribute)`),d[u[t].buffer]+=u[t].size*Qr[u[t].type];for(const t in u){const e=u[t],r=e.size;void 0===e.stride&&(d[e.buffer]===r*Qr[e.type]?e.stride=0:e.stride=d[e.buffer]),void 0===e.start&&(e.start=f[e.buffer],f[e.buffer]+=r*Qr[e.type])}l=n.createVertexArray(),n.bindVertexArray(l);for(let t=0;t<c.length;t++){const e=c[t];i.bind(e),r&&e._glBuffers[s].refCount++}return this.activateVao(t,o),h[o.id]=l,h[a]=l,n.bindVertexArray(null),i.unbind(B.ARRAY_BUFFER),l}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,i=this.renderer?.buffer;if(t.disposeRunner.remove(this),r){if(i)for(let t=0;t<s.length;t++){const r=s[t]._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0===r.refCount&&!e&&i.dispose(s[t],e))}if(!e)for(const t in r)if("g"===t[0]){const e=r[t];this._activeVao===e&&this.unbind(),n.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,i=t.buffers,o=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let a=null;for(const t in o){const h=o[t],l=i[h.buffer],c=l._glBuffers[n];if(e.attributeData[t]){a!==c&&(s.bind(l),a=c);const n=e.attributeData[t].location;if(r.enableVertexAttribArray(n),r.vertexAttribPointer(n,h.size,h.type||r.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(n,h.divisor)}}}}draw(t,e,r,n){const{gl:s}=this,i=this._activeGeometry;if(i.indexBuffer){const o=i.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?s.UNSIGNED_SHORT:s.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?i.instanced?s.drawElementsInstanced(t,e||i.indexBuffer.data.length,a,(r||0)*o,n||1):s.drawElements(t,e||i.indexBuffer.data.length,a,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else i.instanced?s.drawArraysInstanced(t,r,e||i.getSize(),n||1):s.drawArrays(t,r,e||i.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Jr.extension={type:he.RendererSystem,name:"geometry"},ue.add(Jr);const tn=new We;class en{constructor(t,e){this._texture=t,this.mapCoord=new We,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],i=t[n+1];e[n]=s*r.a+i*r.c+r.tx,e[n+1]=s*r.b+i*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.orig,s=e.trim;s&&(tn.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(tn));const i=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/i.resolution,h=this.clampOffset;return o[0]=(e._frame.x+a+h)/i.width,o[1]=(e._frame.y+a+h)/i.height,o[2]=(e._frame.x+e._frame.width-a+h)/i.width,o[3]=(e._frame.y+e._frame.height-a+h)/i.height,this.uClampOffset[0]=h/i.realWidth,this.uClampOffset[1]=h/i.realHeight,this.isSimple=e._frame.width===i.width&&e._frame.height===i.height&&0===e.rotate,!0}}class rn extends Ir{constructor(t,e,r){let n=null;"string"!=typeof t&&void 0===e&&void 0===r&&(n=t,t=void 0,e=void 0,r=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",r),this.maskSprite=n,this.maskMatrix=new We}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,n){const s=this._maskSprite,i=s._texture;i.valid&&(i.uvMatrix||(i.uvMatrix=new en(i,0)),i.uvMatrix.update(),this.uniforms.npmAlpha=i.baseTexture.alphaMode?0:1,this.uniforms.mask=i,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(i.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=i.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))}}class nn{constructor(t=null){this.type=F.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ir.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=F.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class sn{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const t=this.maskDataPool.pop()||new nn;t.pooled=!0,t.maskObject=e,r=t}const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==F.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case F.SCISSOR:this.renderer.scissor.push(r);break;case F.STENCIL:this.renderer.stencil.push(r);break;case F.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case F.COLOR:this.pushColorMask(r)}r.type===F.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case F.SCISSOR:this.renderer.scissor.pop(e);break;case F.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case F.SPRITE:this.popSpriteMask(e);break;case F.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===F.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=F.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=F.SCISSOR:t.type=F.STENCIL:t.type=F.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new rn])),n[0].resolution=t.resolution,n[0].multisample=t.multisample,n[0].maskSprite=e;const s=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,n),r.filterArea=s,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))}destroy(){this.renderer=null}}sn.extension={type:he.RendererSystem,name:"mask"},ue.add(sn);class on{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==r&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const an=new We,hn=[],ln=class t extends on{constructor(t){super(t),this.glConst=L.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:n}=this,s=n.renderTexture,i=r.getBounds(!0,hn.pop()??new Ue);this.roundFrameToPixels(i,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),e&&i.fit(e),t._scissorRectLocal=i}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:n,d:s}=t;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(e){const{maskObject:r}=e;if(!r.isFastRect||!r.isFastRect()||t.isMatrixRotated(r.worldTransform)||t.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const n=e._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(e,r,n,s,i){t.isMatrixRotated(i)||((i=i?an.copyFrom(i):an.identity()).translate(-n.x,-n.y).scale(s.width/n.width,s.height/n.height).translate(s.x,s.y),this.renderer.filter.transformAABB(i,e),e.fit(s),e.x=Math.round(e.x*r),e.y=Math.round(e.y*r),e.width=Math.round(e.width*r),e.height=Math.round(e.height*r))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&hn.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};ln.extension={type:he.RendererSystem,name:"scissor"};let cn=ln;ue.add(cn);class un extends on{constructor(t){super(t),this.glConst=L.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;0!==s&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==s&&(t._colorMask=s,r.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;0!==n&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==n&&(r._colorMask=n,e.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}un.extension={type:he.RendererSystem,name:"stencil"},ue.add(un);class dn{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(ot("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(ot("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(ot("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}dn.extension={type:[he.RendererSystem,he.CanvasRendererSystem],name:"_plugin"},ue.add(dn);class fn{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new We,this.transform=null}update(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,r,n){const s=this.projectionMatrix,i=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=i*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-i-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}fn.extension={type:he.RendererSystem,name:"projection"},ue.add(fn);const pn=new rr,mn=new Ue;class gn{constructor(t){this.renderer=t,this._tempMatrix=new We}generateTexture(t,e){const{region:r,...n}=e||{},s=r?.copyTo(mn)||t.getLocalBounds(mn,!0),i=n.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/i),s.height=Math.max(s.height,1/i),n.width=s.width,n.height=s.height,n.resolution=i,n.multisample??(n.multisample=this.renderer.multisample);const o=Xr.create(n);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const a=t.transform;return t.transform=pn,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,o}destroy(){}}gn.extension={type:[he.RendererSystem,he.CanvasRendererSystem],name:"textureGenerator"},ue.add(gn);const yn=new Ue,bn=new Ue;class xn{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Ue,this.destinationFrame=new Ue,this.viewportFrame=new Ue}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const n=this.renderer;let s,i,o;this.current=t,t?(s=t.baseTexture,o=s.resolution,e||(yn.width=t.frame.width,yn.height=t.frame.height,e=yn),r||(bn.x=t.frame.x,bn.y=t.frame.y,bn.width=e.width,bn.height=e.height,r=bn),i=s.framebuffer):(o=n.resolution,e||(yn.width=n._view.screen.width,yn.height=n._view.screen.height,e=yn),r||((r=yn).width=e.width,r.height=e.height));const a=this.viewportFrame;a.x=r.x*o,a.y=r.y*o,a.width=r.width*o,a.height=r.height*o,t||(a.y=n.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(i,a),this.renderer.projection.update(r,e,o,!i),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=Xt.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,i=this.current?this.current.baseTexture:this.renderer._view.screen,o=s.width!==i.width||s.height!==i.height;if(o){let{x:t,y:e,width:r,height:n}=this.viewportFrame;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,r,n)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}xn.extension={type:he.RendererSystem,name:"renderTexture"},ue.add(xn);class _n{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function vn(t,e,r){const n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}function wn(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function En(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return wn(2*e);case"bvec3":return wn(3*e);case"bvec4":return wn(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function Tn(t,e){const r=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),n=t.getShaderInfoLog(e),s=n.split("\n"),i={},o=s.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||i[t]||(i[t]=!0,0)))),a=[""];o.forEach((t=>{r[t-1]=`%c${r[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=r.join("\n");a[0]=h,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function An(t,e,r,n,s){r.buffer.update(s)}const Sn={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},Rn={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let In,Mn=0;const Pn={textureCount:0,uboCount:0};class Cn{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Mn++}systemCheck(){if(!function(){if("boolean"==typeof In)return In;try{In=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{In=!1}return In}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(Pn.textureCount=0,Pn.uboCount=0,this.syncUniformGroup(t.uniformGroup,Pn)),n}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){const r=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const n in t.uniforms){const s=e[n];if(!s){!0===t.uniforms[n]?.group&&(t.uniforms[n].ubo?r.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');\n                    `):r.push(`\n                        renderer.shader.syncUniformGroup(uv.${n}, syncData);\n                    `));continue}const i=t.uniforms[n];let o=!1;for(let t=0;t<nr.length;t++)if(nr[t].test(s,i)){r.push(nr[t].code(n,i)),o=!0;break}if(!o){const t=(1!==s.size||s.isArray?ir:sr)[s.type].replace("location",`ud["${n}"].location`);r.push(`\n            cu = ud["${n}"];\n            cv = cu.value;\n            v = uv["${n}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",r.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||0!==t.dirtyId||!r.uniformGroups[t.id]){t.dirtyId=0;const n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,Pn,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const i=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[i];if(o||(o=this._uboCache[i]=function(t,e){if(!t.autoManage)return{size:0,syncFunc:An};const r=function(t,e){const r=[];for(const n in t)e[n]&&r.push(e[n]);return r.sort(((t,e)=>t.index-e.index)),r}(t.uniforms,e),{uboElements:n,size:s}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let r=0,n=0,s=0;for(let t=0;t<e.length;t++){const i=e[t];if(r=Rn[i.data.type],i.data.size>1&&(r=Math.max(r,16)*i.data.size),i.dataLen=r,n%r!=0&&n<16){const t=n%r%16;n+=t,s+=t}n+r>16?(s=16*Math.ceil(s/16),i.offset=s,s+=r,n=r):(i.offset=s,n+=r,s+=r)}return s=16*Math.ceil(s/16),{uboElements:e,size:s}}(r),i=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let e=0;e<n.length;e++){const r=n[e],s=t.uniforms[r.data.name],o=r.data.name;let a=!1;for(let t=0;t<nr.length;t++){const e=nr[t];if(e.codeUbo&&e.test(r.data,s)){i.push(`offset = ${r.offset/4};`,nr[t].codeUbo(r.data.name,s)),a=!0;break}}if(!a)if(r.data.size>1){const t=cr(r.data.type),e=Math.max(Rn[r.data.type]/16,1),n=t/e,s=(4-n%4)%4;i.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${r.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${r.data.size*e}; i++)\n                {\n                    for(var j = 0; j < ${n}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${s};\n                }\n\n                `)}else{const t=Sn[r.data.type];i.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${r.offset/4};\n                ${t};\n                `)}}return i.push("\n       renderer.buffer.update(buffer);\n    "),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",i.join("\n"))}}(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const n=t.uniforms,s=[`${r}-`];for(const t in n)s.push(t),e[t]&&s.push(e[t].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,n=function(t,e){const r=vn(t,t.VERTEX_SHADER,e.vertexSrc),n=vn(t,t.FRAGMENT_SHADER,e.fragmentSrc),s=t.createProgram();t.attachShader(s,r),t.attachShader(s,n);const i=e.extra?.transformFeedbackVaryings;if(i&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(s,i.names,"separate"===i.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||function(t,e,r,n){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||Tn(t,r),t.getShaderParameter(n,t.COMPILE_STATUS)||Tn(t,n),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,s,r,n),e.attributeData=function(t,e){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const n=e.getActiveAttrib(t,s);if(n.name.startsWith("gl_"))continue;const i=fr(e,n.type),o={type:i,name:n.name,size:cr(i),location:e.getAttribLocation(t,n.name)};r[n.name]=o}return r}(s,t),e.uniformData=function(t,e){const r={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<n;s++){const n=e.getActiveUniform(t,s),i=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),a=fr(e,n.type);r[i]={name:i,index:s,type:a,size:n.size,isArray:o,value:En(a,n.size)}}return r}(s,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const r=Object.keys(e.attributeData);r.sort(((t,e)=>t>e?1:-1));for(let n=0;n<r.length;n++)e.attributeData[r[n]].location=n,t.bindAttribLocation(s,n,r[n]);t.linkProgram(s)}t.deleteShader(r),t.deleteShader(n);const o={};for(const r in e.uniformData){const n=e.uniformData[r];o[r]={location:t.getUniformLocation(s,r),value:En(n.type,n.size)}}return new _n(s,o)}(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Cn.extension={type:he.RendererSystem,name:"shader"},ue.add(Cn);class kn{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}kn.defaultOptions={hello:!1},kn.extension={type:[he.RendererSystem,he.CanvasRendererSystem],name:"startup"},ue.add(kn);const On=class t{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=v.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new me,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[v.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.ADD]=[t.ONE,t.ONE],e[v.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.NONE]=[0,0],e[v.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[v.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[v.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[v.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[v.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[v.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[v.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[v.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[v.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[v.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[v.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):!e&&-1!==r&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};On.extension={type:he.RendererSystem,name:"state"};let Fn=On;ue.add(Fn);class Nn extends nt{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),r=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const e of r)this.addSystem(t.systems[e],e)}addRunners(...t){t.forEach((t=>{this.runners[t]=new be(t)}))}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const t in this.runners)this.runners[t].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach((n=>{const s=r.find((t=>this._systemsHash[t]===n));n[t.name](e[s])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const Bn=class t{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=t.defaultMaxIdle,this.checkCountMax=t.defaultCheckCountMax,this.mode=t.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==k.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let n=0;n<e.length;n++){const s=e[n];s.resource&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,r=!0)}if(r){let t=0;for(let r=0;r<e.length;r++)null!==e[r]&&(e[t++]=e[r]);e.length=t}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let e=t.children.length-1;e>=0;e--)this.unload(t.children[e])}destroy(){this.renderer=null}};Bn.defaultMode=k.AUTO,Bn.defaultMaxIdle=3600,Bn.defaultCheckCountMax=600,Bn.extension={type:he.RendererSystem,name:"textureGC"};let Dn=Bn;ue.add(Dn);class Ln{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=A.UNSIGNED_BYTE,this.internalFormat=E.RGBA,this.samplerType=0}}class Vn{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Ee,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[A.UNSIGNED_BYTE]:{[E.RGBA]:t.RGBA8,[E.RGB]:t.RGB8,[E.RG]:t.RG8,[E.RED]:t.R8,[E.RGBA_INTEGER]:t.RGBA8UI,[E.RGB_INTEGER]:t.RGB8UI,[E.RG_INTEGER]:t.RG8UI,[E.RED_INTEGER]:t.R8UI,[E.ALPHA]:t.ALPHA,[E.LUMINANCE]:t.LUMINANCE,[E.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[A.BYTE]:{[E.RGBA]:t.RGBA8_SNORM,[E.RGB]:t.RGB8_SNORM,[E.RG]:t.RG8_SNORM,[E.RED]:t.R8_SNORM,[E.RGBA_INTEGER]:t.RGBA8I,[E.RGB_INTEGER]:t.RGB8I,[E.RG_INTEGER]:t.RG8I,[E.RED_INTEGER]:t.R8I},[A.UNSIGNED_SHORT]:{[E.RGBA_INTEGER]:t.RGBA16UI,[E.RGB_INTEGER]:t.RGB16UI,[E.RG_INTEGER]:t.RG16UI,[E.RED_INTEGER]:t.R16UI,[E.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[A.SHORT]:{[E.RGBA_INTEGER]:t.RGBA16I,[E.RGB_INTEGER]:t.RGB16I,[E.RG_INTEGER]:t.RG16I,[E.RED_INTEGER]:t.R16I},[A.UNSIGNED_INT]:{[E.RGBA_INTEGER]:t.RGBA32UI,[E.RGB_INTEGER]:t.RGB32UI,[E.RG_INTEGER]:t.RG32UI,[E.RED_INTEGER]:t.R32UI,[E.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[A.INT]:{[E.RGBA_INTEGER]:t.RGBA32I,[E.RGB_INTEGER]:t.RGB32I,[E.RG_INTEGER]:t.RG32I,[E.RED_INTEGER]:t.R32I},[A.FLOAT]:{[E.RGBA]:t.RGBA32F,[E.RGB]:t.RGB32F,[E.RG]:t.RG32F,[E.RED]:t.R32F,[E.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[A.HALF_FLOAT]:{[E.RGBA]:t.RGBA16F,[E.RGB]:t.RGB16F,[E.RG]:t.RG16F,[E.RED]:t.R16F},[A.UNSIGNED_SHORT_5_6_5]:{[E.RGB]:t.RGB565},[A.UNSIGNED_SHORT_4_4_4_4]:{[E.RGBA]:t.RGBA4},[A.UNSIGNED_SHORT_5_5_5_1]:{[E.RGBA]:t.RGB5_A1},[A.UNSIGNED_INT_2_10_10_10_REV]:{[E.RGBA]:t.RGB10_A2,[E.RGBA_INTEGER]:t.RGB10_A2UI},[A.UNSIGNED_INT_10F_11F_11F_REV]:{[E.RGB]:t.R11F_G11F_B10F},[A.UNSIGNED_INT_5_9_9_9_REV]:{[E.RGB]:t.RGB9_E5},[A.UNSIGNED_INT_24_8]:{[E.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[A.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[E.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[A.UNSIGNED_BYTE]:{[E.RGBA]:t.RGBA,[E.RGB]:t.RGB,[E.ALPHA]:t.ALPHA,[E.LUMINANCE]:t.LUMINANCE,[E.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[A.UNSIGNED_SHORT_5_6_5]:{[E.RGB]:t.RGB},[A.UNSIGNED_SHORT_4_4_4_4]:{[E.RGBA]:t.RGBA},[A.UNSIGNED_SHORT_5_5_5_1]:{[E.RGBA]:t.RGBA}},e}(t),this.samplerTypes=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[t.RGB]:S.FLOAT,[t.RGBA]:S.FLOAT,[t.ALPHA]:S.FLOAT,[t.LUMINANCE]:S.FLOAT,[t.LUMINANCE_ALPHA]:S.FLOAT,[t.R8]:S.FLOAT,[t.R8_SNORM]:S.FLOAT,[t.RG8]:S.FLOAT,[t.RG8_SNORM]:S.FLOAT,[t.RGB8]:S.FLOAT,[t.RGB8_SNORM]:S.FLOAT,[t.RGB565]:S.FLOAT,[t.RGBA4]:S.FLOAT,[t.RGB5_A1]:S.FLOAT,[t.RGBA8]:S.FLOAT,[t.RGBA8_SNORM]:S.FLOAT,[t.RGB10_A2]:S.FLOAT,[t.RGB10_A2UI]:S.FLOAT,[t.SRGB8]:S.FLOAT,[t.SRGB8_ALPHA8]:S.FLOAT,[t.R16F]:S.FLOAT,[t.RG16F]:S.FLOAT,[t.RGB16F]:S.FLOAT,[t.RGBA16F]:S.FLOAT,[t.R32F]:S.FLOAT,[t.RG32F]:S.FLOAT,[t.RGB32F]:S.FLOAT,[t.RGBA32F]:S.FLOAT,[t.R11F_G11F_B10F]:S.FLOAT,[t.RGB9_E5]:S.FLOAT,[t.R8I]:S.INT,[t.R8UI]:S.UINT,[t.R16I]:S.INT,[t.R16UI]:S.UINT,[t.R32I]:S.INT,[t.R32UI]:S.UINT,[t.RG8I]:S.INT,[t.RG8UI]:S.UINT,[t.RG16I]:S.INT,[t.RG16UI]:S.UINT,[t.RG32I]:S.INT,[t.RG32UI]:S.UINT,[t.RGB8I]:S.INT,[t.RGB8UI]:S.UINT,[t.RGB16I]:S.INT,[t.RGB16UI]:S.UINT,[t.RGB32I]:S.INT,[t.RGB32UI]:S.UINT,[t.RGBA8I]:S.INT,[t.RGBA8UI]:S.UINT,[t.RGBA16I]:S.INT,[t.RGBA16UI]:S.UINT,[t.RGBA32I]:S.INT,[t.RGBA32UI]:S.UINT,[t.DEPTH_COMPONENT16]:S.FLOAT,[t.DEPTH_COMPONENT24]:S.FLOAT,[t.DEPTH_COMPONENT32F]:S.FLOAT,[t.DEPTH_STENCIL]:S.FLOAT,[t.DEPTH24_STENCIL8]:S.FLOAT,[t.DEPTH32F_STENCIL8]:S.FLOAT}:{[t.RGB]:S.FLOAT,[t.RGBA]:S.FLOAT,[t.ALPHA]:S.FLOAT,[t.LUMINANCE]:S.FLOAT,[t.LUMINANCE_ALPHA]:S.FLOAT,[t.DEPTH_STENCIL]:S.FLOAT},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let t=0;t<e;t++)this.boundTextures[t]=null;this.emptyTextures={};const r=new Ln(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Ln(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t=0;t<this.boundTextures.length;t++)this.bind(null,t)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<r.length;t++)r[t]===this.unknownTexture&&this.bind(null,t)}for(let n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(r)for(let r=t-1;r>=0;--r){const t=e[r];t&&t._glTextures[n].samplerType!==S.FLOAT&&this.renderer.texture.unbind(t)}}initTexture(t){const e=new Ln(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??S.FLOAT,2===this.webGLVersion&&t.type===A.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==S.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,s=t.realHeight,i=r.gl;(e.width!==n||e.height!==s||e.dirtyId<0)&&(e.width=n,e.height=s,i.texImage2D(t.target,0,e.internalFormat,n,s,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&qt(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==M.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=I.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==M.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===R.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===R.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===R.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===R.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}Vn.extension={type:he.RendererSystem,name:"texture"},ue.add(Vn);class Un{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:n}=this;e&&n.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let s=0;s<t.buffers.length;s++){const i=t.buffers[s];i&&(r.buffer.update(i),i._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,s,i._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];if(!n)continue;const i=n._glBuffers[this.CONTEXT_UID];i&&(i.refCount--,0===i.refCount&&!e&&s.dispose(n,e))}r&&(e||n.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Un.extension={type:he.RendererSystem,name:"transformFeedback"},ue.add(Un);class Xn{constructor(t){this.renderer=t}init(t){this.screen=new Ue(0,0,t.width,t.height),this.element=t.view||L.ADAPTER.createCanvas(),this.resolution=t.resolution||L.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Xn.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Xn.extension={type:[he.RendererSystem,he.CanvasRendererSystem],name:"_view"},ue.add(Xn),L.PREFER_ENV=b.WEBGL2,L.STRICT_TEXTURE_CACHE=!1,L.RENDER_OPTIONS={...kr.defaultOptions,...Mr.defaultOptions,...Xn.defaultOptions,...kn.defaultOptions},Object.defineProperties(L,{WRAP_MODE:{get:()=>Ee.defaultOptions.wrapMode,set(t){ot("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Ee.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>Ee.defaultOptions.scaleMode,set(t){ot("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Ee.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>Ee.defaultOptions.mipmap,set(t){ot("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Ee.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>Ee.defaultOptions.anisotropicLevel,set(t){ot("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Ee.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(ot("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ir.defaultResolution),set(t){Ir.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(ot("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ir.defaultMultisample),set(t){Ir.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>Sr.defaultMaxTextures,set(t){ot("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Sr.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>Sr.defaultBatchSize,set(t){ot("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Sr.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>Sr.canUploadSameBuffer,set(t){ot("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Sr.canUploadSameBuffer=t}},GC_MODE:{get:()=>Dn.defaultMode,set(t){ot("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Dn.defaultMode=t}},GC_MAX_IDLE:{get:()=>Dn.defaultMaxIdle,set(t){ot("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Dn.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>Dn.defaultCheckCountMax,set(t){ot("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Dn.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>br.defaultVertexPrecision,set(t){ot("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),br.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>br.defaultFragmentPrecision,set(t){ot("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),br.defaultFragmentPrecision=t}}});var jn=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(jn||{});class Yn{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Gn=class t{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Yn(null,null,1/0),this.deltaMS=1/t.targetFPMS,this.elapsedMS=1/t.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=jn.NORMAL){return this._addListener(new Yn(t,e,r))}addOnce(t,e,r=jn.NORMAL){return this._addListener(new Yn(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let r;if(e>this.lastTime){if(r=this.elapsedMS=e-this.lastTime,r>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){const t=e-this._lastFrame|0;if(t<this._minElapsedMS)return;this._lastFrame=e-t%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*t.targetFPMS;const n=this._head;let s=n.next;for(;s;)s=s.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const r=Math.min(this.maxFPS,e),n=Math.min(Math.max(0,r)/1e3,t.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!t._shared){const e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared}static get system(){if(!t._system){const e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system}};Gn.targetFPMS=.06;let Wn=Gn;Object.defineProperties(L,{TARGET_FPMS:{get:()=>Wn.targetFPMS,set(t){ot("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Wn.targetFPMS=t}}});class Hn{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,jn.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Wn.shared:new Wn,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Hn.extension=he.Application,ue.add(Hn);const $n=[];ue.handleByList(he.Renderer,$n);const zn="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class qn{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=N.HIGH?this.multisample=N.HIGH:e>=N.MEDIUM?this.multisample=N.MEDIUM:e>=N.LOW?this.multisample=N.LOW:this.multisample=N.NONE}destroy(){}}qn.extension={type:he.RendererSystem,name:"_multisample"},ue.add(qn);class Kn{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Zn{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,r){const{gl:n,CONTEXT_UID:s}=this;r=r||0;const i=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,i.buffer,256*r,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new Kn(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Zn.extension={type:he.RendererSystem,name:"buffer"},ue.add(Zn);class Qn{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let n,s,i,o;if(e&&(n=e.renderTexture,s=e.clear,i=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=i,!r.context.isLost){if(n||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(s??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),n&&(e.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Qn.extension={type:he.RendererSystem,name:"objectRenderer"},ue.add(Qn);const Jn=class t extends Nn{constructor(e){super(),this.type=x.WEBGL,e=Object.assign({},L.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new _r({projectionMatrix:new We},!0);const r={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:t.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(r),"useContextAlpha"in e&&(ot("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&"notMultiplied"!==e.useContextAlpha,e.backgroundAlpha=!1===e.useContextAlpha?1:e.backgroundAlpha),this._plugin.rendererPlugins=t.__plugins,this.options=e,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&(typeof ut>"u"&&(ut=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:L.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!L.ADAPTER.getWebGLRenderingContext())return!1;const e=L.ADAPTER.createCanvas();let r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!!r?.getContextAttributes()?.stencil;if(r){const t=r.getExtension("WEBGL_lose_context");t&&t.loseContext()}return r=null,n}catch{return!1}}()),ut)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return ot("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return ot("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return ot("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return ot("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){ot("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return ot("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){ot("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return ot("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Jn.extension={type:he.Renderer,priority:1},Jn.__plugins={},Jn.__systems={};let ts=Jn;ue.handleByMap(he.RendererPlugin,ts.__plugins),ue.handleByMap(he.RendererSystem,ts.__systems),ue.add(ts);class es extends xe{constructor(t,e){const{width:r,height:n}=e||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let e=0;e<t;e++){const t=new Ee;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof xe?this.addResourceAt(t[r],r):this.addResourceAt(ye(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),this.update(),Promise.resolve(this)})),this._load}}const rs=class t extends es{constructor(e,r){const{width:n,height:s,autoLoad:i,linkBaseTexture:o}=r||{};if(e&&e.length!==t.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:n,height:s});for(let e=0;e<t.SIDES;e++)this.items[e].target=T.TEXTURE_CUBE_MAP_POSITIVE_X+e;this.linkBaseTexture=!1!==o,e&&this.initFromArray(e,r),!1!==i&&this.load()}bind(t){super.bind(t),t.target=T.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(void 0===r&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=T.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(e,r,n){const s=this.itemDirtyIds;for(let i=0;i<t.SIDES;i++){const t=this.items[i];(s[i]<t.dirtyId||n.dirtyId<r.dirtyId)&&(t.valid&&t.resource?(t.resource.upload(e,t,n),s[i]=t.dirtyId):s[i]<-1&&(e.gl.texImage2D(t.target,0,n.internalFormat,r.realWidth,r.realHeight,0,r.format,n.type,null),s[i]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===t.SIDES}};rs.SIDES=6;let ns=rs;class ss extends Nr{constructor(t,e){let r,n,s;e=e||{},"string"==typeof t?(r=ss.EMPTY,n=t,s=!0):(r=t,n=null,s=!1),super(r),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??s,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await L.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await e.blob();if(this.destroyed)return;const n=await createImageBitmap(r,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===P.UNPACK?"premultiply":"none"});if(this.destroyed)return void n.close();this.source=n,this.update(),t(this)}catch(t){if(this.destroyed)return;e(t),this.onError.emit(t)}else t(this)}))),this._load}upload(t,e,r){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return ss._EMPTY=ss._EMPTY??L.ADAPTER.createCanvas(0,0),ss._EMPTY}}const is=class t extends Nr{constructor(t,e){e=e||{},super(L.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((e=>{if(this._resolve=()=>{this.update(),e(this)},t.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Nr.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,s=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/r*e,s=this._overrideHeight||this._overrideWidth/e*r),n=Math.round(n),s=Math.round(s);const i=this.source;i.width=n,i.height=s,i._pixiId=`canvas_${Qt()}`,i.getContext("2d").drawImage(t,0,0,e,r,0,0,n,s),this._resolve(),this._resolve=null}}static getSize(e){const r=t.SVG_SIZE.exec(e),n={};return r&&(n[r[1]]=Math.round(parseFloat(r[3])),n[r[5]]=Math.round(parseFloat(r[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,r){return"svg"===r||"string"==typeof e&&e.startsWith("data:image/svg+xml")||"string"==typeof e&&t.SVG_XML.test(e)}};is.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,is.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let os=is;const as=class t extends Nr{constructor(e,r){if(r=r||{},!(e instanceof HTMLVideoElement)){const n=document.createElement("video");!1!==r.autoLoad&&n.setAttribute("preload","auto"),!1!==r.playsinline&&(n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline","")),!0===r.muted&&(n.setAttribute("muted",""),n.muted=!0),!0===r.loop&&n.setAttribute("loop",""),!1!==r.autoPlay&&n.setAttribute("autoplay",""),"string"==typeof e&&(e=[e]);const s=e[0].src||e[0];Nr.crossOrigin(n,s,r.crossorigin);for(let r=0;r<e.length;++r){const s=document.createElement("source");let{src:i,mime:o}=e[r];if(i=i||e[r],i.startsWith("data:"))o=i.slice(5,i.indexOf(";"));else if(!i.startsWith("blob:")){const e=i.split("?").shift().toLowerCase(),r=e.slice(e.lastIndexOf(".")+1);o=o||t.MIME_TYPES[r]||`video/${r}`}s.src=i,o&&(s.type=o),n.appendChild(s)}e=n}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=r.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==r.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==r.autoLoad&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const t=Wn.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Wn.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Wn.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Wn.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,r){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||t.TYPES.includes(r)}};as.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],as.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let hs=as;ge.push(ss,Br,class extends Nr{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},hs,os,_e,ns,class extends es{constructor(t,e){const{width:r,height:n}=e||{};let s,i;Array.isArray(t)?(s=t,i=t.length):i=t,super(i,{width:r,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=T.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:n,itemDirtyIds:s,items:i}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,e.format,r.type,null);for(let t=0;t<n;t++){const n=i[t];s[t]<n.dirtyId&&(s[t]=n.dirtyId,n.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,t,n.resource.width,n.resource.height,1,e.format,r.type,n.resource.source))}return!0}});class ls{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Ue.EMPTY:((t=t||new Ue(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:n,c:s,d:i,tx:o,ty:a}=t,h=r*e.x+s*e.y+o,l=n*e.x+i*e.y+a;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,r=this.minY,n=this.maxX,s=this.maxY,i=t[0],o=t[1];e=i<e?i:e,r=o<r?o:r,n=i>n?i:n,s=o>s?o:s,i=t[2],o=t[3],e=i<e?i:e,r=o<r?o:r,n=i>n?i:n,s=o>s?o:s,i=t[4],o=t[5],e=i<e?i:e,r=o<r?o:r,n=i>n?i:n,s=o>s?o:s,i=t[6],o=t[7],e=i<e?i:e,r=o<r?o:r,n=i>n?i:n,s=o>s?o:s,this.minX=e,this.minY=r,this.maxX=n,this.maxY=s}addFrame(t,e,r,n,s){this.addFrameMatrix(t.worldTransform,e,r,n,s)}addFrameMatrix(t,e,r,n,s){const i=t.a,o=t.b,a=t.c,h=t.d,l=t.tx,c=t.ty;let u=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=i*e+a*r+l,g=o*e+h*r+c;u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=i*n+a*r+l,g=o*n+h*r+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=i*e+a*s+l,g=o*e+h*s+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=i*n+a*s+l,g=o*n+h*s+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,this.minX=u,this.minY=d,this.maxX=f,this.maxY=p}addVertexData(t,e,r){let n=this.minX,s=this.minY,i=this.maxX,o=this.maxY;for(let a=e;a<r;a+=2){const e=t[a],r=t[a+1];n=e<n?e:n,s=r<s?r:s,i=e>i?e:i,o=r>o?r:o}this.minX=n,this.minY=s,this.maxX=i,this.maxY=o}addVertices(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)}addVerticesMatrix(t,e,r,n,s=0,i=s){const o=t.a,a=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY;for(let t=r;t<n;t+=2){const r=e[t],n=e[t+1],g=o*r+h*n+c,y=l*n+a*r+u;d=Math.min(d,g-s),p=Math.max(p,g+s),f=Math.min(f,y-i),m=Math.max(m,y+i)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addBounds(t){const e=this.minX,r=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,i=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=s&&n<=i){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=n<e?n:e,this.maxX=s>o?s:o,this.maxY=i>a?i:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,i=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=s&&n<=i){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=n<e?n:e,this.maxX=s>o?s:o,this.maxY=i>a?i:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,n,s,i){t-=s,e-=i,r+=s,n+=i,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class cs extends nt{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new rr,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ls,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const n=e[r];Object.defineProperty(cs.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Ue),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Ue),t=this._localBoundsRect),this._localBounds||(this._localBounds=new ls);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=r?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const i=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,i}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,n=1,s=0,i=0,o=0,a=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=s,this.skew.x=i,this.skew.y=o,this.pivot.x=a,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new us),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Ne}set angle(t){this.transform.rotation=t*Be}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class us extends cs{constructor(){super(...arguments),this.sortDirty=null}}cs.prototype.displayObjectUpdateTransform=cs.prototype.updateTransform;const ds=new We;function fs(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const ps=class t extends cs{constructor(){super(),this.children=[],this.sortableChildren=t.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);qt(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(-1===r)return null;e.parent=null,e.transform._parentID=-1,qt(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,qt(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,n=e-r;let s;if(n>0&&n<=e){s=this.children.splice(r,n);for(let t=0;t<s.length;++t)s[t].parent=null,s[t].transform&&(s[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<s.length;++t)s[t].emit("removed",this),this.emit("childRemoved",s[t],this,t);return s}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const r=this.children[e];r._lastSortedIndex=e,!t&&0!==r.zIndex&&(t=!0)}t&&this.children.length>1&&this.children.sort(fs),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const r=e.renderTexture.sourceFrame;if(!(r.width>0&&r.height>0))return;let n,s;this.cullArea?(n=this.cullArea,s=this.worldTransform):this._render!==t.prototype._render&&(n=this.getBounds(!0));const i=e.projection.transform;if(i&&(s?(s=ds.copyFrom(s),s.prepend(i)):s=i),n&&r.intersects(n,s))this._render(e);else if(this.cullArea)return;for(let t=0,r=this.children.length;t<r;++t){const r=this.children[t],n=r.cullable;r.cullable=n||!this.cullArea,r.render(e),r.cullable=n}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const n=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==F.NONE));if(n&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}n&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let e=0;e<r.length;++e)r[e].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};ps.defaultSortableChildren=!1;let ms=ps;ms.prototype.containerUpdateTransform=ms.prototype.updateTransform,Object.defineProperties(L,{SORTABLE_CHILDREN:{get:()=>ms.defaultSortableChildren,set(t){ot("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ms.defaultSortableChildren=t}}});const gs=new Le,ys=new Uint16Array([0,1,2,0,2,3]);class bs extends ms{constructor(t){super(),this._anchor=new tr(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Xt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=v.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Ur.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=ys,this.pluginName="batch",this.isSprite=!0,this._roundPixels=L.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Kt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Kt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,i=e.d,o=e.tx,a=e.ty,h=this.vertexData,l=t.trim,c=t.orig,u=this._anchor;let d=0,f=0,p=0,m=0;if(l?(f=l.x-u._x*c.width,d=f+l.width,m=l.y-u._y*c.height,p=m+l.height):(f=-u._x*c.width,d=f+c.width,m=-u._y*c.height,p=m+c.height),h[0]=r*f+s*m+o,h[1]=i*m+n*f+a,h[2]=r*d+s*m+o,h[3]=i*m+n*d+a,h[4]=r*d+s*p+o,h[5]=i*p+n*d+a,h[6]=r*f+s*p+o,h[7]=i*p+n*f+a,this._roundPixels){const t=L.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,s=this.transform.worldTransform,i=s.a,o=s.b,a=s.c,h=s.d,l=s.tx,c=s.ty,u=-n._x*r.width,d=u+r.width,f=-n._y*r.height,p=f+r.height;if(e[0]=i*u+a*f+l,e[1]=h*f+o*u+c,e[2]=i*d+a*f+l,e[3]=h*f+o*d+c,e[4]=i*d+a*p+l,e[5]=h*p+o*d+c,e[6]=i*u+a*p+l,e[7]=h*p+o*u+c,this._roundPixels){const t=L.RESOLUTION;for(let r=0;r<e.length;++r)e[r]=Math.round(e[r]*t)/t}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new ls),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Ue),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,gs);const e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return gs.x>=n&&gs.x<n+e&&(s=-r*this.anchor.y,gs.y>=s&&gs.y<s+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof Ur?t:Ur.from(t,e);return new bs(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Kt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Kt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Ur.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const xs=new We;cs.prototype._cacheAsBitmap=!1,cs.prototype._cacheData=null,cs.prototype._cacheAsBitmapResolution=null,cs.prototype._cacheAsBitmapMultisample=null;class _s{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(cs.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new _s),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),cs.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},cs.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(new Ue,!0);if(this.filters?.length){const t=this.filters[0].padding;r.pad(t)}const n=this.cacheAsBitmapResolution||t.resolution;r.ceil(n),r.width=Math.max(r.width,1/n),r.height=Math.max(r.height,1/n);const s=t.renderTexture.current,i=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,h=Xr.create({width:r.width,height:r.height,resolution:n,multisample:this.cacheAsBitmapMultisample??t.multisample}),l=`cacheAsBitmap_${Qt()}`;this._cacheData.textureCacheId=l,Ee.addToCache(h.baseTexture,l),Ur.addToCache(h,l);const c=this.transform.localTransform.copyTo(xs).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(s,i,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const u=new bs(h);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-r.x/r.width,u.anchor.y=-r.y/r.height,u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},cs.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},cs.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(new Ue,!0),r=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,s=t._projTransform,i=this.cacheAsBitmapResolution||t.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);const o=Xr.create({width:e.width,height:e.height,resolution:i}),a=`cacheAsBitmap_${Qt()}`;this._cacheData.textureCacheId=a,Ee.addToCache(o.baseTexture,a),Ur.addToCache(o,a);const h=xs;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=e.x,h.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const l=new bs(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-e.x/e.width,l.anchor.y=-e.y/e.height,l.alpha=r,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)},cs.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},cs.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},cs.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Ee.removeFromCache(this._cacheData.textureCacheId),Ur.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},cs.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},cs.prototype.name=null,ms.prototype.getChildByName=function(t,e){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===t)return this.children[e];if(e)for(let e=0,r=this.children.length;e<r;e++){const r=this.children[e];if(!r.getChildByName)continue;const n=r.getChildByName(t,!0);if(n)return n}return null},cs.prototype.getGlobalPosition=function(t=new Le,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const vs={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},ws=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class Es extends Ir{constructor(t,e=8,r=4,n=Ir.defaultResolution,s=5){const i=function(t,e){const r=Math.ceil(t/2);let n,s="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",i="";n=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let e=0;e<t;e++){let t=n.replace("%index%",e.toString());t=t.replace("%sampleIndex%",e-(r-1)+".0"),i+=t,i+="\n"}return s=s.replace("%blur%",i),s=s.replace("%size%",t.toString()),s}(s,t),o=function(t){const e=vs[t],r=e.length;let n,s=ws,i="";for(let s=0;s<t;s++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s.toString());n=s,s>=r&&(n=t-s-1),o=o.replace("%value%",e[n].toString()),i+=o,i+="\n"}return s=s.replace("%blur%",i),s=s.replace("%size%",t.toString()),s}(s);super(i,o),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,n);else{const s=t.getFilterTexture(),i=t.renderer;let o=e,a=s;this.state.blend=!1,t.applyFilter(this,o,a,C.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,C.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,i.shader.bind(this),i.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,r,n),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class Ts extends Ir{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(zn,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,n,s]=Xt.shared.setValue(t).toArray(),i=[r,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(i,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),n=Math.sin(t),s=1/3,i=(0,Math.sqrt)(s),o=[r+(1-r)*s,s*(1-r)-i*n,s*(1-r)+i*n,0,0,s*(1-r)+i*n,r+s*(1-r),s*(1-r)-i*n,0,0,s*(1-r)-i*n,s*(1-r)+i*n,r+s*(1-r),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const r=(t||0)+1,n=-.5*(r-1),s=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const r=2*t/3+1,n=-.5*(r-1),s=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,r,n,s){t=t||.2,e=e||.15,r=r||16770432,n=n||3375104;const i=Xt.shared,[o,a,h]=i.setValue(r).toArray(),[l,c,u]=i.setValue(n).toArray(),d=[.3,.59,.11,0,0,o,a,h,t,0,l,c,u,e,0,o-l,a-c,h-u,0,0];this._loadMatrix(d,s)}night(t,e){const r=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Ts.prototype.grayscale=Ts.prototype.greyscale;class As extends Ir{constructor(t,e){const r=new We;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,null==e&&(e=20),this.scale=new Le(e,e)}apply(t,e,r,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,i=Math.sqrt(s.a*s.a+s.b*s.b),o=Math.sqrt(s.c*s.c+s.d*s.d);0!==i&&0!==o&&(this.uniforms.rotation[0]=s.a/i,this.uniforms.rotation[1]=s.b/i,this.uniforms.rotation[2]=s.c/o,this.uniforms.rotation[3]=s.d/o),t.applyFilter(this,e,r,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}const Ss={AlphaFilter:class extends Ir{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends Ir{constructor(t=8,e=4,r=Ir.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Es(!0,t,e,r,n),this.blurYFilter=new Es(!1,t,e,r,n),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,n){const s=Math.abs(this.blurXFilter.strength),i=Math.abs(this.blurYFilter.strength);if(s&&i){const s=t.getFilterTexture();this.blurXFilter.apply(t,e,s,C.CLEAR),this.blurYFilter.apply(t,s,r,n),t.returnFilterTexture(s)}else i?this.blurYFilter.apply(t,e,r,n):this.blurXFilter.apply(t,e,r,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:Es,ColorMatrixFilter:Ts,DisplacementFilter:As,FXAAFilter:class extends Ir{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends Ir{constructor(t=.5,e=Math.random()){super(zn,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(Ss).forEach((([t,e])=>{Object.defineProperty(Ss,t,{get:()=>(ot("7.1.0",`filters.${t} has moved to ${t}`),e)})}));const Rs=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Wn.system.add(this.tickerUpdate,this,jn.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Wn.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class Is{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Is.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Le,this.page=new Le,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Ms extends Is{constructor(){super(...arguments),this.client=new Le,this.movement=new Le,this.offset=new Le,this.global=new Le,this.screen=new Le}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,n,s,i,o,a,h,l,c,u,d,f,p){throw new Error("Method not implemented.")}}class Ps extends Ms{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Cs extends Ms{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Cs.DOM_DELTA_PIXEL=0,Cs.DOM_DELTA_LINE=1,Cs.DOM_DELTA_PAGE=2;const ks=new Le,Os=new Le;class Fs{constructor(t){this.dispatch=new nt,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,n=e.length;r<n;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Rs.pauseUpdate=!0;const r=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,ks.set(t,e),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=r.length-1;n<s;n++)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(0===r.length)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let e=r.length-1;e>=0;e--)n.forEach((n=>{t.currentTarget=r[e],this.notifyTarget(t,n)}))}propagationPath(t){const e=[t];for(let r=0;r<2048&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,n,s,i=!1){let o=!1;if(this._interactivePrune(t))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(Rs.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let h=a.length-1;h>=0;h--){const l=a[h],c=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,r,n,s,i||s(t,r));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const e=t.isInteractive();(c.length>0||e)&&(e&&this._allInteractiveElements.push(t),c.push(t)),0===this._hitElements.length&&(this._hitElements=c),o=!0}}}const a=this._isInteractive(e),h=t.isInteractive();return a&&h&&this._allInteractiveElements.push(t),i||this._hitElements.length>0?null:o?this._hitElements:a&&!s(t,r)&&n(t,r)?h?[t]:[]:null}hitTestRecursive(t,e,r,n,s){if(this._interactivePrune(t)||s(t,r))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(Rs.pauseUpdate=!1),t.interactiveChildren&&t.children){const i=t.children;for(let o=i.length-1;o>=0;o--){const a=i[o],h=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,r,n,s);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const e=t.isInteractive();return(h.length>0||e)&&h.push(t),h}}}const i=this._isInteractive(e),o=t.isInteractive();return i&&n(t,r)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable&&"none"!==t.eventMode&&("passive"!==t.eventMode||t.interactiveChildren)&&!t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Os),!t.hitArea.contains(Os.x,Os.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!r.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){const r=`on${e=e??t.type}`;t.currentTarget[r]?.(t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Ps))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Ps))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r="mouse"===e.pointerType||"pen"===e.pointerType,n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(n.overTargets?.length>0&&s!==e.target){const n="mousemove"===t.type?"mouseout":"pointerout",i=this.createPointerEvent(t,n,s);if(this.dispatchEvent(i,"pointerout"),r&&this.dispatchEvent(i,"mouseout"),!e.composedPath().includes(s)){const n=this.createPointerEvent(t,"pointerleave",s);for(n.eventPhase=n.AT_TARGET;n.target&&!e.composedPath().includes(n.target);)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;this.freeEvent(n)}this.freeEvent(i)}if(s!==e.target){const n="mousemove"===t.type?"mouseover":"pointerover",i=this.clonePointerEvent(e,n);this.dispatchEvent(i,"pointerover"),r&&this.dispatchEvent(i,"mouseover");let o=s?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==s&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),r&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(i)}const i=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?i.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&i.push("globalpointermove"),"touch"===e.pointerType&&(this.moveOnAll?i.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&i.push("globaltouchmove")),r&&(this.moveOnAll?i.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&i.push("globalmousemove"),this.cursor=e.target?.cursor),i.length>0&&this.all(e,i),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Ps))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n="mouse"===r.pointerType||"pen"===r.pointerType;this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursor=r.target?.cursor);const s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof Ps))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const r="mouse"===t.pointerType||"pen"===t.pointerType,n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");const i=this.createPointerEvent(t,"pointerleave",n);for(i.eventPhase=i.AT_TARGET;i.target&&i.target!==this.rootTarget.parent;)i.currentTarget=i.target,this.notifyTarget(i),r&&this.notifyTarget(i,"mouseleave"),i.target=i.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(i)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Ps))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),"touch"===r.pointerType)this.dispatchEvent(r,"touchend");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let i=s;if(s&&!r.composedPath().includes(s)){let e=s;for(;e&&!r.composedPath().includes(e);){if(r.currentTarget=e,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType)this.notifyTarget(r,"touchendoutside");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.notifyTarget(r,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete n.pressTargetsByButton[t.button],i=e}if(i){const s=this.clonePointerEvent(r,"click");s.target=i,s.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:s.target,timeStamp:e});const o=n.clicksByButton[t.button];if(o.target===s.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=s.target,o.timeStamp=e,s.detail=o.clickCount,"mouse"===s.pointerType){const t=2===s.button;this.dispatchEvent(s,t?"rightclick":"click")}else"touch"===s.pointerType&&this.dispatchEvent(s,"tap");this.dispatchEvent(s,"pointertap"),this.freeEvent(s)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Ps))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(r){let s=r;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):("mouse"===n.pointerType||"pen"===n.pointerType)&&this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Cs))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const n=this.allocateEvent(Ps);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=r??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],"string"==typeof e&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Cs);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(Ps);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Ps&&e instanceof Ps&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Ms&&e instanceof Ms&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let n=0,s=r.length;n<s&&!t.propagationImmediatelyStopped;n++)r[n].once&&t.currentTarget.removeListener(e,r[n].fn,void 0,!0),r[n].fn.call(r[n].context,t)}}const Ns={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Bs=class t{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new Fs(null),Rs.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Ps(null),this.rootWheelEvent=new Cs(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...t.defaultEventFeatures},{set:(t,e,r)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=r),t[e]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:r,resolution:n}=this.renderer;this.setTargetElement(r),this.resolution=n,t._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,r=e.length;t<r;t++){const r=e[t],n=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Rs.pointerMoved();const e=this.normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let t=0,e=n.length;t<e;t++){const e=this.bootstrapEvent(this.rootPointerEvent,n[t]);e.type+=r,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Rs.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Rs.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Rs.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(r-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,n=t.changedTouches.length;r<n;r++){const n=t.changedTouches[r];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof globalThis.PointerEvent)){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=1),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Ns[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};Bs.extension={name:"events",type:[he.RendererSystem,he.CanvasRendererSystem]},Bs.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Ds=Bs;function Ls(t){return"dynamic"===t||"static"===t}ue.add(Ds);const Vs={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Ls(Ds.defaultEventMode)},set interactive(t){ot("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Ds.defaultEventMode},set eventMode(t){this._internalInteractive=Ls(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,r){const n="function"==typeof e?void 0:e;t="boolean"==typeof r&&r||"object"==typeof r&&r.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,n)},removeEventListener(t,e,r){const n="function"==typeof e?void 0:e;t="boolean"==typeof r&&r||"object"==typeof r&&r.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,n)},dispatchEvent(t){if(!(t instanceof Is))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};cs.mixin(Vs),cs.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Us{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(rt.tablet||rt.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this.updateAccessibleObjects(e[t])}update(){const t=performance.now();if(rt.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:i,height:o,resolution:a}=this.renderer,h=n/i*a,l=s/o*a;let c=this.div;c.style.left=`${e}px`,c.style.top=`${r}px`,c.style.width=`${i}px`,c.style.height=`${o}px`;for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.renderId!==this.renderId)e._accessibleActive=!1,qt(this.children,t,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{c=e._accessibleDiv;let t=e.hitArea;const r=e.worldTransform;e.hitArea?(c.style.left=(r.tx+t.x*r.a)*h+"px",c.style.top=(r.ty+t.y*r.d)*l+"px",c.style.width=t.width*r.a*h+"px",c.style.height=t.height*r.d*l+"px"):(t=e.getBounds(),this.capHitArea(t),c.style.left=t.x*h+"px",c.style.top=t.y*l+"px",c.style.width=t.width*h+"px",c.style.height=t.height*l+"px",c.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(c.title=e.accessibleTitle),c.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&c.setAttribute("aria-label",e.accessibleHint)),(e.accessibleTitle!==c.title||e.tabIndex!==c.tabIndex)&&(c.title=e.accessibleTitle,c.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:(!t.accessibleHint||null===t.accessibleHint)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new Is(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>n.dispatchEvent(s,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Us.extension={name:"accessibility",type:[he.RendererPlugin,he.CanvasRendererPlugin]},ue.add(Us);const Xs=class t{constructor(e){this.stage=new ms,e=Object.assign({forceCanvas:!1},e),this.renderer=function(t){for(const e of $n)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(e),t._plugins.forEach((t=>{t.init.call(this,e)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(e,r){const n=t._plugins.slice(0);n.reverse(),n.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Xs._plugins=[];let js=Xs;ue.handleByList(he.Application,js._plugins);class Ys{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:n}=this._resizeTo;t=r,e=n}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Ys.extension=he.Application,ue.add(Ys);const Gs={loader:he.LoadParser,resolver:he.ResolveParser,cache:he.CacheParser,detection:he.DetectionParser};ue.handle(he.Asset,(t=>{const e=t.ref;Object.entries(Gs).filter((([t])=>!!e[t])).forEach((([t,r])=>ue.add(Object.assign(e[t],{extension:e[t].extension??r}))))}),(t=>{const e=t.ref;Object.keys(Gs).filter((t=>!!e[t])).forEach((t=>ue.remove(e[t])))}));class Ws{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Hs(t,e){const r=t.split("?")[0],n=lt.extname(r).toLowerCase();return Array.isArray(e)?e.includes(n):n===e}const $s=(t,e,r=!1)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t||r?e(t):t)):t),zs=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=$s(t);let n;for(let t=0;t<this.parsers.length;t++){const s=this.parsers[t];if(s.test(e)){n=s.getCacheableAssets(r,e);break}}n||(n={},r.forEach((t=>{n[t]=e})));const s=Object.keys(n),i={cacheKeys:s,keys:r};if(r.forEach((t=>{this._cacheMap.set(t,i)})),s.forEach((t=>{this._cache.has(t)&&this._cache.get(t)!==e&&console.warn("[Cache] already has key:",t),this._cache.set(t,n[t])})),e instanceof Ur){const t=e;r.forEach((e=>{t.baseTexture!==Ur.EMPTY.baseTexture&&Ee.addToCache(t.baseTexture,e),Ur.addToCache(t,e)}))}}remove(t){if(!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}},qs=t=>!Array.isArray(t);class Ks{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{let n=null,s=null;if(e.loadParser&&(s=this._parserHash[e.loadParser],s||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!s){for(let r=0;r<this.parsers.length;r++){const n=this.parsers[r];if(n.load&&n.test?.(t,e,this)){s=n;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,e,this),r.parser=s;for(let t=0;t<this.parsers.length;t++){const s=this.parsers[t];s.parse&&s.parse&&await(s.testParse?.(n,e,this))&&(n=await s.parse(n,e,this)||n,r.parser=s)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const n={},s=qs(t),i=$s(t,(t=>({alias:[t],src:t}))),o=i.length,a=i.map((async t=>{const s=lt.toAbsolute(t.src);if(!n[t.src])try{this.promiseCache[s]||(this.promiseCache[s]=this._getLoadPromiseAndParser(s,t)),n[t.src]=await this.promiseCache[s].promise,e&&e(++r/o)}catch(e){throw delete this.promiseCache[s],delete n[t.src],new Error(`[Loader.load] Failed to load ${s}.\n${e}`)}}));return await Promise.all(a),s?n[i[0].src]:n}async unload(t){const e=$s(t,(t=>({alias:[t],src:t}))).map((async t=>{const e=lt.toAbsolute(t.src),r=this.promiseCache[e];if(r){const n=await r.promise;delete this.promiseCache[e],r.parser?.unload?.(n,t,this)}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e})),{})}}var Zs=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Zs||{});function Qs(t,e){if(Array.isArray(e)){for(const r of e)if(t.startsWith(`data:${r}`))return!0;return!1}return t.startsWith(`data:${e}`)}const Js={extension:{type:he.LoadParser,priority:Zs.Low},name:"loadJson",test:t=>Qs(t,"application/json")||Hs(t,".json"),load:async t=>await(await L.ADAPTER.fetch(t)).json()};ue.add(Js);const ti={name:"loadTxt",extension:{type:he.LoadParser,priority:Zs.Low},test:t=>Qs(t,"text/plain")||Hs(t,".txt"),load:async t=>await(await L.ADAPTER.fetch(t)).text()};ue.add(ti);const ei=["normal","bold","100","200","300","400","500","600","700","800","900"],ri=[".ttf",".otf",".woff",".woff2"],ni=["font/ttf","font/otf","font/woff","font/woff2"],si=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i,ii=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/,oi={extension:{type:he.LoadParser,priority:Zs.Low},name:"loadWebFont",test:t=>Qs(t,ni)||Hs(t,ri),async load(t,e){const r=L.ADAPTER.getFontFaceSet();if(r){const s=[],i=e.data?.family??function(t){const e=lt.extname(t),r=lt.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let n=r.length>0;for(const t of r)if(!t.match(si)){n=!1;break}let s=r.join(" ");return n||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}(t),o=e.data?.weights?.filter((t=>ei.includes(t)))??["normal"],a=e.data??{};for(let e=0;e<o.length;e++){const h=o[e],l=new FontFace(i,`url(${n=t,ii.test(n)?n:encodeURI(n)})`,{...a,weight:h});await l.load(),r.add(l),s.push(l)}return 1===s.length?s[0]:s}var n;return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>L.ADAPTER.getFontFaceSet().delete(t)))}};ue.add(oi);let ai,hi=0;const li="\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ",ci="\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };";let ui;const di=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([li],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",(n=>{r.terminate(),URL.revokeObjectURL(e),t(n.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===ai&&(ai=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<ai&&(ui||(ui=URL.createObjectURL(new Blob([ci],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(ui),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise(((r,n)=>{this.queue.push({id:t,arguments:e,resolve:r,reject:n})}));return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[hi]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:hi++,id:r})}};function fi(t,e,r){t.resource.internal=!0;const n=new Ur(t),s=()=>{delete e.promiseCache[r],zs.has(r)&&zs.remove(r)};return n.baseTexture.once("destroyed",(()=>{r in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())})),n.once("destroyed",(()=>{t.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())})),n}const pi=[".jpeg",".jpg",".png",".webp",".avif"],mi=["image/jpeg","image/png","image/webp","image/avif"],gi={name:"loadTextures",extension:{type:he.LoadParser,priority:Zs.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>Qs(t,mi)||Hs(t,pi),async load(t,e,r){const n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let s;s=n?this.config.preferWorkers&&await di.isImageBitmapSupported()?await di.loadImageBitmap(t):await async function(t){const e=await L.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const r=await e.blob();return await createImageBitmap(r)}(t):await new Promise(((e,r)=>{const n=new Image;n.crossOrigin=this.config.crossOrigin,n.src=t,n.complete?e(n):(n.onload=()=>e(n),n.onerror=t=>r(t))}));const i={...e.data};i.resolution??(i.resolution=ae(t)),n&&void 0===i.resourceOptions?.ownsImageBitmap&&(i.resourceOptions={...i.resourceOptions},i.resourceOptions.ownsImageBitmap=!0);const o=new Ee(s,i);return o.resource.src=t,fi(o,r,t)},unload(t){t.destroy(!0)}};ue.add(gi);const yi={extension:{type:he.LoadParser,priority:Zs.High},name:"loadSVG",test:t=>Qs(t,"image/svg+xml")||Hs(t,".svg"),testParse:async t=>os.test(t),async parse(t,e,r){const n=new os(t,e?.data?.resourceOptions);await n.load();const s=new Ee(n,{resolution:ae(t),...e?.data});return s.resource.src=e.src,fi(s,r,e.src)},load:async(t,e)=>(await L.ADAPTER.fetch(t)).text(),unload:gi.unload};ue.add(yi);const bi=[".mp4",".m4v",".webm",".ogv"],xi=["video/mp4","video/webm","video/ogg"],_i={name:"loadVideo",extension:{type:he.LoadParser,priority:Zs.High},config:{defaultAutoPlay:!0},test:t=>Qs(t,xi)||Hs(t,bi),async load(t,e,r){let n;const s=await(await L.ADAPTER.fetch(t)).blob(),i=URL.createObjectURL(s);try{const s={autoPlay:this.config.defaultAutoPlay,...e?.data?.resourceOptions},o=new hs(i,s);await o.load();const a=new Ee(o,{alphaMode:await dt(),resolution:ae(t),...e?.data});a.resource.src=t,n=fi(a,r,t),n.baseTexture.once("destroyed",(()=>{URL.revokeObjectURL(i)}))}catch(t){throw URL.revokeObjectURL(i),t}return n},unload(t){t.destroy(!0)}};function vi(t,e,r,n,s){const i=e[r];for(let o=0;o<i.length;o++){const a=i[o];r<e.length-1?vi(t.replace(n[r],a),e,r+1,n,s):s.push(t.replace(n[r],a))}}function wi(t){const e=t.match(/\{(.*?)\}/g),r=[];if(e){const n=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");n.push(e)})),vi(t,n,0,e,r)}else r.push(t);return r}ue.add(_i);class Ei{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}getAlias(t){const{alias:e,name:r,src:n,srcs:s}=t;return $s(e||r||n||s,(t=>"string"==typeof t?t:Array.isArray(t)?t.map((t=>t?.src??t?.srcs??t)):t?.src||t?.srcs?t.src??t.srcs:t),!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach((e=>{const n=e.src??e.srcs,s=e.alias??e.name;let i;if("string"==typeof s){const e=this._createBundleAssetId(t,s);r.push(e),i=[s,e]}else{const e=s.map((e=>this._createBundleAssetId(t,e)));r.push(...e),i=[...s,...e]}this.add({...e,alias:i,src:n})})):Object.keys(e).forEach((n=>{const s=[n,this._createBundleAssetId(t,n)];if("string"==typeof e[n])this.add({alias:s,src:e[n]});else if(Array.isArray(e[n]))this.add({alias:s,src:e[n]});else{const t=e[n],r=t.src??t.srcs;this.add({...t,alias:s,src:Array.isArray(r)?r:[r]})}r.push(...s)})),this._bundles[t]=r}add(t,e,r,n,s){const i=[];let o;"string"==typeof t||Array.isArray(t)&&"string"==typeof t[0]?(ot("7.2.0","Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead."),i.push({alias:t,src:e,data:r,format:n,loadParser:s})):Array.isArray(t)?i.push(...t):i.push(t),o=t=>{this.hasKey(t)&&console.warn(`[Resolver] already has key: ${t} overwriting`)},$s(i).forEach((t=>{const{src:e,srcs:r}=t;let{data:n,format:s,loadParser:i}=t;const a=$s(e||r).map((t=>"string"==typeof t?wi(t):Array.isArray(t)?t:[t])),h=this.getAlias(t);Array.isArray(h)?h.forEach(o):o(h);const l=[];a.forEach((t=>{t.forEach((t=>{let e={};if("object"!=typeof t){e.src=t;for(let r=0;r<this._parsers.length;r++){const n=this._parsers[r];if(n.test(t)){e=n.parse(t);break}}}else n=t.data??n,s=t.format??s,i=t.loadParser??i,e={...e,...t};if(!h)throw new Error(`[Resolver] alias is undefined for this asset: ${e.src}`);e=this.buildResolvedAsset(e,{aliases:h,data:n,format:s,loadParser:i}),l.push(e)}))})),h.forEach((t=>{this._assetMap[t]=l}))}))}resolveBundle(t){const e=qs(t);t=$s(t);const r={};return t.forEach((t=>{const e=this._bundles[t];if(e){const n=this.resolve(e),s={};for(const e in n){const r=n[e];s[this._extractAssetIdFromBundle(t,e)]=r}r[t]=s}})),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const r in e)t[r]=e[r].src;return t}return e.src}resolve(t){const e=qs(t);t=$s(t);const r={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const r=e[0],n=this._getPreferredOrder(e);n?.priority.forEach((t=>{n.params[t].forEach((r=>{const n=e.filter((e=>!!e[t]&&e[t]===r));n.length&&(e=n)}))})),this._resolverHash[t]=e[0]??r}else this._resolverHash[t]=this.buildResolvedAsset({alias:[t],src:t},{});r[t]=this._resolverHash[t]})),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],r=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){return this._defaultSearchParams?`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`:t}buildResolvedAsset(t,e){const{aliases:r,data:n,loadParser:s,format:i}=e;return(this._basePath||this._rootPath)&&(t.src=lt.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.format=i??lt.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}const Ti=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Ei,this.loader=new Ks,this.cache=zs,this._backgroundLoader=new Ws(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,r="number"==typeof e?[e]:e,n=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r,n,s){this.resolver.add(t,e,r,n,s)}async load(t,e){this._initialized||await this.init();const r=qs(t),n=$s(t).map((t=>{if("string"!=typeof t){const e=this.resolver.getAlias(t);return e.some((t=>!this.resolver.hasKey(t)))&&this.add(t),Array.isArray(e)?e[0]:e}return this.resolver.hasKey(t)||this.add({alias:t,src:t}),t})),s=this.resolver.resolve(n),i=await this._mapLoadToResolve(s,e);return r?i[n[0]]:i}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;"string"==typeof t&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},i=Object.keys(n);let o=0,a=0;const h=()=>{e?.(++o/a)},l=i.map((t=>{const e=n[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{s[t]=e}))}));return await Promise.all(l),r?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return zs.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=zs.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(r,e);this._backgroundLoader.active=!0;const i={};return r.forEach(((t,e)=>{const r=s[t.src],o=[t.src];t.alias&&o.push(...t.alias),i[n[e]]=r,zs.set(o,r)})),i}async unload(t){this._initialized||await this.init();const e=$s(t).map((t=>"string"!=typeof t?t.src:t)),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=$s(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{zs.remove(t.src)})),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter(((t,r)=>e.indexOf(t)===r)),e}get detections(){return this._detections}get preferWorkers(){return gi.config.preferWorkers}set preferWorkers(t){ot("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((r=>{e.config[r]=t[r]}))}))}};ue.handleByList(he.LoadParser,Ti.loader.parsers).handleByList(he.ResolveParser,Ti.resolver.parsers).handleByList(he.CacheParser,Ti.cache.parsers).handleByList(he.DetectionParser,Ti.detections);const Ai={extension:he.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Ur)),getCacheableAssets:(t,e)=>{const r={};return t.forEach((t=>{e.forEach(((e,n)=>{r[t+(0===n?"":n+1)]=e}))})),r}};async function Si(t){if("Image"in globalThis)return new Promise((e=>{const r=new Image;r.onload=()=>{e(!0)},r.onerror=()=>{e(!1)},r.src=t}));if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}ue.add(Ai);const Ri={extension:{type:he.DetectionParser,priority:1},test:async()=>Si("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};ue.add(Ri);const Ii={extension:{type:he.DetectionParser,priority:0},test:async()=>Si("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};ue.add(Ii);const Mi=["png","jpg","jpeg"],Pi={extension:{type:he.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...Mi],remove:async t=>t.filter((t=>!Mi.includes(t)))};ue.add(Pi);const Ci="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function ki(t){return!Ci&&""!==document.createElement("video").canPlayType(t)}const Oi={extension:{type:he.DetectionParser,priority:0},test:async()=>ki("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter((t=>"webm"!==t))};ue.add(Oi);const Fi={extension:{type:he.DetectionParser,priority:0},test:async()=>ki("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter((t=>"mp4"!==t&&"m4v"!==t))};ue.add(Fi);const Ni={extension:{type:he.DetectionParser,priority:0},test:async()=>ki("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter((t=>"ogv"!==t))};ue.add(Ni);const Bi={extension:he.ResolveParser,test:gi.test,parse:t=>({resolution:parseFloat(L.RETINA_PREFIX.exec(t)?.[1]??"1"),format:lt.extname(t).slice(1),src:t})};ue.add(Bi);const Di=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t};var Li=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(Li||{});const Vi={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Ui,Xi;function ji(){Xi={s3tc:Ui.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Ui.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Ui.getExtension("WEBGL_compressed_texture_etc"),etc1:Ui.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Ui.getExtension("WEBGL_compressed_texture_pvrtc")||Ui.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Ui.getExtension("WEBGL_compressed_texture_atc"),astc:Ui.getExtension("WEBGL_compressed_texture_astc")}}const Yi={extension:{type:he.DetectionParser,priority:2},test:async()=>{const t=L.ADAPTER.createCanvas().getContext("webgl");return t?(Ui=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async t=>{Xi||ji();const e=[];for(const t in Xi)Xi[t]&&e.push(t);return[...e,...t]},remove:async t=>(Xi||ji(),t.filter((t=>!(t in Xi))))};ue.add(Yi);class Gi extends _e{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,n;"string"==typeof t?(r=t,n=new Uint8Array):(r=null,n=t),super(n,e),this.origin=r,this.buffer=n?new de(n):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new de(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class Wi extends Gi{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Wi._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Wi._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let t=0,e=this.levels;t<e;t++){const{levelID:e,levelWidth:r,levelHeight:s,levelBuffer:i}=this._levelBuffers[t];n.compressedTexImage2D(n.TEXTURE_2D,e,this.format,r,s,0,i)}return!0}onBlobLoaded(){this._levelBuffers=Wi._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,n,s,i,o){const a=new Array(r);let h=t.byteOffset,l=i,c=o,u=l+n-1&~(n-1),d=c+s-1&~(s-1),f=u*d*Vi[e];for(let i=0;i<r;i++)a[i]={levelID:i,levelWidth:r>1?l:u,levelHeight:r>1?c:d,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,l=l>>1||1,c=c>>1||1,u=l+n-1&~(n-1),d=c+s-1&~(s-1),f=u*d*Vi[e];return a}}const Hi={827611204:Li.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:Li.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:Li.COMPRESSED_RGBA_S3TC_DXT5_EXT},$i={70:Li.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Li.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Li.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Li.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Li.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Li.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Li.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Li.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Li.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT},zi=[171,75,84,88,32,49,49,187,13,10,26,10],qi={[A.UNSIGNED_BYTE]:1,[A.UNSIGNED_SHORT]:2,[A.INT]:4,[A.UNSIGNED_INT]:4,[A.FLOAT]:4,[A.HALF_FLOAT]:8},Ki={[E.RGBA]:4,[E.RGB]:3,[E.RG]:2,[E.RED]:1,[E.LUMINANCE]:1,[E.LUMINANCE_ALPHA]:2,[E.ALPHA]:1},Zi={[A.UNSIGNED_SHORT_4_4_4_4]:2,[A.UNSIGNED_SHORT_5_5_5_1]:2,[A.UNSIGNED_SHORT_5_6_5]:2};function Qi(t){switch(t){case E.RGBA:return E.RGBA_INTEGER;case E.RGB:return E.RGB_INTEGER;case E.RG:return E.RG_INTEGER;case E.RED:return E.RED_INTEGER;default:return t}}const Ji={extension:{type:he.LoadParser,priority:Zs.High},name:"loadDDS",test:t=>Hs(t,".dds"),async load(t,e,r){const n=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const r=new Uint32Array(t,0,124/Uint32Array.BYTES_PER_ELEMENT),n=r[3],s=r[4],i=r[7],o=new Uint32Array(t,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const r=o[2];if(808540228!==r){const e=Hi[r],o=new Uint8Array(t,128);return[new Wi(o,{format:e,width:s,height:n,levels:i})]}const a=128,h=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),l=h[0],c=h[1],u=h[2],d=h[3],f=$i[l];if(void 0===f)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,m=148;if(1===d)p.push(new Uint8Array(t,m));else{const e=Vi[f];let r=0,o=s,a=n;for(let t=0;t<i;t++)r+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1;let h=m;for(let e=0;e<d;e++)p.push(new Uint8Array(t,h,r)),h+=r}return p.map((t=>new Wi(t,{format:f,width:s,height:n,levels:i})))}throw 64&a?new Error("DDSParser does not support uncompressed texture data."):512&a?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&a?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&a?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await(await L.ADAPTER.fetch(t)).arrayBuffer()).map((n=>fi(new Ee(n,{mipmap:M.OFF,alphaMode:P.NO_PREMULTIPLIED_ALPHA,resolution:ae(t),...e.data}),r,t)));return 1===n.length?n[0]:n},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};ue.add(Ji);const to={extension:{type:he.LoadParser,priority:Zs.High},name:"loadKTX",test:t=>Hs(t,".ktx"),async load(t,e,r){const n=await(await L.ADAPTER.fetch(t)).arrayBuffer(),{compressed:s,uncompressed:i,kvData:o}=function(t,e,r=!1){const n=new DataView(e);if(!function(t,e){for(let r=0;r<zi.length;r++)if(e.getUint8(r)!==zi[r])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}(t,n))return null;const s=67305985===n.getUint32(12,!0),i=n.getUint32(16,s),o=n.getUint32(24,s),a=n.getUint32(28,s),h=n.getUint32(36,s),l=n.getUint32(40,s)||1,c=n.getUint32(44,s)||1,u=n.getUint32(48,s)||1,d=n.getUint32(52,s),f=n.getUint32(56,s),p=n.getUint32(60,s);if(0===l||1!==c)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const m=h+3&-4,g=l+3&-4,y=new Array(u);let b,x=h*l;if(0===i&&(x=m*g),b=0!==i?qi[i]?qi[i]*Ki[o]:Zi[i]:Vi[a],void 0===b)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const _=r?function(t,e,r){const n=new Map;let s=0;for(;s<e;){const i=t.getUint32(64+s,r),o=64+s+4,a=3-(i+3)%4;if(0===i||i>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<i&&0!==t.getUint8(o+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(t.buffer,o,h)),c=new DataView(t.buffer,o+h+1,i-h-1);n.set(l,c),s+=4+i+a}return n}(n,p,s):null;let v=x*b,w=h,E=l,T=m,S=g,R=64+p;for(let t=0;t<f;t++){const r=n.getUint32(R,s);let o=R+4;for(let r=0;r<u;r++){let n=y[r];n||(n=y[r]=new Array(f)),n[t]={levelID:t,levelWidth:f>1||0!==i?w:T,levelHeight:f>1||0!==i?E:S,levelBuffer:new Uint8Array(e,o,v)},o+=v}R+=r+4,R=R%4!=0?R+4-R%4:R,w=w>>1||1,E=E>>1||1,T=w+4-1&-4,S=E+4-1&-4,v=T*S*b}return 0!==i?{uncompressed:y.map((t=>{let e=t[0].levelBuffer,r=!1;return i===A.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):i===A.UNSIGNED_INT?(r=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):i===A.INT&&(r=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new _e(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:i,format:r?Qi(o):o}})),kvData:_}:{compressed:y.map((t=>new Wi(null,{format:a,width:h,height:l,levels:f,levelBuffers:t}))),kvData:_}}(t,n),a=s??i,h={mipmap:M.OFF,alphaMode:P.NO_PREMULTIPLIED_ALPHA,resolution:ae(t),...e.data},l=a.map((e=>{a===i&&Object.assign(h,{type:e.type,format:e.format});const n=e.resource??e,s=new Ee(n,h);return s.ktxKeyValueData=o,fi(s,r,t)}));return 1===l.length?l[0]:l},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};ue.add(to);const eo={extension:he.ResolveParser,test:t=>{const e=lt.extname(t).slice(1);return["basis","ktx","dds"].includes(e)},parse:t=>{const e=lt.extname(t).slice(1);if("ktx"===e){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some((e=>t.endsWith(e))))return{resolution:parseFloat(L.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(L.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e,src:t}}};ue.add(eo);const ro=new Ue,no=class t{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,r,n){const s=new Image;return s.src=await this.base64(t,e,r,n),s}async base64(t,e,r,n){const s=this.canvas(t,n);if(void 0!==s.toBlob)return new Promise(((t,n)=>{s.toBlob((e=>{if(!e)return void n(new Error("ICanvas.toBlob failed!"));const r=new FileReader;r.onload=()=>t(r.result),r.onerror=n,r.readAsDataURL(e)}),e,r)}));if(void 0!==s.toDataURL)return s.toDataURL(e,r);if(void 0!==s.convertToBlob){const t=await s.convertToBlob({type:e,quality:r});return new Promise(((e,r)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=r,n.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,r){const{pixels:n,width:s,height:i,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,r);o&&t._flipY(n,s,i),a&&t._unpremultiplyAlpha(n);const h=new se(s,i,1),l=new ImageData(new Uint8ClampedArray(n.buffer),s,i);return h.context.putImageData(l,0,0),h.canvas}pixels(e,r){const{pixels:n,width:s,height:i,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,r);return o&&t._flipY(n,s,i),a&&t._unpremultiplyAlpha(n),n}_rawPixels(t,e){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let n,s,i=!1,o=!1,a=!1;t&&(t instanceof Xr?s=t:(s=r.generateTexture(t,{region:e,resolution:r.resolution,multisample:r.multisample}),a=!0,e&&(ro.width=e.width,ro.height=e.height,e=ro)));const h=r.gl;if(s){if(n=s.baseTexture.resolution,e=e??s.frame,i=!1,o=s.baseTexture.alphaMode>0&&s.baseTexture.format===E.RGBA,!a){r.renderTexture.bind(s);const t=s.framebuffer.glFramebuffers[r.CONTEXT_UID];t.blitFramebuffer&&r.framebuffer.bind(t.blitFramebuffer)}}else n=r.resolution,e||((e=ro).width=r.width/n,e.height=r.height/n),i=!0,o=this._rendererPremultipliedAlpha,r.renderTexture.bind();const l=Math.max(Math.round(e.width*n),1),c=Math.max(Math.round(e.height*n),1),u=new Uint8Array(4*l*c);return h.readPixels(Math.round(e.x*n),Math.round(e.y*n),l,c,h.RGBA,h.UNSIGNED_BYTE,u),a&&s?.destroy(!0),{pixels:u,width:l,height:c,flipY:i,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,r){const n=e<<2,s=r>>1,i=new Uint8Array(n);for(let e=0;e<s;e++){const s=e*n,o=(r-e-1)*n;i.set(t.subarray(s,s+n)),t.copyWithin(s,o,o+n),t.set(i,o)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const e=t[r+3];if(0!==e){const n=255.001/e;t[r]=t[r]*n+.5,t[r+1]=t[r+1]*n+.5,t[r+2]=t[r+2]*n+.5}}}};no.extension={name:"extract",type:he.RendererSystem};let so=no;ue.add(so);const io={build(t){const e=t.points;let r,n,s,i,o,a;if(t.type===De.CIRC){const e=t.shape;r=e.x,n=e.y,o=a=e.radius,s=i=0}else if(t.type===De.ELIP){const e=t.shape;r=e.x,n=e.y,o=e.width,a=e.height,s=i=0}else{const e=t.shape,h=e.width/2,l=e.height/2;r=e.x+h,n=e.y+l,o=a=Math.max(0,Math.min(e.radius,Math.min(h,l))),s=h-o,i=l-a}if(!(o>=0&&a>=0&&s>=0&&i>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(o+a)),l=8*h+(s?4:0)+(i?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=r+s,e[1]=e[3]=n+i,e[2]=e[4]=r-s,void(e[5]=e[7]=n-i);let c=0,u=4*h+(s?2:0)+2,d=u,f=l;{const t=s+o,a=i,h=r+t,l=r-t,p=n+a;if(e[c++]=h,e[c++]=p,e[--u]=p,e[--u]=l,i){const t=n-a;e[d++]=l,e[d++]=t,e[--f]=t,e[--f]=h}}for(let t=1;t<h;t++){const l=Math.PI/2*(t/h),p=s+Math.cos(l)*o,m=i+Math.sin(l)*a,g=r+p,y=r-p,b=n+m,x=n-m;e[c++]=g,e[c++]=b,e[--u]=b,e[--u]=y,e[d++]=y,e[d++]=x,e[--f]=x,e[--f]=g}{const t=i+a,o=r+s,h=r-s,l=n+t,u=n-t;e[c++]=o,e[c++]=l,e[--f]=u,e[--f]=o,s&&(e[c++]=h,e[c++]=l,e[--f]=u,e[--f]=h)}},triangulate(t,e){const r=t.points,n=e.points,s=e.indices;if(0===r.length)return;let i=n.length/2;const o=i;let a,h;if(t.type!==De.RREC){const e=t.shape;a=e.x,h=e.y}else{const e=t.shape;a=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;n.push(t.matrix?l.a*a+l.c*h+l.tx:a,t.matrix?l.b*a+l.d*h+l.ty:h),i++,n.push(r[0],r[1]);for(let t=2;t<r.length;t+=2)n.push(r[t],r[t+1]),s.push(i++,o,i);s.push(o+1,o,i)}};function oo(t,e=!1){const r=t.length;if(r<6)return;let n=0;for(let e=0,s=t[r-2],i=t[r-1];e<r;e+=2){const r=t[e],o=t[e+1];n+=(r-s)*(o+i),s=r,i=o}if(!e&&n>0||e&&n<=0){const e=r/2;for(let n=e+e%2;n<r;n+=2){const e=r-n-2,s=r-n-1,i=n,o=n+1;[t[e],t[i]]=[t[i],t[e]],[t[s],t[o]]=[t[o],t[s]]}}}const ao={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let r=t.points;const n=t.holes,s=e.points,i=e.indices;if(r.length>=6){oo(r,!1);const t=[];for(let e=0;e<n.length;e++){const s=n[e];oo(s.points,!0),t.push(r.length/2),r=r.concat(s.points)}const e=st(r,t,2);if(!e)return;const o=s.length/2;for(let t=0;t<e.length;t+=3)i.push(e[t]+o),i.push(e[t+1]+o),i.push(e[t+2]+o);for(let t=0;t<r.length;t++)s.push(r[t])}}},ho={build(t){const e=t.shape,r=e.x,n=e.y,s=e.width,i=e.height,o=t.points;o.length=0,s>=0&&i>=0&&o.push(r,n,r+s,n,r+s,n+i,r,n+i)},triangulate(t,e){const r=t.points,n=e.points;if(0===r.length)return;const s=n.length/2;n.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},lo={build(t){io.build(t)},triangulate(t,e){io.triangulate(t,e)}};var co=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(co||{}),uo=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(uo||{});const fo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let r=Math.ceil(t/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}};class po{static curveTo(t,e,r,n,s,i){const o=i[i.length-2],a=i[i.length-1]-e,h=o-t,l=n-e,c=r-t,u=Math.abs(a*c-h*l);if(u<1e-8||0===s)return(i[i.length-2]!==t||i[i.length-1]!==e)&&i.push(t,e),null;const d=a*a+h*h,f=l*l+c*c,p=a*l+h*c,m=s*Math.sqrt(d)/u,g=s*Math.sqrt(f)/u,y=m*p/d,b=g*p/f,x=m*c+g*h,_=m*l+g*a,v=h*(g+y),w=a*(g+y),E=c*(m+b),T=l*(m+b);return{cx:x+t,cy:_+e,radius:s,startAngle:Math.atan2(w-_,v-x),endAngle:Math.atan2(T-_,E-x),anticlockwise:h*l>c*a}}static arc(t,e,r,n,s,i,o,a,h){const l=o-i,c=fo._segmentsCount(Math.abs(l)*s,40*Math.ceil(Math.abs(l)/Fe)),u=l/(2*c),d=2*u,f=Math.cos(u),p=Math.sin(u),m=c-1,g=m%1/m;for(let t=0;t<=m;++t){const e=u+i+d*(t+g*t),o=Math.cos(e),a=-Math.sin(e);h.push((f*o+p*a)*s+r,(f*-a+p*o)*s+n)}}}class mo{static curveLength(t,e,r,n,s,i,o,a){let h=0,l=0,c=0,u=0,d=0,f=0,p=0,m=0,g=0,y=0,b=0,x=t,_=e;for(let v=1;v<=10;++v)l=v/10,c=l*l,u=c*l,d=1-l,f=d*d,p=f*d,m=p*t+3*f*l*r+3*d*c*s+u*o,g=p*e+3*f*l*n+3*d*c*i+u*a,y=x-m,b=_-g,x=m,_=g,h+=Math.sqrt(y*y+b*b);return h}static curveTo(t,e,r,n,s,i,o){const a=o[o.length-2],h=o[o.length-1];o.length-=2;const l=fo._segmentsCount(mo.curveLength(a,h,t,e,r,n,s,i));let c=0,u=0,d=0,f=0,p=0;o.push(a,h);for(let m=1,g=0;m<=l;++m)g=m/l,c=1-g,u=c*c,d=u*c,f=g*g,p=f*g,o.push(d*a+3*u*g*t+3*c*f*r+p*s,d*h+3*u*g*e+3*c*f*n+p*i)}}function go(t,e,r,n,s,i,o,a){let h,l;o?(h=n,l=-r):(h=-n,l=r);const c=t-r*s+h,u=e-n*s+l,d=t+r*i+h,f=e+n*i+l;return a.push(c,u,d,f),2}function yo(t,e,r,n,s,i,o,a){const h=r-t,l=n-e;let c=Math.atan2(h,l),u=Math.atan2(s-t,i-e);a&&c<u?c+=2*Math.PI:!a&&c>u&&(u+=2*Math.PI);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=1+(15*p*Math.sqrt(m)/Math.PI>>0),y=f/g;if(d+=y,a){o.push(t,e,r,n);for(let r=1,n=d;r<g;r++,n+=y)o.push(t,e,t+Math.sin(n)*m,e+Math.cos(n)*m);o.push(t,e,s,i)}else{o.push(r,n,t,e);for(let r=1,n=d;r<g;r++,n+=y)o.push(t+Math.sin(n)*m,e+Math.cos(n)*m,t,e);o.push(s,i,t,e)}return 2*g}function bo(t,e){t.lineStyle.native?function(t,e){let r=0;const n=t.shape,s=t.points||n.points,i=n.type!==De.POLY||n.closeStroke;if(0===s.length)return;const o=e.points,a=e.indices,h=s.length/2,l=o.length/2;let c=l;for(o.push(s[0],s[1]),r=1;r<h;r++)o.push(s[2*r],s[2*r+1]),a.push(c,c+1),c++;i&&a.push(c,l)}(t,e):function(t,e){const r=t.shape;let n=t.points||r.points.slice();const s=e.closePointEps;if(0===n.length)return;const i=t.lineStyle,o=new Le(n[0],n[1]),a=new Le(n[n.length-2],n[n.length-1]),h=r.type!==De.POLY||r.closeStroke,l=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(h){n=n.slice(),l&&(n.pop(),n.pop(),a.set(n[n.length-2],n[n.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);n.unshift(t,e),n.push(t,e)}const c=e.points,u=n.length/2;let d=n.length;const f=c.length/2,p=i.width/2,m=p*p,g=i.miterLimit*i.miterLimit;let y=n[0],b=n[1],x=n[2],_=n[3],v=0,w=0,E=-(b-_),T=y-x,A=0,S=0,R=Math.sqrt(E*E+T*T);E/=R,T/=R,E*=p,T*=p;const I=i.alignment,M=2*(1-I),P=2*I;h||(i.cap===uo.ROUND?d+=yo(y-E*(M-P)*.5,b-T*(M-P)*.5,y-E*M,b-T*M,y+E*P,b+T*P,c,!0)+2:i.cap===uo.SQUARE&&(d+=go(y,b,E,T,M,P,!0,c))),c.push(y-E*M,b-T*M,y+E*P,b+T*P);for(let t=1;t<u-1;++t){y=n[2*(t-1)],b=n[2*(t-1)+1],x=n[2*t],_=n[2*t+1],v=n[2*(t+1)],w=n[2*(t+1)+1],E=-(b-_),T=y-x,R=Math.sqrt(E*E+T*T),E/=R,T/=R,E*=p,T*=p,A=-(_-w),S=x-v,R=Math.sqrt(A*A+S*S),A/=R,S/=R,A*=p,S*=p;const e=x-y,r=b-_,s=x-v,o=w-_,a=e*s+r*o,h=r*s-o*e,l=h<0;if(Math.abs(h)<.001*Math.abs(a)){c.push(x-E*M,_-T*M,x+E*P,_+T*P),a>=0&&(i.join===co.ROUND?d+=yo(x,_,x-E*M,_-T*M,x-A*M,_-S*M,c,!1)+4:d+=2,c.push(x-A*P,_-S*P,x+A*M,_+S*M));continue}const u=(-E+y)*(-T+_)-(-E+x)*(-T+b),f=(-A+v)*(-S+_)-(-A+x)*(-S+w),I=(e*f-s*u)/h,C=(o*u-r*f)/h,k=(I-x)*(I-x)+(C-_)*(C-_),O=x+(I-x)*M,F=_+(C-_)*M,N=x-(I-x)*P,B=_-(C-_)*P,D=l?M:P,L=k<=Math.min(e*e+r*r,s*s+o*o)+D*D*m;let V=i.join;if(V===co.MITER&&k/m>g&&(V=co.BEVEL),L)switch(V){case co.MITER:c.push(O,F,N,B);break;case co.BEVEL:l?c.push(O,F,x+E*P,_+T*P,O,F,x+A*P,_+S*P):c.push(x-E*M,_-T*M,N,B,x-A*M,_-S*M,N,B),d+=2;break;case co.ROUND:l?(c.push(O,F,x+E*P,_+T*P),d+=yo(x,_,x+E*P,_+T*P,x+A*P,_+S*P,c,!0)+4,c.push(O,F,x+A*P,_+S*P)):(c.push(x-E*M,_-T*M,N,B),d+=yo(x,_,x-E*M,_-T*M,x-A*M,_-S*M,c,!1)+4,c.push(x-A*M,_-S*M,N,B))}else{switch(c.push(x-E*M,_-T*M,x+E*P,_+T*P),V){case co.MITER:l?c.push(N,B,N,B):c.push(O,F,O,F),d+=2;break;case co.ROUND:d+=l?yo(x,_,x+E*P,_+T*P,x+A*P,_+S*P,c,!0)+2:yo(x,_,x-E*M,_-T*M,x-A*M,_-S*M,c,!1)+2}c.push(x-A*M,_-S*M,x+A*P,_+S*P),d+=2}}y=n[2*(u-2)],b=n[2*(u-2)+1],x=n[2*(u-1)],_=n[2*(u-1)+1],E=-(b-_),T=y-x,R=Math.sqrt(E*E+T*T),E/=R,T/=R,E*=p,T*=p,c.push(x-E*M,_-T*M,x+E*P,_+T*P),h||(i.cap===uo.ROUND?d+=yo(x-E*(M-P)*.5,_-T*(M-P)*.5,x-E*M,_-T*M,x+E*P,_+T*P,c,!1)+2:i.cap===uo.SQUARE&&(d+=go(x,_,E,T,M,P,!1,c)));const C=e.indices,k=fo.epsilon*fo.epsilon;for(let t=f;t<d+f-2;++t)y=c[2*t],b=c[2*t+1],x=c[2*(t+1)],_=c[2*(t+1)+1],v=c[2*(t+2)],w=c[2*(t+2)+1],!(Math.abs(y*(_-w)+x*(w-b)+v*(b-_))<k)&&C.push(t,t+1,t+2)}(t,e)}class xo{static curveLength(t,e,r,n,s,i){const o=t-2*r+s,a=e-2*n+i,h=2*r-2*t,l=2*n-2*e,c=4*(o*o+a*a),u=4*(o*h+a*l),d=h*h+l*l,f=2*Math.sqrt(c+u+d),p=Math.sqrt(c),m=2*c*p,g=2*Math.sqrt(d),y=u/p;return(m*f+p*u*(f-g)+(4*d*c-u*u)*Math.log((2*p+y+f)/(y+g)))/(4*m)}static curveTo(t,e,r,n,s){const i=s[s.length-2],o=s[s.length-1],a=fo._segmentsCount(xo.curveLength(i,o,t,e,r,n));let h=0,l=0;for(let c=1;c<=a;++c){const u=c/a;h=i+(t-i)*u,l=o+(e-o)*u,s.push(h+(t+(r-t)*u-h)*u,l+(e+(n-e)*u-l)*u)}}}const _o={[De.POLY]:ao,[De.CIRC]:io,[De.ELIP]:io,[De.RECT]:ho,[De.RREC]:lo},vo=[],wo=[];class Eo{constructor(t,e=null,r=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new Eo(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class To{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const Ao=new Le,So=class t extends Oe{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new ls,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),wo.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),vo.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,n=null){const s=new Eo(t,e,r,n);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new Eo(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const n=e[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,Ao):Ao.copyFrom(t),n.shape.contains(Ao.x,Ao.y))){let t=!1;if(n.holes)for(let e=0;e<n.holes.length;e++)if(n.holes[e].shape.contains(Ao.x,Ao.y)){t=!0;break}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(let s=this.shapeIndex;s<e.length;s++){this.shapeIndex++;const i=e[s],o=i.fillStyle,a=i.lineStyle;_o[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix),(o.visible||a.visible)&&this.processHoles(i.holes);for(let e=0;e<2;e++){const s=0===e?o:a;if(!s.visible)continue;const h=s.texture.baseTexture,l=this.indices.length,c=this.points.length/2;h.wrapMode=I.REPEAT,0===e?this.processFill(i):this.processLine(i);const u=this.points.length/2-c;0!==u&&(r&&!this._compareStyles(n,s)&&(r.end(l,c),r=null),r||(r=vo.pop()||new To,r.begin(s,l,c),this.batches.push(r),n=s),this.addUvs(this.points,t,s.texture,c,u,s.matrix))}}const s=this.indices.length,i=this.points.length/2;if(r&&r.end(s,i),0===this.batches.length)return void(this.batchable=!0);const o=i>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],r=e.fillStyle,n=e.lineStyle;if(r&&!r.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const r=t[e];for(let t=0;t<r.size;t++){const e=r.start+t;this.indicesUint16[e]=this.indicesUint16[e]-r.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<2*t.BATCHABLE_SIZE}buildDrawCalls(){let t=++Ee._globalBatch;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),wo.push(this.drawCalls[t]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let n=wo.pop();n||(n=new Te,n.texArray=new Er),n.texArray.count=0,n.start=0,n.size=0,n.type=w.TRIANGLES;let s=0,i=null,o=0,a=!1,h=w.TRIANGLES,l=0;this.drawCalls.push(n);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,p=f.texture.baseTexture;a!==!!f.native&&(a=!!f.native,h=a?w.LINES:w.TRIANGLES,i=null,s=d,t++),i!==p&&(i=p,p._batchEnabled!==t&&(s===d&&(t++,s=0,n.size>0&&(n=wo.pop(),n||(n=new Te,n.texArray=new Er),this.drawCalls.push(n)),n.start=l,n.size=0,n.texArray.count=0,n.type=h),p.touched=1,p._batchEnabled=t,p._batchLocation=s,p.wrapMode=I.REPEAT,n.texArray.elements[n.texArray.count++]=p,s++)),n.size+=u.size,l+=u.size,o=p._batchLocation,this.addColors(e,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(r,o,u.attribSize,u.attribStart)}Ee._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,n=this.textureIds,s=new ArrayBuffer(3*t.length*4),i=new Float32Array(s),o=new Uint32Array(s);let a=0;for(let s=0;s<t.length/2;s++)i[a++]=t[2*s],i[a++]=t[2*s+1],i[a++]=e[2*s],i[a++]=e[2*s+1],o[a++]=r[s],i[a++]=n[s];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?ao.triangulate(t,this):_o[t.type].triangulate(t,this)}processLine(t){bo(t,this);for(let e=0;e<t.holes.length;e++)bo(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];_o[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const n=t[2*r],s=t[2*r+1];t[2*r]=e.a*n+e.c*s+e.tx,t[2*r+1]=e.b*n+e.d*s+e.ty}}addColors(t,e,r,n,s=0){const i=Xt.shared.setValue(e).toLittleEndianNumber(),o=Xt.shared.setValue(i).toPremultiplied(r);t.length=Math.max(t.length,s+n);for(let e=0;e<n;e++)t[s+e]=o}addTextureIds(t,e,r,n=0){t.length=Math.max(t.length,n+r);for(let s=0;s<r;s++)t[n+s]=e}addUvs(t,e,r,n,s,i=null){let o=0;const a=e.length,h=r.frame;for(;o<s;){let r=t[2*(n+o)],s=t[2*(n+o)+1];if(i){const t=i.a*r+i.c*s+i.tx;s=i.b*r+i.d*s+i.ty,r=t}o++,e.push(r/h.width,s/h.height)}const l=r.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,r,a,s)}adjustUvs(t,e,r,n){const s=e.baseTexture,i=1e-6,o=r+2*n,a=e.frame,h=a.width/s.width,l=a.height/s.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(t[r]+i),f=Math.floor(t[r+1]+i);for(let e=r+2;e<o;e+=2)d=Math.min(d,Math.floor(t[e]+i)),f=Math.min(f,Math.floor(t[e+1]+i));c-=d,u-=f;for(let e=r;e<o;e+=2)t[e]=(t[e]+c)*h,t[e+1]=(t[e+1]+u)*l}};So.BATCHABLE_SIZE=100;let Ro=So;class Io{constructor(){this.color=16777215,this.alpha=1,this.texture=Ur.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Io;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Ur.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Mo extends Io{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=uo.BUTT,this.join=co.MITER,this.miterLimit=10}clone(){const t=new Mo;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=uo.BUTT,this.join=co.MITER,this.miterLimit=10}}const Po={},Co=class t extends ms{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Io,this._lineStyle=new Mo,this._matrix=null,this._holeMode=!1,this.state=me.for2d(),this._geometry=t||new Ro,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Xt(16777215),this.blendMode=v.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new t(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,n=.5,s=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:r,alignment:n,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Ur.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:uo.BUTT,join:co.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Ye,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Ye,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,n=r[r.length-2],s=r[r.length-1];return(n!==t||s!==e)&&r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,n){this._initCurve();const s=this.currentPath.points;return 0===s.length&&this.moveTo(0,0),xo.curveTo(t,e,r,n,s),this}bezierCurveTo(t,e,r,n,s,i){return this._initCurve(),mo.curveTo(t,e,r,n,s,i,this.currentPath.points),this}arcTo(t,e,r,n,s){this._initCurve(t,e);const i=this.currentPath.points,o=po.curveTo(t,e,r,n,s,i);if(o){const{cx:t,cy:e,radius:r,startAngle:n,endAngle:s,anticlockwise:i}=o;this.arc(t,e,r,n,s,i)}return this}arc(t,e,r,n,s,i=!1){if(n===s)return this;if(!i&&s<=n?s+=Fe:i&&n<=s&&(n+=Fe),s-n==0)return this;const o=t+Math.cos(n)*r,a=e+Math.sin(n)*r,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-o),e=Math.abs(l[l.length-1]-a);t<h&&e<h||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return po.arc(o,a,t,e,r,n,s,i,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:Ur.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Xt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Ur.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,n){return this.drawShape(new Ue(t,e,r,n))}drawRoundedRect(t,e,r,n,s){return this.drawShape(new Ge(t,e,r,n,s))}drawCircle(t,e,r){return this.drawShape(new Xe(t,e,r))}drawEllipse(t,e,r,n){return this.drawShape(new je(t,e,r,n))}drawPolygon(...t){let e,r=!0;const n=t[0];n.points?(r=n.closeStroke,e=n.points):e=Array.isArray(t[0])?t[0]:t;const s=new Ye(e);return s.closeStroke=r,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==De.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let n=0;n<r;n++){const r=t.batches[n],s=r.style.color,i=new Float32Array(this.vertexData.buffer,4*r.attribStart*2,2*r.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*r.attribStart*2,2*r.attribSize),a={vertexData:i,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*r.start,r.size),uvs:o,_batchRGB:Xt.shared.setValue(s).toRgbArray(),_tintRGB:s,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[n]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,n=this.worldAlpha,s=e.uniforms,i=r.drawCalls;s.translationMatrix=this.transform.worldTransform,Xt.shared.setValue(this._tintColor).premultiply(n).toArray(s.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let e=0,n=i.length;e<n;e++)this._renderDrawCallDirect(t,r.drawCalls[e])}_renderDrawCallDirect(t,e){const{texArray:r,type:n,size:s,start:i}=e,o=r.count;for(let e=0;e<o;e++)t.texture.bind(r.elements[e],e);t.geometry.draw(n,s,i)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!Po[r]){const{maxTextures:e}=t.plugins[r],n=new Int32Array(e);for(let t=0;t<e;t++)n[t]=t;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new We,default:_r.from({uSamplers:n},!0)},i=t.plugins[r]._shader.program;Po[r]=new vr(i,s)}e=Po[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:n,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,r,n,s)}containsPoint(e){return this.worldTransform.applyInverse(e,t._TEMP_POINT),this._geometry.containsPoint(t._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Xt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,i=e.d,o=e.tx,a=e.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let t=0;t<h.length;t+=2){const e=h[t],u=h[t+1];l[c++]=r*e+s*u+o,l[c++]=i*u+n*e+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};Co.curves=fo,Co._TEMP_POINT=new Le;let ko=Co;class Oo{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Fo=new Le,No=new Ye,Bo=class t extends ms{constructor(t,e,r,n=w.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||me.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=L.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(e){const r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===w.TRIANGLES&&r.length<2*t.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,i=n.b,o=n.c,a=n.d,h=n.tx,l=n.ty,c=this.vertexData;for(let t=0;t<c.length/2;t++){const r=e[2*t],n=e[2*t+1];c[2*t]=s*r+o*n+h,c[2*t+1]=i*r+a*n+l}if(this._roundPixels){const t=L.RESOLUTION;for(let e=0;e<c.length;++e)c[e]=Math.round(c[e]*t)/t}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Oo(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Fo);const e=this.geometry.getBuffer("aVertexPosition").data,r=No.points,n=this.geometry.getIndex().data,s=n.length,i=4===this.drawMode?3:1;for(let t=0;t+2<s;t+=i){const s=2*n[t],i=2*n[t+1],o=2*n[t+2];if(r[0]=e[s],r[1]=e[s+1],r[2]=e[i],r[3]=e[i+1],r[4]=e[o],r[5]=e[o+1],No.contains(Fo.x,Fo.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};Bo.BATCHABLE_SIZE=100;let Do=Bo;class Lo extends ke{constructor(t,e,r){super();const n=new Se(t),s=new Se(e,!0),i=new Se(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,A.FLOAT).addAttribute("aTextureCoord",s,2,!1,A.FLOAT).addIndex(i),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class Vo extends vr{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:We.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(r,e.uniforms),super(e.program||br.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),r),this._colorDirty=!1,this.uvMatrix=new en(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new Xt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Xt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Uo extends Do{constructor(t=Ur.EMPTY,e,r,n,s){const i=new Lo(e,r,n);i.getBuffer("aVertexPosition").static=!1,super(i,new Vo(t),null,s),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}class Xo{constructor(t,e,r){this.geometry=new ke,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let n=t[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||A.FLOAT,offset:n.offset},e[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Se(function(t,e=null){const r=6*t;if((e=e||new Uint16Array(r)).length!==r)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${r}`);for(let t=0,n=0;t<r;t+=6,n+=4)e[t+0]=n+0,e[t+1]=n+1,e[t+2]=n+2,e[t+3]=n+0,e[t+4]=n+2,e[t+5]=n+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let t=0;t<this.dynamicProperties.length;++t){const r=this.dynamicProperties[t];r.offset=e,e+=r.size,this.dynamicStride+=r.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Se(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let t=0;t<this.staticProperties.length;++t){const e=this.staticProperties[t];e.offset=n,n+=e.size,this.staticStride+=e.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Se(this.staticData,!0,!1);for(let e=0;e<this.dynamicProperties.length;++e){const r=this.dynamicProperties[e];t.addAttribute(r.attributeName,this.dynamicBuffer,0,r.type===A.UNSIGNED_BYTE,r.type,4*this.dynamicStride,4*r.offset)}for(let e=0;e<this.staticProperties.length;++e){const r=this.staticProperties[e];t.addAttribute(r.attributeName,this.staticBuffer,0,r.type===A.UNSIGNED_BYTE,r.type,4*this.staticStride,4*r.offset)}}uploadDynamic(t,e,r){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,r,s.type===A.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,r,s.type===A.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class jo extends Tr{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new We,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:A.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=vr.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=me.for2d()}render(t){const e=t.children,r=t._maxSize,n=t._batchSize,s=this.renderer;let i=e.length;if(0===i)return;i>r&&!t.autoResize&&(i=r);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,h=a.alphaMode>0;this.state.blendMode=Gt(t.blendMode,h),s.state.set(this.state);const l=s.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Xt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let u=!1;for(let r=0,a=0;r<i;r+=n,a+=1){let h=i-r;h>n&&(h=n),a>=o.length&&o.push(this._generateOneMoreBuffer(t));const c=o[a];c.uploadDynamic(e,r,h);const d=t._bufferUpdateIDs[a]||0;u=u||c._updateID<d,u&&(c._updateID=t._updateID,c.uploadStatic(e,r,h)),s.geometry.bind(c.geometry),l.drawElements(l.TRIANGLES,6*h,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,n=t._batchSize,s=t._properties;for(let t=0;t<r;t+=n)e.push(new Xo(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new Xo(this.properties,r,e)}uploadVertices(t,e,r,n,s,i){let o=0,a=0,h=0,l=0;for(let c=0;c<r;++c){const r=t[e+c],u=r._texture,d=r.scale.x,f=r.scale.y,p=u.trim,m=u.orig;p?(a=p.x-r.anchor.x*m.width,o=a+p.width,l=p.y-r.anchor.y*m.height,h=l+p.height):(o=m.width*(1-r.anchor.x),a=m.width*-r.anchor.x,h=m.height*(1-r.anchor.y),l=m.height*-r.anchor.y),n[i]=a*d,n[i+1]=l*f,n[i+s]=o*d,n[i+s+1]=l*f,n[i+2*s]=o*d,n[i+2*s+1]=h*f,n[i+3*s]=a*d,n[i+3*s+1]=h*f,i+=4*s}}uploadPosition(t,e,r,n,s,i){for(let o=0;o<r;o++){const r=t[e+o].position;n[i]=r.x,n[i+1]=r.y,n[i+s]=r.x,n[i+s+1]=r.y,n[i+2*s]=r.x,n[i+2*s+1]=r.y,n[i+3*s]=r.x,n[i+3*s+1]=r.y,i+=4*s}}uploadRotation(t,e,r,n,s,i){for(let o=0;o<r;o++){const r=t[e+o].rotation;n[i]=r,n[i+s]=r,n[i+2*s]=r,n[i+3*s]=r,i+=4*s}}uploadUvs(t,e,r,n,s,i){for(let o=0;o<r;++o){const r=t[e+o]._texture._uvs;r?(n[i]=r.x0,n[i+1]=r.y0,n[i+s]=r.x1,n[i+s+1]=r.y1,n[i+2*s]=r.x2,n[i+2*s+1]=r.y2,n[i+3*s]=r.x3,n[i+3*s+1]=r.y3,i+=4*s):(n[i]=0,n[i+1]=0,n[i+s]=0,n[i+s+1]=0,n[i+2*s]=0,n[i+2*s+1]=0,n[i+3*s]=0,n[i+3*s+1]=0,i+=4*s)}}uploadTint(t,e,r,n,s,i){for(let o=0;o<r;++o){const r=t[e+o],a=Xt.shared.setValue(r._tintRGB).toPremultiplied(r.alpha,r.texture.baseTexture.alphaMode>0);n[i]=a,n[i+s]=a,n[i+2*s]=a,n[i+3*s]=a,i+=4*s}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}jo.extension={name:"particle",type:he.RendererPlugin},ue.add(jo);var Yo=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(Yo||{});const Go={willReadFrequently:!0},Wo=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0!==e){const r=L.ADAPTER.getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(t,e,r,n,s,i,o,a,h){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=s,this.lineWidths=i,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(e,r,n,s=t._canvas){n=n??r.wordWrap;const i=r.toFontString(),o=t.measureFont(i);0===o.fontSize&&(o.fontSize=r.fontSize,o.ascent=r.fontSize);const a=s.getContext("2d",Go);a.font=i;const h=(n?t.wordWrap(e,r,s):e).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let c=0;for(let e=0;e<h.length;e++){const n=t._measureText(h[e],r.letterSpacing,a);l[e]=n,c=Math.max(c,n)}let u=c+r.strokeThickness;r.dropShadow&&(u+=r.dropShadowDistance);const d=r.lineHeight||o.fontSize+r.strokeThickness;let f=Math.max(d,o.fontSize+2*r.strokeThickness)+r.leading+(h.length-1)*(d+r.leading);return r.dropShadow&&(f+=r.dropShadowDistance),new t(e,r,u,f,h,l,d+r.leading,c,o)}static _measureText(e,r,n){let s=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(n.letterSpacing=`${r}px`,n.textLetterSpacing=`${r}px`,s=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let i=n.measureText(e).width;return i>0&&(s?i-=r:i+=(t.graphemeSegmenter(e).length-1)*r),i}static wordWrap(e,r,n=t._canvas){const s=n.getContext("2d",Go);let i=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:c}=r,u=t.collapseSpaces(c),d=t.collapseNewlines(c);let f=!u;const p=r.wordWrapWidth+l,m=t.tokenize(e);for(let e=0;e<m.length;e++){let n=m[e];if(t.isNewline(n)){if(!d){a+=t.addLine(o),f=!u,o="",i=0;continue}n=" "}if(u){const e=t.isBreakingSpace(n),r=t.isBreakingSpace(o[o.length-1]);if(e&&r)continue}const c=t.getFromCache(n,l,h,s);if(c>p)if(""!==o&&(a+=t.addLine(o),o="",i=0),t.canBreakWords(n,r.breakWords)){const e=t.wordWrapSplit(n);for(let c=0;c<e.length;c++){let u=e[c],d=u,m=1;for(;e[c+m];){const s=e[c+m];if(t.canBreakChars(d,s,n,c,r.breakWords))break;u+=s,d=s,m++}c+=m-1;const g=t.getFromCache(u,l,h,s);g+i>p&&(a+=t.addLine(o),f=!1,o="",i=0),o+=u,i+=g}}else{o.length>0&&(a+=t.addLine(o),o="",i=0);const r=e===m.length-1;a+=t.addLine(n,!r),f=!1,o="",i=0}else c+i>p&&(f=!1,a+=t.addLine(o),o="",i=0),(o.length>0||!t.isBreakingSpace(n)||f)&&(o+=n,i+=c)}return a+=t.addLine(o,!1),a}static addLine(e,r=!0){return e=t.trimRight(e),r?`${e}\n`:e}static getFromCache(e,r,n,s){let i=n[e];return"number"!=typeof i&&(i=t._measureText(e,r,s)+r,n[e]=i),i}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(e){if("string"!=typeof e)return"";for(let r=e.length-1;r>=0;r--){const n=e[r];if(!t.isBreakingSpace(n))break;e=e.slice(0,-1)}return e}static isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const r=[];let n="";if("string"!=typeof e)return r;for(let s=0;s<e.length;s++){const i=e[s],o=e[s+1];t.isBreakingSpace(i,o)||t.isNewline(i)?(""!==n&&(r.push(n),n=""),r.push(i)):n+=i}return""!==n&&r.push(n),r}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,s){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const r={ascent:0,descent:0,fontSize:0},n=t._canvas,s=t._context;s.font=e;const i=t.METRICS_STRING+t.BASELINE_SYMBOL,o=Math.ceil(s.measureText(i).width);let a=Math.ceil(s.measureText(t.BASELINE_SYMBOL).width);const h=Math.ceil(t.HEIGHT_MULTIPLIER*a);if(a=a*t.BASELINE_MULTIPLIER|0,0===o||0===h)return t._fonts[e]=r,r;n.width=o,n.height=h,s.fillStyle="#f00",s.fillRect(0,0,o,h),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(i,0,a);const l=s.getImageData(0,0,o,h).data,c=l.length,u=4*o;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let t=0;t<u;t+=4)if(255!==l[f+t]){p=!0;break}if(p)break;f+=u}for(r.ascent=a-d,f=c-u,p=!1,d=h;d>a;--d){for(let t=0;t<u;t+=4)if(255!==l[f+t]){p=!0;break}if(p)break;f-=u}return r.descent=d-a,r.fontSize=r.ascent+r.descent,t._fonts[e]=r,r}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let e;try{const r=new OffscreenCanvas(0,0);if(r.getContext("2d",Go)?.measureText)return t.__canvas=r,r;e=L.ADAPTER.createCanvas()}catch{e=L.ADAPTER.createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",Go)),t.__context}};Wo.METRICS_STRING="|ÉqÅ",Wo.BASELINE_SYMBOL="M",Wo.BASELINE_MULTIPLIER=1.4,Wo.HEIGHT_MULTIPLIER=2,Wo.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),Wo.experimentalLetterSpacing=!1,Wo._fonts={},Wo._newlines=[10,13],Wo._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Ho=Wo;const $o=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],zo=class t{constructor(t){this.styleID=0,this.reset(),Zo(this,t,t)}clone(){const e={};return Zo(e,this,t.defaultStyle),new t(e)}reset(){Zo(this,t.defaultStyle,t.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Ko(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Ko(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Ko(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let r=e[t].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!$o.includes(r)&&(r=`"${r}"`),e[t]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};zo.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Yo.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let qo=zo;function Ko(t){const e=Xt.shared,r=t=>{const r=e.setValue(t);return 1===r.alpha?r.toHex():r.toRgbaString()};return Array.isArray(t)?t.map(r):r(t)}function Zo(t,e,r){for(const n in r)Array.isArray(e[n])?t[n]=e[n].slice():t[n]=e[n]}const Qo={texture:!0,children:!1,baseTexture:!0},Jo=class t extends bs{constructor(e,r,n){let s=!1;n||(n=L.ADAPTER.createCanvas(),s=!0),n.width=3,n.height=3;const i=Ur.from(n);i.orig=new Ue,i.trim=new Ue,super(i),this._ownCanvas=s,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=t.defaultResolution??L.RESOLUTION,this._autoResolution=t.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=r,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ho.experimentalLetterSpacing}static set experimentalLetterSpacing(t){ot("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ho.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,n=Ho.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=n.width,i=n.height,o=n.lines,a=n.lineHeight,h=n.lineWidths,l=n.maxLineWidth,c=n.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,i)+2*e.padding)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;const f=e.dropShadow?2:1;for(let t=0;t<f;++t){const s=e.dropShadow&&0===t,f=s?Math.ceil(Math.max(1,i)+2*e.padding):0,p=f*this._resolution;if(s){r.fillStyle="black",r.strokeStyle="black";const t=e.dropShadowColor,n=e.dropShadowBlur*this._resolution,s=e.dropShadowDistance*this._resolution;r.shadowColor=Xt.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=n,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*s,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*s+p}else r.fillStyle=this._generateFillStyle(e,o,n),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let m=(a-c.fontSize)/2;a-c.fontSize<0&&(m=0);for(let t=0;t<o.length;t++)u=e.strokeThickness/2,d=e.strokeThickness/2+t*a+c.ascent+m,"right"===e.align?u+=l-h[t]:"center"===e.align&&(u+=(l-h[t])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[t],u+e.padding,d+e.padding-f,!0),e.fill&&this.drawLetterSpacing(o[t],u+e.padding,d+e.padding-f)}this.updateTexture()}drawLetterSpacing(t,e,r,n=!1){const s=this._style.letterSpacing;let i=!1;if(Ho.experimentalLetterSpacingSupported&&(Ho.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,i=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===s||i)return void(n?this.context.strokeText(t,e,r):this.context.fillText(t,e,r));let o=e;const a=Ho.graphemeSegmenter(t);let h=this.context.measureText(t).width,l=0;for(let t=0;t<a.length;++t){const e=a[t];n?this.context.strokeText(e,o,r):this.context.fillText(e,o,r);let i="";for(let e=t+1;e<a.length;++e)i+=a[e];l=this.context.measureText(i).width,o+=h-l+s,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=function(t){const e=function(t){const{width:e,height:r}=t,n=t.getContext("2d",{willReadFrequently:!0});if(null===n)throw new TypeError("Failed to get canvas 2D context");const s=n.getImageData(0,0,e,r).data;let i=0,o=0,a=e-1,h=r-1;for(;o<r&&ie(s,e,o);)++o;if(o===r)return te.EMPTY;for(;ie(s,e,h);)--h;for(;oe(s,e,i,o,h);)++i;for(;oe(s,e,a,o,h);)--a;return++a,++h,new te(i,o,a,h)}(t),{width:r,height:n}=e;let s=null;if(!e.isEmpty()){const i=t.getContext("2d");if(null===i)throw new TypeError("Failed to get canvas 2D context");s=i.getImageData(e.left,e.top,r,n)}return{width:r,height:n,data:s}}(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,r=this._style,n=r.trim?0:r.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-2*n,e.orig.height=e._frame.height-2*n,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const n=t.fill;if(!Array.isArray(n))return n;if(1===n.length)return n[0];let s;const i=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-i-2*o,h=this.canvas.height/this._resolution-i-2*o,l=n.slice(),c=t.fillGradientStops.slice();if(!c.length){const t=l.length+1;for(let e=1;e<t;++e)c.push(e/t)}if(l.unshift(n[0]),c.unshift(0),l.push(n[n.length-1]),c.push(1),t.fillGradientType===Yo.LINEAR_VERTICAL){s=this.context.createLinearGradient(a/2,o,a/2,h+o);const n=r.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const i=r.lineHeight*(t-1)+n,o=r.lineHeight*t;let a=o;t>0&&i>o&&(a=(o+i)/2);const u=o+n,d=r.lineHeight*(t+1);let f=u;t+1<e.length&&d<u&&(f=(u+d)/2);const p=(f-a)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof c[t]?c[t]:t/l.length;let r=Math.min(1,Math.max(0,a/h+e*p));r=Number(r.toFixed(5)),s.addColorStop(r,l[t])}}}else{s=this.context.createLinearGradient(o,h/2,a+o,h/2);const t=l.length+1;let e=1;for(let r=0;r<l.length;r++){let n;n="number"==typeof c[r]?c[r]:e/t,s.addColorStop(n,l[r]),e++}}return s}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Qo,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Kt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Kt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof qo?t:new qo(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Jo.defaultAutoResolution=!0;let ta=Jo;class ea{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function ra(t,e){let r=!1;if(t?._textures?.length)for(let n=0;n<t._textures.length;n++)if(t._textures[n]instanceof Ur){const s=t._textures[n].baseTexture;e.includes(s)||(e.push(s),r=!0)}return r}function na(t,e){if(t.baseTexture instanceof Ee){const r=t.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function sa(t,e){if(t._texture&&t._texture instanceof Ur){const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function ia(t,e){return e instanceof ta&&(e.updateText(!0),!0)}function oa(t,e){if(e instanceof qo){const t=e.toFontString();return Ho.measureFont(t),!0}return!1}function aa(t,e){if(t instanceof ta){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function ha(t,e){return t instanceof qo&&(e.includes(t)||e.push(t),!0)}const la=class t{constructor(e){this.limiter=new ea(t.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(aa),this.registerFindHook(ha),this.registerFindHook(ra),this.registerFindHook(na),this.registerFindHook(sa),this.registerUploadHook(ia),this.registerUploadHook(oa)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Wn.system.addOnce(this.tick,this,jn.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Wn.system.addOnce(this.tick,this,jn.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ms)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Wn.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};la.uploadsPerFrame=4;let ca=la;function ua(t,e){return e instanceof Ee&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function da(t,e){if(!(e instanceof ko))return!1;const{geometry:r}=e;e.finishPoly(),r.updateBatches();const{batches:n}=r;for(let e=0;e<n.length;e++){const{texture:r}=n[e].style;r&&ua(t,r.baseTexture)}return r.batchable||t.geometry.bind(r,e._resolveDirectShader(t)),!0}function fa(t,e){return t instanceof ko&&(e.push(t),!0)}Object.defineProperties(L,{UPLOADS_PER_FRAME:{get:()=>ca.uploadsPerFrame,set(t){ot("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),ca.uploadsPerFrame=t}}});class pa extends ca{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(fa),this.registerUploadHook(ua),this.registerUploadHook(da)}}pa.extension={name:"prepare",type:he.RendererSystem},ue.add(pa),new Le;var ma="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const ga=new We;class ya extends Tr{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Gr,this.state=me.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=vr.from(ma,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?vr.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):vr.from(ma,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,i=t.uvRespectAnchor?t.anchor.y:0;n=r.uvs,n[0]=n[6]=-s,n[1]=n[3]=-i,n[2]=n[4]=1-s,n[5]=n[7]=1-i,r.invalidate();const o=t._texture,a=o.baseTexture,h=a.alphaMode>0,l=t.tileTransform.localTransform,c=t.uvMatrix;let u=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;u&&(a._glTextures[e.CONTEXT_UID]?u=a.wrapMode!==I.CLAMP:a.wrapMode===I.CLAMP&&(a.wrapMode=I.REPEAT));const d=u?this.simpleShader:this.shader,f=o.width,p=o.height,m=t._width,g=t._height;ga.set(l.a*f/m,l.b*f/g,l.c*p/m,l.d*p/g,l.tx/m,l.ty/g),ga.invert(),u?ga.prepend(c.mapCoord):(d.uniforms.uMapCoord=c.mapCoord.toArray(!0),d.uniforms.uClampFrame=c.uClampFrame,d.uniforms.uClampOffset=c.uClampOffset),d.uniforms.uTransform=ga.toArray(!0),d.uniforms.uColor=Xt.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=o,e.shader.bind(d),e.geometry.bind(r),this.state.blendMode=Gt(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}ya.extension={name:"tilingSprite",type:he.RendererPlugin},ue.add(ya);const ba=class t{constructor(t,e,r=null){this.linkedSheets=[],this._texture=t instanceof Ur?t:null,this.baseTexture=t instanceof Ee?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=ae(t,null);return null===r&&(r=parseFloat(e??"1")),1!==r&&this.baseTexture.setResolution(r),r}parse(){return new Promise((e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(e){let r=e;const n=t.BATCH_SIZE;for(;r-e<n&&r<this._frameKeys.length;){const t=this._frameKeys[r],e=this._frames[t],n=e.frame;if(n){let r=null,s=null;const i=!1!==e.trimmed&&e.sourceSize?e.sourceSize:e.frame,o=new Ue(0,0,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution);r=e.rotated?new Ue(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):new Ue(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),!1!==e.trimmed&&e.spriteSourceSize&&(s=new Ue(Math.floor(e.spriteSourceSize.x)/this.resolution,Math.floor(e.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[t]=new Ur(this.baseTexture,r,o,s,e.rotated?2:0,e.anchor,e.borders),Ur.addToCache(this.textures[t],t.toString())}r++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const n=t[e][r];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*t.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};ba.BATCH_SIZE=1e3;let xa=ba;const _a=["jpg","png","jpeg","avif","webp"];function va(t,e,r){const n={};if(t.forEach((t=>{n[t]=e})),Object.keys(e.textures).forEach((t=>{n[t]=e.textures[t]})),!r){const r=lt.dirname(t[0]);e.linkedSheets.forEach(((t,s)=>{const i=va([`${r}/${e.data.meta.related_multi_packs[s]}`],t,!0);Object.assign(n,i)}))}return n}const wa={extension:he.Asset,cache:{test:t=>t instanceof xa,getCacheableAssets:(t,e)=>va(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),r=e.pop(),n=e.pop();return"json"===r&&_a.includes(n)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(L.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:he.LoadParser,priority:Zs.Normal},testParse:async(t,e)=>".json"===lt.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,r){let n=lt.dirname(e.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");let s=n+t.meta.image;s=Di(s,e.src);const i=(await r.load([s]))[s],o=new xa(i.baseTexture,t,e.src);await o.parse();const a=t?.meta?.related_multi_packs;if(Array.isArray(a)){const t=[];for(const s of a){if("string"!=typeof s)continue;let i=n+s;e.data?.ignoreMultiPack||(i=Di(i,e.src),t.push(r.load({src:i,data:{ignoreMultiPack:!0}})))}const s=await Promise.all(t);o.linkedSheets=s,s.forEach((t=>{t.linkedSheets=[o].concat(o.linkedSheets.filter((e=>e!==t)))}))}return o},unload(t){t.destroy(!0)}}};ue.add(wa);class Ea{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Ta{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in e){const n=e[t].match(/^[a-z]+/gm)[0],s=e[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),i={};for(const t in s){const e=s[t].split("="),r=e[0],n=e[1].replace(/"/gm,""),o=parseFloat(n),a=isNaN(o)?n:o;i[r]=a}r[n].push(i)}const n=new Ea;return r.info.forEach((t=>n.info.push({face:t.face,size:parseInt(t.size,10)}))),r.common.forEach((t=>n.common.push({lineHeight:parseInt(t.lineHeight,10)}))),r.page.forEach((t=>n.page.push({id:parseInt(t.id,10),file:t.file}))),r.char.forEach((t=>n.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),r.kerning.forEach((t=>n.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),r.distanceField.forEach((t=>n.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),n}}class Aa{static test(t){const e=t;return"string"!=typeof t&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Ea,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),i=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let t=0;t<r.length;t++)e.info.push({face:r[t].getAttribute("face"),size:parseInt(r[t].getAttribute("size"),10)});for(let t=0;t<n.length;t++)e.common.push({lineHeight:parseInt(n[t].getAttribute("lineHeight"),10)});for(let t=0;t<s.length;t++)e.page.push({id:parseInt(s[t].getAttribute("id"),10)||0,file:s[t].getAttribute("file")});for(let t=0;t<i.length;t++){const r=i[t];e.char.push({id:parseInt(r.getAttribute("id"),10),page:parseInt(r.getAttribute("page"),10)||0,x:parseInt(r.getAttribute("x"),10),y:parseInt(r.getAttribute("y"),10),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10),xoffset:parseInt(r.getAttribute("xoffset"),10),yoffset:parseInt(r.getAttribute("yoffset"),10),xadvance:parseInt(r.getAttribute("xadvance"),10)})}for(let t=0;t<o.length;t++)e.kerning.push({first:parseInt(o[t].getAttribute("first"),10),second:parseInt(o[t].getAttribute("second"),10),amount:parseInt(o[t].getAttribute("amount"),10)});for(let t=0;t<a.length;t++)e.distanceField.push({fieldType:a[t].getAttribute("fieldType"),distanceRange:parseInt(a[t].getAttribute("distanceRange"),10)});return e}}class Sa{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&Aa.test(L.ADAPTER.parseXML(t))}static parse(t){return Aa.parse(L.ADAPTER.parseXML(t))}}const Ra=[Ta,Aa,Sa];function Ia(t,e,r,n,s,i,o){const a=r.text,h=r.fontProperties;e.translate(n,s),e.scale(i,i);const l=o.strokeThickness/2,c=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,r,n,s,i){const o=r.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const h=r.dropShadow?r.dropShadowDistance:0,l=r.padding||0,c=t.width/n-h-2*l,u=t.height/n-h-2*l,d=o.slice(),f=r.fillGradientStops.slice();if(!f.length){const t=d.length+1;for(let e=1;e<t;++e)f.push(e/t)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),r.fillGradientType===Yo.LINEAR_VERTICAL){a=e.createLinearGradient(c/2,l,c/2,u+l);let t=0;const n=(i.fontProperties.fontSize+r.strokeThickness)/u;for(let e=0;e<s.length;e++){const r=i.lineHeight*e;for(let e=0;e<d.length;e++){let s=0;s="number"==typeof f[e]?f[e]:e/d.length;const i=r/u+s*n;let o=Math.max(t,i);o=Math.min(o,1),a.addColorStop(o,d[e]),t=o}}}else{a=e.createLinearGradient(l,u/2,c+l,u/2);const t=d.length+1;let r=1;for(let e=0;e<d.length;e++){let n;n="number"==typeof f[e]?f[e]:r/t,a.addColorStop(n,d[e]),r++}}return a}(t,e,o,i,[a],r),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,r=o.dropShadowBlur*i,n=o.dropShadowDistance*i;e.shadowColor=Xt.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=r,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*n,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*n}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,l,c+r.lineHeight-h.descent),o.fill&&e.fillText(a,l,c+r.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Ma(t){return Array.from?Array.from(t):t.split("")}function Pa(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const Ca=class t{constructor(t,e,r){const[n]=t.info,[s]=t.common,[i]=t.page,[o]=t.distanceField,a=ae(i.file),h={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=h;for(let r=0;r<t.page.length;r++){const{id:n,file:s}=t.page[r];h[n]=e instanceof Array?e[r]:e[s],o?.fieldType&&"none"!==o.fieldType&&(h[n].baseTexture.alphaMode=P.NO_PREMULTIPLIED_ALPHA,h[n].baseTexture.mipmap=M.OFF)}for(let e=0;e<t.char.length;e++){const{id:r,page:n}=t.char[e];let{x:s,y:i,width:o,height:l,xoffset:c,yoffset:u,xadvance:d}=t.char[e];s/=a,i/=a,o/=a,l/=a,c/=a,u/=a,d/=a;const f=new Ue(s+h[n].frame.x/a,i+h[n].frame.y/a,o,l);this.chars[r]={xOffset:c,yOffset:u,xAdvance:d,kerning:{},texture:new Ur(h[n].baseTexture,f),page:n}}for(let e=0;e<t.kerning.length;e++){let{first:r,second:n,amount:s}=t.kerning[e];r/=a,n/=a,s/=a,this.chars[n]&&(this.chars[n].kerning[r]=s)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(e,r,n){let s;if(e instanceof Ea)s=e;else{const t=function(t){for(let e=0;e<Ra.length;e++)if(Ra[e].test(t))return Ra[e];return null}(e);if(!t)throw new Error("Unrecognized data format for font.");s=t.parse(e)}r instanceof Ur&&(r=[r]);const i=new t(s,r,n);return t.available[i.font]=i,i}static uninstall(e){const r=t.available[e];if(!r)throw new Error(`No font found named '${e}'`);r.destroy(),delete t.available[e]}static from(e,r,n){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:i,resolution:o,textureWidth:a,textureHeight:h,...l}=Object.assign({},t.defaultOptions,n),c=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];if(Array.isArray(n)){if(2!==n.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const t=n[0].charCodeAt(0),r=n[1].charCodeAt(0);if(r<t)throw new Error("[BitmapFont]: Invalid character range.");for(let n=t,s=r;n<=s;n++)e.push(String.fromCharCode(n))}else e.push(...Ma(n))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(s),u=r instanceof qo?r:new qo(r),d=a,f=new Ea;f.info[0]={face:u.fontFamily,size:u.fontSize},f.common[0]={lineHeight:u.fontSize};let p,m,g,y=0,b=0,x=0;const _=[],v=[];for(let t=0;t<c.length;t++){p||(p=L.ADAPTER.createCanvas(),p.width=a,p.height=h,m=p.getContext("2d"),g=new Ee(p,{resolution:o,...l}),_.push(g),v.push(new Ur(g)),f.page.push({id:v.length-1,file:""}));const e=c[t],r=Ho.measureText(e,u,!1,p),n=r.width,s=Math.ceil(r.height),w=Math.ceil(("italic"===u.fontStyle?2:1)*n);if(b>=h-s*o){if(0===b)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${e}')`);--t,p=null,m=null,g=null,b=0,y=0,x=0;continue}if(x=Math.max(s+r.fontProperties.descent,x),w*o+y>=d){if(0===y)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${e}')`);--t,b+=x*o,b=Math.ceil(b),y=0,x=0;continue}Ia(p,m,r,y,b,o,u);const E=Pa(r.text);f.char.push({id:E,page:v.length-1,x:y/o,y:b/o,width:w,height:s,xoffset:0,yoffset:0,xadvance:n-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),y+=(w+2*i)*o,y=Math.ceil(y)}if(!n?.skipKerning)for(let t=0,e=c.length;t<e;t++){const r=c[t];for(let t=0;t<e;t++){const e=c[t],n=m.measureText(r).width,s=m.measureText(e).width,i=m.measureText(r+e).width-(n+s);i&&f.kerning.push({first:Pa(r),second:Pa(e),amount:i})}}const w=new t(f,v,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=w,w}};Ca.ALPHA=[["a","z"],["A","Z"]," "],Ca.NUMERIC=[["0","9"]],Ca.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Ca.ASCII=[[" ","~"]],Ca.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Ca.ALPHANUMERIC},Ca.available={};let ka=Ca;const Oa=[],Fa=[],Na=[];(class t extends ms{constructor(e,r={}){super();const{align:n,tint:s,maxWidth:i,letterSpacing:o,fontName:a,fontSize:h}=Object.assign({},t.styleDefaults,r);if(!ka.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tintColor=new Xt(s),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=e,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new tr((()=>{this.dirty=!0}),this,0,0),this._roundPixels=L.ROUND_PIXELS,this.dirty=!0,this._resolution=L.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=ka.available[this._fontName],e=this.fontSize,r=e/t.size,n=new Le,s=[],i=[],o=[],a=Ma(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),h=this._maxWidth*t.size/e,l="none"===t.distanceFieldType?Oa:Fa;let c=null,u=0,d=0,f=0,p=-1,m=0,g=0,y=0,b=0;for(let e=0;e<a.length;e++){const r=a[e],l=Pa(r);if(/(?:\s)/.test(r)&&(p=e,m=u,b++),"\r"===r||"\n"===r){i.push(u),o.push(-1),d=Math.max(d,u),++f,++g,n.x=0,n.y+=t.lineHeight,c=null,b=0;continue}const x=t.chars[l];if(!x)continue;c&&x.kerning[c]&&(n.x+=x.kerning[c]);const _=Na.pop()||{texture:Ur.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Le};_.texture=x.texture,_.line=f,_.charCode=l,_.position.x=Math.round(n.x+x.xOffset+this._letterSpacing/2),_.position.y=Math.round(n.y+x.yOffset),_.prevSpaces=b,s.push(_),u=_.position.x+Math.max(x.xAdvance-x.xOffset,x.texture.orig.width),n.x+=x.xAdvance+this._letterSpacing,y=Math.max(y,x.yOffset+x.texture.height),c=l,-1!==p&&h>0&&n.x>h&&(++g,qt(s,1+p-g,1+e-p),e=p,p=-1,i.push(m),o.push(s.length>0?s[s.length-1].prevSpaces:0),d=Math.max(d,m),f++,n.x=0,n.y+=t.lineHeight,c=null,b=0)}const x=a[a.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(u=m),i.push(u),d=Math.max(d,u),o.push(-1));const _=[];for(let t=0;t<=f;t++){let e=0;"right"===this._align?e=d-i[t]:"center"===this._align?e=(d-i[t])/2:"justify"===this._align&&(e=o[t]<0?0:(d-i[t])/o[t]),_.push(e)}const w=s.length,E={},T=[],A=this._activePagesMeshData;l.push(...A);for(let e=0;e<w;e++){const r=s[e].texture,n=r.baseTexture.uid;if(!E[n]){let e=l.pop();if(!e){const r=new Lo;let n,s;"none"===t.distanceFieldType?(n=new Vo(Ur.EMPTY),s=v.NORMAL):(n=new Vo(Ur.EMPTY,{program:br.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),s=v.NORMAL_NPM);const i=new Do(r,n);i.blendMode=s,e={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:i,vertices:null,uvs:null,indices:null}}e.index=0,e.indexCount=0,e.vertexCount=0,e.uvsCount=0,e.total=0;const{_textureCache:s}=this;s[n]=s[n]||new Ur(r.baseTexture),e.mesh.texture=s[n],e.mesh.tint=this._tintColor.value,T.push(e),E[n]=e}E[n].total++}for(let t=0;t<A.length;t++)T.includes(A[t])||this.removeChild(A[t].mesh);for(let t=0;t<T.length;t++)T[t].mesh.parent!==this&&this.addChild(T[t].mesh);this._activePagesMeshData=T;for(const t in E){const e=E[t],r=e.total;if(!(e.indices?.length>6*r)||e.vertices.length<2*Do.BATCHABLE_SIZE)e.vertices=new Float32Array(8*r),e.uvs=new Float32Array(8*r),e.indices=new Uint16Array(6*r);else{const t=e.total,r=e.vertices;for(let e=4*t*2;e<r.length;e++)r[e]=0}e.mesh.size=6*r}for(let t=0;t<w;t++){const e=s[t];let n=e.position.x+_[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(n=Math.round(n));const i=n*r,o=e.position.y*r,a=e.texture,h=E[a.baseTexture.uid],l=a.frame,c=a._uvs,u=h.index++;h.indices[6*u+0]=0+4*u,h.indices[6*u+1]=1+4*u,h.indices[6*u+2]=2+4*u,h.indices[6*u+3]=0+4*u,h.indices[6*u+4]=2+4*u,h.indices[6*u+5]=3+4*u,h.vertices[8*u+0]=i,h.vertices[8*u+1]=o,h.vertices[8*u+2]=i+l.width*r,h.vertices[8*u+3]=o,h.vertices[8*u+4]=i+l.width*r,h.vertices[8*u+5]=o+l.height*r,h.vertices[8*u+6]=i,h.vertices[8*u+7]=o+l.height*r,h.uvs[8*u+0]=c.x0,h.uvs[8*u+1]=c.y0,h.uvs[8*u+2]=c.x1,h.uvs[8*u+3]=c.y1,h.uvs[8*u+4]=c.x2,h.uvs[8*u+5]=c.y2,h.uvs[8*u+6]=c.x3,h.uvs[8*u+7]=c.y3}this._textWidth=d*r,this._textHeight=(n.y+t.lineHeight)*r;for(const t in E){const e=E[t];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const r=this._textWidth*this.anchor.x,n=this._textHeight*this.anchor.y;for(let s=0;s<e.total;s++)e.vertices[t++]-=r,e.vertices[t++]-=n,e.vertices[t++]-=r,e.vertices[t++]-=n,e.vertices[t++]-=r,e.vertices[t++]-=n,e.vertices[t++]-=r,e.vertices[t++]-=n}this._maxLineHeight=y*r;const n=e.mesh.geometry.getBuffer("aVertexPosition"),s=e.mesh.geometry.getBuffer("aTextureCoord"),i=e.mesh.geometry.getIndex();n.data=e.vertices,s.data=e.uvs,i.data=e.indices,n.update(),s.update(),i.update()}for(let t=0;t<s.length;t++)Na.push(s[t]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:n}=ka.available[this._fontName];if("none"!==r){const{a:r,b:s,c:i,d:o}=this.worldTransform,a=Math.sqrt(r*r+s*s),h=Math.sqrt(i*i+o*o),l=(Math.abs(a)+Math.abs(h))/2,c=this.fontSize/n,u=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*c*u}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=ka.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!ka.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??ka.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r="none"===ka.available[this._fontName].distanceFieldType?Oa:Fa;r.push(...this._activePagesMeshData);for(const t of this._activePagesMeshData)this.removeChild(t.mesh);this._activePagesMeshData=[],r.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Ur.EMPTY}));for(const t in e)e[t].destroy(),delete e[t];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}}).styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const Ba=[".xml",".fnt"],Da={extension:{type:he.LoadParser,priority:Zs.Normal},name:"loadBitmapFont",test:t=>Ba.includes(lt.extname(t).toLowerCase()),testParse:async t=>Ta.test(t)||Sa.test(t),async parse(t,e,r){const n=Ta.test(t)?Ta.parse(t):Sa.parse(t),{src:s}=e,{page:i}=n,o=[];for(let t=0;t<i.length;++t){const e=i[t].file;let r=lt.join(lt.dirname(s),e);r=Di(r,s),o.push(r)}const a=await r.load(o),h=o.map((t=>a[t]));return ka.install(n,h,!0)},load:async(t,e)=>(await L.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};ue.add(Da);const La=class t extends qo{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new t(Object.keys(t.defaultOptions).reduce(((t,r)=>({...t,[r]:e[r]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((e=>{URL.revokeObjectURL(e.src),e.refs--,0===e.refs&&(e.fontFace&&document.fonts.delete(e.fontFace),delete t.availableFonts[e.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,r={}){const{availableFonts:n}=t;if(n[e]){const t=n[e];return this._fonts.push(t),t.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return L.ADAPTER.fetch(e).then((t=>t.blob())).then((async t=>new Promise(((e,r)=>{const n=URL.createObjectURL(t),s=new FileReader;s.onload=()=>e([n,s.result]),s.onerror=r,s.readAsDataURL(t)})))).then((async([t,s])=>{const i=Object.assign({family:lt.basename(e,lt.extname(e)),weight:"normal",style:"normal",display:"auto",src:t,dataSrc:s,refs:1,originalUrl:e,fontFace:null},r);n[e]=i,this._fonts.push(i),this.styleID++;const o=new FontFace(i.family,`url(${i.src})`,{weight:i.weight,style:i.style,display:i.display});i.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style};\n                font-display: ${e.display};\n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=jt(t)),"number"==typeof t?(e=t,ot("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Xt.shared.setValue(e).toHex()):t;var e}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const s=`${r}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,t.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=L.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};La.availableFonts={},La.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let Va=La;const Ua=class t extends bs{constructor(e="",r={}){super(Ur.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const n=new Image,s=Ur.from(n,{scaleMode:L.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new Ue,s.trim=new Ue,this.texture=s;const i="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(i,"svg"),h=document.createElementNS(i,"foreignObject"),l=document.createElementNS(o,"div"),c=document.createElementNS(o,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=t.defaultMaxWidth,this.maxHeight=t.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=n,this._loadImage=new Image,this._autoResolution=t.defaultAutoResolution,this._resolution=t.defaultResolution??L.RESOLUTION,this.text=e,this.style=r}measureText(t){const{text:e,style:r,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:r.toCSS(n)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const s=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:i,height:o}=s;(i>this.maxWidth||o>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const a=Math.min(this.maxWidth,Math.ceil(i)),h=Math.min(this.maxHeight,Math.ceil(o));return this._svgRoot.setAttribute("width",a.toString()),this._svgRoot.setAttribute("height",h.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(n)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:a+2*r.padding,height:h+2*r.padding}}async updateText(t=!0){const{style:e,_image:r,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:i}=this.measureText();r.width=n.width=Math.ceil(Math.max(1,s)),r.height=n.height=Math.ceil(Math.max(1,i)),this._updateID++;const o=this._updateID;await new Promise((t=>{n.onload=async()=>{o<this._updateID||(await e.onBeforeDraw(),r.src=n.src,n.onload=null,n.src="",this.updateTexture()),t()};const s=(new XMLSerializer).serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(s)}`}))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:n}=this,{padding:s}=t,{baseTexture:i}=e;e.trim.width=e._frame.width=r.width/n,e.trim.height=e._frame.height=r.height/n,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-2*s,e.orig.height=e._frame.height-2*s,this._onTextureUpdate(),i.setRealSize(r.width,r.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},t.defaultDestroyOptions,e),super.destroy(e);const r=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=r,this._svgRoot?.remove(),this._svgRoot=r,this._domElement?.remove(),this._domElement=r,this._foreignObject?.remove(),this._foreignObject=r,this._styleElement?.remove(),this._styleElement=r,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=r,this._image.src="",this._image=r}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Kt(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Kt(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof Va?(this.ownsStyle=!1,this._style=t):t instanceof qo?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Va.from(t)):(this.ownsStyle=!0,this._style=new Va(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};Ua.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Ua.defaultMaxWidth=2024,Ua.defaultMaxHeight=2024,Ua.defaultAutoResolution=!0;var Xa="GAME_EVENT.BET",ja="GAME_EVENT.WIN",Ya="GAME_EVENT.LOSE",Ga="GAME_EVENT.RESET",Wa="GAME_EVENT.BACKGROUND_CHANGE_STAGE",Ha="GAME_EVENT.TOGGLE_FADE_MAIN_SOUND",$a="UI_EVENT.BET",za="UI_EVENT.BET_INCREASE",qa="UI_EVENT.BET_DECRASE",Ka="UI_EVENT.TAKE",Za="UI_EVENT.AUTO_TAKE_INCREASE",Qa="UI_EVENT.AUTO_TAKE_DECRASE",Ja="UI_EVENT.AUTO_BET",th="UI_EVENT.AUTO_TAKE",eh="SOUND_EVENT.POPUP_WIN",rh="SOUND_EVENT.POPUP_LOSE",nh="SOUND_EVENT.TRANSITION_OPEN",sh="SOUND_EVENT.TRANSITION_CLOSE",ih="SOUND_EVENT.BALLON",oh=(t=>(t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping",t))(oh||{});class ah{constructor(t,e=new Array,r=0,n=new DataView(t.buffer)){this.strings=e,this.index=r,this.buffer=n}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){const t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){const t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),r=127&e;return 0!=(128&e)&&(e=this.readByte(),r|=(127&e)<<7,0!=(128&e)&&(e=this.readByte(),r|=(127&e)<<14,0!=(128&e)&&(e=this.readByte(),r|=(127&e)<<21,0!=(128&e)&&(e=this.readByte(),r|=(127&e)<<28)))),t?r:r>>>1^-(1&r)}readStringRef(){const t=this.readInt(!0);return 0==t?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let r=0;r<t;){const t=this.readUnsignedByte();switch(t>>4){case 12:case 13:e+=String.fromCharCode((31&t)<<6|63&this.readByte()),r+=2;break;case 14:e+=String.fromCharCode((15&t)<<12|(63&this.readByte())<<6|63&this.readByte()),r+=3;break;default:e+=String.fromCharCode(t),r++}}return e}readFloat(){const t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return 0!=this.readByte()}}var hh=(t=>(t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add",t))(hh||{}),lh=(t=>(t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut",t))(lh||{}),ch=(t=>(t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent",t))(ch||{}),uh=(t=>(t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale",t))(uh||{}),dh=(t=>(t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection",t))(dh||{});function fh(t){switch(t.toLowerCase()){case"nearest":return ph.Nearest;case"linear":return ph.Linear;case"mipmap":return ph.MipMap;case"mipmapnearestnearest":return ph.MipMapNearestNearest;case"mipmaplinearnearest":return ph.MipMapLinearNearest;case"mipmapnearestlinear":return ph.MipMapNearestLinear;case"mipmaplinearlinear":return ph.MipMapLinearLinear;default:throw new Error(`Unknown texture filter ${t}`)}}var ph=(t=>(t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear",t))(ph||{}),mh=(t=>(t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat",t))(mh||{});class gh{constructor(){this.size=null,this.names=null,this.values=null,this.renderObject=null}get width(){const t=this.texture;return t.trim?t.trim.width:t.orig.width}get height(){const t=this.texture;return t.trim?t.trim.height:t.orig.height}get u(){return this.texture._uvs.x0}get v(){return this.texture._uvs.y0}get u2(){return this.texture._uvs.x2}get v2(){return this.texture._uvs.y2}get offsetX(){const t=this.texture;return t.trim?t.trim.x:0}get offsetY(){return this.spineOffsetY}get pixiOffsetY(){const t=this.texture;return t.trim?t.trim.y:0}get spineOffsetY(){const t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)}get originalWidth(){return this.texture.orig.width}get originalHeight(){return this.texture.orig.height}get x(){return this.texture.frame.x}get y(){return this.texture.frame.y}get rotate(){return 0!==this.texture.rotate}get degrees(){return(360-45*this.texture.rotate)%360}}class yh{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0,this.rotate=0,this.index=0}}class bh{constructor(t,e,r){this.pages=new Array,this.regions=new Array,t&&this.addSpineAtlas(t,e,r)}addTexture(t,e){const r=this.pages;let n=null;for(let t=0;t<r.length;t++)if(r[t].baseTexture===e.baseTexture){n=r[t];break}if(null===n){n=new _h,n.name="texturePage";const t=e.baseTexture;n.width=t.realWidth,n.height=t.realHeight,n.baseTexture=t,n.minFilter=n.magFilter=ph.Nearest,n.uWrap=mh.ClampToEdge,n.vWrap=mh.ClampToEdge,r.push(n)}const s=new vh;return s.name=t,s.page=n,s.texture=e,s.index=-1,this.regions.push(s),s}addTextureHash(t,e){for(const r in t)t.hasOwnProperty(r)&&this.addTexture(e&&-1!==r.indexOf(".")?r.substr(0,r.lastIndexOf(".")):r,t[r])}addSpineAtlas(t,e,r){return this.load(t,e,r)}load(t,e,r){if(null==e)throw new Error("textureLoader cannot be null.");const n=new xh(t),s=new Array(4);let i=null;const o={};let a=null;o.size=()=>{i.width=parseInt(s[1]),i.height=parseInt(s[2])},o.format=()=>{},o.filter=()=>{i.minFilter=fh(s[1]),i.magFilter=fh(s[2])},o.repeat=()=>{-1!=s[1].indexOf("x")&&(i.uWrap=mh.Repeat),-1!=s[1].indexOf("y")&&(i.vWrap=mh.Repeat)},o.pma=()=>{i.pma="true"==s[1]};const h={xy:()=>{a.x=parseInt(s[1]),a.y=parseInt(s[2])},size:()=>{a.width=parseInt(s[1]),a.height=parseInt(s[2])},bounds:()=>{a.x=parseInt(s[1]),a.y=parseInt(s[2]),a.width=parseInt(s[3]),a.height=parseInt(s[4])},offset:()=>{a.offsetX=parseInt(s[1]),a.offsetY=parseInt(s[2])},orig:()=>{a.originalWidth=parseInt(s[1]),a.originalHeight=parseInt(s[2])},offsets:()=>{a.offsetX=parseInt(s[1]),a.offsetY=parseInt(s[2]),a.originalWidth=parseInt(s[3]),a.originalHeight=parseInt(s[4])},rotate:()=>{const t=s[1];let e=0;e="true"==t.toLocaleLowerCase()?6:"false"==t.toLocaleLowerCase()?0:(720-parseFloat(t))%360/45,a.rotate=e},index:()=>{a.index=parseInt(s[1])}};let l=n.readLine();for(;null!=l&&0==l.trim().length;)l=n.readLine();for(;null!=l&&0!=l.trim().length&&0!=n.readEntry(s,l);)l=n.readLine();const c=()=>{for(;;){if(null==l)return r&&r(this);if(0==l.trim().length)i=null,l=n.readLine();else{if(null===i){for(i=new _h,i.name=l.trim();0!=n.readEntry(s,l=n.readLine());){const t=o[s[0]];t&&t()}this.pages.push(i),e(i.name,(t=>{if(null===t)return this.pages.splice(this.pages.indexOf(i),1),r&&r(null);i.baseTexture=t,i.pma&&(t.alphaMode=P.PMA),t.valid||t.setSize(i.width,i.height),i.setFilters(),i.width&&i.height||(i.width=t.realWidth,i.height=t.realHeight,i.width&&i.height||console.log(`ERROR spine atlas page ${i.name}: meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)`)),c()}));break}{a=new yh;const t=new vh;t.name=l,t.page=i;let e=null,r=null;for(;;){const t=n.readEntry(s,l=n.readLine());if(0==t)break;const i=h[s[0]];if(i)i();else{null==e&&(e=[],r=[]),e.push(s[0]);const n=[];for(let e=0;e<t;e++)n.push(parseInt(s[e+1]));r.push(n)}}0==a.originalWidth&&0==a.originalHeight&&(a.originalWidth=a.width,a.originalHeight=a.height);const o=i.baseTexture.resolution;a.x/=o,a.y/=o,a.width/=o,a.height/=o,a.originalWidth/=o,a.originalHeight/=o,a.offsetX/=o,a.offsetY/=o;const c=a.rotate%4!=0,u=new Ue(a.x,a.y,c?a.height:a.width,c?a.width:a.height),d=new Ue(0,0,a.originalWidth,a.originalHeight),f=new Ue(a.offsetX,a.originalHeight-a.height-a.offsetY,a.width,a.height);t.texture=new Ur(t.page.baseTexture,u,d,f,a.rotate),t.index=a.index,t.texture.updateUvs(),this.regions.push(t)}}}};c()}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].baseTexture.dispose()}}class xh{constructor(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(null==e)return 0;if(0==(e=e.trim()).length)return 0;const r=e.indexOf(":");if(-1==r)return 0;t[0]=e.substr(0,r).trim();for(let n=1,s=r+1;;n++){const r=e.indexOf(",",s);if(-1==r)return t[n]=e.substr(s).trim(),n;if(t[n]=e.substr(s,r-s).trim(),s=r+1,4==n)return 4}}}class _h{constructor(){this.minFilter=ph.Nearest,this.magFilter=ph.Nearest,this.uWrap=mh.ClampToEdge,this.vWrap=mh.ClampToEdge}setFilters(){const t=this.baseTexture,e=this.minFilter;e==ph.Linear?t.scaleMode=R.LINEAR:this.minFilter==ph.Nearest?t.scaleMode=R.NEAREST:(t.mipmap=M.POW2,e==ph.MipMapNearestNearest?t.scaleMode=R.NEAREST:t.scaleMode=R.LINEAR)}}class vh extends gh{}class wh{constructor(){this.array=new Array}add(t){const e=this.contains(t);return this.array[0|t]=0|t,!e}contains(t){return null!=this.array[0|t]}remove(t){this.array[0|t]=void 0}clear(){this.array.length=0}}class Eh{constructor(){this.entries={},this.size=0}add(t){const e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}addAll(t){const e=this.size;for(let e=0,r=t.length;e<r;e++)this.add(t[e]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}const Th=class{constructor(t=0,e=0,r=0,n=0){this.r=t,this.g=e,this.b=r,this.a=n}set(t,e,r,n){return this.r=t,this.g=e,this.b=r,this.a=n,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,r,n){return this.r+=t,this.g+=e,this.b+=r,this.a+=n,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}static fromString(t){return(new Th).setFromString(t)}};let Ah=Th;Ah.WHITE=new Th(1,1,1,1),Ah.RED=new Th(1,0,0,1),Ah.GREEN=new Th(0,1,0,1),Ah.BLUE=new Th(0,0,1,1),Ah.MAGENTA=new Th(1,0,1,1);const Sh=class{static clamp(t,e,r){return t<e?e:t>r?r:t}static cosDeg(t){return Math.cos(t*Sh.degRad)}static sinDeg(t){return Math.sin(t*Sh.degRad)}static signum(t){return Math.sign(t)}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){const e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(t,e){return Sh.randomTriangularWith(t,e,.5*(t+e))}static randomTriangularWith(t,e,r){const n=Math.random(),s=e-t;return n<=(r-t)/s?t+Math.sqrt(n*s*(r-t)):e-Math.sqrt((1-n)*s*(e-r))}static isPowerOfTwo(t){return t&&0==(t&t-1)}};let Rh=Sh;Rh.PI=3.1415927,Rh.PI2=2*Sh.PI,Rh.radiansToDegrees=180/Sh.PI,Rh.radDeg=Sh.radiansToDegrees,Rh.degreesToRadians=Sh.PI/180,Rh.degRad=Sh.degreesToRadians;class Ih{apply(t,e,r){return t+(e-t)*this.applyInternal(r)}}class Mh extends Ih{constructor(t){super(),this.power=2,this.power=t}applyInternal(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1}}class Ph extends Mh{applyInternal(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1}}const Ch=class{static arrayCopy(t,e,r,n,s){for(let i=e,o=n;i<e+s;i++,o++)r[o]=t[i]}static arrayFill(t,e,r,n){for(let s=e;s<r;s++)t[s]=n}static setArraySize(t,e,r=0){const n=t.length;if(n==e)return t;if(t.length=e,n<e)for(let s=n;s<e;s++)t[s]=r;return t}static ensureArrayCapacity(t,e,r=0){return t.length>=e?t:Ch.setArraySize(t,e,r)}static newArray(t,e){const r=new Array(t);for(let n=0;n<t;n++)r[n]=e;return r}static newFloatArray(t){if(Ch.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}static newShortArray(t){if(Ch.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}static toFloatArray(t){return Ch.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return Ch.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,r=!0){for(let r=0;r<t.length;r++)if(t[r]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}};let kh=Ch;kh.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;class Oh{constructor(t){this.items=new Array,this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}}class Fh{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){const t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}class Nh{constructor(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new Oh((()=>kh.newFloatArray(16)))}update(t,e){if(!t)throw new Error("skeleton cannot be null.");const r=this.boundingBoxes,n=this.polygons,s=this.polygonPool,i=t.slots,o=i.length;r.length=0,s.freeAll(n),n.length=0;for(let t=0;t<o;t++){const e=i[t];if(!e.bone.active)continue;const o=e.getAttachment();if(null!=o&&o.type===oh.BoundingBox){const t=o;r.push(t);let i=s.obtain();i.length!=t.worldVerticesLength&&(i=kh.newFloatArray(t.worldVerticesLength)),n.push(i),t.computeWorldVertices(e,0,t.worldVerticesLength,i,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;const s=this.polygons;for(let i=0,o=s.length;i<o;i++){const o=s[i],a=o;for(let s=0,i=o.length;s<i;s+=2){const i=a[s],o=a[s+1];t=Math.min(t,i),e=Math.min(e,o),r=Math.max(r,i),n=Math.max(n,o)}}this.minX=t,this.minY=e,this.maxX=r,this.maxY=n}aabbContainsPoint(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}aabbIntersectsSegment(t,e,r,n){const s=this.minX,i=this.minY,o=this.maxX,a=this.maxY;if(t<=s&&r<=s||e<=i&&n<=i||t>=o&&r>=o||e>=a&&n>=a)return!1;const h=(n-e)/(r-t);let l=h*(s-t)+e;if(l>i&&l<a)return!0;if(l=h*(o-t)+e,l>i&&l<a)return!0;let c=(i-e)/h+t;return c>s&&c<o||(c=(a-e)/h+t,c>s&&c<o)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,e){const r=this.polygons;for(let n=0,s=r.length;n<s;n++)if(this.containsPointPolygon(r[n],t,e))return this.boundingBoxes[n];return null}containsPointPolygon(t,e,r){const n=t,s=t.length;let i=s-2,o=!1;for(let t=0;t<s;t+=2){const s=n[t+1],a=n[i+1];if(s<r&&a>=r||a<r&&s>=r){const h=n[t];h+(r-s)/(a-s)*(n[i]-h)<e&&(o=!o)}i=t}return o}intersectsSegment(t,e,r,n){const s=this.polygons;for(let i=0,o=s.length;i<o;i++)if(this.intersectsSegmentPolygon(s[i],t,e,r,n))return this.boundingBoxes[i];return null}intersectsSegmentPolygon(t,e,r,n,s){const i=t,o=t.length,a=e-n,h=r-s,l=e*s-r*n;let c=i[o-2],u=i[o-1];for(let t=0;t<o;t+=2){const o=i[t],d=i[t+1],f=c*d-u*o,p=c-o,m=u-d,g=a*m-h*p,y=(l*p-a*f)/g;if((y>=c&&y<=o||y>=o&&y<=c)&&(y>=e&&y<=n||y>=n&&y<=e)){const t=(l*m-h*f)/g;if((t>=u&&t<=d||t>=d&&t<=u)&&(t>=r&&t<=s||t>=s&&t<=r))return!0}c=o,u=d}return!1}getPolygon(t){if(!t)throw new Error("boundingBox cannot be null.");const e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}const Bh=!1,Dh=[0,0,0];class Lh extends bs{constructor(){super(...arguments),this.region=null,this.attachment=null}}class Vh extends Uo{constructor(t,e,r,n,s){super(t,e,r,n,s),this.region=null,this.attachment=null}}const Uh=class extends ms{constructor(t){if(super(),!t)throw new Error("The spineData param is required.");if("string"==typeof t)throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.');this.spineData=t,this.createSkeleton(t),this.slotContainers=[],this.tempClipContainers=[];for(let t=0,e=this.skeleton.slots.length;t<e;t++){const e=this.skeleton.slots[t],r=e.getAttachment(),n=this.newContainer();if(this.slotContainers.push(n),this.addChild(n),this.tempClipContainers.push(null),r)if(r.type===oh.Region){const t=r.name,s=this.createSprite(e,r,t);e.currentSprite=s,e.currentSpriteName=t,n.addChild(s)}else if(r.type===oh.Mesh){const t=this.createMesh(e,r);e.currentMesh=t,e.currentMeshId=r.id,e.currentMeshName=r.name,n.addChild(t)}else r.type===oh.Clipping&&(this.createGraphics(e,r),n.addChild(e.clippingContainer),n.addChild(e.currentGraphics))}this.tintRgb=new Float32Array([1,1,1]),this.autoUpdate=!0,this.visible=!0}get debug(){return this._debug}set debug(t){t!=this._debug&&(this._debug?.unregisterSpine(this),t?.registerSpine(this),this._debug=t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this.updateTransform=t?Uh.prototype.autoUpdateTransform:ms.prototype.updateTransform)}get tint(){return jt(this.tintRgb)}set tint(t){this.tintRgb=function(t,e=[]){return ot("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Xt.shared.setValue(t).toRgbArray(e)}(t,this.tintRgb)}get delayLimit(){return(void 0!==this.localDelayLimit?this.localDelayLimit:0)||Number.MAX_VALUE}update(t){const e=this.delayLimit;if(t>e&&(t=e),this.state.update(t),this.state.apply(this.skeleton),!this.skeleton)return;this.skeleton.updateWorldTransform();const r=this.skeleton.slots,n=this.color;let s=null,i=null;n?(s=n.light,i=n.dark):s=this.tintRgb;for(let t=0,e=r.length;t<e;t++){const e=r[t],n=e.getAttachment(),o=this.slotContainers[t];if(!n){o.visible=!1;continue}let a=null;n.sequence&&n.sequence.apply(e,n);let h=n.region;const l=n.color;switch(null!=n&&n.type){case oh.Region:if(o.transform.setFromMatrix(e.bone.matrix),h=n.region,e.currentMesh&&(e.currentMesh.visible=!1,e.currentMesh=null,e.currentMeshId=void 0,e.currentMeshName=void 0),!h){e.currentSprite&&(e.currentSprite.renderable=!1);break}if(!e.currentSpriteName||e.currentSpriteName!==n.name){const t=n.name;if(e.currentSprite&&(e.currentSprite.visible=!1),e.sprites=e.sprites||{},void 0!==e.sprites[t])e.sprites[t].visible=!0;else{const r=this.createSprite(e,n,t);o.addChild(r)}e.currentSprite=e.sprites[t],e.currentSpriteName=t}e.currentSprite.renderable=!0,e.hackRegion||this.setSpriteRegion(n,e.currentSprite,h),e.currentSprite.color?a=e.currentSprite.color:(Dh[0]=s[0]*e.color.r*l.r,Dh[1]=s[1]*e.color.g*l.g,Dh[2]=s[2]*e.color.b*l.b,e.currentSprite.tint=jt(Dh)),e.currentSprite.blendMode=e.blendMode;break;case oh.Mesh:if(e.currentSprite){e.currentSprite.visible=!1,e.currentSprite=null,e.currentSpriteName=void 0;const t=new rr;t._parentID=-1,t._worldID=o.transform._worldID,o.transform=t}if(!h){e.currentMesh&&(e.currentMesh.renderable=!1);break}const t=n.id;if(void 0===e.currentMeshId||e.currentMeshId!==t){const r=t;if(e.currentMesh&&(e.currentMesh.visible=!1),e.meshes=e.meshes||{},void 0!==e.meshes[r])e.meshes[r].visible=!0;else{const t=this.createMesh(e,n);o.addChild(t)}e.currentMesh=e.meshes[r],e.currentMeshName=n.name,e.currentMeshId=r}e.currentMesh.renderable=!0,n.computeWorldVerticesOld(e,e.currentMesh.vertices),e.currentMesh.color?a=e.currentMesh.color:(Dh[0]=s[0]*e.color.r*l.r,Dh[1]=s[1]*e.color.g*l.g,Dh[2]=s[2]*e.color.b*l.b,e.currentMesh.tint=jt(Dh)),e.currentMesh.blendMode=e.blendMode,e.hackRegion||this.setMeshRegion(n,e.currentMesh,h);break;case oh.Clipping:e.currentGraphics||(this.createGraphics(e,n),o.addChild(e.clippingContainer),o.addChild(e.currentGraphics)),this.updateGraphics(e,n),o.alpha=1,o.visible=!0;continue;default:o.visible=!1;continue}if(o.visible=!0,a){let t=e.color.r*l.r,r=e.color.g*l.g,n=e.color.b*l.b;a.setLight(s[0]*t+i[0]*(1-t),s[1]*r+i[1]*(1-r),s[2]*n+i[2]*(1-n)),e.darkColor?(t=e.darkColor.r,r=e.darkColor.g,n=e.darkColor.b):(t=0,r=0,n=0),a.setDark(s[0]*t+i[0]*(1-t),s[1]*r+i[1]*(1-r),s[2]*n+i[2]*(1-n))}o.alpha=e.color.a}const o=this.skeleton.drawOrder;let a=null,h=null;for(let t=0,e=o.length;t<e;t++){const e=r[o[t].data.index],n=this.slotContainers[o[t].data.index];if(h||null!==n.parent&&n.parent!==this&&(n.parent.removeChild(n),n.parent=this),e.currentGraphics&&e.getAttachment())h=e.clippingContainer,a=e.getAttachment(),h.children.length=0,this.children[t]=n,a.endSlot===e.data&&(a.endSlot=null);else if(h){let r=this.tempClipContainers[t];r||(r=this.tempClipContainers[t]=this.newContainer(),r.visible=!1),this.children[t]=r,n.parent=null,h.addChild(n),a.endSlot==e.data&&(h.renderable=!0,h=null,a=null)}else this.children[t]=n}this._debug?.renderDebug(this)}setSpriteRegion(t,e,r){e.attachment===t&&e.region===r||(e.region=r,e.attachment=t,e.texture=r.texture,e.rotation=t.rotation*Rh.degRad,e.position.x=t.x,e.position.y=t.y,e.alpha=t.color.a,r.size?(e.scale.x=r.size.width/r.originalWidth,e.scale.y=-r.size.height/r.originalHeight):(e.scale.x=t.scaleX*t.width/r.originalWidth,e.scale.y=-t.scaleY*t.height/r.originalHeight))}setMeshRegion(t,e,r){e.attachment===t&&e.region===r||(e.region=r,e.attachment=t,e.texture=r.texture,r.texture.updateUvs(),e.uvBuffer.update(t.regionUVs))}autoUpdateTransform(){{this.lastTime=this.lastTime||Date.now();const t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t)}ms.prototype.updateTransform.call(this)}createSprite(t,e,r){let n=e.region;t.hackAttachment===e&&(n=t.hackRegion);const s=n?n.texture:null,i=this.newSprite(s);return i.anchor.set(.5),n&&this.setSpriteRegion(e,i,e.region),t.sprites=t.sprites||{},t.sprites[r]=i,i}createMesh(t,e){let r=e.region;t.hackAttachment===e&&(r=t.hackRegion,t.hackAttachment=null,t.hackRegion=null);const n=this.newMesh(r?r.texture:null,new Float32Array(e.regionUVs.length),e.regionUVs,new Uint16Array(e.triangles),w.TRIANGLES);return void 0!==n._canvasPadding&&(n._canvasPadding=1.5),n.alpha=e.color.a,n.region=e.region,r&&this.setMeshRegion(e,n,r),t.meshes=t.meshes||{},t.meshes[e.id]=n,n}createGraphics(t,e){const r=this.newGraphics(),n=new Ye([]);return r.clear(),r.beginFill(16777215,1),r.drawPolygon(n),r.renderable=!1,t.currentGraphics=r,t.clippingContainer=this.newContainer(),t.clippingContainer.mask=t.currentGraphics,r}updateGraphics(t,e){const r=t.currentGraphics.geometry,n=r.graphicsData[0].shape.points,s=e.worldVerticesLength;n.length=s,e.computeWorldVertices(t,0,s,n,0,2),r.invalidate()}hackTextureBySlotIndex(t,e=null,r=null){const n=this.skeleton.slots[t];if(!n)return!1;const s=n.getAttachment();let i=s.region;return e?(i=new gh,i.texture=e,i.size=r,n.hackRegion=i,n.hackAttachment=s):(n.hackRegion=null,n.hackAttachment=null),n.currentSprite?this.setSpriteRegion(s,n.currentSprite,i):n.currentMesh&&this.setMeshRegion(s,n.currentMesh,i),!0}hackTextureBySlotName(t,e=null,r=null){const n=this.skeleton.findSlotIndex(t);return-1!=n&&this.hackTextureBySlotIndex(n,e,r)}hackTextureAttachment(t,e,r,n=null){const s=this.skeleton.findSlotIndex(t),i=this.skeleton.getAttachmentByName(t,e);i.region.texture=r;const o=this.skeleton.slots[s];if(!o)return!1;const a=o.getAttachment();if(e===a.name){let t=i.region;return r?(t=new gh,t.texture=r,t.size=n,o.hackRegion=t,o.hackAttachment=a):(o.hackRegion=null,o.hackAttachment=null),o.currentSprite&&o.currentSprite.region!=t?(this.setSpriteRegion(a,o.currentSprite,t),o.currentSprite.region=t):o.currentMesh&&o.currentMesh.region!=t&&this.setMeshRegion(a,o.currentMesh,t),!0}return!1}newContainer(){return new ms}newSprite(t){return new Lh(t)}newGraphics(){return new ko}newMesh(t,e,r,n,s){return new Vh(t,e,r,n,s)}transformHack(){return 1}hackAttachmentGroups(t,e,r){if(!t)return;const n=[],s=[];for(let i=0,o=this.skeleton.slots.length;i<o;i++){const o=this.skeleton.slots[i],a=o.currentSpriteName||o.currentMeshName||"",h=o.currentSprite||o.currentMesh;a.endsWith(t)?(h.parentGroup=e,s.push(h)):r&&h&&(h.parentGroup=r,n.push(h))}return[n,s]}destroy(t){this.debug=null;for(let e=0,r=this.skeleton.slots.length;e<r;e++){const r=this.skeleton.slots[e];for(const e in r.meshes)r.meshes[e].destroy(t);r.meshes=null;for(const e in r.sprites)r.sprites[e].destroy(t);r.sprites=null}for(let e=0,r=this.slotContainers.length;e<r;e++)this.slotContainers[e].destroy(t);this.spineData=null,this.skeleton=null,this.slotContainers=null,this.stateData=null,this.state=null,this.tempClipContainers=null,super.destroy(t)}};let Xh=Uh;Xh.clippingPolygon=[],Object.defineProperty(Xh.prototype,"visible",{get(){return this._visible},set(t){t!==this._visible&&(this._visible=t,t&&(this.lastTime=0))}});const jh={extension:he.Asset,loader:{extension:{type:he.LoadParser,priority:Zs.Normal},test:t=>Hs(t,".atlas"),async load(t){const e=await L.ADAPTER.fetch(t);return await e.text()},testParse(t,e){const r=Hs(e.src,".atlas"),n="string"==typeof t;return Promise.resolve(r&&n)},async parse(t,e,r){const n=e.data;let s=lt.dirname(e.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");let i=null,o=null;const a=new Promise(((t,e)=>{i=t,o=e}));let h;const l=t=>{t||o("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),i(h)};if(n.image||n.images){const e=Object.assign(n.image?{default:n.image}:{},n.images);h=new bh(t,((t,r)=>{const n=e[t]||e.default;n&&n.baseTexture?r(n.baseTexture):r(n)}),l)}else h=new bh(t,Yh(r,s,n.imageMetadata),l);return await a},unload(t){t.dispose()}}},Yh=(t,e,r)=>async(n,s)=>{const i=lt.normalize([...e.split(lt.sep),n].join(lt.sep));s((await t.load({src:i,data:r})).baseTexture)};function Gh(t){return t.hasOwnProperty("bones")}ue.add(jh);class Wh{constructor(){}installLoader(){const t=this,e={extension:he.Asset,loader:{extension:{type:he.LoadParser,priority:Zs.Normal},test:t=>Hs(t,".skel"),async load(t){const e=await L.ADAPTER.fetch(t);return await e.arrayBuffer()},testParse(t,e){const r=Hs(e.src,".json")&&Gh(t),n=Hs(e.src,".skel")&&t instanceof ArrayBuffer,s=!1===e.data?.spineAtlas;return Promise.resolve(r&&!s||n)},async parse(e,r,n){const s=lt.extname(r.src).toLowerCase(),i=lt.basename(r.src,s);let o=lt.dirname(r.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");let a=null,h=e;Hs(r.src,".json")&&Gh(e)?a=t.createJsonParser():(a=t.createBinaryParser(),h=new Uint8Array(e));const l=r.data||{},c=l?.spineSkeletonScale??null;c&&(a.scale=c);const u=l.spineAtlas;if(u&&u.pages)return t.parseData(a,u,h);const d=l.atlasRawData;if(d){let e=null,r=null;const s=new Promise(((t,n)=>{e=t,r=n})),i=new bh(d,Yh(n,o,l.imageMetadata),(t=>{t||r("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),e(i)})),c=await s;return t.parseData(a,c,h)}let f=l.spineAtlasFile;f||(f=`${o+i}.atlas`);const p=await n.load({src:f,data:l,alias:l.spineAtlasAlias});return t.parseData(a,p,h)}}};return ue.add(e),e}}class Hh{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}}const $h=class extends Hh{constructor(t){super(t),this.id=(65535&$h.nextID++)<<11,this.worldVerticesLength=0,this.deformAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,r,n,s,i){r=s+(r>>1)*i;const o=t.bone.skeleton,a=t.deform;let h=this.vertices;const l=this.bones;if(null==l){a.length>0&&(h=a);const o=t.bone.matrix,l=o.tx,c=o.ty,u=o.a,d=o.c,f=o.b,p=o.d;for(let t=e,o=s;o<r;t+=2,o+=i){const e=h[t],r=h[t+1];n[o]=e*u+r*d+l,n[o+1]=e*f+r*p+c}return}let c=0,u=0;for(let t=0;t<e;t+=2){const t=l[c];c+=t+1,u+=t}const d=o.bones;if(0==a.length)for(let t=s,e=3*u;t<r;t+=i){let r=0,s=0,i=l[c++];for(i+=c;c<i;c++,e+=3){const t=d[l[c]].matrix,n=h[e],i=h[e+1],o=h[e+2];r+=(n*t.a+i*t.c+t.tx)*o,s+=(n*t.b+i*t.d+t.ty)*o}n[t]=r,n[t+1]=s}else{const t=a;for(let e=s,o=3*u,a=u<<1;e<r;e+=i){let r=0,s=0,i=l[c++];for(i+=c;c<i;c++,o+=3,a+=2){const e=d[l[c]].matrix,n=h[o]+t[a],i=h[o+1]+t[a+1],u=h[o+2];r+=(n*e.a+i*e.c+e.tx)*u,s+=(n*e.b+i*e.d+e.ty)*u}n[e]=r,n[e+1]=s}}}copyTo(t){null!=this.bones?(t.bones=new Array(this.bones.length),kh.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=kh.newFloatArray(this.vertices.length),kh.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}};let zh=$h;zh.nextID=0;class qh extends zh{constructor(t){super(t),this.type=oh.BoundingBox,this.color=new Ah(1,1,1,1)}copy(){const t=new qh(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class Kh extends zh{constructor(t){super(t),this.type=oh.Clipping,this.color=new Ah(.2275,.2275,.8078,1)}copy(){const t=new Kh(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class Zh extends zh{constructor(t){super(t),this.type=oh.Mesh,this.color=new Ah(1,1,1,1),this.tempColor=new Ah(0,0,0,0)}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(null!=this.parentMesh)return this.newLinkedMesh();const t=new Zh(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),kh.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),kh.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),kh.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}newLinkedMesh(){const t=new Zh(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t}}class Qh extends zh{constructor(t){super(t),this.type=oh.Path,this.closed=!1,this.constantSpeed=!1,this.color=new Ah(1,1,1,1)}copy(){const t=new Qh(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),kh.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class Jh extends zh{constructor(t){super(t),this.type=oh.Point,this.color=new Ah(.38,.94,0,1)}computeWorldPosition(t,e){const r=t.matrix;return e.x=this.x*r.a+this.y*r.c+t.worldX,e.y=this.x*r.b+this.y*r.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,r=Rh.cosDeg(this.rotation),n=Rh.sinDeg(this.rotation),s=r*e.a+n*e.c,i=r*e.b+n*e.d;return Math.atan2(i,s)*Rh.radDeg}copy(){const t=new Jh(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}class tl{constructor(t,e){if(this.deform=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Ah,this.darkColor=null==t.darkColor?null:new Ah,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}}const el=class extends Hh{constructor(t){super(t),this.type=oh.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Ah(1,1,1,1),this.offset=kh.newFloatArray(8),this.uvs=kh.newFloatArray(8),this.tempColor=new Ah(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,s=r+this.region.width*t,i=n+this.region.height*e,o=this.rotation*Math.PI/180,a=Math.cos(o),h=Math.sin(o),l=r*a+this.x,c=r*h,u=n*a+this.y,d=n*h,f=s*a+this.x,p=s*h,m=i*a+this.y,g=i*h,y=this.offset;y[el.OX1]=l-d,y[el.OY1]=u+c,y[el.OX2]=l-g,y[el.OY2]=m+c,y[el.OX3]=f-g,y[el.OY3]=m+p,y[el.OX4]=f-d,y[el.OY4]=u+p}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,r,n){const s=this.offset,i=t instanceof tl?t.bone.matrix:t.matrix,o=i.tx,a=i.ty,h=i.a,l=i.c,c=i.b,u=i.d;let d=0,f=0;d=s[el.OX1],f=s[el.OY1],e[r]=d*h+f*l+o,e[r+1]=d*c+f*u+a,r+=n,d=s[el.OX2],f=s[el.OY2],e[r]=d*h+f*l+o,e[r+1]=d*c+f*u+a,r+=n,d=s[el.OX3],f=s[el.OY3],e[r]=d*h+f*l+o,e[r+1]=d*c+f*u+a,r+=n,d=s[el.OX4],f=s[el.OY4],e[r]=d*h+f*l+o,e[r+1]=d*c+f*u+a}copy(){const t=new el(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,kh.arrayCopy(this.uvs,0,t.uvs,0,8),kh.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}};let rl=el;rl.OX1=0,rl.OY1=1,rl.OX2=2,rl.OY2=3,rl.OX3=4,rl.OY3=5,rl.OX4=6,rl.OY4=7,rl.X1=0,rl.Y1=1,rl.C1R=2,rl.C1G=3,rl.C1B=4,rl.C1A=5,rl.U1=6,rl.V1=7,rl.X2=8,rl.Y2=9,rl.C2R=10,rl.C2G=11,rl.C2B=12,rl.C2A=13,rl.U2=14,rl.V2=15,rl.X3=16,rl.Y3=17,rl.C3R=18,rl.C3G=19,rl.C3B=20,rl.C3A=21,rl.U3=22,rl.V3=23,rl.X4=24,rl.Y4=25,rl.C4R=26,rl.C4G=27,rl.C4B=28,rl.C4A=29,rl.U4=30,rl.V4=31;class nl{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,r,n){t.x+=Rh.randomTriangular(-this.jitterX,this.jitterY),t.y+=Rh.randomTriangular(-this.jitterX,this.jitterY)}end(){}}const sl=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,r,n){const s=this.angle*Rh.degreesToRadians,i=t.x-this.worldX,o=t.y-this.worldY,a=Math.sqrt(i*i+o*o);if(a<this.radius){const e=sl.interpolation.apply(0,s,(this.radius-a)/this.radius),r=Math.cos(e),n=Math.sin(e);t.x=r*i-n*o+this.worldX,t.y=n*i+r*o+this.worldY}}end(){}};let il=sl;il.interpolation=new Ph(2);class ol{constructor(t,e,r){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(let t=0;t<e.length;t++)this.timelineIds[e[t].getPropertyId()]=!0;this.duration=r}hasTimeline(t){return 1==this.timelineIds[t]}apply(t,e,r,n,s,i,o,a){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(r%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let n=0,l=h.length;n<l;n++)h[n].apply(t,e,r,s,i,o,a)}static binarySearch(t,e,r=1){let n=0,s=t.length/r-2;if(0==s)return r;let i=s>>>1;for(;;){if(t[(i+1)*r]<=e?n=i+1:s=i,n==s)return(n+1)*r;i=n+s>>>1}}static linearSearch(t,e,r){for(let n=0,s=t.length-r;n<=s;n+=r)if(t[n]>e)return n;return-1}}var al=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(al||{});const hl=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=kh.newFloatArray((t-1)*hl.BEZIER_SIZE)}getFrameCount(){return this.curves.length/hl.BEZIER_SIZE+1}setLinear(t){this.curves[t*hl.BEZIER_SIZE]=hl.LINEAR}setStepped(t){this.curves[t*hl.BEZIER_SIZE]=hl.STEPPED}getCurveType(t){const e=t*hl.BEZIER_SIZE;if(e==this.curves.length)return hl.LINEAR;const r=this.curves[e];return r==hl.LINEAR?hl.LINEAR:r==hl.STEPPED?hl.STEPPED:hl.BEZIER}setCurve(t,e,r,n,s){const i=.03*(2*-e+n),o=.03*(2*-r+s),a=.006*(3*(e-n)+1),h=.006*(3*(r-s)+1);let l=2*i+a,c=2*o+h,u=.3*e+i+.16666667*a,d=.3*r+o+.16666667*h,f=t*hl.BEZIER_SIZE;const p=this.curves;p[f++]=hl.BEZIER;let m=u,g=d;for(let t=f+hl.BEZIER_SIZE-1;f<t;f+=2)p[f]=m,p[f+1]=g,u+=l,d+=c,l+=a,c+=h,m+=u,g+=d}getCurvePercent(t,e){e=Rh.clamp(e,0,1);const r=this.curves;let n=t*hl.BEZIER_SIZE;const s=r[n];if(s==hl.LINEAR)return e;if(s==hl.STEPPED)return 0;n++;let i=0;for(let t=n,s=n+hl.BEZIER_SIZE-1;n<s;n+=2)if(i=r[n],i>=e){let s,o;return n==t?(s=0,o=0):(s=r[n-2],o=r[n-1]),o+(r[n+1]-o)*(e-s)/(i-s)}const o=r[n-1];return o+(1-o)*(e-i)/(1-i)}};let ll=hl;ll.LINEAR=0,ll.STEPPED=1,ll.BEZIER=2,ll.BEZIER_SIZE=19;const cl=class extends ll{constructor(t){super(t),this.frames=kh.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,r){t<<=1,this.frames[t]=e,this.frames[t+cl.ROTATION]=r}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.bones[this.boneIndex];if(!h.active)return;if(r<a[0]){switch(i){case hh.setup:return void(h.rotation=h.data.rotation);case hh.first:const t=h.data.rotation-h.rotation;h.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*s}return}if(r>=a[a.length-cl.ENTRIES]){let t=a[a.length+cl.PREV_ROTATION];switch(i){case hh.setup:h.rotation=h.data.rotation+t*s;break;case hh.first:case hh.replace:t+=h.data.rotation-h.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case hh.add:h.rotation+=t*s}return}const l=ol.binarySearch(a,r,cl.ENTRIES),c=a[l+cl.PREV_ROTATION],u=a[l],d=this.getCurvePercent((l>>1)-1,1-(r-u)/(a[l+cl.PREV_TIME]-u));let f=a[l+cl.ROTATION]-c;switch(f=c+(f-360*(16384-(16384.499999999996-f/360|0)))*d,i){case hh.setup:h.rotation=h.data.rotation+(f-360*(16384-(16384.499999999996-f/360|0)))*s;break;case hh.first:case hh.replace:f+=h.data.rotation-h.rotation;case hh.add:h.rotation+=(f-360*(16384-(16384.499999999996-f/360|0)))*s}}};let ul=cl;ul.ENTRIES=2,ul.PREV_TIME=-2,ul.PREV_ROTATION=-1,ul.ROTATION=1;const dl=class extends ll{constructor(t){super(t),this.frames=kh.newFloatArray(t*dl.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,r,n){t*=dl.ENTRIES,this.frames[t]=e,this.frames[t+dl.X]=r,this.frames[t+dl.Y]=n}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.bones[this.boneIndex];if(!h.active)return;if(r<a[0]){switch(i){case hh.setup:return h.x=h.data.x,void(h.y=h.data.y);case hh.first:h.x+=(h.data.x-h.x)*s,h.y+=(h.data.y-h.y)*s}return}let l=0,c=0;if(r>=a[a.length-dl.ENTRIES])l=a[a.length+dl.PREV_X],c=a[a.length+dl.PREV_Y];else{const t=ol.binarySearch(a,r,dl.ENTRIES);l=a[t+dl.PREV_X],c=a[t+dl.PREV_Y];const e=a[t],n=this.getCurvePercent(t/dl.ENTRIES-1,1-(r-e)/(a[t+dl.PREV_TIME]-e));l+=(a[t+dl.X]-l)*n,c+=(a[t+dl.Y]-c)*n}switch(i){case hh.setup:h.x=h.data.x+l*s,h.y=h.data.y+c*s;break;case hh.first:case hh.replace:h.x+=(h.data.x+l-h.x)*s,h.y+=(h.data.y+c-h.y)*s;break;case hh.add:h.x+=l*s,h.y+=c*s}}};let fl=dl;fl.ENTRIES=3,fl.PREV_TIME=-3,fl.PREV_X=-2,fl.PREV_Y=-1,fl.X=1,fl.Y=2;class pl extends fl{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.bones[this.boneIndex];if(!h.active)return;if(r<a[0]){switch(i){case hh.setup:return h.scaleX=h.data.scaleX,void(h.scaleY=h.data.scaleY);case hh.first:h.scaleX+=(h.data.scaleX-h.scaleX)*s,h.scaleY+=(h.data.scaleY-h.scaleY)*s}return}let l=0,c=0;if(r>=a[a.length-pl.ENTRIES])l=a[a.length+pl.PREV_X]*h.data.scaleX,c=a[a.length+pl.PREV_Y]*h.data.scaleY;else{const t=ol.binarySearch(a,r,pl.ENTRIES);l=a[t+pl.PREV_X],c=a[t+pl.PREV_Y];const e=a[t],n=this.getCurvePercent(t/pl.ENTRIES-1,1-(r-e)/(a[t+pl.PREV_TIME]-e));l=(l+(a[t+pl.X]-l)*n)*h.data.scaleX,c=(c+(a[t+pl.Y]-c)*n)*h.data.scaleY}if(1==s)i==hh.add?(h.scaleX+=l-h.data.scaleX,h.scaleY+=c-h.data.scaleY):(h.scaleX=l,h.scaleY=c);else{let t=0,e=0;if(o==lh.mixOut)switch(i){case hh.setup:t=h.data.scaleX,e=h.data.scaleY,h.scaleX=t+(Math.abs(l)*Rh.signum(t)-t)*s,h.scaleY=e+(Math.abs(c)*Rh.signum(e)-e)*s;break;case hh.first:case hh.replace:t=h.scaleX,e=h.scaleY,h.scaleX=t+(Math.abs(l)*Rh.signum(t)-t)*s,h.scaleY=e+(Math.abs(c)*Rh.signum(e)-e)*s;break;case hh.add:t=h.scaleX,e=h.scaleY,h.scaleX=t+(Math.abs(l)*Rh.signum(t)-h.data.scaleX)*s,h.scaleY=e+(Math.abs(c)*Rh.signum(e)-h.data.scaleY)*s}else switch(i){case hh.setup:t=Math.abs(h.data.scaleX)*Rh.signum(l),e=Math.abs(h.data.scaleY)*Rh.signum(c),h.scaleX=t+(l-t)*s,h.scaleY=e+(c-e)*s;break;case hh.first:case hh.replace:t=Math.abs(h.scaleX)*Rh.signum(l),e=Math.abs(h.scaleY)*Rh.signum(c),h.scaleX=t+(l-t)*s,h.scaleY=e+(c-e)*s;break;case hh.add:t=Rh.signum(l),e=Rh.signum(c),h.scaleX=Math.abs(h.scaleX)*t+(l-Math.abs(h.data.scaleX)*t)*s,h.scaleY=Math.abs(h.scaleY)*e+(c-Math.abs(h.data.scaleY)*e)*s}}}}class ml extends fl{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.bones[this.boneIndex];if(!h.active)return;if(r<a[0]){switch(i){case hh.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case hh.first:h.shearX+=(h.data.shearX-h.shearX)*s,h.shearY+=(h.data.shearY-h.shearY)*s}return}let l=0,c=0;if(r>=a[a.length-ml.ENTRIES])l=a[a.length+ml.PREV_X],c=a[a.length+ml.PREV_Y];else{const t=ol.binarySearch(a,r,ml.ENTRIES);l=a[t+ml.PREV_X],c=a[t+ml.PREV_Y];const e=a[t],n=this.getCurvePercent(t/ml.ENTRIES-1,1-(r-e)/(a[t+ml.PREV_TIME]-e));l+=(a[t+ml.X]-l)*n,c+=(a[t+ml.Y]-c)*n}switch(i){case hh.setup:h.shearX=h.data.shearX+l*s,h.shearY=h.data.shearY+c*s;break;case hh.first:case hh.replace:h.shearX+=(h.data.shearX+l-h.shearX)*s,h.shearY+=(h.data.shearY+c-h.shearY)*s;break;case hh.add:h.shearX+=l*s,h.shearY+=c*s}}}const gl=class extends ll{constructor(t){super(t),this.frames=kh.newFloatArray(t*gl.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,r,n,s,i){t*=gl.ENTRIES,this.frames[t]=e,this.frames[t+gl.R]=r,this.frames[t+gl.G]=n,this.frames[t+gl.B]=s,this.frames[t+gl.A]=i}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=this.frames;if(r<h[0]){switch(i){case hh.setup:return void a.color.setFromColor(a.data.color);case hh.first:const t=a.color,e=a.data.color;t.add((e.r-t.r)*s,(e.g-t.g)*s,(e.b-t.b)*s,(e.a-t.a)*s)}return}let l=0,c=0,u=0,d=0;if(r>=h[h.length-gl.ENTRIES]){const t=h.length;l=h[t+gl.PREV_R],c=h[t+gl.PREV_G],u=h[t+gl.PREV_B],d=h[t+gl.PREV_A]}else{const t=ol.binarySearch(h,r,gl.ENTRIES);l=h[t+gl.PREV_R],c=h[t+gl.PREV_G],u=h[t+gl.PREV_B],d=h[t+gl.PREV_A];const e=h[t],n=this.getCurvePercent(t/gl.ENTRIES-1,1-(r-e)/(h[t+gl.PREV_TIME]-e));l+=(h[t+gl.R]-l)*n,c+=(h[t+gl.G]-c)*n,u+=(h[t+gl.B]-u)*n,d+=(h[t+gl.A]-d)*n}if(1==s)a.color.set(l,c,u,d);else{const t=a.color;i==hh.setup&&t.setFromColor(a.data.color),t.add((l-t.r)*s,(c-t.g)*s,(u-t.b)*s,(d-t.a)*s)}}};let yl=gl;yl.ENTRIES=5,yl.PREV_TIME=-5,yl.PREV_R=-4,yl.PREV_G=-3,yl.PREV_B=-2,yl.PREV_A=-1,yl.R=1,yl.G=2,yl.B=3,yl.A=4;const bl=class extends ll{constructor(t){super(t),this.frames=kh.newFloatArray(t*bl.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,r,n,s,i,o,a,h){t*=bl.ENTRIES,this.frames[t]=e,this.frames[t+bl.R]=r,this.frames[t+bl.G]=n,this.frames[t+bl.B]=s,this.frames[t+bl.A]=i,this.frames[t+bl.R2]=o,this.frames[t+bl.G2]=a,this.frames[t+bl.B2]=h}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=this.frames;if(r<h[0]){switch(i){case hh.setup:return a.color.setFromColor(a.data.color),void a.darkColor.setFromColor(a.data.darkColor);case hh.first:const t=a.color,e=a.darkColor,r=a.data.color,n=a.data.darkColor;t.add((r.r-t.r)*s,(r.g-t.g)*s,(r.b-t.b)*s,(r.a-t.a)*s),e.add((n.r-e.r)*s,(n.g-e.g)*s,(n.b-e.b)*s,0)}return}let l=0,c=0,u=0,d=0,f=0,p=0,m=0;if(r>=h[h.length-bl.ENTRIES]){const t=h.length;l=h[t+bl.PREV_R],c=h[t+bl.PREV_G],u=h[t+bl.PREV_B],d=h[t+bl.PREV_A],f=h[t+bl.PREV_R2],p=h[t+bl.PREV_G2],m=h[t+bl.PREV_B2]}else{const t=ol.binarySearch(h,r,bl.ENTRIES);l=h[t+bl.PREV_R],c=h[t+bl.PREV_G],u=h[t+bl.PREV_B],d=h[t+bl.PREV_A],f=h[t+bl.PREV_R2],p=h[t+bl.PREV_G2],m=h[t+bl.PREV_B2];const e=h[t],n=this.getCurvePercent(t/bl.ENTRIES-1,1-(r-e)/(h[t+bl.PREV_TIME]-e));l+=(h[t+bl.R]-l)*n,c+=(h[t+bl.G]-c)*n,u+=(h[t+bl.B]-u)*n,d+=(h[t+bl.A]-d)*n,f+=(h[t+bl.R2]-f)*n,p+=(h[t+bl.G2]-p)*n,m+=(h[t+bl.B2]-m)*n}if(1==s)a.color.set(l,c,u,d),a.darkColor.set(f,p,m,1);else{const t=a.color,e=a.darkColor;i==hh.setup&&(t.setFromColor(a.data.color),e.setFromColor(a.data.darkColor)),t.add((l-t.r)*s,(c-t.g)*s,(u-t.b)*s,(d-t.a)*s),e.add((f-e.r)*s,(p-e.g)*s,(m-e.b)*s,0)}}};let xl=bl;xl.ENTRIES=8,xl.PREV_TIME=-8,xl.PREV_R=-7,xl.PREV_G=-6,xl.PREV_B=-5,xl.PREV_A=-4,xl.PREV_R2=-3,xl.PREV_G2=-2,xl.PREV_B2=-1,xl.R=1,xl.G=2,xl.B=3,xl.A=4,xl.R2=5,xl.G2=6,xl.B2=7;class _l{constructor(t){this.frames=kh.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,r){this.frames[t]=e,this.attachmentNames[t]=r}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;if(o==lh.mixOut)return void(i==hh.setup&&this.setAttachment(t,a,a.data.attachmentName));const h=this.frames;if(r<h[0])return void(i!=hh.setup&&i!=hh.first||this.setAttachment(t,a,a.data.attachmentName));let l=0;l=r>=h[h.length-1]?h.length-1:ol.binarySearch(h,r,1)-1;const c=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}setAttachment(t,e,r){e.setAttachment(null==r?null:t.getAttachment(this.slotIndex,r))}}let vl=null;class wl extends ll{constructor(t){super(t),this.frames=kh.newFloatArray(t),this.frameVertices=new Array(t),null==vl&&(vl=kh.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,r){this.frames[t]=e,this.frameVertices[t]=r}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=a.getAttachment();if(!(h instanceof zh)||h.deformAttachment!=this.attachment)return;const l=a.deform;0==l.length&&(i=hh.setup);const c=this.frameVertices,u=c[0].length,d=this.frames;if(r<d[0]){const t=h;switch(i){case hh.setup:return void(l.length=0);case hh.first:if(1==s){l.length=0;break}const e=kh.setArraySize(l,u);if(null==t.bones){const r=t.vertices;for(let t=0;t<u;t++)e[t]+=(r[t]-e[t])*s}else{s=1-s;for(let t=0;t<u;t++)e[t]*=s}}return}const f=kh.setArraySize(l,u);if(r>=d[d.length-1]){const t=c[d.length-1];if(1==s)if(i==hh.add){const e=h;if(null==e.bones){const r=e.vertices;for(let e=0;e<u;e++)f[e]+=t[e]-r[e]}else for(let e=0;e<u;e++)f[e]+=t[e]}else kh.arrayCopy(t,0,f,0,u);else switch(i){case hh.setup:{const e=h;if(null==e.bones){const r=e.vertices;for(let e=0;e<u;e++){const n=r[e];f[e]=n+(t[e]-n)*s}}else for(let e=0;e<u;e++)f[e]=t[e]*s;break}case hh.first:case hh.replace:for(let e=0;e<u;e++)f[e]+=(t[e]-f[e])*s;break;case hh.add:const e=h;if(null==e.bones){const r=e.vertices;for(let e=0;e<u;e++)f[e]+=(t[e]-r[e])*s}else for(let e=0;e<u;e++)f[e]+=t[e]*s}return}const p=ol.binarySearch(d,r),m=c[p-1],g=c[p],y=d[p],b=this.getCurvePercent(p-1,1-(r-y)/(d[p-1]-y));if(1==s)if(i==hh.add){const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const r=m[t];f[t]+=r+(g[t]-r)*b-e[t]}}else for(let t=0;t<u;t++){const e=m[t];f[t]+=e+(g[t]-e)*b}}else for(let t=0;t<u;t++){const e=m[t];f[t]=e+(g[t]-e)*b}else switch(i){case hh.setup:{const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const r=m[t],n=e[t];f[t]=n+(r+(g[t]-r)*b-n)*s}}else for(let t=0;t<u;t++){const e=m[t];f[t]=(e+(g[t]-e)*b)*s}break}case hh.first:case hh.replace:for(let t=0;t<u;t++){const e=m[t];f[t]+=(e+(g[t]-e)*b-f[t])*s}break;case hh.add:const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const r=m[t];f[t]+=(r+(g[t]-r)*b-e[t])*s}}else for(let t=0;t<u;t++){const e=m[t];f[t]+=(e+(g[t]-e)*b)*s}}}}class El{constructor(t){this.frames=kh.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,r,n,s,i,o){if(null==n)return;const a=this.frames,h=this.frames.length;if(e>r)this.apply(t,e,Number.MAX_VALUE,n,s,i,o),e=-1;else if(e>=a[h-1])return;if(r<a[0])return;let l=0;if(e<a[0])l=0;else{l=ol.binarySearch(a,e);const t=a[l];for(;l>0&&a[l-1]==t;)l--}for(;l<h&&r>=a[l];l++)n.push(this.events[l])}}class Tl{constructor(t){this.frames=kh.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,r){this.frames[t]=e,this.drawOrders[t]=r}apply(t,e,r,n,s,i,o){const a=t.drawOrder,h=t.slots;if(o==lh.mixOut&&i==hh.setup)return void kh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const l=this.frames;if(r<l[0])return void(i!=hh.setup&&i!=hh.first||kh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let c=0;c=r>=l[l.length-1]?l.length-1:ol.binarySearch(l,r)-1;const u=this.drawOrders[c];if(null==u)kh.arrayCopy(h,0,a,0,h.length);else for(let t=0,e=u.length;t<e;t++)a[t]=h[u[t]]}}const Al=class extends ll{constructor(t){super(t),this.frames=kh.newFloatArray(t*Al.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,r,n,s,i,o){t*=Al.ENTRIES,this.frames[t]=e,this.frames[t+Al.MIX]=r,this.frames[t+Al.SOFTNESS]=n,this.frames[t+Al.BEND_DIRECTION]=s,this.frames[t+Al.COMPRESS]=i?1:0,this.frames[t+Al.STRETCH]=o?1:0}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(!h.active)return;if(r<a[0]){switch(i){case hh.setup:return h.mix=h.data.mix,h.softness=h.data.softness,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case hh.first:h.mix+=(h.data.mix-h.mix)*s,h.softness+=(h.data.softness-h.softness)*s,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}return}if(r>=a[a.length-Al.ENTRIES])return void(i==hh.setup?(h.mix=h.data.mix+(a[a.length+Al.PREV_MIX]-h.data.mix)*s,h.softness=h.data.softness+(a[a.length+Al.PREV_SOFTNESS]-h.data.softness)*s,o==lh.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=a[a.length+Al.PREV_BEND_DIRECTION],h.compress=0!=a[a.length+Al.PREV_COMPRESS],h.stretch=0!=a[a.length+Al.PREV_STRETCH])):(h.mix+=(a[a.length+Al.PREV_MIX]-h.mix)*s,h.softness+=(a[a.length+Al.PREV_SOFTNESS]-h.softness)*s,o==lh.mixIn&&(h.bendDirection=a[a.length+Al.PREV_BEND_DIRECTION],h.compress=0!=a[a.length+Al.PREV_COMPRESS],h.stretch=0!=a[a.length+Al.PREV_STRETCH])));const l=ol.binarySearch(a,r,Al.ENTRIES),c=a[l+Al.PREV_MIX],u=a[l+Al.PREV_SOFTNESS],d=a[l],f=this.getCurvePercent(l/Al.ENTRIES-1,1-(r-d)/(a[l+Al.PREV_TIME]-d));i==hh.setup?(h.mix=h.data.mix+(c+(a[l+Al.MIX]-c)*f-h.data.mix)*s,h.softness=h.data.softness+(u+(a[l+Al.SOFTNESS]-u)*f-h.data.softness)*s,o==lh.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=a[l+Al.PREV_BEND_DIRECTION],h.compress=0!=a[l+Al.PREV_COMPRESS],h.stretch=0!=a[l+Al.PREV_STRETCH])):(h.mix+=(c+(a[l+Al.MIX]-c)*f-h.mix)*s,h.softness+=(u+(a[l+Al.SOFTNESS]-u)*f-h.softness)*s,o==lh.mixIn&&(h.bendDirection=a[l+Al.PREV_BEND_DIRECTION],h.compress=0!=a[l+Al.PREV_COMPRESS],h.stretch=0!=a[l+Al.PREV_STRETCH]))}};let Sl=Al;Sl.ENTRIES=6,Sl.PREV_TIME=-6,Sl.PREV_MIX=-5,Sl.PREV_SOFTNESS=-4,Sl.PREV_BEND_DIRECTION=-3,Sl.PREV_COMPRESS=-2,Sl.PREV_STRETCH=-1,Sl.MIX=1,Sl.SOFTNESS=2,Sl.BEND_DIRECTION=3,Sl.COMPRESS=4,Sl.STRETCH=5;const Rl=class extends ll{constructor(t){super(t),this.frames=kh.newFloatArray(t*Rl.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,r,n,s,i){t*=Rl.ENTRIES,this.frames[t]=e,this.frames[t+Rl.ROTATE]=r,this.frames[t+Rl.TRANSLATE]=n,this.frames[t+Rl.SCALE]=s,this.frames[t+Rl.SHEAR]=i}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(!h.active)return;if(r<a[0]){const t=h.data;switch(i){case hh.setup:return h.rotateMix=t.rotateMix,h.translateMix=t.translateMix,h.scaleMix=t.scaleMix,void(h.shearMix=t.shearMix);case hh.first:h.rotateMix+=(t.rotateMix-h.rotateMix)*s,h.translateMix+=(t.translateMix-h.translateMix)*s,h.scaleMix+=(t.scaleMix-h.scaleMix)*s,h.shearMix+=(t.shearMix-h.shearMix)*s}return}let l=0,c=0,u=0,d=0;if(r>=a[a.length-Rl.ENTRIES]){const t=a.length;l=a[t+Rl.PREV_ROTATE],c=a[t+Rl.PREV_TRANSLATE],u=a[t+Rl.PREV_SCALE],d=a[t+Rl.PREV_SHEAR]}else{const t=ol.binarySearch(a,r,Rl.ENTRIES);l=a[t+Rl.PREV_ROTATE],c=a[t+Rl.PREV_TRANSLATE],u=a[t+Rl.PREV_SCALE],d=a[t+Rl.PREV_SHEAR];const e=a[t],n=this.getCurvePercent(t/Rl.ENTRIES-1,1-(r-e)/(a[t+Rl.PREV_TIME]-e));l+=(a[t+Rl.ROTATE]-l)*n,c+=(a[t+Rl.TRANSLATE]-c)*n,u+=(a[t+Rl.SCALE]-u)*n,d+=(a[t+Rl.SHEAR]-d)*n}if(i==hh.setup){const t=h.data;h.rotateMix=t.rotateMix+(l-t.rotateMix)*s,h.translateMix=t.translateMix+(c-t.translateMix)*s,h.scaleMix=t.scaleMix+(u-t.scaleMix)*s,h.shearMix=t.shearMix+(d-t.shearMix)*s}else h.rotateMix+=(l-h.rotateMix)*s,h.translateMix+=(c-h.translateMix)*s,h.scaleMix+=(u-h.scaleMix)*s,h.shearMix+=(d-h.shearMix)*s}};let Il=Rl;Il.ENTRIES=5,Il.PREV_TIME=-5,Il.PREV_ROTATE=-4,Il.PREV_TRANSLATE=-3,Il.PREV_SCALE=-2,Il.PREV_SHEAR=-1,Il.ROTATE=1,Il.TRANSLATE=2,Il.SCALE=3,Il.SHEAR=4;const Ml=class extends ll{constructor(t){super(t),this.frames=kh.newFloatArray(t*Ml.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,r){t*=Ml.ENTRIES,this.frames[t]=e,this.frames[t+Ml.VALUE]=r}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;if(r<a[0]){switch(i){case hh.setup:return void(h.position=h.data.position);case hh.first:h.position+=(h.data.position-h.position)*s}return}let l=0;if(r>=a[a.length-Ml.ENTRIES])l=a[a.length+Ml.PREV_VALUE];else{const t=ol.binarySearch(a,r,Ml.ENTRIES);l=a[t+Ml.PREV_VALUE];const e=a[t],n=this.getCurvePercent(t/Ml.ENTRIES-1,1-(r-e)/(a[t+Ml.PREV_TIME]-e));l+=(a[t+Ml.VALUE]-l)*n}i==hh.setup?h.position=h.data.position+(l-h.data.position)*s:h.position+=(l-h.position)*s}};let Pl=Ml;Pl.ENTRIES=2,Pl.PREV_TIME=-2,Pl.PREV_VALUE=-1,Pl.VALUE=1;class Cl extends Pl{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;if(r<a[0]){switch(i){case hh.setup:return void(h.spacing=h.data.spacing);case hh.first:h.spacing+=(h.data.spacing-h.spacing)*s}return}let l=0;if(r>=a[a.length-Cl.ENTRIES])l=a[a.length+Cl.PREV_VALUE];else{const t=ol.binarySearch(a,r,Cl.ENTRIES);l=a[t+Cl.PREV_VALUE];const e=a[t],n=this.getCurvePercent(t/Cl.ENTRIES-1,1-(r-e)/(a[t+Cl.PREV_TIME]-e));l+=(a[t+Cl.VALUE]-l)*n}i==hh.setup?h.spacing=h.data.spacing+(l-h.data.spacing)*s:h.spacing+=(l-h.spacing)*s}}const kl=class extends ll{constructor(t){super(t),this.frames=kh.newFloatArray(t*kl.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,r,n){t*=kl.ENTRIES,this.frames[t]=e,this.frames[t+kl.ROTATE]=r,this.frames[t+kl.TRANSLATE]=n}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;if(r<a[0]){switch(i){case hh.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case hh.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*s,h.translateMix+=(h.data.translateMix-h.translateMix)*s}return}let l=0,c=0;if(r>=a[a.length-kl.ENTRIES])l=a[a.length+kl.PREV_ROTATE],c=a[a.length+kl.PREV_TRANSLATE];else{const t=ol.binarySearch(a,r,kl.ENTRIES);l=a[t+kl.PREV_ROTATE],c=a[t+kl.PREV_TRANSLATE];const e=a[t],n=this.getCurvePercent(t/kl.ENTRIES-1,1-(r-e)/(a[t+kl.PREV_TIME]-e));l+=(a[t+kl.ROTATE]-l)*n,c+=(a[t+kl.TRANSLATE]-c)*n}i==hh.setup?(h.rotateMix=h.data.rotateMix+(l-h.data.rotateMix)*s,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*s):(h.rotateMix+=(l-h.rotateMix)*s,h.translateMix+=(c-h.translateMix)*s)}};let Ol=kl;Ol.ENTRIES=3,Ol.PREV_TIME=-3,Ol.PREV_ROTATE=-2,Ol.PREV_TRANSLATE=-1,Ol.ROTATE=1,Ol.TRANSLATE=2;const Fl=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new Vl(this),this.propertyIDs=new wh,this.animationsChanged=!1,this.trackEntryPool=new Oh((()=>new Dl)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(null==n)continue;n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;let s=t*n.timeScale;if(n.delay>0){if(n.delay-=s,n.delay>0)continue;s=-n.delay,n.delay=0}let i=n.next;if(null!=i){const e=n.trackLast-i.delay;if(e>=0){for(i.delay=0,i.trackTime+=0==n.timeScale?0:(e/n.timeScale+t)*i.timeScale,n.trackTime+=s,this.setCurrent(r,i,!0);null!=i.mixingFrom;)i.mixTime+=t,i=i.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&null==n.mixingFrom){e[r]=null,this.queue.end(n),this.disposeNext(n);continue}if(null!=n.mixingFrom&&this.updateMixingFrom(n,t)){let t=n.mixingFrom;for(n.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}n.trackTime+=s}this.queue.drain()}updateMixingFrom(t,e){const r=t.mixingFrom;if(null==r)return!0;const n=this.updateMixingFrom(r,e);return r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=r.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=r.mixingFrom,null!=r.mixingFrom&&(r.mixingFrom.mixingTo=t),t.interruptAlpha=r.interruptAlpha,this.queue.end(r)),n):(r.trackTime+=e*r.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,r=this.tracks;let n=!1;for(let s=0,i=r.length;s<i;s++){const i=r[s];if(null==i||i.delay>0)continue;n=!0;const o=0==s?hh.first:i.mixBlend;let a=i.alpha;null!=i.mixingFrom?a*=this.applyMixingFrom(i,t,o):i.trackTime>=i.trackEnd&&null==i.next&&(a=0);const h=i.animationLast,l=i.getAnimationTime(),c=i.animation.timelines.length,u=i.animation.timelines;if(0==s&&1==a||o==hh.add)for(let r=0;r<c;r++){kh.webkit602BugfixHelper(a,o);const n=u[r];n instanceof _l?this.applyAttachmentTimeline(n,t,l,o,!0):n.apply(t,h,l,e,a,o,lh.mixIn)}else{const r=i.timelineMode,n=0==i.timelinesRotation.length;n&&kh.setArraySize(i.timelinesRotation,c<<1,null);const s=i.timelinesRotation;for(let i=0;i<c;i++){const c=u[i],d=r[i]==Fl.SUBSEQUENT?o:hh.setup;c instanceof ul?this.applyRotateTimeline(c,t,l,a,d,s,i<<1,n):c instanceof _l?this.applyAttachmentTimeline(c,t,l,o,!0):(kh.webkit602BugfixHelper(a,o),c.apply(t,h,l,e,a,d,lh.mixIn))}}this.queueEvents(i,l),e.length=0,i.nextAnimationLast=l,i.nextTrackLast=i.trackTime}const s=this.unkeyedState+Fl.SETUP,i=t.slots;for(let e=0,r=t.slots.length;e<r;e++){const r=i[e];if(r.attachmentState==s){const e=r.data.attachmentName;r.setAttachment(null==e?null:t.getAttachment(r.data.index,e))}}return this.unkeyedState+=2,this.queue.drain(),n}applyMixingFrom(t,e,r){const n=t.mixingFrom;null!=n.mixingFrom&&this.applyMixingFrom(n,e,r);let s=0;0==t.mixDuration?(s=1,r==hh.first&&(r=hh.setup)):(s=t.mixTime/t.mixDuration,s>1&&(s=1),r!=hh.first&&(r=n.mixBlend));const i=s<n.eventThreshold?this.events:null,o=s<n.attachmentThreshold,a=s<n.drawOrderThreshold,h=n.animationLast,l=n.getAnimationTime(),c=n.animation.timelines.length,u=n.animation.timelines,d=n.alpha*t.interruptAlpha,f=d*(1-s);if(r==hh.add)for(let t=0;t<c;t++)u[t].apply(e,h,l,i,f,r,lh.mixOut);else{const t=n.timelineMode,s=n.timelineHoldMix,p=0==n.timelinesRotation.length;p&&kh.setArraySize(n.timelinesRotation,c<<1,null);const m=n.timelinesRotation;n.totalAlpha=0;for(let g=0;g<c;g++){const c=u[g];let y,b=lh.mixOut,x=0;switch(t[g]){case Fl.SUBSEQUENT:if(!a&&c instanceof Tl)continue;y=r,x=f;break;case Fl.FIRST:y=hh.setup,x=f;break;case Fl.HOLD_SUBSEQUENT:y=r,x=d;break;case Fl.HOLD_FIRST:y=hh.setup,x=d;break;default:y=hh.setup;const t=s[g];x=d*Math.max(0,1-t.mixTime/t.mixDuration)}n.totalAlpha+=x,c instanceof ul?this.applyRotateTimeline(c,e,l,x,y,m,g<<1,p):c instanceof _l?this.applyAttachmentTimeline(c,e,l,y,o):(kh.webkit602BugfixHelper(x,r),a&&c instanceof Tl&&y==hh.setup&&(b=lh.mixIn),c.apply(e,h,l,i,x,y,b))}}return t.mixDuration>0&&this.queueEvents(n,l),this.events.length=0,n.nextAnimationLast=l,n.nextTrackLast=n.trackTime,s}applyAttachmentTimeline(t,e,r,n,s){const i=e.slots[t.slotIndex];if(!i.bone.active)return;const o=t.frames;if(r<o[0])n!=hh.setup&&n!=hh.first||this.setAttachment(e,i,i.data.attachmentName,s);else{let n;n=r>=o[o.length-1]?o.length-1:ol.binarySearch(o,r)-1,this.setAttachment(e,i,t.attachmentNames[n],s)}i.attachmentState<=this.unkeyedState&&(i.attachmentState=this.unkeyedState+Fl.SETUP)}setAttachment(t,e,r,n){e.setAttachment(null==r?null:t.getAttachment(e.data.index,r)),n&&(e.attachmentState=this.unkeyedState+Fl.CURRENT)}applyRotateTimeline(t,e,r,n,s,i,o,a){if(a&&(i[o]=0),1==n)return void t.apply(e,0,r,null,1,s,lh.mixIn);const h=t,l=h.frames,c=e.bones[h.boneIndex];if(!c.active)return;let u=0,d=0;if(r<l[0])switch(s){case hh.setup:c.rotation=c.data.rotation;default:return;case hh.first:u=c.rotation,d=c.data.rotation}else if(u=s==hh.setup?c.data.rotation:c.rotation,r>=l[l.length-ul.ENTRIES])d=c.data.rotation+l[l.length+ul.PREV_ROTATION];else{const t=ol.binarySearch(l,r,ul.ENTRIES),e=l[t+ul.PREV_ROTATION],n=l[t],s=h.getCurvePercent((t>>1)-1,1-(r-n)/(l[t+ul.PREV_TIME]-n));d=l[t+ul.ROTATION]-e,d-=360*(16384-(16384.499999999996-d/360|0)),d=e+d*s+c.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}let f=0,p=d-u;if(p-=360*(16384-(16384.499999999996-p/360|0)),0==p)f=i[o];else{let t=0,e=0;a?(t=0,e=p):(t=i[o],e=i[o+1]);const r=p>0;let n=t>=0;Rh.signum(e)!=Rh.signum(p)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Rh.signum(t)),n=r),f=p+t-t%360,n!=r&&(f+=360*Rh.signum(t)),i[o]=f}i[o+1]=p,u+=f*n,c.rotation=u-360*(16384-(16384.499999999996-u/360|0))}queueEvents(t,e){const r=t.animationStart,n=t.animationEnd,s=n-r,i=t.trackLast%s,o=this.events;let a=0;const h=o.length;for(;a<h;a++){const e=o[a];if(e.time<i)break;e.time>n||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==s||i>t.trackTime%s:e>=n&&t.animationLast<n,l&&this.queue.complete(t);a<h;a++)o[a].time<r||this.queue.event(t,o[a])}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let r=e;for(;;){const t=r.mixingFrom;if(null==t)break;this.queue.end(t),r.mixingFrom=null,r.mixingTo=null,r=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,r){const n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(r&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,null!=n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,r){const n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,n,r)}setAnimationWith(t,e,r){if(null==e)throw new Error("animation cannot be null.");let n=!0,s=this.expandToIndex(t);null!=s&&(-1==s.nextTrackLast?(this.tracks[t]=s.mixingFrom,this.queue.interrupt(s),this.queue.end(s),this.disposeNext(s),s=s.mixingFrom,n=!1):this.disposeNext(s));const i=this.trackEntry(t,e,r,s);return this.setCurrent(t,i,n),this.queue.drain(),i}addAnimation(t,e,r,n){const s=this.data.skeletonData.findAnimation(e);if(null==s)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,s,r,n)}addAnimationWith(t,e,r,n){if(null==e)throw new Error("animation cannot be null.");let s=this.expandToIndex(t);if(null!=s)for(;null!=s.next;)s=s.next;const i=this.trackEntry(t,e,r,s);if(null==s)this.setCurrent(t,i,!0),this.queue.drain();else if(s.next=i,n<=0){const t=s.animationEnd-s.animationStart;0!=t?(s.loop?n+=t*(1+(s.trackTime/t|0)):n+=Math.max(t,s.trackTime),n-=this.data.getMix(s.animation,e)):n=s.trackTime}return i.delay=n,i}setEmptyAnimation(t,e){const r=this.setAnimationWith(t,Fl.emptyAnimation,!1);return r.mixDuration=e,r.trackEnd=e,r}addEmptyAnimation(t,e,r){r<=0&&(r-=e);const n=this.addAnimationWith(t,Fl.emptyAnimation,!1,r);return n.mixDuration=e,n.trackEnd=e,n}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,r=this.tracks.length;e<r;e++){const r=this.tracks[e];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(kh.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,r,n){const s=this.trackEntryPool.obtain();return s.trackIndex=t,s.animation=e,s.loop=r,s.holdPrevious=!1,s.eventThreshold=0,s.attachmentThreshold=0,s.drawOrderThreshold=0,s.animationStart=0,s.animationEnd=e.duration,s.animationLast=-1,s.nextAnimationLast=-1,s.delay=0,s.trackTime=0,s.trackLast=-1,s.nextTrackLast=-1,s.trackEnd=Number.MAX_VALUE,s.timeScale=1,s.alpha=1,s.interruptAlpha=1,s.mixTime=0,s.mixDuration=null==n?0:this.data.getMix(n.animation,e),s.mixBlend=hh.replace,s}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==hh.add||this.computeHold(e),e=e.mixingTo}while(null!=e)}}}computeHold(t){const e=t.mixingTo,r=t.animation.timelines,n=t.animation.timelines.length,s=kh.setArraySize(t.timelineMode,n);t.timelineHoldMix.length=0;const i=kh.setArraySize(t.timelineHoldMix,n),o=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let t=0;t<n;t++)s[t]=o.add(r[t].getPropertyId())?Fl.HOLD_FIRST:Fl.HOLD_SUBSEQUENT;else t:for(let a=0;a<n;a++){const n=r[a],h=n.getPropertyId();if(o.add(h))if(null==e||n instanceof _l||n instanceof Tl||n instanceof El||!e.animation.hasTimeline(h))s[a]=Fl.FIRST;else{for(let r=e.mixingTo;null!=r;r=r.mixingTo)if(!r.animation.hasTimeline(h)){if(t.mixDuration>0){s[a]=Fl.HOLD_MIX,i[a]=r;continue t}break}s[a]=Fl.HOLD_FIRST}else s[a]=Fl.SUBSEQUENT}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,r){Fl.deprecatedWarning1||(Fl.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,r)}addAnimationByName(t,e,r,n){Fl.deprecatedWarning2||(Fl.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,r,n)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return Fl.deprecatedWarning3||(Fl.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let Nl=Fl;Nl.emptyAnimation=new ol("<empty>",[],0),Nl.SUBSEQUENT=0,Nl.FIRST=1,Nl.HOLD_SUBSEQUENT=2,Nl.HOLD_FIRST=3,Nl.HOLD_MIX=4,Nl.SETUP=1,Nl.CURRENT=2,Nl.deprecatedWarning1=!1,Nl.deprecatedWarning2=!1,Nl.deprecatedWarning3=!1;const Bl=class{constructor(){this.mixBlend=hh.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return Bl.deprecatedWarning1||(Bl.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){Bl.deprecatedWarning1||(Bl.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return Bl.deprecatedWarning2||(Bl.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){Bl.deprecatedWarning2||(Bl.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let Dl=Bl;Dl.deprecatedWarning1=!1,Dl.deprecatedWarning2=!1;const Ll=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(Ul.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Ul.interrupt),this.objects.push(t)}end(t){this.objects.push(Ul.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Ul.dispose),this.objects.push(t)}complete(t){this.objects.push(Ul.complete),this.objects.push(t)}event(t,e){this.objects.push(Ul.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return Ll.deprecatedWarning1||(Ll.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let r=0;r<t.length;r+=2){const n=t[r],s=t[r+1];switch(n){case Ul.start:null!=s.listener&&s.listener.start&&s.listener.start(s);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(s);s.onStart&&this.deprecateStuff()&&s.onStart(s.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(s.trackIndex);break;case Ul.interrupt:null!=s.listener&&s.listener.interrupt&&s.listener.interrupt(s);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(s);break;case Ul.end:null!=s.listener&&s.listener.end&&s.listener.end(s);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(s);s.onEnd&&this.deprecateStuff()&&s.onEnd(s.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(s.trackIndex);case Ul.dispose:null!=s.listener&&s.listener.dispose&&s.listener.dispose(s);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(s);this.animState.trackEntryPool.free(s);break;case Ul.complete:null!=s.listener&&s.listener.complete&&s.listener.complete(s);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(s);const n=Rh.toInt(s.loopsCount());s.onComplete&&this.deprecateStuff()&&s.onComplete(s.trackIndex,n),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(s.trackIndex,n);break;case Ul.event:const i=t[2+r++];null!=s.listener&&s.listener.event&&s.listener.event(s,i);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(s,i);s.onEvent&&this.deprecateStuff()&&s.onEvent(s.trackIndex,i),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(s.trackIndex,i)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let Vl=Ll;Vl.deprecatedWarning1=!1;var Ul=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(Ul||{});class Xl{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}}const jl=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,r){const n=this.skeletonData.findAnimation(t);if(null==n)throw new Error(`Animation not found: ${t}`);const s=this.skeletonData.findAnimation(e);if(null==s)throw new Error(`Animation not found: ${e}`);this.setMixWith(n,s,r)}setMixByName(t,e,r){jl.deprecatedWarning1||(jl.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,e,r)}setMixWith(t,e,r){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const n=`${t.name}.${e.name}`;this.animationToMixTime[n]=r}getMix(t,e){const r=`${t.name}.${e.name}`,n=this.animationToMixTime[r];return void 0===n?this.defaultMix:n}};let Yl=jl;Yl.deprecatedWarning1=!1;class Gl{constructor(t){this.atlas=t}newRegionAttachment(t,e,r){const n=this.atlas.findRegion(r);if(null==n)throw new Error(`Region not found in atlas: ${r} (region attachment: ${e})`);const s=new rl(e);return s.region=n,s}newMeshAttachment(t,e,r){const n=this.atlas.findRegion(r);if(null==n)throw new Error(`Region not found in atlas: ${r} (mesh attachment: ${e})`);const s=new Zh(e);return s.region=n,s}newBoundingBoxAttachment(t,e){return new qh(e)}newPathAttachment(t,e){return new Qh(e)}newPointAttachment(t,e){return new Jh(e)}newClippingAttachment(t,e){return new Kh(e)}}class Wl{constructor(t,e,r){if(this.matrix=new We,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=r,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,r,n,s,i,o){this.ax=t,this.ay=e,this.arotation=r,this.ascaleX=n,this.ascaleY=s,this.ashearX=i,this.ashearY=o,this.appliedValid=!0;const a=this.parent,h=this.matrix,l=this.skeleton.scaleX,c=-this.skeleton.scaleY;if(null==a){const a=this.skeleton,u=r+90+o;return h.a=Rh.cosDeg(r+i)*n*l,h.c=Rh.cosDeg(u)*s*l,h.b=Rh.sinDeg(r+i)*n*c,h.d=Rh.sinDeg(u)*s*c,h.tx=t*l+a.x,void(h.ty=e*c+a.y)}let u=a.matrix.a,d=a.matrix.c,f=a.matrix.b,p=a.matrix.d;switch(h.tx=u*t+d*e+a.matrix.tx,h.ty=f*t+p*e+a.matrix.ty,this.data.transformMode){case dh.Normal:{const t=r+90+o,e=Rh.cosDeg(r+i)*n,a=Rh.cosDeg(t)*s,l=Rh.sinDeg(r+i)*n,c=Rh.sinDeg(t)*s;return h.a=u*e+d*l,h.c=u*a+d*c,h.b=f*e+p*l,void(h.d=f*a+p*c)}case dh.OnlyTranslation:{const t=r+90+o;h.a=Rh.cosDeg(r+i)*n,h.c=Rh.cosDeg(t)*s,h.b=Rh.sinDeg(r+i)*n,h.d=Rh.sinDeg(t)*s;break}case dh.NoRotationOrReflection:{let t=u*u+f*f,e=0;t>1e-4?(t=Math.abs(u*p-d*f)/t,u/=this.skeleton.scaleX,f/=this.skeleton.scaleY,d=f*t,p=u*t,e=Math.atan2(f,u)*Rh.radDeg):(u=0,f=0,e=90-Math.atan2(p,d)*Rh.radDeg);const a=r+i-e,l=r+o-e+90,c=Rh.cosDeg(a)*n,m=Rh.cosDeg(l)*s,g=Rh.sinDeg(a)*n,y=Rh.sinDeg(l)*s;h.a=u*c-d*g,h.c=u*m-d*y,h.b=f*c+p*g,h.d=f*m+p*y;break}case dh.NoScale:case dh.NoScaleOrReflection:{const t=Rh.cosDeg(r),e=Rh.sinDeg(r);let a=(u*t+d*e)/l,m=(f*t+p*e)/c,g=Math.sqrt(a*a+m*m);g>1e-5&&(g=1/g),a*=g,m*=g,g=Math.sqrt(a*a+m*m),this.data.transformMode==dh.NoScale&&u*p-d*f<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(g=-g);const y=Math.PI/2+Math.atan2(m,a),b=Math.cos(y)*g,x=Math.sin(y)*g,_=Rh.cosDeg(i)*n,v=Rh.cosDeg(90+o)*s,w=Rh.sinDeg(i)*n,E=Rh.sinDeg(90+o)*s;h.a=a*_+b*w,h.c=a*v+b*E,h.b=m*_+x*w,h.d=m*v+x*E;break}}h.a*=l,h.c*=l,h.b*=c,h.d*=c}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*Rh.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*Rh.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*Rh.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*Rh.radDeg);const r=t.matrix,n=1/(r.a*r.d-r.b*r.c),s=e.tx-r.tx,i=e.ty-r.ty;this.ax=s*r.d*n-i*r.c*n,this.ay=i*r.a*n-s*r.b*n;const o=n*r.d,a=n*r.a,h=n*r.c,l=n*r.b,c=o*e.a-h*e.b,u=o*e.c-h*e.d,d=a*e.b-l*e.a,f=a*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*f,t)*Rh.radDeg,this.arotation=Math.atan2(d,c)*Rh.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*Rh.radDeg}worldToLocal(t){const e=this.matrix,r=e.a,n=e.c,s=e.b,i=e.d,o=1/(r*i-n*s),a=t.x-e.tx,h=t.y-e.ty;return t.x=a*i*o-h*n*o,t.y=h*r*o-a*s*o,t}localToWorld(t){const e=this.matrix,r=t.x,n=t.y;return t.x=r*e.a+n*e.c+e.tx,t.y=r*e.b+n*e.d+e.ty,t}worldToLocalRotation(t){const e=Rh.sinDeg(t),r=Rh.cosDeg(t),n=this.matrix;return Math.atan2(n.a*e-n.b*r,n.d*r-n.c*e)*Rh.radDeg}localToWorldRotation(t){const e=Rh.sinDeg(t),r=Rh.cosDeg(t),n=this.matrix;return Math.atan2(r*n.b+e*n.d,r*n.a+e*n.c)*Rh.radDeg}rotateWorld(t){const e=this.matrix,r=e.a,n=e.c,s=e.b,i=e.d,o=Rh.cosDeg(t),a=Rh.sinDeg(t);e.a=o*r-a*s,e.c=o*n-a*i,e.b=a*r+o*s,e.d=a*n+o*i,this.appliedValid=!1}}class Hl{constructor(t,e,r){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=dh.Normal,this.skinRequired=!1,this.color=new Ah,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=r}}class $l{constructor(t,e,r){this.name=t,this.order=e,this.skinRequired=r}}class zl{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}class ql{constructor(t){this.name=t}}class Kl{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let r=0;r<t.bones.length;r++)this.bones.push(e.findBone(t.bones[r].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}apply1(t,e,r,n,s,i,o){t.appliedValid||t.updateAppliedTransform();const a=t.parent.matrix,h=a.a;let l=a.c;const c=a.b;let u=a.d,d=-t.ashearX-t.arotation,f=0,p=0;switch(t.data.transformMode){case dh.OnlyTranslation:f=e-t.worldX,p=r-t.worldY;break;case dh.NoRotationOrReflection:const n=Math.abs(h*u-l*c)/(h*h+c*c),s=h/t.skeleton.scaleX,i=c/t.skeleton.scaleY;l=-i*n*t.skeleton.scaleX,u=s*n*t.skeleton.scaleY,d+=Math.atan2(i,s)*Rh.radDeg;default:const o=e-a.tx,m=r-a.ty,g=h*u-l*c;f=(o*u-m*l)/g-t.ax,p=(m*h-o*c)/g-t.ay}d+=Math.atan2(p,f)*Rh.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);let m=t.ascaleX,g=t.ascaleY;if(n||s){switch(t.data.transformMode){case dh.NoScale:case dh.NoScaleOrReflection:f=e-t.worldX,p=r-t.worldY}const a=t.data.length*m,h=Math.sqrt(f*f+p*p);if(n&&h<a||s&&h>a&&a>1e-4){const t=(h/a-1)*o+1;m*=t,i&&(g*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*o,m,g,t.ashearX,t.ashearY)}apply2(t,e,r,n,s,i,o,a){if(0==a)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const h=t.ax,l=t.ay;let c=t.ascaleX,u=c,d=t.ascaleY,f=e.ascaleX;const p=t.matrix;let m=0,g=0,y=0;c<0?(c=-c,m=180,y=-1):(m=0,y=1),d<0&&(d=-d,y=-y),f<0?(f=-f,g=180):g=0;const b=e.ax;let x=0,_=0,v=0,w=p.a,E=p.c,T=p.b,A=p.d;const S=Math.abs(c-d)<=1e-4;S?(x=e.ay,_=w*b+E*x+p.tx,v=T*b+A*x+p.ty):(x=0,_=w*b+p.tx,v=T*b+p.ty);const R=t.parent.matrix;w=R.a,E=R.c,T=R.b,A=R.d;const I=1/(w*A-E*T);let M=_-R.tx,P=v-R.ty;const C=(M*A-P*E)*I-h,k=(P*w-M*T)*I-l,O=Math.sqrt(C*C+k*k);let F,N,B=e.data.length*f;if(O<1e-4)return this.apply1(t,r,n,!1,i,!1,a),void e.updateWorldTransformWith(b,x,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);M=r-R.tx,P=n-R.ty;let D=(M*A-P*E)*I-h,L=(P*w-M*T)*I-l,V=D*D+L*L;if(0!=o){o*=c*(f+1)/2;const t=Math.sqrt(V),e=t-O-B*c+o;if(e>0){let r=Math.min(1,e/(2*o))-1;r=(e-o*(1-r*r))/t,D-=r*D,L-=r*L,V=D*D+L*L}}t:if(S){B*=c;let t=(V-O*O-B*B)/(2*O*B);t<-1?t=-1:t>1&&(t=1,i&&(u*=(Math.sqrt(V)/(O+B)-1)*a+1)),N=Math.acos(t)*s,w=O+B*t,E=B*Math.sin(N),F=Math.atan2(L*w-D*E,D*w+L*E)}else{w=c*B,E=d*B;const t=w*w,e=E*E,r=Math.atan2(L,D);T=e*O*O+t*V-t*e;const n=-2*e*O,i=e-t;if(A=n*n-4*i*T,A>=0){let t=Math.sqrt(A);n<0&&(t=-t),t=-(n+t)/2;const e=t/i,o=T/t,a=Math.abs(e)<Math.abs(o)?e:o;if(a*a<=V){P=Math.sqrt(V-a*a)*s,F=r-Math.atan2(P,a),N=Math.atan2(P/d,(a-O)/c);break t}}let o=Rh.PI,a=O-w,h=a*a,l=0,u=0,f=O+w,p=f*f,m=0;T=-w*O/(t-e),T>=-1&&T<=1&&(T=Math.acos(T),M=w*Math.cos(T)+O,P=E*Math.sin(T),A=M*M+P*P,A<h&&(o=T,h=A,a=M,l=P),A>p&&(u=T,p=A,f=M,m=P)),V<=(h+p)/2?(F=r-Math.atan2(l*s,a),N=o*s):(F=r-Math.atan2(m*s,f),N=u*s)}const U=Math.atan2(x,b)*y;let X=t.arotation;F=(F-U)*Rh.radDeg+m-X,F>180?F-=360:F<-180&&(F+=360),t.updateWorldTransformWith(h,l,X+F*a,u,t.ascaleY,0,0),X=e.arotation,N=((N+U)*Rh.radDeg-e.ashearX)*y+g-X,N>180?N-=360:N<-180&&(N+=360),e.updateWorldTransformWith(b,x,X+N*a,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class Zl extends $l{constructor(t){super(t,0,!1),this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}}class Ql extends $l{constructor(t){super(t,0,!1),this.bones=new Array}}var Jl=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(Jl||{});const tc=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let r=0,n=t.bones.length;r<n;r++)this.bones.push(e.findBone(t.bones[r].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}isActive(){return this.active}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof Qh))return;const e=this.rotateMix,r=this.translateMix,n=e>0;if(!(r>0||n))return;const s=this.data,i=s.spacingMode,o=i==Jl.Length,a=s.rotateMode,h=a==uh.Tangent,l=a==uh.ChainScale,c=this.bones.length,u=h?c:c+1,d=this.bones,f=kh.setArraySize(this.spaces,u);let p=null;const m=this.spacing;if(l||o){l&&(p=kh.setArraySize(this.lengths,c));for(let t=0,e=u-1;t<e;){const e=d[t],r=e.data.length;if(r<tc.epsilon)l&&(p[t]=0),f[++t]=0;else{const n=r*e.matrix.a,s=r*e.matrix.b,i=Math.sqrt(n*n+s*s);l&&(p[t]=i),f[++t]=(o?r+m:m)*i/r}}}else for(let t=1;t<u;t++)f[t]=m;const g=this.computeWorldPositions(t,u,h,s.positionMode==ch.Percent,i==Jl.Percent);let y=g[0],b=g[1],x=s.offsetRotation,_=!1;if(0==x)_=a==uh.Chain;else{_=!1;const t=this.target.bone.matrix;x*=t.a*t.d-t.b*t.c>0?Rh.degRad:-Rh.degRad}for(let t=0,s=3;t<c;t++,s+=3){const i=d[t],o=i.matrix;o.tx+=(y-o.tx)*r,o.ty+=(b-o.ty)*r;const a=g[s],c=g[s+1],u=a-y,m=c-b;if(l){const r=p[t];if(0!=r){const t=(Math.sqrt(u*u+m*m)/r-1)*e+1;o.a*=t,o.b*=t}}if(y=a,b=c,n){const r=o.a,n=o.c,a=o.b,l=o.d;let c=0,d=0,p=0;if(h&&(c=h?g[s-1]:0==f[t+1]?g[s+2]:Math.atan2(m,u)),c-=Math.atan2(a,r),_){d=Math.cos(c),p=Math.sin(c);const t=i.data.length;y+=(t*(d*r-p*a)-u)*e,b+=(t*(p*r+d*a)-m)*e}else c+=x;c>Rh.PI?c-=Rh.PI2:c<-Rh.PI&&(c+=Rh.PI2),c*=e,d=Math.cos(c),p=Math.sin(c),o.a=d*r-p*a,o.c=d*n-p*l,o.b=p*r+d*a,o.d=p*n+d*l}i.appliedValid=!1}}computeWorldPositions(t,e,r,n,s){const i=this.target;let o=this.position;const a=this.spaces,h=kh.setArraySize(this.positions,3*e+2);let l=null;const c=t.closed;let u=t.worldVerticesLength,d=u/6,f=tc.NONE;if(!t.constantSpeed){const p=t.lengths;d-=c?1:2;const m=p[d];if(n&&(o*=m),s)for(let t=0;t<e;t++)a[t]*=m;l=kh.setArraySize(this.world,8);for(let n=0,s=0,g=0;n<e;n++,s+=3){const e=a[n];o+=e;let y=o;if(c)y%=m,y<0&&(y+=m),g=0;else{if(y<0){f!=tc.BEFORE&&(f=tc.BEFORE,t.computeWorldVertices(i,2,4,l,0,2)),this.addBeforePosition(y,l,0,h,s);continue}if(y>m){f!=tc.AFTER&&(f=tc.AFTER,t.computeWorldVertices(i,u-6,4,l,0,2)),this.addAfterPosition(y-m,l,0,h,s);continue}}for(;;g++){const t=p[g];if(!(y>t)){if(0==g)y/=t;else{const e=p[g-1];y=(y-e)/(t-e)}break}}g!=f&&(f=g,c&&g==d?(t.computeWorldVertices(i,u-4,4,l,0,2),t.computeWorldVertices(i,0,4,l,4,2)):t.computeWorldVertices(i,6*g+2,8,l,0,2)),this.addCurvePosition(y,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,s,r||n>0&&0==e)}return h}c?(u+=2,l=kh.setArraySize(this.world,u),t.computeWorldVertices(i,2,u-4,l,0,2),t.computeWorldVertices(i,0,2,l,u-4,2),l[u-2]=l[0],l[u-1]=l[1]):(d--,u-=4,l=kh.setArraySize(this.world,u),t.computeWorldVertices(i,2,u,l,0,2));const p=kh.setArraySize(this.curves,d);let m=0,g=l[0],y=l[1],b=0,x=0,_=0,v=0,w=0,E=0,T=0,A=0,S=0,R=0,I=0,M=0,P=0,C=0;for(let t=0,e=2;t<d;t++,e+=6)b=l[e],x=l[e+1],_=l[e+2],v=l[e+3],w=l[e+4],E=l[e+5],T=.1875*(g-2*b+_),A=.1875*(y-2*x+v),S=.09375*(3*(b-_)-g+w),R=.09375*(3*(x-v)-y+E),I=2*T+S,M=2*A+R,P=.75*(b-g)+T+.16666667*S,C=.75*(x-y)+A+.16666667*R,m+=Math.sqrt(P*P+C*C),P+=I,C+=M,I+=S,M+=R,m+=Math.sqrt(P*P+C*C),P+=I,C+=M,m+=Math.sqrt(P*P+C*C),P+=I+S,C+=M+R,m+=Math.sqrt(P*P+C*C),p[t]=m,g=w,y=E;if(n&&(o*=m),s)for(let t=0;t<e;t++)a[t]*=m;const k=this.segments;let O=0;for(let t=0,n=0,s=0,i=0;t<e;t++,n+=3){const e=a[t];o+=e;let d=o;if(c)d%=m,d<0&&(d+=m),s=0;else{if(d<0){this.addBeforePosition(d,l,0,h,n);continue}if(d>m){this.addAfterPosition(d-m,l,u-4,h,n);continue}}for(;;s++){const t=p[s];if(!(d>t)){if(0==s)d/=t;else{const e=p[s-1];d=(d-e)/(t-e)}break}}if(s!=f){f=s;let t=6*s;for(g=l[t],y=l[t+1],b=l[t+2],x=l[t+3],_=l[t+4],v=l[t+5],w=l[t+6],E=l[t+7],T=.03*(g-2*b+_),A=.03*(y-2*x+v),S=.006*(3*(b-_)-g+w),R=.006*(3*(x-v)-y+E),I=2*T+S,M=2*A+R,P=.3*(b-g)+T+.16666667*S,C=.3*(x-y)+A+.16666667*R,O=Math.sqrt(P*P+C*C),k[0]=O,t=1;t<8;t++)P+=I,C+=M,I+=S,M+=R,O+=Math.sqrt(P*P+C*C),k[t]=O;P+=I,C+=M,O+=Math.sqrt(P*P+C*C),k[8]=O,P+=I+S,C+=M+R,O+=Math.sqrt(P*P+C*C),k[9]=O,i=0}for(d*=O;;i++){const t=k[i];if(!(d>t)){if(0==i)d/=t;else{const e=k[i-1];d=i+(d-e)/(t-e)}break}}this.addCurvePosition(.1*d,g,y,b,x,_,v,w,E,h,n,r||t>0&&0==e)}return h}addBeforePosition(t,e,r,n,s){const i=e[r],o=e[r+1],a=e[r+2]-i,h=e[r+3]-o,l=Math.atan2(h,a);n[s]=i+t*Math.cos(l),n[s+1]=o+t*Math.sin(l),n[s+2]=l}addAfterPosition(t,e,r,n,s){const i=e[r+2],o=e[r+3],a=i-e[r],h=o-e[r+1],l=Math.atan2(h,a);n[s]=i+t*Math.cos(l),n[s+1]=o+t*Math.sin(l),n[s+2]=l}addCurvePosition(t,e,r,n,s,i,o,a,h,l,c,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,y=p*t,b=3*y,x=p*b,_=b*t,v=e*g+n*x+i*_+a*f,w=r*g+s*x+o*_+h*f;l[c]=v,l[c+1]=w,u&&(l[c+2]=Math.atan2(w-(r*m+s*y*2+o*d),v-(e*m+n*y*2+i*d)))}};let ec=tc;ec.NONE=-1,ec.BEFORE=-2,ec.AFTER=-3,ec.epsilon=1e-5;class rc{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new Fh,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let r=0;r<t.bones.length;r++)this.bones.push(e.findBone(t.bones[r].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target,i=s.matrix,o=i.a,a=i.c,h=i.b,l=i.d,c=o*l-a*h>0?Rh.degRad:-Rh.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let i=0,c=f.length;i<c;i++){const c=f[i];let p=!1;const m=c.matrix;if(0!=t){const e=m.a,r=m.c,n=m.b,s=m.d;let i=Math.atan2(h,o)-Math.atan2(n,e)+u;i>Rh.PI?i-=Rh.PI2:i<-Rh.PI&&(i+=Rh.PI2),i*=t;const a=Math.cos(i),l=Math.sin(i);m.a=a*e-l*n,m.c=a*r-l*s,m.b=l*e+a*n,m.d=l*r+a*s,p=!0}if(0!=e){const t=this.temp;s.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,p=!0}if(r>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(o*o+h*h);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*r)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(a*a+l*l),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*r)/t),m.c*=t,m.d*=t,p=!0}if(n>0){const t=m.c,e=m.d,r=Math.atan2(e,t);let s=Math.atan2(l,a)-Math.atan2(h,o)-(r-Math.atan2(m.b,m.a));s>Rh.PI?s-=Rh.PI2:s<-Rh.PI&&(s+=Rh.PI2),s=r+(s+d)*n;const i=Math.sqrt(t*t+e*e);m.c=Math.cos(s)*i,m.d=Math.sin(s)*i,p=!0}p&&(c.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target,i=s.matrix,o=i.a,a=i.c,h=i.b,l=i.d,c=o*l-a*h>0?Rh.degRad:-Rh.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let i=0,c=f.length;i<c;i++){const c=f[i];let p=!1;const m=c.matrix;if(0!=t){const e=m.a,r=m.c,n=m.b,s=m.d;let i=Math.atan2(h,o)+u;i>Rh.PI?i-=Rh.PI2:i<-Rh.PI&&(i+=Rh.PI2),i*=t;const a=Math.cos(i),l=Math.sin(i);m.a=a*e-l*n,m.c=a*r-l*s,m.b=l*e+a*n,m.d=l*r+a*s,p=!0}if(0!=e){const t=this.temp;s.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,p=!0}if(r>0){let t=(Math.sqrt(o*o+h*h)-1+this.data.offsetScaleX)*r+1;m.a*=t,m.b*=t,t=(Math.sqrt(a*a+l*l)-1+this.data.offsetScaleY)*r+1,m.c*=t,m.d*=t,p=!0}if(n>0){let t=Math.atan2(l,a)-Math.atan2(h,o);t>Rh.PI?t-=Rh.PI2:t<-Rh.PI&&(t+=Rh.PI2);const e=m.c,r=m.d;t=Math.atan2(r,e)+(t-Rh.PI/2+d)*n;const s=Math.sqrt(e*e+r*r);m.c=Math.cos(t)*s,m.d=Math.sin(t)*s,p=!0}p&&(c.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target;s.appliedValid||s.updateAppliedTransform();const i=this.bones;for(let o=0,a=i.length;o<a;o++){const a=i[o];a.appliedValid||a.updateAppliedTransform();let h=a.arotation;if(0!=t){let e=s.arotation-h+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),h+=e*t}let l=a.ax,c=a.ay;0!=e&&(l+=(s.ax-l+this.data.offsetX)*e,c+=(s.ay-c+this.data.offsetY)*e);let u=a.ascaleX,d=a.ascaleY;r>0&&(u>1e-5&&(u=(u+(s.ascaleX-u+this.data.offsetScaleX)*r)/u),d>1e-5&&(d=(d+(s.ascaleY-d+this.data.offsetScaleY)*r)/d));const f=a.ashearY;if(n>0){let t=s.ashearY-f+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),a.shearY+=t*n}a.updateWorldTransformWith(l,c,h,u,d,a.ashearX,f)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target;s.appliedValid||s.updateAppliedTransform();const i=this.bones;for(let o=0,a=i.length;o<a;o++){const a=i[o];a.appliedValid||a.updateAppliedTransform();let h=a.arotation;0!=t&&(h+=(s.arotation+this.data.offsetRotation)*t);let l=a.ax,c=a.ay;0!=e&&(l+=(s.ax+this.data.offsetX)*e,c+=(s.ay+this.data.offsetY)*e);let u=a.ascaleX,d=a.ascaleY;r>0&&(u>1e-5&&(u*=(s.ascaleX-1+this.data.offsetScaleX)*r+1),d>1e-5&&(d*=(s.ascaleY-1+this.data.offsetScaleY)*r+1));let f=a.ashearY;n>0&&(f+=(s.ashearY+this.data.offsetShearY)*n),a.updateWorldTransformWith(l,c,h,u,d,a.ashearX,f)}}}const nc=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const r=t.bones[e];let n;if(null==r.parent)n=new Wl(r,this,null);else{const t=this.bones[r.parent.index];n=new Wl(r,this,t),t.children.push(n)}this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const r=t.slots[e],n=this.bones[r.boneData.index],s=new tl(r,n);this.slots.push(s),this.drawOrder.push(s)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const r=t.ikConstraints[e];this.ikConstraints.push(new Kl(r,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const r=t.transformConstraints[e];this.transformConstraints.push(new rc(r,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const r=t.pathConstraints[e];this.pathConstraints.push(new ec(r,this))}this.color=new Ah(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let e=0,r=t.length;e<r;e++){const r=t[e];r.sorted=r.data.skinRequired,r.active=!r.sorted}if(null!=this.skin){const t=this.skin.bones;for(let e=0,r=this.skin.bones.length;e<r;e++){let r=this.bones[t[e].index];do{r.sorted=!1,r.active=!0,r=r.parent}while(null!=r)}}const e=this.ikConstraints,r=this.transformConstraints,n=this.pathConstraints,s=e.length,i=r.length,o=n.length,a=s+i+o;t:for(let t=0;t<a;t++){for(let r=0;r<s;r++){const n=e[r];if(n.data.order==t){this.sortIkConstraint(n);continue t}}for(let e=0;e<i;e++){const n=r[e];if(n.data.order==t){this.sortTransformConstraint(n);continue t}}for(let e=0;e<o;e++){const r=n[e];if(r.data.order==t){this.sortPathConstraint(r);continue t}}}for(let e=0,r=t.length;e<r;e++)this.sortBone(t[e])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&kh.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const r=t.bones,n=r[0];if(this.sortBone(n),r.length>1){const t=r[r.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(n.children),r[r.length-1].sorted=!0}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&kh.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,r=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,r,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,r,n);for(let t=0,e=this.data.skins.length;t<e;t++)this.sortPathConstraintAttachment(this.data.skins[t],r,n);const s=e.getAttachment();s instanceof Qh&&this.sortPathConstraintAttachmentWith(s,n);const i=t.bones,o=i.length;for(let t=0;t<o;t++)this.sortBone(i[t]);this._updateCache.push(t);for(let t=0;t<o;t++)this.sortReset(i[t].children);for(let t=0;t<o;t++)i[t].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&kh.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,r=e.length;if(t.data.local)for(let t=0;t<r;t++){const r=e[t];this.sortBone(r.parent),this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}else for(let t=0;t<r;t++)this.sortBone(e[t]);this._updateCache.push(t);for(let t=0;t<r;t++)this.sortReset(e[t].children);for(let t=0;t<r;t++)e[t].sorted=!0}sortPathConstraintAttachment(t,e,r){const n=t.attachments[e];if(n)for(const t in n)this.sortPathConstraintAttachmentWith(n[t],r)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof Qh))return;const r=t.bones;if(null==r)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<r.length;){const n=r[e++];for(let s=e+n;e<s;e++){const n=r[e];this.sortBone(t[n])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,r=t.length;e<r;e++){const r=t[e];r.active&&(r.sorted&&this.sortReset(r.children),r.sorted=!1)}}updateWorldTransform(){const t=this.updateCacheReset;for(let e=0,r=t.length;e<r;e++){const r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0}const e=this._updateCache;for(let t=0,r=e.length;t<r;t++)e[t].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let e=0,r=t.length;e<r;e++)t[e].setToSetupPose();const e=this.ikConstraints;for(let t=0,r=e.length;t<r;t++){const r=e[t];r.mix=r.data.mix,r.softness=r.data.softness,r.bendDirection=r.data.bendDirection,r.compress=r.data.compress,r.stretch=r.data.stretch}const r=this.transformConstraints;for(let t=0,e=r.length;t<e;t++){const e=r[t],n=e.data;e.rotateMix=n.rotateMix,e.translateMix=n.translateMix,e.scaleMix=n.scaleMix,e.shearMix=n.shearMix}const n=this.pathConstraints;for(let t=0,e=n.length;t<e;t++){const e=n[t],r=e.data;e.position=r.position,e.spacing=r.spacing,e.rotateMix=r.rotateMix,e.translateMix=r.translateMix}}setSlotsToSetupPose(){const t=this.slots;kh.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,r=t.length;e<r;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return r;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return r;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let r=0,n=e.length;r<n;r++){const n=e[r],s=n.data.attachmentName;if(null!=s){const e=t.getAttachment(r,s);null!=e&&n.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const r=this.skin.getAttachment(t,e);if(null!=r)return r}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const r=this.slots;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(s.data.name==t){let r=null;if(null!=e&&(r=this.getAttachment(n,e),null==r))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void s.setAttachment(r)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}getBounds(t,e,r=new Array(2)){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const n=this.drawOrder;let s=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let t=0,e=n.length;t<e;t++){const e=n[t];if(!e.bone.active)continue;let h=0,l=null;const c=e.getAttachment();if(c instanceof rl)h=8,l=kh.setArraySize(r,h,0),c.computeWorldVertices(e.bone,l,0,2);else if(c instanceof Zh){const t=c;h=t.worldVerticesLength,l=kh.setArraySize(r,h,0),t.computeWorldVertices(e,0,h,l,0,2)}if(null!=l)for(let t=0,e=l.length;t<e;t+=2){const e=l[t],r=l[t+1];s=Math.min(s,e),i=Math.min(i,r),o=Math.max(o,e),a=Math.max(a,r)}}t.set(s,i),e.set(o-s,a-i)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){nc.deprecatedWarning1||(nc.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){nc.deprecatedWarning1||(nc.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let sc=nc;sc.deprecatedWarning1=!1;class ic{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1}}class oc{constructor(t,e,r){if(this.color=new Ah(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==r)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=r}}class ac extends $l{constructor(t){super(t,0,!1),this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}}class hc{constructor(t,e,r){this.slotIndex=t,this.name=e,this.attachment=r}}class lc{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,r){if(null==r)throw new Error("attachment cannot be null.");const n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=r}addSkin(t){for(let e=0;e<t.bones.length;e++){const r=t.bones[e];let n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==r){n=!0;break}n||this.bones.push(r)}for(let e=0;e<t.constraints.length;e++){const r=t.constraints[e];let n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==r){n=!0;break}n||this.constraints.push(r)}const e=t.getAttachments();for(let t=0;t<e.length;t++){const r=e[t];this.setAttachment(r.slotIndex,r.name,r.attachment)}}copySkin(t){for(let e=0;e<t.bones.length;e++){const r=t.bones[e];let n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==r){n=!0;break}n||this.bones.push(r)}for(let e=0;e<t.constraints.length;e++){const r=t.constraints[e];let n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==r){n=!0;break}n||this.constraints.push(r)}const e=t.getAttachments();for(let t=0;t<e.length;t++){const r=e[t];null!=r.attachment&&(r.attachment instanceof Zh?(r.attachment=r.attachment.newLinkedMesh(),this.setAttachment(r.slotIndex,r.name,r.attachment)):(r.attachment=r.attachment.copy(),this.setAttachment(r.slotIndex,r.name,r.attachment)))}}getAttachment(t,e){const r=this.attachments[t];return r?r[e]:null}removeAttachment(t,e){const r=this.attachments[t];r&&(r[e]=null)}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const r=this.attachments[e];if(r)for(const n in r){const s=r[n];s&&t.push(new hc(e,n,s))}}return t}getAttachmentsForSlot(t,e){const r=this.attachments[t];if(r)for(const n in r){const s=r[n];s&&e.push(new hc(t,n,s))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let r=0;for(let n=0;n<t.slots.length;n++){const s=t.slots[n],i=s.getAttachment();if(i&&r<e.attachments.length){const t=e.attachments[r];for(const e in t)if(i==t[e]){const t=this.getAttachment(r,e);null!=t&&s.setAttachment(t);break}}r++}}}const cc=class{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,r=new ic;r.name="";const n=new ah(t);if(r.hash=n.readString(),r.version=n.readString(),"3.8.75"===r.version){const t="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(t)}r.x=n.readFloat(),r.y=n.readFloat(),r.width=n.readFloat(),r.height=n.readFloat();const s=n.readBoolean();s&&(r.fps=n.readFloat(),r.imagesPath=n.readString(),r.audioPath=n.readString());let i=0;i=n.readInt(!0);for(let t=0;t<i;t++)n.strings.push(n.readString());i=n.readInt(!0);for(let t=0;t<i;t++){const i=n.readString(),o=0==t?null:r.bones[n.readInt(!0)],a=new Hl(t,i,o);a.rotation=n.readFloat(),a.x=n.readFloat()*e,a.y=n.readFloat()*e,a.scaleX=n.readFloat(),a.scaleY=n.readFloat(),a.shearX=n.readFloat(),a.shearY=n.readFloat(),a.length=n.readFloat()*e,a.transformMode=cc.TransformModeValues[n.readInt(!0)],a.skinRequired=n.readBoolean(),s&&Ah.rgba8888ToColor(a.color,n.readInt32()),r.bones.push(a)}i=n.readInt(!0);for(let t=0;t<i;t++){const e=n.readString(),s=r.bones[n.readInt(!0)],i=new oc(t,e,s);Ah.rgba8888ToColor(i.color,n.readInt32());const o=n.readInt32();-1!=o&&Ah.rgb888ToColor(i.darkColor=new Ah,o),i.attachmentName=n.readStringRef(),i.blendMode=cc.BlendModeValues[n.readInt(!0)],r.slots.push(i)}i=n.readInt(!0);for(let t,s=0;s<i;s++){const s=new Zl(n.readString());s.order=n.readInt(!0),s.skinRequired=n.readBoolean(),t=n.readInt(!0);for(let e=0;e<t;e++)s.bones.push(r.bones[n.readInt(!0)]);s.target=r.bones[n.readInt(!0)],s.mix=n.readFloat(),s.softness=n.readFloat()*e,s.bendDirection=n.readByte(),s.compress=n.readBoolean(),s.stretch=n.readBoolean(),s.uniform=n.readBoolean(),r.ikConstraints.push(s)}i=n.readInt(!0);for(let t,s=0;s<i;s++){const s=new ac(n.readString());s.order=n.readInt(!0),s.skinRequired=n.readBoolean(),t=n.readInt(!0);for(let e=0;e<t;e++)s.bones.push(r.bones[n.readInt(!0)]);s.target=r.bones[n.readInt(!0)],s.local=n.readBoolean(),s.relative=n.readBoolean(),s.offsetRotation=n.readFloat(),s.offsetX=n.readFloat()*e,s.offsetY=n.readFloat()*e,s.offsetScaleX=n.readFloat(),s.offsetScaleY=n.readFloat(),s.offsetShearY=n.readFloat(),s.rotateMix=n.readFloat(),s.translateMix=n.readFloat(),s.scaleMix=n.readFloat(),s.shearMix=n.readFloat(),r.transformConstraints.push(s)}i=n.readInt(!0);for(let t,s=0;s<i;s++){const s=new Ql(n.readString());s.order=n.readInt(!0),s.skinRequired=n.readBoolean(),t=n.readInt(!0);for(let e=0;e<t;e++)s.bones.push(r.bones[n.readInt(!0)]);s.target=r.slots[n.readInt(!0)],s.positionMode=cc.PositionModeValues[n.readInt(!0)],s.spacingMode=cc.SpacingModeValues[n.readInt(!0)],s.rotateMode=cc.RotateModeValues[n.readInt(!0)],s.offsetRotation=n.readFloat(),s.position=n.readFloat(),s.positionMode==ch.Fixed&&(s.position*=e),s.spacing=n.readFloat(),s.spacingMode!=Jl.Length&&s.spacingMode!=Jl.Fixed||(s.spacing*=e),s.rotateMix=n.readFloat(),s.translateMix=n.readFloat(),r.pathConstraints.push(s)}const o=this.readSkin(n,r,!0,s);null!=o&&(r.defaultSkin=o,r.skins.push(o));{let t=r.skins.length;for(kh.setArraySize(r.skins,i=t+n.readInt(!0));t<i;t++)r.skins[t]=this.readSkin(n,r,!1,s)}i=this.linkedMeshes.length;for(let t=0;t<i;t++){const e=this.linkedMeshes[t],n=null==e.skin?r.defaultSkin:r.findSkin(e.skin);if(null==n)throw new Error(`Skin not found: ${e.skin}`);const s=n.getAttachment(e.slotIndex,e.parent);if(null==s)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.deformAttachment=e.inheritDeform?s:e.mesh,e.mesh.setParentMesh(s)}this.linkedMeshes.length=0,i=n.readInt(!0);for(let t=0;t<i;t++){const t=new ql(n.readStringRef());t.intValue=n.readInt(!1),t.floatValue=n.readFloat(),t.stringValue=n.readString(),t.audioPath=n.readString(),null!=t.audioPath&&(t.volume=n.readFloat(),t.balance=n.readFloat()),r.events.push(t)}i=n.readInt(!0);for(let t=0;t<i;t++)r.animations.push(this.readAnimation(n,n.readString(),r));return r}readSkin(t,e,r,n){let s=null,i=0;if(r){if(i=t.readInt(!0),0==i)return null;s=new lc("default")}else{s=new lc(t.readStringRef()),s.bones.length=t.readInt(!0);for(let r=0,n=s.bones.length;r<n;r++)s.bones[r]=e.bones[t.readInt(!0)];for(let r=0,n=t.readInt(!0);r<n;r++)s.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let r=0,n=t.readInt(!0);r<n;r++)s.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let r=0,n=t.readInt(!0);r<n;r++)s.constraints.push(e.pathConstraints[t.readInt(!0)]);i=t.readInt(!0)}for(let r=0;r<i;r++){const r=t.readInt(!0);for(let i=0,o=t.readInt(!0);i<o;i++){const i=t.readStringRef(),o=this.readAttachment(t,e,s,r,i,n);null!=o&&s.setAttachment(r,i,o)}}return s}readAttachment(t,e,r,n,s,i){const o=this.scale;let a=t.readStringRef();null==a&&(a=s);const h=t.readByte();switch(cc.AttachmentTypeValues[h]){case oh.Region:{let e=t.readStringRef();const n=t.readFloat(),s=t.readFloat(),i=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readInt32();null==e&&(e=a);const f=this.attachmentLoader.newRegionAttachment(r,a,e);return null==f?null:(f.path=e,f.x=s*o,f.y=i*o,f.scaleX=h,f.scaleY=l,f.rotation=n,f.width=c*o,f.height=u*o,Ah.rgba8888ToColor(f.color,d),f)}case oh.BoundingBox:{const e=t.readInt(!0),n=this.readVertices(t,e),s=i?t.readInt32():0,o=this.attachmentLoader.newBoundingBoxAttachment(r,a);return null==o?null:(o.worldVerticesLength=e<<1,o.vertices=n.vertices,o.bones=n.bones,i&&Ah.rgba8888ToColor(o.color,s),o)}case oh.Mesh:{let e=t.readStringRef();const n=t.readInt32(),s=t.readInt(!0),h=this.readFloatArray(t,s<<1,1),l=this.readShortArray(t),c=this.readVertices(t,s),u=t.readInt(!0);let d=null,f=0,p=0;i&&(d=this.readShortArray(t),f=t.readFloat(),p=t.readFloat()),null==e&&(e=a);const m=this.attachmentLoader.newMeshAttachment(r,a,e);return null==m?null:(m.path=e,Ah.rgba8888ToColor(m.color,n),m.bones=c.bones,m.vertices=c.vertices,m.worldVerticesLength=s<<1,m.triangles=l,m.regionUVs=new Float32Array(h),m.hullLength=u<<1,i&&(m.edges=d,m.width=f*o,m.height=p*o),m)}case oh.LinkedMesh:{let e=t.readStringRef();const s=t.readInt32(),h=t.readStringRef(),l=t.readStringRef(),c=t.readBoolean();let u=0,d=0;i&&(u=t.readFloat(),d=t.readFloat()),null==e&&(e=a);const f=this.attachmentLoader.newMeshAttachment(r,a,e);return null==f?null:(f.path=e,Ah.rgba8888ToColor(f.color,s),i&&(f.width=u*o,f.height=d*o),this.linkedMeshes.push(new dc(f,h,n,l,c)),f)}case oh.Path:{const e=t.readBoolean(),n=t.readBoolean(),s=t.readInt(!0),h=this.readVertices(t,s),l=kh.newArray(s/3,0);for(let e=0,r=l.length;e<r;e++)l[e]=t.readFloat()*o;const c=i?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(r,a);return null==u?null:(u.closed=e,u.constantSpeed=n,u.worldVerticesLength=s<<1,u.vertices=h.vertices,u.bones=h.bones,u.lengths=l,i&&Ah.rgba8888ToColor(u.color,c),u)}case oh.Point:{const e=t.readFloat(),n=t.readFloat(),s=t.readFloat(),h=i?t.readInt32():0,l=this.attachmentLoader.newPointAttachment(r,a);return null==l?null:(l.x=n*o,l.y=s*o,l.rotation=e,i&&Ah.rgba8888ToColor(l.color,h),l)}case oh.Clipping:{const n=t.readInt(!0),s=t.readInt(!0),o=this.readVertices(t,s),h=i?t.readInt32():0,l=this.attachmentLoader.newClippingAttachment(r,a);return null==l?null:(l.endSlot=e.slots[n],l.worldVerticesLength=s<<1,l.vertices=o.vertices,l.bones=o.bones,i&&Ah.rgba8888ToColor(l.color,h),l)}}return null}readVertices(t,e){const r=e<<1,n=new fc,s=this.scale;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,r,s),n;const i=new Array,o=new Array;for(let r=0;r<e;r++){const e=t.readInt(!0);o.push(e);for(let r=0;r<e;r++)o.push(t.readInt(!0)),i.push(t.readFloat()*s),i.push(t.readFloat()*s),i.push(t.readFloat())}return n.vertices=kh.toFloatArray(i),n.bones=o,n}readFloatArray(t,e,r){const n=new Array(e);if(1==r)for(let r=0;r<e;r++)n[r]=t.readFloat();else for(let s=0;s<e;s++)n[s]=t.readFloat()*r;return n}readShortArray(t){const e=t.readInt(!0),r=new Array(e);for(let n=0;n<e;n++)r[n]=t.readShort();return r}readAnimation(t,e,r){const n=new Array,s=this.scale;let i=0;const o=new Ah,a=new Ah;for(let e=0,r=t.readInt(!0);e<r;e++){const e=t.readInt(!0);for(let r=0,s=t.readInt(!0);r<s;r++){const r=t.readByte(),s=t.readInt(!0);switch(r){case cc.SLOT_ATTACHMENT:{const r=new _l(s);r.slotIndex=e;for(let e=0;e<s;e++)r.setFrame(e,t.readFloat(),t.readStringRef());n.push(r),i=Math.max(i,r.frames[s-1]);break}case cc.SLOT_COLOR:{const r=new yl(s);r.slotIndex=e;for(let e=0;e<s;e++){const n=t.readFloat();Ah.rgba8888ToColor(o,t.readInt32()),r.setFrame(e,n,o.r,o.g,o.b,o.a),e<s-1&&this.readCurve(t,e,r)}n.push(r),i=Math.max(i,r.frames[(s-1)*yl.ENTRIES]);break}case cc.SLOT_TWO_COLOR:{const r=new xl(s);r.slotIndex=e;for(let e=0;e<s;e++){const n=t.readFloat();Ah.rgba8888ToColor(o,t.readInt32()),Ah.rgb888ToColor(a,t.readInt32()),r.setFrame(e,n,o.r,o.g,o.b,o.a,a.r,a.g,a.b),e<s-1&&this.readCurve(t,e,r)}n.push(r),i=Math.max(i,r.frames[(s-1)*xl.ENTRIES]);break}}}}for(let e=0,r=t.readInt(!0);e<r;e++){const e=t.readInt(!0);for(let r=0,o=t.readInt(!0);r<o;r++){const r=t.readByte(),o=t.readInt(!0);switch(r){case cc.BONE_ROTATE:{const r=new ul(o);r.boneIndex=e;for(let e=0;e<o;e++)r.setFrame(e,t.readFloat(),t.readFloat()),e<o-1&&this.readCurve(t,e,r);n.push(r),i=Math.max(i,r.frames[(o-1)*ul.ENTRIES]);break}case cc.BONE_TRANSLATE:case cc.BONE_SCALE:case cc.BONE_SHEAR:{let a,h=1;r==cc.BONE_SCALE?a=new pl(o):r==cc.BONE_SHEAR?a=new ml(o):(a=new fl(o),h=s),a.boneIndex=e;for(let e=0;e<o;e++)a.setFrame(e,t.readFloat(),t.readFloat()*h,t.readFloat()*h),e<o-1&&this.readCurve(t,e,a);n.push(a),i=Math.max(i,a.frames[(o-1)*fl.ENTRIES]);break}}}}for(let e=0,r=t.readInt(!0);e<r;e++){const e=t.readInt(!0),r=t.readInt(!0),o=new Sl(r);o.ikConstraintIndex=e;for(let e=0;e<r;e++)o.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat()*s,t.readByte(),t.readBoolean(),t.readBoolean()),e<r-1&&this.readCurve(t,e,o);n.push(o),i=Math.max(i,o.frames[(r-1)*Sl.ENTRIES])}for(let e=0,r=t.readInt(!0);e<r;e++){const e=t.readInt(!0),r=t.readInt(!0),s=new Il(r);s.transformConstraintIndex=e;for(let e=0;e<r;e++)s.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),e<r-1&&this.readCurve(t,e,s);n.push(s),i=Math.max(i,s.frames[(r-1)*Il.ENTRIES])}for(let e=0,o=t.readInt(!0);e<o;e++){const e=t.readInt(!0),o=r.pathConstraints[e];for(let r=0,a=t.readInt(!0);r<a;r++){const r=t.readByte(),a=t.readInt(!0);switch(r){case cc.PATH_POSITION:case cc.PATH_SPACING:{let h,l=1;r==cc.PATH_SPACING?(h=new Cl(a),o.spacingMode!=Jl.Length&&o.spacingMode!=Jl.Fixed||(l=s)):(h=new Pl(a),o.positionMode==ch.Fixed&&(l=s)),h.pathConstraintIndex=e;for(let e=0;e<a;e++)h.setFrame(e,t.readFloat(),t.readFloat()*l),e<a-1&&this.readCurve(t,e,h);n.push(h),i=Math.max(i,h.frames[(a-1)*Pl.ENTRIES]);break}case cc.PATH_MIX:{const r=new Ol(a);r.pathConstraintIndex=e;for(let e=0;e<a;e++)r.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat()),e<a-1&&this.readCurve(t,e,r);n.push(r),i=Math.max(i,r.frames[(a-1)*Ol.ENTRIES]);break}}}}for(let e=0,o=t.readInt(!0);e<o;e++){const e=r.skins[t.readInt(!0)];for(let r=0,o=t.readInt(!0);r<o;r++){const r=t.readInt(!0);for(let o=0,a=t.readInt(!0);o<a;o++){const o=e.getAttachment(r,t.readStringRef()),a=null!=o.bones,h=o.vertices,l=a?h.length/3*2:h.length,c=t.readInt(!0),u=new wl(c);u.slotIndex=r,u.attachment=o;for(let e=0;e<c;e++){const r=t.readFloat();let n,i=t.readInt(!0);if(0==i)n=a?kh.newFloatArray(l):h;else{n=kh.newFloatArray(l);const e=t.readInt(!0);if(i+=e,1==s)for(let r=e;r<i;r++)n[r]=t.readFloat();else for(let r=e;r<i;r++)n[r]=t.readFloat()*s;if(!a)for(let t=0,e=n.length;t<e;t++)n[t]+=h[t]}u.setFrame(e,r,n),e<c-1&&this.readCurve(t,e,u)}n.push(u),i=Math.max(i,u.frames[c-1])}}}const h=t.readInt(!0);if(h>0){const e=new Tl(h),s=r.slots.length;for(let r=0;r<h;r++){const n=t.readFloat(),i=t.readInt(!0),o=kh.newArray(s,0);for(let t=s-1;t>=0;t--)o[t]=-1;const a=kh.newArray(s-i,0);let h=0,l=0;for(let e=0;e<i;e++){const e=t.readInt(!0);for(;h!=e;)a[l++]=h++;o[h+t.readInt(!0)]=h++}for(;h<s;)a[l++]=h++;for(let t=s-1;t>=0;t--)-1==o[t]&&(o[t]=a[--l]);e.setFrame(r,n,o)}n.push(e),i=Math.max(i,e.frames[h-1])}const l=t.readInt(!0);if(l>0){const e=new El(l);for(let n=0;n<l;n++){const s=t.readFloat(),i=r.events[t.readInt(!0)],o=new zl(s,i);o.intValue=t.readInt(!1),o.floatValue=t.readFloat(),o.stringValue=t.readBoolean()?t.readString():i.stringValue,null!=o.data.audioPath&&(o.volume=t.readFloat(),o.balance=t.readFloat()),e.setFrame(n,o)}n.push(e),i=Math.max(i,e.frames[l-1])}return new ol(e,n,i)}readCurve(t,e,r){switch(t.readByte()){case cc.CURVE_STEPPED:r.setStepped(e);break;case cc.CURVE_BEZIER:this.setCurve(r,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}}setCurve(t,e,r,n,s,i){t.setCurve(e,r,n,s,i)}};let uc=cc;uc.AttachmentTypeValues=[0,1,2,3,4,5,6],uc.TransformModeValues=[dh.Normal,dh.OnlyTranslation,dh.NoRotationOrReflection,dh.NoScale,dh.NoScaleOrReflection],uc.PositionModeValues=[ch.Fixed,ch.Percent],uc.SpacingModeValues=[Jl.Length,Jl.Fixed,Jl.Percent],uc.RotateModeValues=[uh.Tangent,uh.Chain,uh.ChainScale],uc.BlendModeValues=[v.NORMAL,v.ADD,v.MULTIPLY,v.SCREEN],uc.BONE_ROTATE=0,uc.BONE_TRANSLATE=1,uc.BONE_SCALE=2,uc.BONE_SHEAR=3,uc.SLOT_ATTACHMENT=0,uc.SLOT_COLOR=1,uc.SLOT_TWO_COLOR=2,uc.PATH_POSITION=0,uc.PATH_SPACING=1,uc.PATH_MIX=2,uc.CURVE_LINEAR=0,uc.CURVE_STEPPED=1,uc.CURVE_BEZIER=2;class dc{constructor(t,e,r,n,s){this.mesh=t,this.skin=e,this.slotIndex=r,this.parent=n,this.inheritDeform=s}}class fc{constructor(t=null,e=null){this.bones=t,this.vertices=e}}class pc extends Nh{}class mc{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,r=new ic,n="string"==typeof t?JSON.parse(t):t,s=n.skeleton;if(null!=s){if(r.hash=s.hash,r.version=s.spine,"3.8"!==r.version.substr(0,3)){const t=`Spine 3.8 loader cant load version ${s.spine}. Please configure your pixi-spine bundle`;console.error(t)}if("3.8.75"===r.version){const t="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(t)}r.x=s.x,r.y=s.y,r.width=s.width,r.height=s.height,r.fps=s.fps,r.imagesPath=s.images}if(n.bones)for(let t=0;t<n.bones.length;t++){const s=n.bones[t];let i=null;const o=this.getValue(s,"parent",null);if(null!=o&&(i=r.findBone(o),null==i))throw new Error(`Parent bone not found: ${o}`);const a=new Hl(r.bones.length,s.name,i);a.length=this.getValue(s,"length",0)*e,a.x=this.getValue(s,"x",0)*e,a.y=this.getValue(s,"y",0)*e,a.rotation=this.getValue(s,"rotation",0),a.scaleX=this.getValue(s,"scaleX",1),a.scaleY=this.getValue(s,"scaleY",1),a.shearX=this.getValue(s,"shearX",0),a.shearY=this.getValue(s,"shearY",0),a.transformMode=mc.transformModeFromString(this.getValue(s,"transform","normal")),a.skinRequired=this.getValue(s,"skin",!1),r.bones.push(a)}if(n.slots)for(let t=0;t<n.slots.length;t++){const e=n.slots[t],s=e.name,i=e.bone,o=r.findBone(i);if(null==o)throw new Error(`Slot bone not found: ${i}`);const a=new oc(r.slots.length,s,o),h=this.getValue(e,"color",null);null!=h&&a.color.setFromString(h);const l=this.getValue(e,"dark",null);null!=l&&(a.darkColor=new Ah(1,1,1,1),a.darkColor.setFromString(l)),a.attachmentName=this.getValue(e,"attachment",null),a.blendMode=mc.blendModeFromString(this.getValue(e,"blend","normal")),r.slots.push(a)}if(n.ik)for(let t=0;t<n.ik.length;t++){const s=n.ik[t],i=new Zl(s.name);i.order=this.getValue(s,"order",0),i.skinRequired=this.getValue(s,"skin",!1);for(let t=0;t<s.bones.length;t++){const e=s.bones[t],n=r.findBone(e);if(null==n)throw new Error(`IK bone not found: ${e}`);i.bones.push(n)}const o=s.target;if(i.target=r.findBone(o),null==i.target)throw new Error(`IK target bone not found: ${o}`);i.mix=this.getValue(s,"mix",1),i.softness=this.getValue(s,"softness",0)*e,i.bendDirection=this.getValue(s,"bendPositive",!0)?1:-1,i.compress=this.getValue(s,"compress",!1),i.stretch=this.getValue(s,"stretch",!1),i.uniform=this.getValue(s,"uniform",!1),r.ikConstraints.push(i)}if(n.transform)for(let t=0;t<n.transform.length;t++){const s=n.transform[t],i=new ac(s.name);i.order=this.getValue(s,"order",0),i.skinRequired=this.getValue(s,"skin",!1);for(let t=0;t<s.bones.length;t++){const e=s.bones[t],n=r.findBone(e);if(null==n)throw new Error(`Transform constraint bone not found: ${e}`);i.bones.push(n)}const o=s.target;if(i.target=r.findBone(o),null==i.target)throw new Error(`Transform constraint target bone not found: ${o}`);i.local=this.getValue(s,"local",!1),i.relative=this.getValue(s,"relative",!1),i.offsetRotation=this.getValue(s,"rotation",0),i.offsetX=this.getValue(s,"x",0)*e,i.offsetY=this.getValue(s,"y",0)*e,i.offsetScaleX=this.getValue(s,"scaleX",0),i.offsetScaleY=this.getValue(s,"scaleY",0),i.offsetShearY=this.getValue(s,"shearY",0),i.rotateMix=this.getValue(s,"rotateMix",1),i.translateMix=this.getValue(s,"translateMix",1),i.scaleMix=this.getValue(s,"scaleMix",1),i.shearMix=this.getValue(s,"shearMix",1),r.transformConstraints.push(i)}if(n.path)for(let t=0;t<n.path.length;t++){const s=n.path[t],i=new Ql(s.name);i.order=this.getValue(s,"order",0),i.skinRequired=this.getValue(s,"skin",!1);for(let t=0;t<s.bones.length;t++){const e=s.bones[t],n=r.findBone(e);if(null==n)throw new Error(`Transform constraint bone not found: ${e}`);i.bones.push(n)}const o=s.target;if(i.target=r.findSlot(o),null==i.target)throw new Error(`Path target slot not found: ${o}`);i.positionMode=mc.positionModeFromString(this.getValue(s,"positionMode","percent")),i.spacingMode=mc.spacingModeFromString(this.getValue(s,"spacingMode","length")),i.rotateMode=mc.rotateModeFromString(this.getValue(s,"rotateMode","tangent")),i.offsetRotation=this.getValue(s,"rotation",0),i.position=this.getValue(s,"position",0),i.positionMode==ch.Fixed&&(i.position*=e),i.spacing=this.getValue(s,"spacing",0),i.spacingMode!=Jl.Length&&i.spacingMode!=Jl.Fixed||(i.spacing*=e),i.rotateMix=this.getValue(s,"rotateMix",1),i.translateMix=this.getValue(s,"translateMix",1),r.pathConstraints.push(i)}if(n.skins)for(let t=0;t<n.skins.length;t++){const e=n.skins[t],s=new lc(e.name);if(e.bones)for(let n=0;n<e.bones.length;n++){const i=r.findBone(e.bones[n]);if(null==i)throw new Error(`Skin bone not found: ${e.bones[t]}`);s.bones.push(i)}if(e.ik)for(let n=0;n<e.ik.length;n++){const i=r.findIkConstraint(e.ik[n]);if(null==i)throw new Error(`Skin IK constraint not found: ${e.ik[t]}`);s.constraints.push(i)}if(e.transform)for(let n=0;n<e.transform.length;n++){const i=r.findTransformConstraint(e.transform[n]);if(null==i)throw new Error(`Skin transform constraint not found: ${e.transform[t]}`);s.constraints.push(i)}if(e.path)for(let n=0;n<e.path.length;n++){const i=r.findPathConstraint(e.path[n]);if(null==i)throw new Error(`Skin path constraint not found: ${e.path[t]}`);s.constraints.push(i)}for(const t in e.attachments){const n=r.findSlot(t);if(null==n)throw new Error(`Slot not found: ${t}`);const i=e.attachments[t];for(const t in i){const e=this.readAttachment(i[t],s,n.index,t,r);null!=e&&s.setAttachment(n.index,t,e)}}r.skins.push(s),"default"==s.name&&(r.defaultSkin=s)}for(let t=0,e=this.linkedMeshes.length;t<e;t++){const e=this.linkedMeshes[t],n=null==e.skin?r.defaultSkin:r.findSkin(e.skin);if(null==n)throw new Error(`Skin not found: ${e.skin}`);const s=n.getAttachment(e.slotIndex,e.parent);if(null==s)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.deformAttachment=e.inheritDeform?s:e.mesh,e.mesh.setParentMesh(s)}if(this.linkedMeshes.length=0,n.events)for(const t in n.events){const e=n.events[t],s=new ql(t);s.intValue=this.getValue(e,"int",0),s.floatValue=this.getValue(e,"float",0),s.stringValue=this.getValue(e,"string",""),s.audioPath=this.getValue(e,"audio",null),null!=s.audioPath&&(s.volume=this.getValue(e,"volume",1),s.balance=this.getValue(e,"balance",0)),r.events.push(s)}if(n.animations)for(const t in n.animations){const e=n.animations[t];this.readAnimation(e,t,r)}return r}readAttachment(t,e,r,n,s){const i=this.scale;switch(n=this.getValue(t,"name",n),this.getValue(t,"type","region")){case"region":{const r=this.getValue(t,"path",n),s=this.attachmentLoader.newRegionAttachment(e,n,r);if(null==s)return null;s.path=r,s.x=this.getValue(t,"x",0)*i,s.y=this.getValue(t,"y",0)*i,s.scaleX=this.getValue(t,"scaleX",1),s.scaleY=this.getValue(t,"scaleY",1),s.rotation=this.getValue(t,"rotation",0),s.width=t.width*i,s.height=t.height*i;const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}case"boundingbox":{const r=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(null==r)return null;this.readVertices(t,r,t.vertexCount<<1);const s=this.getValue(t,"color",null);return null!=s&&r.color.setFromString(s),r}case"mesh":case"linkedmesh":{const s=this.getValue(t,"path",n),o=this.attachmentLoader.newMeshAttachment(e,n,s);if(null==o)return null;o.path=s;const a=this.getValue(t,"color",null);null!=a&&o.color.setFromString(a),o.width=this.getValue(t,"width",0)*i,o.height=this.getValue(t,"height",0)*i;const h=this.getValue(t,"parent",null);if(null!=h)return this.linkedMeshes.push(new gc(o,this.getValue(t,"skin",null),r,h,this.getValue(t,"deform",!0))),o;const l=t.uvs;return this.readVertices(t,o,l.length),o.triangles=t.triangles,o.regionUVs=new Float32Array(l),o.edges=this.getValue(t,"edges",null),o.hullLength=2*this.getValue(t,"hull",0),o}case"path":{const r=this.attachmentLoader.newPathAttachment(e,n);if(null==r)return null;r.closed=this.getValue(t,"closed",!1),r.constantSpeed=this.getValue(t,"constantSpeed",!0);const s=t.vertexCount;this.readVertices(t,r,s<<1);const o=kh.newArray(s/3,0);for(let e=0;e<t.lengths.length;e++)o[e]=t.lengths[e]*i;r.lengths=o;const a=this.getValue(t,"color",null);return null!=a&&r.color.setFromString(a),r}case"point":{const r=this.attachmentLoader.newPointAttachment(e,n);if(null==r)return null;r.x=this.getValue(t,"x",0)*i,r.y=this.getValue(t,"y",0)*i,r.rotation=this.getValue(t,"rotation",0);const s=this.getValue(t,"color",null);return null!=s&&r.color.setFromString(s),r}case"clipping":{const r=this.attachmentLoader.newClippingAttachment(e,n);if(null==r)return null;const i=this.getValue(t,"end",null);if(null!=i){const t=s.findSlot(i);if(null==t)throw new Error(`Clipping end slot not found: ${i}`);r.endSlot=t}const o=t.vertexCount;this.readVertices(t,r,o<<1);const a=this.getValue(t,"color",null);return null!=a&&r.color.setFromString(a),r}}return null}readVertices(t,e,r){const n=this.scale;e.worldVerticesLength=r;const s=t.vertices;if(r==s.length){const t=kh.toFloatArray(s);if(1!=n)for(let e=0,r=s.length;e<r;e++)t[e]*=n;return void(e.vertices=t)}const i=new Array,o=new Array;for(let t=0,e=s.length;t<e;){const e=s[t++];o.push(e);for(let r=t+4*e;t<r;t+=4)o.push(s[t]),i.push(s[t+1]*n),i.push(s[t+2]*n),i.push(s[t+3])}e.bones=o,e.vertices=kh.toFloatArray(i)}readAnimation(t,e,r){const n=this.scale,s=new Array;let i=0;if(t.slots)for(const e in t.slots){const n=t.slots[e],o=r.findSlotIndex(e);if(-1==o)throw new Error(`Slot not found: ${e}`);for(const t in n){const r=n[t];if("attachment"==t){const t=new _l(r.length);t.slotIndex=o;let e=0;for(let n=0;n<r.length;n++){const s=r[n];t.setFrame(e++,this.getValue(s,"time",0),s.name)}s.push(t),i=Math.max(i,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new yl(r.length);t.slotIndex=o;let e=0;for(let n=0;n<r.length;n++){const s=r[n],i=new Ah;i.setFromString(s.color||"ffffffff"),t.setFrame(e,this.getValue(s,"time",0),i.r,i.g,i.b,i.a),this.readCurve(s,t,e),e++}s.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*yl.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${e})`);{const t=new xl(r.length);t.slotIndex=o;let e=0;for(let n=0;n<r.length;n++){const s=r[n],i=new Ah,o=new Ah;i.setFromString(s.light),o.setFromString(s.dark),t.setFrame(e,this.getValue(s,"time",0),i.r,i.g,i.b,i.a,o.r,o.g,o.b),this.readCurve(s,t,e),e++}s.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*xl.ENTRIES])}}}}if(t.bones)for(const e in t.bones){const o=t.bones[e],a=r.findBoneIndex(e);if(-1==a)throw new Error(`Bone not found: ${e}`);for(const t in o){const r=o[t];if("rotate"===t){const t=new ul(r.length);t.boneIndex=a;let e=0;for(let n=0;n<r.length;n++){const s=r[n];t.setFrame(e,this.getValue(s,"time",0),this.getValue(s,"angle",0)),this.readCurve(s,t,e),e++}s.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*ul.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${e})`);{let e=null,o=1,h=0;"scale"===t?(e=new pl(r.length),h=1):"shear"===t?e=new ml(r.length):(e=new fl(r.length),o=n),e.boneIndex=a;let l=0;for(let t=0;t<r.length;t++){const n=r[t],s=this.getValue(n,"x",h),i=this.getValue(n,"y",h);e.setFrame(l,this.getValue(n,"time",0),s*o,i*o),this.readCurve(n,e,l),l++}s.push(e),i=Math.max(i,e.frames[(e.getFrameCount()-1)*fl.ENTRIES])}}}}if(t.ik)for(const e in t.ik){const o=t.ik[e],a=r.findIkConstraint(e),h=new Sl(o.length);h.ikConstraintIndex=r.ikConstraints.indexOf(a);let l=0;for(let t=0;t<o.length;t++){const e=o[t];h.setFrame(l,this.getValue(e,"time",0),this.getValue(e,"mix",1),this.getValue(e,"softness",0)*n,this.getValue(e,"bendPositive",!0)?1:-1,this.getValue(e,"compress",!1),this.getValue(e,"stretch",!1)),this.readCurve(e,h,l),l++}s.push(h),i=Math.max(i,h.frames[(h.getFrameCount()-1)*Sl.ENTRIES])}if(t.transform)for(const e in t.transform){const n=t.transform[e],o=r.findTransformConstraint(e),a=new Il(n.length);a.transformConstraintIndex=r.transformConstraints.indexOf(o);let h=0;for(let t=0;t<n.length;t++){const e=n[t];a.setFrame(h,this.getValue(e,"time",0),this.getValue(e,"rotateMix",1),this.getValue(e,"translateMix",1),this.getValue(e,"scaleMix",1),this.getValue(e,"shearMix",1)),this.readCurve(e,a,h),h++}s.push(a),i=Math.max(i,a.frames[(a.getFrameCount()-1)*Il.ENTRIES])}if(t.path)for(const e in t.path){const o=t.path[e],a=r.findPathConstraintIndex(e);if(-1==a)throw new Error(`Path constraint not found: ${e}`);const h=r.pathConstraints[a];for(const t in o){const e=o[t];if("position"===t||"spacing"===t){let r=null,o=1;"spacing"===t?(r=new Cl(e.length),h.spacingMode!=Jl.Length&&h.spacingMode!=Jl.Fixed||(o=n)):(r=new Pl(e.length),h.positionMode==ch.Fixed&&(o=n)),r.pathConstraintIndex=a;let l=0;for(let n=0;n<e.length;n++){const s=e[n];r.setFrame(l,this.getValue(s,"time",0),this.getValue(s,t,0)*o),this.readCurve(s,r,l),l++}s.push(r),i=Math.max(i,r.frames[(r.getFrameCount()-1)*Pl.ENTRIES])}else if("mix"===t){const t=new Ol(e.length);t.pathConstraintIndex=a;let r=0;for(let n=0;n<e.length;n++){const s=e[n];t.setFrame(r,this.getValue(s,"time",0),this.getValue(s,"rotateMix",1),this.getValue(s,"translateMix",1)),this.readCurve(s,t,r),r++}s.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*Ol.ENTRIES])}}}if(t.deform)for(const e in t.deform){const o=t.deform[e],a=r.findSkin(e);if(null!=a)for(const t in o){const e=o[t],h=r.findSlotIndex(t);if(-1==h)throw new Error(`Slot not found: ${e.name}`);for(const t in e){const r=e[t],o=a.getAttachment(h,t);if(null==o)throw new Error(`Deform attachment not found: ${r.name}`);const l=null!=o.bones,c=o.vertices,u=l?c.length/3*2:c.length,d=new wl(r.length);d.slotIndex=h,d.attachment=o;let f=0;for(let t=0;t<r.length;t++){const e=r[t];let s;const i=this.getValue(e,"vertices",null);if(null==i)s=l?kh.newFloatArray(u):c;else{s=kh.newFloatArray(u);const t=this.getValue(e,"offset",0);if(kh.arrayCopy(i,0,s,t,i.length),1!=n)for(let e=t,r=e+i.length;e<r;e++)s[e]*=n;if(!l)for(let t=0;t<u;t++)s[t]+=c[t]}d.setFrame(f,this.getValue(e,"time",0),s),this.readCurve(e,d,f),f++}s.push(d),i=Math.max(i,d.frames[d.getFrameCount()-1])}}else Bh}let o=t.drawOrder;if(null==o&&(o=t.draworder),null!=o){const t=new Tl(o.length),e=r.slots.length;let n=0;for(let s=0;s<o.length;s++){const i=o[s];let a=null;const h=this.getValue(i,"offsets",null);if(null!=h){a=kh.newArray(e,-1);const t=kh.newArray(e-h.length,0);let n=0,s=0;for(let e=0;e<h.length;e++){const i=h[e],o=r.findSlotIndex(i.slot);if(-1==o)throw new Error(`Slot not found: ${i.slot}`);for(;n!=o;)t[s++]=n++;a[n+i.offset]=n++}for(;n<e;)t[s++]=n++;for(let r=e-1;r>=0;r--)-1==a[r]&&(a[r]=t[--s])}t.setFrame(n++,this.getValue(i,"time",0),a)}s.push(t),i=Math.max(i,t.frames[t.getFrameCount()-1])}if(t.events){const e=new El(t.events.length);let n=0;for(let s=0;s<t.events.length;s++){const i=t.events[s],o=r.findEvent(i.name);if(null==o)throw new Error(`Event not found: ${i.name}`);const a=new zl(kh.toSinglePrecision(this.getValue(i,"time",0)),o);a.intValue=this.getValue(i,"int",o.intValue),a.floatValue=this.getValue(i,"float",o.floatValue),a.stringValue=this.getValue(i,"string",o.stringValue),null!=a.data.audioPath&&(a.volume=this.getValue(i,"volume",1),a.balance=this.getValue(i,"balance",0)),e.setFrame(n++,a)}s.push(e),i=Math.max(i,e.frames[e.getFrameCount()-1])}if(isNaN(i))throw new Error("Error while parsing animation, duration is NaN");r.animations.push(new ol(e,s,i))}readCurve(t,e,r){if(t.hasOwnProperty("curve"))if("stepped"===t.curve)e.setStepped(r);else{const n=t.curve;e.setCurve(r,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}getValue(t,e,r){return void 0!==t[e]?t[e]:r}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return v.NORMAL;if("additive"==t)return v.ADD;if("multiply"==t)return v.MULTIPLY;if("screen"==t)return v.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return ch.Fixed;if("percent"==t)return ch.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return Jl.Length;if("fixed"==t)return Jl.Fixed;if("percent"==t)return Jl.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return uh.Tangent;if("chain"==t)return uh.Chain;if("chainscale"==t)return uh.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return dh.Normal;if("onlytranslation"==t)return dh.OnlyTranslation;if("norotationorreflection"==t)return dh.NoRotationOrReflection;if("noscale"==t)return dh.NoScale;if("noscaleorreflection"==t)return dh.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}}class gc{constructor(t,e,r,n,s){this.mesh=t,this.skin=e,this.slotIndex=r,this.parent=n,this.inheritDeform=s}}class yc extends Xh{createSkeleton(t){this.skeleton=new sc(t),this.skeleton.updateWorldTransform(),this.stateData=new Yl(t),this.state=new Nl(this.stateData)}}class bc{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}}const xc=class extends bc{constructor(t){super(t),this.id=(65535&xc.nextID++)<<11,this.worldVerticesLength=0}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,r,n,s,i){r=s+(r>>1)*i;const o=t.bone.skeleton,a=t.attachmentVertices;let h=this.vertices;const l=this.bones;if(null==l){a.length>0&&(h=a);const o=t.bone.matrix,l=o.tx,c=o.ty,u=o.a,d=o.c,f=o.b,p=o.d;for(let t=e,o=s;o<r;t+=2,o+=i){const e=h[t],r=h[t+1];n[o]=e*u+r*d+l,n[o+1]=e*f+r*p+c}return}let c=0,u=0;for(let t=0;t<e;t+=2){const t=l[c];c+=t+1,u+=t}const d=o.bones;if(0==a.length)for(let t=s,e=3*u;t<r;t+=i){let r=0,s=0,i=l[c++];for(i+=c;c<i;c++,e+=3){const t=d[l[c]].matrix,n=h[e],i=h[e+1],o=h[e+2];r+=(n*t.a+i*t.c+t.tx)*o,s+=(n*t.b+i*t.d+t.ty)*o}n[t]=r,n[t+1]=s}else{const t=a;for(let e=s,o=3*u,a=u<<1;e<r;e+=i){let r=0,s=0,i=l[c++];for(i+=c;c<i;c++,o+=3,a+=2){const e=d[l[c]].matrix,n=h[o]+t[a],i=h[o+1]+t[a+1],u=h[o+2];r+=(n*e.a+i*e.c+e.tx)*u,s+=(n*e.b+i*e.d+e.ty)*u}n[e]=r,n[e+1]=s}}}applyDeform(t){return this==t}};let _c=xc;_c.nextID=0;class vc extends _c{constructor(t){super(t),this.type=oh.BoundingBox,this.color=new Ah(1,1,1,1)}}class wc extends _c{constructor(t){super(t),this.type=oh.Clipping,this.color=new Ah(.2275,.2275,.8078,1)}}class Ec extends _c{constructor(t){super(t),this.type=oh.Mesh,this.color=new Ah(1,1,1,1),this.inheritDeform=!1,this.tempColor=new Ah(0,0,0,0)}applyDeform(t){return this==t||this.inheritDeform&&this.parentMesh==t}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}}class Tc extends _c{constructor(t){super(t),this.type=oh.Path,this.closed=!1,this.constantSpeed=!1,this.color=new Ah(1,1,1,1)}}class Ac extends _c{constructor(t){super(t),this.type=oh.Point,this.color=new Ah(.38,.94,0,1)}computeWorldPosition(t,e){const r=t.matrix;return e.x=this.x*r.a+this.y*r.c+t.worldX,e.y=this.x*r.b+this.y*r.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,r=Rh.cosDeg(this.rotation),n=Rh.sinDeg(this.rotation),s=r*e.a+n*e.c,i=r*e.b+n*e.d;return Math.atan2(i,s)*Rh.radDeg}}class Sc{constructor(t,e){if(this.attachmentVertices=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Ah,this.darkColor=null==t.darkColor?null:new Ah,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}}const Rc=class extends bc{constructor(t){super(t),this.type=oh.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Ah(1,1,1,1),this.offset=kh.newFloatArray(8),this.uvs=kh.newFloatArray(8),this.tempColor=new Ah(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,s=r+this.region.width*t,i=n+this.region.height*e,o=this.rotation*Math.PI/180,a=Math.cos(o),h=Math.sin(o),l=r*a+this.x,c=r*h,u=n*a+this.y,d=n*h,f=s*a+this.x,p=s*h,m=i*a+this.y,g=i*h,y=this.offset;y[Rc.OX1]=l-d,y[Rc.OY1]=u+c,y[Rc.OX2]=l-g,y[Rc.OY2]=m+c,y[Rc.OX3]=f-g,y[Rc.OY3]=m+p,y[Rc.OX4]=f-d,y[Rc.OY4]=u+p}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,r,n){const s=this.offset,i=t instanceof Sc?t.bone.matrix:t.matrix,o=i.tx,a=i.ty,h=i.a,l=i.c,c=i.b,u=i.d;let d=0,f=0;d=s[Rc.OX1],f=s[Rc.OY1],e[r]=d*h+f*l+o,e[r+1]=d*c+f*u+a,r+=n,d=s[Rc.OX2],f=s[Rc.OY2],e[r]=d*h+f*l+o,e[r+1]=d*c+f*u+a,r+=n,d=s[Rc.OX3],f=s[Rc.OY3],e[r]=d*h+f*l+o,e[r+1]=d*c+f*u+a,r+=n,d=s[Rc.OX4],f=s[Rc.OY4],e[r]=d*h+f*l+o,e[r+1]=d*c+f*u+a}};let Ic=Rc;Ic.OX1=0,Ic.OY1=1,Ic.OX2=2,Ic.OY2=3,Ic.OX3=4,Ic.OY3=5,Ic.OX4=6,Ic.OY4=7,Ic.X1=0,Ic.Y1=1,Ic.C1R=2,Ic.C1G=3,Ic.C1B=4,Ic.C1A=5,Ic.U1=6,Ic.V1=7,Ic.X2=8,Ic.Y2=9,Ic.C2R=10,Ic.C2G=11,Ic.C2B=12,Ic.C2A=13,Ic.U2=14,Ic.V2=15,Ic.X3=16,Ic.Y3=17,Ic.C3R=18,Ic.C3G=19,Ic.C3B=20,Ic.C3A=21,Ic.U3=22,Ic.V3=23,Ic.X4=24,Ic.Y4=25,Ic.C4R=26,Ic.C4G=27,Ic.C4B=28,Ic.C4A=29,Ic.U4=30,Ic.V4=31;class Mc{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,r,n){t.x+=Rh.randomTriangular(-this.jitterX,this.jitterY),t.y+=Rh.randomTriangular(-this.jitterX,this.jitterY)}end(){}}const Pc=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,r,n){const s=this.angle*Rh.degreesToRadians,i=t.x-this.worldX,o=t.y-this.worldY,a=Math.sqrt(i*i+o*o);if(a<this.radius){const e=Pc.interpolation.apply(0,s,(this.radius-a)/this.radius),r=Math.cos(e),n=Math.sin(e);t.x=r*i-n*o+this.worldX,t.y=n*i+r*o+this.worldY}}end(){}};let Cc=Pc;Cc.interpolation=new Ph(2);class kc{constructor(t,e,r){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.duration=r}apply(t,e,r,n,s,i,o,a){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(r%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let n=0,l=h.length;n<l;n++)h[n].apply(t,e,r,s,i,o,a)}static binarySearch(t,e,r=1){let n=0,s=t.length/r-2;if(0==s)return r;let i=s>>>1;for(;;){if(t[(i+1)*r]<=e?n=i+1:s=i,n==s)return(n+1)*r;i=n+s>>>1}}static linearSearch(t,e,r){for(let n=0,s=t.length-r;n<=s;n+=r)if(t[n]>e)return n;return-1}}var Oc=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(Oc||{});const Fc=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=kh.newFloatArray((t-1)*Fc.BEZIER_SIZE)}getFrameCount(){return this.curves.length/Fc.BEZIER_SIZE+1}setLinear(t){this.curves[t*Fc.BEZIER_SIZE]=Fc.LINEAR}setStepped(t){this.curves[t*Fc.BEZIER_SIZE]=Fc.STEPPED}getCurveType(t){const e=t*Fc.BEZIER_SIZE;if(e==this.curves.length)return Fc.LINEAR;const r=this.curves[e];return r==Fc.LINEAR?Fc.LINEAR:r==Fc.STEPPED?Fc.STEPPED:Fc.BEZIER}setCurve(t,e,r,n,s){const i=.03*(2*-e+n),o=.03*(2*-r+s),a=.006*(3*(e-n)+1),h=.006*(3*(r-s)+1);let l=2*i+a,c=2*o+h,u=.3*e+i+.16666667*a,d=.3*r+o+.16666667*h,f=t*Fc.BEZIER_SIZE;const p=this.curves;p[f++]=Fc.BEZIER;let m=u,g=d;for(let t=f+Fc.BEZIER_SIZE-1;f<t;f+=2)p[f]=m,p[f+1]=g,u+=l,d+=c,l+=a,c+=h,m+=u,g+=d}getCurvePercent(t,e){e=Rh.clamp(e,0,1);const r=this.curves;let n=t*Fc.BEZIER_SIZE;const s=r[n];if(s==Fc.LINEAR)return e;if(s==Fc.STEPPED)return 0;n++;let i=0;for(let t=n,s=n+Fc.BEZIER_SIZE-1;n<s;n+=2)if(i=r[n],i>=e){let s,o;return n==t?(s=0,o=0):(s=r[n-2],o=r[n-1]),o+(r[n+1]-o)*(e-s)/(i-s)}const o=r[n-1];return o+(1-o)*(e-i)/(1-i)}};let Nc=Fc;Nc.LINEAR=0,Nc.STEPPED=1,Nc.BEZIER=2,Nc.BEZIER_SIZE=19;const Bc=class extends Nc{constructor(t){super(t),this.frames=kh.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,r){t<<=1,this.frames[t]=e,this.frames[t+Bc.ROTATION]=r}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.bones[this.boneIndex];if(r<a[0]){switch(i){case hh.setup:return void(h.rotation=h.data.rotation);case hh.first:const t=h.data.rotation-h.rotation;h.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*s}return}if(r>=a[a.length-Bc.ENTRIES]){let t=a[a.length+Bc.PREV_ROTATION];switch(i){case hh.setup:h.rotation=h.data.rotation+t*s;break;case hh.first:case hh.replace:t+=h.data.rotation-h.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case hh.add:h.rotation+=t*s}return}const l=kc.binarySearch(a,r,Bc.ENTRIES),c=a[l+Bc.PREV_ROTATION],u=a[l],d=this.getCurvePercent((l>>1)-1,1-(r-u)/(a[l+Bc.PREV_TIME]-u));let f=a[l+Bc.ROTATION]-c;switch(f=c+(f-360*(16384-(16384.499999999996-f/360|0)))*d,i){case hh.setup:h.rotation=h.data.rotation+(f-360*(16384-(16384.499999999996-f/360|0)))*s;break;case hh.first:case hh.replace:f+=h.data.rotation-h.rotation;case hh.add:h.rotation+=(f-360*(16384-(16384.499999999996-f/360|0)))*s}}};let Dc=Bc;Dc.ENTRIES=2,Dc.PREV_TIME=-2,Dc.PREV_ROTATION=-1,Dc.ROTATION=1;const Lc=class extends Nc{constructor(t){super(t),this.frames=kh.newFloatArray(t*Lc.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,r,n){t*=Lc.ENTRIES,this.frames[t]=e,this.frames[t+Lc.X]=r,this.frames[t+Lc.Y]=n}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.bones[this.boneIndex];if(r<a[0]){switch(i){case hh.setup:return h.x=h.data.x,void(h.y=h.data.y);case hh.first:h.x+=(h.data.x-h.x)*s,h.y+=(h.data.y-h.y)*s}return}let l=0,c=0;if(r>=a[a.length-Lc.ENTRIES])l=a[a.length+Lc.PREV_X],c=a[a.length+Lc.PREV_Y];else{const t=kc.binarySearch(a,r,Lc.ENTRIES);l=a[t+Lc.PREV_X],c=a[t+Lc.PREV_Y];const e=a[t],n=this.getCurvePercent(t/Lc.ENTRIES-1,1-(r-e)/(a[t+Lc.PREV_TIME]-e));l+=(a[t+Lc.X]-l)*n,c+=(a[t+Lc.Y]-c)*n}switch(i){case hh.setup:h.x=h.data.x+l*s,h.y=h.data.y+c*s;break;case hh.first:case hh.replace:h.x+=(h.data.x+l-h.x)*s,h.y+=(h.data.y+c-h.y)*s;break;case hh.add:h.x+=l*s,h.y+=c*s}}};let Vc=Lc;Vc.ENTRIES=3,Vc.PREV_TIME=-3,Vc.PREV_X=-2,Vc.PREV_Y=-1,Vc.X=1,Vc.Y=2;class Uc extends Vc{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.bones[this.boneIndex];if(r<a[0]){switch(i){case hh.setup:return h.scaleX=h.data.scaleX,void(h.scaleY=h.data.scaleY);case hh.first:h.scaleX+=(h.data.scaleX-h.scaleX)*s,h.scaleY+=(h.data.scaleY-h.scaleY)*s}return}let l=0,c=0;if(r>=a[a.length-Uc.ENTRIES])l=a[a.length+Uc.PREV_X]*h.data.scaleX,c=a[a.length+Uc.PREV_Y]*h.data.scaleY;else{const t=kc.binarySearch(a,r,Uc.ENTRIES);l=a[t+Uc.PREV_X],c=a[t+Uc.PREV_Y];const e=a[t],n=this.getCurvePercent(t/Uc.ENTRIES-1,1-(r-e)/(a[t+Uc.PREV_TIME]-e));l=(l+(a[t+Uc.X]-l)*n)*h.data.scaleX,c=(c+(a[t+Uc.Y]-c)*n)*h.data.scaleY}if(1==s)i==hh.add?(h.scaleX+=l-h.data.scaleX,h.scaleY+=c-h.data.scaleY):(h.scaleX=l,h.scaleY=c);else{let t=0,e=0;if(o==lh.mixOut)switch(i){case hh.setup:t=h.data.scaleX,e=h.data.scaleY,h.scaleX=t+(Math.abs(l)*Rh.signum(t)-t)*s,h.scaleY=e+(Math.abs(c)*Rh.signum(e)-e)*s;break;case hh.first:case hh.replace:t=h.scaleX,e=h.scaleY,h.scaleX=t+(Math.abs(l)*Rh.signum(t)-t)*s,h.scaleY=e+(Math.abs(c)*Rh.signum(e)-e)*s;break;case hh.add:t=h.scaleX,e=h.scaleY,h.scaleX=t+(Math.abs(l)*Rh.signum(t)-h.data.scaleX)*s,h.scaleY=e+(Math.abs(c)*Rh.signum(e)-h.data.scaleY)*s}else switch(i){case hh.setup:t=Math.abs(h.data.scaleX)*Rh.signum(l),e=Math.abs(h.data.scaleY)*Rh.signum(c),h.scaleX=t+(l-t)*s,h.scaleY=e+(c-e)*s;break;case hh.first:case hh.replace:t=Math.abs(h.scaleX)*Rh.signum(l),e=Math.abs(h.scaleY)*Rh.signum(c),h.scaleX=t+(l-t)*s,h.scaleY=e+(c-e)*s;break;case hh.add:t=Rh.signum(l),e=Rh.signum(c),h.scaleX=Math.abs(h.scaleX)*t+(l-Math.abs(h.data.scaleX)*t)*s,h.scaleY=Math.abs(h.scaleY)*e+(c-Math.abs(h.data.scaleY)*e)*s}}}}class Xc extends Vc{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.bones[this.boneIndex];if(r<a[0]){switch(i){case hh.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case hh.first:h.shearX+=(h.data.shearX-h.shearX)*s,h.shearY+=(h.data.shearY-h.shearY)*s}return}let l=0,c=0;if(r>=a[a.length-Xc.ENTRIES])l=a[a.length+Xc.PREV_X],c=a[a.length+Xc.PREV_Y];else{const t=kc.binarySearch(a,r,Xc.ENTRIES);l=a[t+Xc.PREV_X],c=a[t+Xc.PREV_Y];const e=a[t],n=this.getCurvePercent(t/Xc.ENTRIES-1,1-(r-e)/(a[t+Xc.PREV_TIME]-e));l+=(a[t+Xc.X]-l)*n,c+=(a[t+Xc.Y]-c)*n}switch(i){case hh.setup:h.shearX=h.data.shearX+l*s,h.shearY=h.data.shearY+c*s;break;case hh.first:case hh.replace:h.shearX+=(h.data.shearX+l-h.shearX)*s,h.shearY+=(h.data.shearY+c-h.shearY)*s;break;case hh.add:h.shearX+=l*s,h.shearY+=c*s}}}const jc=class extends Nc{constructor(t){super(t),this.frames=kh.newFloatArray(t*jc.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,r,n,s,i){t*=jc.ENTRIES,this.frames[t]=e,this.frames[t+jc.R]=r,this.frames[t+jc.G]=n,this.frames[t+jc.B]=s,this.frames[t+jc.A]=i}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex],h=this.frames;if(r<h[0]){switch(i){case hh.setup:return void a.color.setFromColor(a.data.color);case hh.first:const t=a.color,e=a.data.color;t.add((e.r-t.r)*s,(e.g-t.g)*s,(e.b-t.b)*s,(e.a-t.a)*s)}return}let l=0,c=0,u=0,d=0;if(r>=h[h.length-jc.ENTRIES]){const t=h.length;l=h[t+jc.PREV_R],c=h[t+jc.PREV_G],u=h[t+jc.PREV_B],d=h[t+jc.PREV_A]}else{const t=kc.binarySearch(h,r,jc.ENTRIES);l=h[t+jc.PREV_R],c=h[t+jc.PREV_G],u=h[t+jc.PREV_B],d=h[t+jc.PREV_A];const e=h[t],n=this.getCurvePercent(t/jc.ENTRIES-1,1-(r-e)/(h[t+jc.PREV_TIME]-e));l+=(h[t+jc.R]-l)*n,c+=(h[t+jc.G]-c)*n,u+=(h[t+jc.B]-u)*n,d+=(h[t+jc.A]-d)*n}if(1==s)a.color.set(l,c,u,d);else{const t=a.color;i==hh.setup&&t.setFromColor(a.data.color),t.add((l-t.r)*s,(c-t.g)*s,(u-t.b)*s,(d-t.a)*s)}}};let Yc=jc;Yc.ENTRIES=5,Yc.PREV_TIME=-5,Yc.PREV_R=-4,Yc.PREV_G=-3,Yc.PREV_B=-2,Yc.PREV_A=-1,Yc.R=1,Yc.G=2,Yc.B=3,Yc.A=4;const Gc=class extends Nc{constructor(t){super(t),this.frames=kh.newFloatArray(t*Gc.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,r,n,s,i,o,a,h){t*=Gc.ENTRIES,this.frames[t]=e,this.frames[t+Gc.R]=r,this.frames[t+Gc.G]=n,this.frames[t+Gc.B]=s,this.frames[t+Gc.A]=i,this.frames[t+Gc.R2]=o,this.frames[t+Gc.G2]=a,this.frames[t+Gc.B2]=h}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex],h=this.frames;if(r<h[0]){switch(i){case hh.setup:return a.color.setFromColor(a.data.color),void a.darkColor.setFromColor(a.data.darkColor);case hh.first:const t=a.color,e=a.darkColor,r=a.data.color,n=a.data.darkColor;t.add((r.r-t.r)*s,(r.g-t.g)*s,(r.b-t.b)*s,(r.a-t.a)*s),e.add((n.r-e.r)*s,(n.g-e.g)*s,(n.b-e.b)*s,0)}return}let l=0,c=0,u=0,d=0,f=0,p=0,m=0;if(r>=h[h.length-Gc.ENTRIES]){const t=h.length;l=h[t+Gc.PREV_R],c=h[t+Gc.PREV_G],u=h[t+Gc.PREV_B],d=h[t+Gc.PREV_A],f=h[t+Gc.PREV_R2],p=h[t+Gc.PREV_G2],m=h[t+Gc.PREV_B2]}else{const t=kc.binarySearch(h,r,Gc.ENTRIES);l=h[t+Gc.PREV_R],c=h[t+Gc.PREV_G],u=h[t+Gc.PREV_B],d=h[t+Gc.PREV_A],f=h[t+Gc.PREV_R2],p=h[t+Gc.PREV_G2],m=h[t+Gc.PREV_B2];const e=h[t],n=this.getCurvePercent(t/Gc.ENTRIES-1,1-(r-e)/(h[t+Gc.PREV_TIME]-e));l+=(h[t+Gc.R]-l)*n,c+=(h[t+Gc.G]-c)*n,u+=(h[t+Gc.B]-u)*n,d+=(h[t+Gc.A]-d)*n,f+=(h[t+Gc.R2]-f)*n,p+=(h[t+Gc.G2]-p)*n,m+=(h[t+Gc.B2]-m)*n}if(1==s)a.color.set(l,c,u,d),a.darkColor.set(f,p,m,1);else{const t=a.color,e=a.darkColor;i==hh.setup&&(t.setFromColor(a.data.color),e.setFromColor(a.data.darkColor)),t.add((l-t.r)*s,(c-t.g)*s,(u-t.b)*s,(d-t.a)*s),e.add((f-e.r)*s,(p-e.g)*s,(m-e.b)*s,0)}}};let Wc=Gc;Wc.ENTRIES=8,Wc.PREV_TIME=-8,Wc.PREV_R=-7,Wc.PREV_G=-6,Wc.PREV_B=-5,Wc.PREV_A=-4,Wc.PREV_R2=-3,Wc.PREV_G2=-2,Wc.PREV_B2=-1,Wc.R=1,Wc.G=2,Wc.B=3,Wc.A=4,Wc.R2=5,Wc.G2=6,Wc.B2=7;class Hc{constructor(t){this.frames=kh.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,r){this.frames[t]=e,this.attachmentNames[t]=r}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(o==lh.mixOut&&i==hh.setup){const e=a.data.attachmentName;return void a.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}const h=this.frames;if(r<h[0]){if(i==hh.setup||i==hh.first){const e=a.data.attachmentName;a.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}return}let l=0;l=r>=h[h.length-1]?h.length-1:kc.binarySearch(h,r,1)-1;const c=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}}let $c=null;class zc extends Nc{constructor(t){super(t),this.frames=kh.newFloatArray(t),this.frameVertices=new Array(t),null==$c&&($c=kh.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,r){this.frames[t]=e,this.frameVertices[t]=r}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex],h=a.getAttachment();if(!(h instanceof _c&&h.applyDeform(this.attachment)))return;const l=a.attachmentVertices;0==l.length&&(i=hh.setup);const c=this.frameVertices,u=c[0].length,d=this.frames;if(r<d[0]){const t=h;switch(i){case hh.setup:return void(l.length=0);case hh.first:if(1==s){l.length=0;break}const e=kh.setArraySize(l,u);if(null==t.bones){const r=t.vertices;for(let t=0;t<u;t++)e[t]+=(r[t]-e[t])*s}else{s=1-s;for(let t=0;t<u;t++)e[t]*=s}}return}const f=kh.setArraySize(l,u);if(r>=d[d.length-1]){const t=c[d.length-1];if(1==s)if(i==hh.add){const e=h;if(null==e.bones){const r=e.vertices;for(let e=0;e<u;e++)f[e]+=t[e]-r[e]}else for(let e=0;e<u;e++)f[e]+=t[e]}else kh.arrayCopy(t,0,f,0,u);else switch(i){case hh.setup:{const e=h;if(null==e.bones){const r=e.vertices;for(let e=0;e<u;e++){const n=r[e];f[e]=n+(t[e]-n)*s}}else for(let e=0;e<u;e++)f[e]=t[e]*s;break}case hh.first:case hh.replace:for(let e=0;e<u;e++)f[e]+=(t[e]-f[e])*s;case hh.add:const e=h;if(null==e.bones){const r=e.vertices;for(let e=0;e<u;e++)f[e]+=(t[e]-r[e])*s}else for(let e=0;e<u;e++)f[e]+=t[e]*s}return}const p=kc.binarySearch(d,r),m=c[p-1],g=c[p],y=d[p],b=this.getCurvePercent(p-1,1-(r-y)/(d[p-1]-y));if(1==s)if(i==hh.add){const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const r=m[t];f[t]+=r+(g[t]-r)*b-e[t]}}else for(let t=0;t<u;t++){const e=m[t];f[t]+=e+(g[t]-e)*b}}else for(let t=0;t<u;t++){const e=m[t];f[t]=e+(g[t]-e)*b}else switch(i){case hh.setup:{const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const r=m[t],n=e[t];f[t]=n+(r+(g[t]-r)*b-n)*s}}else for(let t=0;t<u;t++){const e=m[t];f[t]=(e+(g[t]-e)*b)*s}break}case hh.first:case hh.replace:for(let t=0;t<u;t++){const e=m[t];f[t]+=(e+(g[t]-e)*b-f[t])*s}break;case hh.add:const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const r=m[t];f[t]+=(r+(g[t]-r)*b-e[t])*s}}else for(let t=0;t<u;t++){const e=m[t];f[t]+=(e+(g[t]-e)*b)*s}}}}class qc{constructor(t){this.frames=kh.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,r,n,s,i,o){if(null==n)return;const a=this.frames,h=this.frames.length;if(e>r)this.apply(t,e,Number.MAX_VALUE,n,s,i,o),e=-1;else if(e>=a[h-1])return;if(r<a[0])return;let l=0;if(e<a[0])l=0;else{l=kc.binarySearch(a,e);const t=a[l];for(;l>0&&a[l-1]==t;)l--}for(;l<h&&r>=a[l];l++)n.push(this.events[l])}}class Kc{constructor(t){this.frames=kh.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,r){this.frames[t]=e,this.drawOrders[t]=r}apply(t,e,r,n,s,i,o){const a=t.drawOrder,h=t.slots;if(o==lh.mixOut&&i==hh.setup)return void kh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const l=this.frames;if(r<l[0])return void(i!=hh.setup&&i!=hh.first||kh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let c=0;c=r>=l[l.length-1]?l.length-1:kc.binarySearch(l,r)-1;const u=this.drawOrders[c];if(null==u)kh.arrayCopy(h,0,a,0,h.length);else for(let t=0,e=u.length;t<e;t++)a[t]=h[u[t]]}}const Zc=class extends Nc{constructor(t){super(t),this.frames=kh.newFloatArray(t*Zc.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,r,n,s,i){t*=Zc.ENTRIES,this.frames[t]=e,this.frames[t+Zc.MIX]=r,this.frames[t+Zc.BEND_DIRECTION]=n,this.frames[t+Zc.COMPRESS]=s?1:0,this.frames[t+Zc.STRETCH]=i?1:0}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(r<a[0]){switch(i){case hh.setup:return h.mix=h.data.mix,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case hh.first:h.mix+=(h.data.mix-h.mix)*s,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}return}if(r>=a[a.length-Zc.ENTRIES])return void(i==hh.setup?(h.mix=h.data.mix+(a[a.length+Zc.PREV_MIX]-h.data.mix)*s,o==lh.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=a[a.length+Zc.PREV_BEND_DIRECTION],h.compress=0!=a[a.length+Zc.PREV_COMPRESS],h.stretch=0!=a[a.length+Zc.PREV_STRETCH])):(h.mix+=(a[a.length+Zc.PREV_MIX]-h.mix)*s,o==lh.mixIn&&(h.bendDirection=a[a.length+Zc.PREV_BEND_DIRECTION],h.compress=0!=a[a.length+Zc.PREV_COMPRESS],h.stretch=0!=a[a.length+Zc.PREV_STRETCH])));const l=kc.binarySearch(a,r,Zc.ENTRIES),c=a[l+Zc.PREV_MIX],u=a[l],d=this.getCurvePercent(l/Zc.ENTRIES-1,1-(r-u)/(a[l+Zc.PREV_TIME]-u));i==hh.setup?(h.mix=h.data.mix+(c+(a[l+Zc.MIX]-c)*d-h.data.mix)*s,o==lh.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=a[l+Zc.PREV_BEND_DIRECTION],h.compress=0!=a[l+Zc.PREV_COMPRESS],h.stretch=0!=a[l+Zc.PREV_STRETCH])):(h.mix+=(c+(a[l+Zc.MIX]-c)*d-h.mix)*s,o==lh.mixIn&&(h.bendDirection=a[l+Zc.PREV_BEND_DIRECTION],h.compress=0!=a[l+Zc.PREV_COMPRESS],h.stretch=0!=a[l+Zc.PREV_STRETCH]))}};let Qc=Zc;Qc.ENTRIES=5,Qc.PREV_TIME=-5,Qc.PREV_MIX=-4,Qc.PREV_BEND_DIRECTION=-3,Qc.PREV_COMPRESS=-2,Qc.PREV_STRETCH=-1,Qc.MIX=1,Qc.BEND_DIRECTION=2,Qc.COMPRESS=3,Qc.STRETCH=4;const Jc=class extends Nc{constructor(t){super(t),this.frames=kh.newFloatArray(t*Jc.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,r,n,s,i){t*=Jc.ENTRIES,this.frames[t]=e,this.frames[t+Jc.ROTATE]=r,this.frames[t+Jc.TRANSLATE]=n,this.frames[t+Jc.SCALE]=s,this.frames[t+Jc.SHEAR]=i}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(r<a[0]){const t=h.data;switch(i){case hh.setup:return h.rotateMix=t.rotateMix,h.translateMix=t.translateMix,h.scaleMix=t.scaleMix,void(h.shearMix=t.shearMix);case hh.first:h.rotateMix+=(t.rotateMix-h.rotateMix)*s,h.translateMix+=(t.translateMix-h.translateMix)*s,h.scaleMix+=(t.scaleMix-h.scaleMix)*s,h.shearMix+=(t.shearMix-h.shearMix)*s}return}let l=0,c=0,u=0,d=0;if(r>=a[a.length-Jc.ENTRIES]){const t=a.length;l=a[t+Jc.PREV_ROTATE],c=a[t+Jc.PREV_TRANSLATE],u=a[t+Jc.PREV_SCALE],d=a[t+Jc.PREV_SHEAR]}else{const t=kc.binarySearch(a,r,Jc.ENTRIES);l=a[t+Jc.PREV_ROTATE],c=a[t+Jc.PREV_TRANSLATE],u=a[t+Jc.PREV_SCALE],d=a[t+Jc.PREV_SHEAR];const e=a[t],n=this.getCurvePercent(t/Jc.ENTRIES-1,1-(r-e)/(a[t+Jc.PREV_TIME]-e));l+=(a[t+Jc.ROTATE]-l)*n,c+=(a[t+Jc.TRANSLATE]-c)*n,u+=(a[t+Jc.SCALE]-u)*n,d+=(a[t+Jc.SHEAR]-d)*n}if(i==hh.setup){const t=h.data;h.rotateMix=t.rotateMix+(l-t.rotateMix)*s,h.translateMix=t.translateMix+(c-t.translateMix)*s,h.scaleMix=t.scaleMix+(u-t.scaleMix)*s,h.shearMix=t.shearMix+(d-t.shearMix)*s}else h.rotateMix+=(l-h.rotateMix)*s,h.translateMix+=(c-h.translateMix)*s,h.scaleMix+=(u-h.scaleMix)*s,h.shearMix+=(d-h.shearMix)*s}};let tu=Jc;tu.ENTRIES=5,tu.PREV_TIME=-5,tu.PREV_ROTATE=-4,tu.PREV_TRANSLATE=-3,tu.PREV_SCALE=-2,tu.PREV_SHEAR=-1,tu.ROTATE=1,tu.TRANSLATE=2,tu.SCALE=3,tu.SHEAR=4;const eu=class extends Nc{constructor(t){super(t),this.frames=kh.newFloatArray(t*eu.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,r){t*=eu.ENTRIES,this.frames[t]=e,this.frames[t+eu.VALUE]=r}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(r<a[0]){switch(i){case hh.setup:return void(h.position=h.data.position);case hh.first:h.position+=(h.data.position-h.position)*s}return}let l=0;if(r>=a[a.length-eu.ENTRIES])l=a[a.length+eu.PREV_VALUE];else{const t=kc.binarySearch(a,r,eu.ENTRIES);l=a[t+eu.PREV_VALUE];const e=a[t],n=this.getCurvePercent(t/eu.ENTRIES-1,1-(r-e)/(a[t+eu.PREV_TIME]-e));l+=(a[t+eu.VALUE]-l)*n}i==hh.setup?h.position=h.data.position+(l-h.data.position)*s:h.position+=(l-h.position)*s}};let ru=eu;ru.ENTRIES=2,ru.PREV_TIME=-2,ru.PREV_VALUE=-1,ru.VALUE=1;class nu extends ru{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(r<a[0]){switch(i){case hh.setup:return void(h.spacing=h.data.spacing);case hh.first:h.spacing+=(h.data.spacing-h.spacing)*s}return}let l=0;if(r>=a[a.length-nu.ENTRIES])l=a[a.length+nu.PREV_VALUE];else{const t=kc.binarySearch(a,r,nu.ENTRIES);l=a[t+nu.PREV_VALUE];const e=a[t],n=this.getCurvePercent(t/nu.ENTRIES-1,1-(r-e)/(a[t+nu.PREV_TIME]-e));l+=(a[t+nu.VALUE]-l)*n}i==hh.setup?h.spacing=h.data.spacing+(l-h.data.spacing)*s:h.spacing+=(l-h.spacing)*s}}const su=class extends Nc{constructor(t){super(t),this.frames=kh.newFloatArray(t*su.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,r,n){t*=su.ENTRIES,this.frames[t]=e,this.frames[t+su.ROTATE]=r,this.frames[t+su.TRANSLATE]=n}apply(t,e,r,n,s,i,o){const a=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(r<a[0]){switch(i){case hh.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case hh.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*s,h.translateMix+=(h.data.translateMix-h.translateMix)*s}return}let l=0,c=0;if(r>=a[a.length-su.ENTRIES])l=a[a.length+su.PREV_ROTATE],c=a[a.length+su.PREV_TRANSLATE];else{const t=kc.binarySearch(a,r,su.ENTRIES);l=a[t+su.PREV_ROTATE],c=a[t+su.PREV_TRANSLATE];const e=a[t],n=this.getCurvePercent(t/su.ENTRIES-1,1-(r-e)/(a[t+su.PREV_TIME]-e));l+=(a[t+su.ROTATE]-l)*n,c+=(a[t+su.TRANSLATE]-c)*n}i==hh.setup?(h.rotateMix=h.data.rotateMix+(l-h.data.rotateMix)*s,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*s):(h.rotateMix+=(l-h.rotateMix)*s,h.translateMix+=(c-h.translateMix)*s)}};let iu=su;iu.ENTRIES=3,iu.PREV_TIME=-3,iu.PREV_ROTATE=-2,iu.PREV_TRANSLATE=-1,iu.ROTATE=1,iu.TRANSLATE=2;const ou=class{constructor(t){this.tracks=new Array,this.events=new Array,this.listeners=new Array,this.queue=new uu(this),this.propertyIDs=new wh,this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new Oh((()=>new lu)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(null==n)continue;n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;let s=t*n.timeScale;if(n.delay>0){if(n.delay-=s,n.delay>0)continue;s=-n.delay,n.delay=0}let i=n.next;if(null!=i){const e=n.trackLast-i.delay;if(e>=0){for(i.delay=0,i.trackTime=0==n.timeScale?0:(e/n.timeScale+t)*i.timeScale,n.trackTime+=s,this.setCurrent(r,i,!0);null!=i.mixingFrom;)i.mixTime+=t,i=i.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&null==n.mixingFrom){e[r]=null,this.queue.end(n),this.disposeNext(n);continue}if(null!=n.mixingFrom&&this.updateMixingFrom(n,t)){let t=n.mixingFrom;for(n.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}n.trackTime+=s}this.queue.drain()}updateMixingFrom(t,e){const r=t.mixingFrom;if(null==r)return!0;const n=this.updateMixingFrom(r,e);return r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=r.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=r.mixingFrom,null!=r.mixingFrom&&(r.mixingFrom.mixingTo=t),t.interruptAlpha=r.interruptAlpha,this.queue.end(r)),n):(r.trackTime+=e*r.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,r=this.tracks;let n=!1;for(let s=0,i=r.length;s<i;s++){const i=r[s];if(null==i||i.delay>0)continue;n=!0;const o=0==s?hh.first:i.mixBlend;let a=i.alpha;null!=i.mixingFrom?a*=this.applyMixingFrom(i,t,o):i.trackTime>=i.trackEnd&&null==i.next&&(a=0);const h=i.animationLast,l=i.getAnimationTime(),c=i.animation.timelines.length,u=i.animation.timelines;if(0==s&&1==a||o==hh.add)for(let r=0;r<c;r++)kh.webkit602BugfixHelper(a,o),u[r].apply(t,h,l,e,a,o,lh.mixIn);else{const r=i.timelineMode,n=0==i.timelinesRotation.length;n&&kh.setArraySize(i.timelinesRotation,c<<1,null);const s=i.timelinesRotation;for(let i=0;i<c;i++){const c=u[i],d=r[i]==ou.SUBSEQUENT?o:hh.setup;c instanceof Dc?this.applyRotateTimeline(c,t,l,a,d,s,i<<1,n):(kh.webkit602BugfixHelper(a,o),c.apply(t,h,l,e,a,d,lh.mixIn))}}this.queueEvents(i,l),e.length=0,i.nextAnimationLast=l,i.nextTrackLast=i.trackTime}return this.queue.drain(),n}applyMixingFrom(t,e,r){const n=t.mixingFrom;null!=n.mixingFrom&&this.applyMixingFrom(n,e,r);let s=0;0==t.mixDuration?(s=1,r==hh.first&&(r=hh.setup)):(s=t.mixTime/t.mixDuration,s>1&&(s=1),r!=hh.first&&(r=n.mixBlend));const i=s<n.eventThreshold?this.events:null,o=s<n.attachmentThreshold,a=s<n.drawOrderThreshold,h=n.animationLast,l=n.getAnimationTime(),c=n.animation.timelines.length,u=n.animation.timelines,d=n.alpha*t.interruptAlpha,f=d*(1-s);if(r==hh.add)for(let t=0;t<c;t++)u[t].apply(e,h,l,i,f,r,lh.mixOut);else{const t=n.timelineMode,s=n.timelineHoldMix,p=0==n.timelinesRotation.length;p&&kh.setArraySize(n.timelinesRotation,c<<1,null);const m=n.timelinesRotation;n.totalAlpha=0;for(let g=0;g<c;g++){const c=u[g];let y,b=lh.mixOut,x=0;switch(t[g]){case ou.SUBSEQUENT:if(!o&&c instanceof Hc)continue;if(!a&&c instanceof Kc)continue;y=r,x=f;break;case ou.FIRST:y=hh.setup,x=f;break;case ou.HOLD:y=hh.setup,x=d;break;default:y=hh.setup;const t=s[g];x=d*Math.max(0,1-t.mixTime/t.mixDuration)}n.totalAlpha+=x,c instanceof Dc?this.applyRotateTimeline(c,e,l,x,y,m,g<<1,p):(kh.webkit602BugfixHelper(x,r),y==hh.setup&&(c instanceof Hc?o&&(b=lh.mixOut):c instanceof Kc&&a&&(b=lh.mixOut)),c.apply(e,h,l,i,x,y,b))}}return t.mixDuration>0&&this.queueEvents(n,l),this.events.length=0,n.nextAnimationLast=l,n.nextTrackLast=n.trackTime,s}applyRotateTimeline(t,e,r,n,s,i,o,a){if(a&&(i[o]=0),1==n)return void t.apply(e,0,r,null,1,s,lh.mixIn);const h=t,l=h.frames,c=e.bones[h.boneIndex];let u=0,d=0;if(r<l[0])switch(s){case hh.setup:c.rotation=c.data.rotation;default:return;case hh.first:u=c.rotation,d=c.data.rotation}else if(u=s==hh.setup?c.data.rotation:c.rotation,r>=l[l.length-Dc.ENTRIES])d=c.data.rotation+l[l.length+Dc.PREV_ROTATION];else{const t=kc.binarySearch(l,r,Dc.ENTRIES),e=l[t+Dc.PREV_ROTATION],n=l[t],s=h.getCurvePercent((t>>1)-1,1-(r-n)/(l[t+Dc.PREV_TIME]-n));d=l[t+Dc.ROTATION]-e,d-=360*(16384-(16384.499999999996-d/360|0)),d=e+d*s+c.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}let f=0,p=d-u;if(p-=360*(16384-(16384.499999999996-p/360|0)),0==p)f=i[o];else{let t=0,e=0;a?(t=0,e=p):(t=i[o],e=i[o+1]);const r=p>0;let n=t>=0;Rh.signum(e)!=Rh.signum(p)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Rh.signum(t)),n=r),f=p+t-t%360,n!=r&&(f+=360*Rh.signum(t)),i[o]=f}i[o+1]=p,u+=f*n,c.rotation=u-360*(16384-(16384.499999999996-u/360|0))}queueEvents(t,e){const r=t.animationStart,n=t.animationEnd,s=n-r,i=t.trackLast%s,o=this.events;let a=0;const h=o.length;for(;a<h;a++){const e=o[a];if(e.time<i)break;e.time>n||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==s||i>t.trackTime%s:e>=n&&t.animationLast<n,l&&this.queue.complete(t);a<h;a++)o[a].time<r||this.queue.event(t,o[a])}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let r=e;for(;;){const t=r.mixingFrom;if(null==t)break;this.queue.end(t),r.mixingFrom=null,r.mixingTo=null,r=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,r){const n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(r&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,null!=n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,r){const n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,n,r)}setAnimationWith(t,e,r){if(null==e)throw new Error("animation cannot be null.");let n=!0,s=this.expandToIndex(t);null!=s&&(-1==s.nextTrackLast?(this.tracks[t]=s.mixingFrom,this.queue.interrupt(s),this.queue.end(s),this.disposeNext(s),s=s.mixingFrom,n=!1):this.disposeNext(s));const i=this.trackEntry(t,e,r,s);return this.setCurrent(t,i,n),this.queue.drain(),i}addAnimation(t,e,r,n){const s=this.data.skeletonData.findAnimation(e);if(null==s)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,s,r,n)}addAnimationWith(t,e,r,n){if(null==e)throw new Error("animation cannot be null.");let s=this.expandToIndex(t);if(null!=s)for(;null!=s.next;)s=s.next;const i=this.trackEntry(t,e,r,s);if(null==s)this.setCurrent(t,i,!0),this.queue.drain();else if(s.next=i,n<=0){const t=s.animationEnd-s.animationStart;0!=t?(s.loop?n+=t*(1+(s.trackTime/t|0)):n+=Math.max(t,s.trackTime),n-=this.data.getMix(s.animation,e)):n=s.trackTime}return i.delay=n,i}setEmptyAnimation(t,e){const r=this.setAnimationWith(t,ou.emptyAnimation,!1);return r.mixDuration=e,r.trackEnd=e,r}addEmptyAnimation(t,e,r){r<=0&&(r-=e);const n=this.addAnimationWith(t,ou.emptyAnimation,!1,r);return n.mixDuration=e,n.trackEnd=e,n}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,r=this.tracks.length;e<r;e++){const r=this.tracks[e];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(kh.ensureArrayCapacity(this.tracks,t-this.tracks.length+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,r,n){const s=this.trackEntryPool.obtain();return s.trackIndex=t,s.animation=e,s.loop=r,s.holdPrevious=!1,s.eventThreshold=0,s.attachmentThreshold=0,s.drawOrderThreshold=0,s.animationStart=0,s.animationEnd=e.duration,s.animationLast=-1,s.nextAnimationLast=-1,s.delay=0,s.trackTime=0,s.trackLast=-1,s.nextTrackLast=-1,s.trackEnd=Number.MAX_VALUE,s.timeScale=1,s.alpha=1,s.interruptAlpha=1,s.mixTime=0,s.mixDuration=null==n?0:this.data.getMix(n.animation,e),s}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==hh.add||this.setTimelineModes(e),e=e.mixingTo}while(null!=e)}}}setTimelineModes(t){const e=t.mixingTo,r=t.animation.timelines,n=t.animation.timelines.length,s=kh.setArraySize(t.timelineMode,n);t.timelineHoldMix.length=0;const i=kh.setArraySize(t.timelineHoldMix,n),o=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let t=0;t<n;t++)o.add(r[t].getPropertyId()),s[t]=ou.HOLD;else t:for(let a=0;a<n;a++){const n=r[a].getPropertyId();if(o.add(n))if(null!=e&&this.hasTimeline(e,n)){for(let r=e.mixingTo;null!=r;r=r.mixingTo)if(!this.hasTimeline(r,n)){if(t.mixDuration>0){s[a]=ou.HOLD_MIX,i[a]=r;continue t}break}s[a]=ou.HOLD}else s[a]=ou.FIRST;else s[a]=ou.SUBSEQUENT}}hasTimeline(t,e){const r=t.animation.timelines;for(let t=0,n=r.length;t<n;t++)if(r[t].getPropertyId()==e)return!0;return!1}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,r){ou.deprecatedWarning1||(ou.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,r)}addAnimationByName(t,e,r,n){ou.deprecatedWarning2||(ou.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,r,n)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return ou.deprecatedWarning3||(ou.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let au=ou;au.emptyAnimation=new kc("<empty>",[],0),au.SUBSEQUENT=0,au.FIRST=1,au.HOLD=2,au.HOLD_MIX=3,au.deprecatedWarning1=!1,au.deprecatedWarning2=!1,au.deprecatedWarning3=!1;const hu=class{constructor(){this.mixBlend=hh.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return hu.deprecatedWarning1||(hu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){hu.deprecatedWarning1||(hu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return hu.deprecatedWarning2||(hu.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){hu.deprecatedWarning2||(hu.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let lu=hu;lu.deprecatedWarning1=!1,lu.deprecatedWarning2=!1;const cu=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(du.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(du.interrupt),this.objects.push(t)}end(t){this.objects.push(du.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(du.dispose),this.objects.push(t)}complete(t){this.objects.push(du.complete),this.objects.push(t)}event(t,e){this.objects.push(du.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return cu.deprecatedWarning1||(cu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let r=0;r<t.length;r+=2){const n=t[r],s=t[r+1];switch(n){case du.start:null!=s.listener&&s.listener.start&&s.listener.start(s);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(s);s.onStart&&this.deprecateStuff()&&s.onStart(s.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(s.trackIndex);break;case du.interrupt:null!=s.listener&&s.listener.interrupt&&s.listener.interrupt(s);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(s);break;case du.end:null!=s.listener&&s.listener.end&&s.listener.end(s);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(s);s.onEnd&&this.deprecateStuff()&&s.onEnd(s.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(s.trackIndex);case du.dispose:null!=s.listener&&s.listener.dispose&&s.listener.dispose(s);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(s);this.animState.trackEntryPool.free(s);break;case du.complete:null!=s.listener&&s.listener.complete&&s.listener.complete(s);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(s);const n=Rh.toInt(s.loopsCount());s.onComplete&&this.deprecateStuff()&&s.onComplete(s.trackIndex,n),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(s.trackIndex,n);break;case du.event:const i=t[2+r++];null!=s.listener&&s.listener.event&&s.listener.event(s,i);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(s,i);s.onEvent&&this.deprecateStuff()&&s.onEvent(s.trackIndex,i),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(s.trackIndex,i)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let uu=cu;uu.deprecatedWarning1=!1;var du=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(du||{});class fu{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}}const pu=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,r){const n=this.skeletonData.findAnimation(t);if(null==n)throw new Error(`Animation not found: ${t}`);const s=this.skeletonData.findAnimation(e);if(null==s)throw new Error(`Animation not found: ${e}`);this.setMixWith(n,s,r)}setMixByName(t,e,r){pu.deprecatedWarning1||(pu.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,e,r)}setMixWith(t,e,r){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const n=`${t.name}.${e.name}`;this.animationToMixTime[n]=r}getMix(t,e){const r=`${t.name}.${e.name}`,n=this.animationToMixTime[r];return void 0===n?this.defaultMix:n}};let mu=pu;mu.deprecatedWarning1=!1;class gu{constructor(t){this.atlas=t}newRegionAttachment(t,e,r){const n=this.atlas.findRegion(r);if(null==n)throw new Error(`Region not found in atlas: ${r} (region attachment: ${e})`);const s=new Ic(e);return s.region=n,s}newMeshAttachment(t,e,r){const n=this.atlas.findRegion(r);if(null==n)throw new Error(`Region not found in atlas: ${r} (mesh attachment: ${e})`);const s=new Ec(e);return s.region=n,s}newBoundingBoxAttachment(t,e){return new vc(e)}newPathAttachment(t,e){return new Tc(e)}newPointAttachment(t,e){return new Ac(e)}newClippingAttachment(t,e){return new wc(e)}}class yu{constructor(t,e,r){if(this.matrix=new We,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!0,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=r,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,r,n,s,i,o){this.ax=t,this.ay=e,this.arotation=r,this.ascaleX=n,this.ascaleY=s,this.ashearX=i,this.ashearY=o,this.appliedValid=!0;const a=this.parent,h=this.matrix,l=this.skeleton.scaleX,c=-this.skeleton.scaleY;if(null==a){const a=this.skeleton,u=r+90+o;return h.a=Rh.cosDeg(r+i)*n*l,h.c=Rh.cosDeg(u)*s*l,h.b=Rh.sinDeg(r+i)*n*c,h.d=Rh.sinDeg(u)*s*c,h.tx=t*l+a.x,void(h.ty=e*c+a.y)}let u=a.matrix.a,d=a.matrix.c,f=a.matrix.b,p=a.matrix.d;switch(h.tx=u*t+d*e+a.matrix.tx,h.ty=f*t+p*e+a.matrix.ty,this.data.transformMode){case dh.Normal:{const t=r+90+o,e=Rh.cosDeg(r+i)*n,a=Rh.cosDeg(t)*s,l=Rh.sinDeg(r+i)*n,c=Rh.sinDeg(t)*s;return h.a=u*e+d*l,h.c=u*a+d*c,h.b=f*e+p*l,void(h.d=f*a+p*c)}case dh.OnlyTranslation:{const t=r+90+o;h.a=Rh.cosDeg(r+i)*n,h.c=Rh.cosDeg(t)*s,h.b=Rh.sinDeg(r+i)*n,h.d=Rh.sinDeg(t)*s;break}case dh.NoRotationOrReflection:{let t=u*u+f*f,e=0;t>1e-4?(t=Math.abs(u*p-d*f)/t,d=f*t,p=u*t,e=Math.atan2(f,u)*Rh.radDeg):(u=0,f=0,e=90-Math.atan2(p,d)*Rh.radDeg);const a=r+i-e,l=r+o-e+90,c=Rh.cosDeg(a)*n,m=Rh.cosDeg(l)*s,g=Rh.sinDeg(a)*n,y=Rh.sinDeg(l)*s;h.a=u*c-d*g,h.c=u*m-d*y,h.b=f*c+p*g,h.d=f*m+p*y;break}case dh.NoScale:case dh.NoScaleOrReflection:{const t=Rh.cosDeg(r),e=Rh.sinDeg(r);let a=(u*t+d*e)/l,m=(f*t+p*e)/c,g=Math.sqrt(a*a+m*m);g>1e-5&&(g=1/g),a*=g,m*=g,g=Math.sqrt(a*a+m*m),this.data.transformMode==dh.NoScale&&u*p-d*f<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(g=-g);const y=Math.PI/2+Math.atan2(m,a),b=Math.cos(y)*g,x=Math.sin(y)*g,_=Rh.cosDeg(i)*n,v=Rh.cosDeg(90+o)*s,w=Rh.sinDeg(i)*n,E=Rh.sinDeg(90+o)*s;h.a=a*_+b*w,h.c=a*v+b*E,h.b=m*_+x*w,h.d=m*v+x*E;break}}h.a*=l,h.c*=l,h.b*=c,h.d*=c}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*Rh.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*Rh.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*Rh.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*Rh.radDeg);const r=t.matrix,n=1/(r.a*r.d-r.b*r.c),s=e.tx-r.tx,i=e.ty-r.ty;this.ax=s*r.d*n-i*r.c*n,this.ay=i*r.a*n-s*r.b*n;const o=n*r.d,a=n*r.a,h=n*r.c,l=n*r.b,c=o*e.a-h*e.b,u=o*e.c-h*e.d,d=a*e.b-l*e.a,f=a*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*f,t)*Rh.radDeg,this.arotation=Math.atan2(d,c)*Rh.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*Rh.radDeg}worldToLocal(t){const e=this.matrix,r=e.a,n=e.c,s=e.b,i=e.d,o=1/(r*i-n*s),a=t.x-e.tx,h=t.y-e.ty;return t.x=a*i*o-h*n*o,t.y=h*r*o-a*s*o,t}localToWorld(t){const e=this.matrix,r=t.x,n=t.y;return t.x=r*e.a+n*e.c+e.tx,t.y=r*e.b+n*e.d+e.ty,t}worldToLocalRotation(t){const e=Rh.sinDeg(t),r=Rh.cosDeg(t),n=this.matrix;return Math.atan2(n.a*e-n.b*r,n.d*r-n.c*e)*Rh.radDeg}localToWorldRotation(t){const e=Rh.sinDeg(t),r=Rh.cosDeg(t),n=this.matrix;return Math.atan2(r*n.b+e*n.d,r*n.a+e*n.c)*Rh.radDeg}rotateWorld(t){const e=this.matrix,r=e.a,n=e.c,s=e.b,i=e.d,o=Rh.cosDeg(t),a=Rh.sinDeg(t);e.a=o*r-a*s,e.c=o*n-a*i,e.b=a*r+o*s,e.d=a*n+o*i,this.appliedValid=!1}}class bu{constructor(t,e,r){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=dh.Normal,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=r}}class xu{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}class _u{constructor(t){this.name=t}}class vu{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let r=0;r<t.bones.length;r++)this.bones.push(e.findBone(t.bones[r].name));this.target=e.findBone(t.target.name)}getOrder(){return this.data.order}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.mix)}}apply1(t,e,r,n,s,i,o){t.appliedValid||t.updateAppliedTransform();const a=t.parent.matrix,h=1/(a.a*a.d-a.b*a.c),l=e-a.tx,c=r-a.ty,u=(l*a.d-c*a.c)*h-t.ax,d=(c*a.a-l*a.b)*h-t.ay;let f=Math.atan2(d,u)*Rh.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);let p=t.ascaleX,m=t.ascaleY;if(n||s){const e=t.data.length*p,r=Math.sqrt(u*u+d*d);if(n&&r<e||s&&r>e&&e>1e-4){const t=(r/e-1)*o+1;p*=t,i&&(m*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+f*o,p,m,t.ashearX,t.ashearY)}apply2(t,e,r,n,s,i,o){if(0==o)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const a=t.ax,h=t.ay;let l=t.ascaleX,c=l,u=t.ascaleY,d=e.ascaleX;const f=t.matrix;let p=0,m=0,g=0;l<0?(l=-l,p=180,g=-1):(p=0,g=1),u<0&&(u=-u,g=-g),d<0?(d=-d,m=180):m=0;const y=e.ax;let b=0,x=0,_=0,v=f.a,w=f.c,E=f.b,T=f.d;const A=Math.abs(l-u)<=1e-4;A?(b=e.ay,x=v*y+w*b+f.tx,_=E*y+T*b+f.ty):(b=0,x=v*y+f.tx,_=E*y+f.ty);const S=t.parent.matrix;v=S.a,w=S.c,E=S.b,T=S.d;const R=1/(v*T-w*E);let I=r-S.tx,M=n-S.ty;const P=(I*T-M*w)*R-a,C=(M*v-I*E)*R-h,k=P*P+C*C;I=x-S.tx,M=_-S.ty;const O=(I*T-M*w)*R-a,F=(M*v-I*E)*R-h,N=Math.sqrt(O*O+F*F);let B=e.data.length*d,D=0,L=0;t:if(A){B*=l;let t=(k-N*N-B*B)/(2*N*B);t<-1?t=-1:t>1&&(t=1,i&&N+B>1e-4&&(c*=(Math.sqrt(k)/(N+B)-1)*o+1)),L=Math.acos(t)*s,v=N+B*t,w=B*Math.sin(L),D=Math.atan2(C*v-P*w,P*v+C*w)}else{v=l*B,w=u*B;const t=v*v,e=w*w,r=Math.atan2(C,P);E=e*N*N+t*k-t*e;const n=-2*e*N,i=e-t;if(T=n*n-4*i*E,T>=0){let t=Math.sqrt(T);n<0&&(t=-t),t=-(n+t)/2;const e=t/i,o=E/t,a=Math.abs(e)<Math.abs(o)?e:o;if(a*a<=k){M=Math.sqrt(k-a*a)*s,D=r-Math.atan2(M,a),L=Math.atan2(M/u,(a-N)/l);break t}}let o=Rh.PI,a=N-v,h=a*a,c=0,d=0,f=N+v,p=f*f,m=0;E=-v*N/(t-e),E>=-1&&E<=1&&(E=Math.acos(E),I=v*Math.cos(E)+N,M=w*Math.sin(E),T=I*I+M*M,T<h&&(o=E,h=T,a=I,c=M),T>p&&(d=E,p=T,f=I,m=M)),k<=(h+p)/2?(D=r-Math.atan2(c*s,a),L=o*s):(D=r-Math.atan2(m*s,f),L=d*s)}const V=Math.atan2(b,y)*g;let U=t.arotation;D=(D-V)*Rh.radDeg+p-U,D>180?D-=360:D<-180&&(D+=360),t.updateWorldTransformWith(a,h,U+D*o,c,t.ascaleY,0,0),U=e.arotation,L=((L+V)*Rh.radDeg-e.ashearX)*g+m-U,L>180?L-=360:L<-180&&(L+=360),e.updateWorldTransformWith(y,b,U+L*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class wu{constructor(t){this.order=0,this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.name=t}}class Eu{constructor(t){this.order=0,this.bones=new Array,this.name=t}}var Tu=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(Tu||{});const Au=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let r=0,n=t.bones.length;r<n;r++)this.bones.push(e.findBone(t.bones[r].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof Tc))return;const e=this.rotateMix,r=this.translateMix,n=e>0;if(!(r>0||n))return;const s=this.data,i=s.spacingMode,o=i==Tu.Length,a=s.rotateMode,h=a==uh.Tangent,l=a==uh.ChainScale,c=this.bones.length,u=h?c:c+1,d=this.bones,f=kh.setArraySize(this.spaces,u);let p=null;const m=this.spacing;if(l||o){l&&(p=kh.setArraySize(this.lengths,c));for(let t=0,e=u-1;t<e;){const e=d[t],r=e.data.length;if(r<Au.epsilon)l&&(p[t]=0),f[++t]=0;else{const n=r*e.matrix.a,s=r*e.matrix.b,i=Math.sqrt(n*n+s*s);l&&(p[t]=i),f[++t]=(o?r+m:m)*i/r}}}else for(let t=1;t<u;t++)f[t]=m;const g=this.computeWorldPositions(t,u,h,s.positionMode==ch.Percent,i==Tu.Percent);let y=g[0],b=g[1],x=s.offsetRotation,_=!1;if(0==x)_=a==uh.Chain;else{_=!1;const t=this.target.bone.matrix;x*=t.a*t.d-t.b*t.c>0?Rh.degRad:-Rh.degRad}for(let t=0,s=3;t<c;t++,s+=3){const i=d[t],o=i.matrix;o.tx+=(y-o.tx)*r,o.ty+=(b-o.ty)*r;const a=g[s],c=g[s+1],u=a-y,m=c-b;if(l){const r=p[t];if(0!=r){const t=(Math.sqrt(u*u+m*m)/r-1)*e+1;o.a*=t,o.b*=t}}if(y=a,b=c,n){const r=o.a,n=o.c,a=o.b,l=o.d;let c=0,d=0,p=0;if(h&&(c=h?g[s-1]:0==f[t+1]?g[s+2]:Math.atan2(m,u)),c-=Math.atan2(a,r),_){d=Math.cos(c),p=Math.sin(c);const t=i.data.length;y+=(t*(d*r-p*a)-u)*e,b+=(t*(p*r+d*a)-m)*e}else c+=x;c>Rh.PI?c-=Rh.PI2:c<-Rh.PI&&(c+=Rh.PI2),c*=e,d=Math.cos(c),p=Math.sin(c),o.a=d*r-p*a,o.c=d*n-p*l,o.b=p*r+d*a,o.d=p*n+d*l}i.appliedValid=!1}}computeWorldPositions(t,e,r,n,s){const i=this.target;let o=this.position;const a=this.spaces,h=kh.setArraySize(this.positions,3*e+2);let l=null;const c=t.closed;let u=t.worldVerticesLength,d=u/6,f=Au.NONE;if(!t.constantSpeed){const p=t.lengths;d-=c?1:2;const m=p[d];if(n&&(o*=m),s)for(let t=0;t<e;t++)a[t]*=m;l=kh.setArraySize(this.world,8);for(let n=0,s=0,g=0;n<e;n++,s+=3){const e=a[n];o+=e;let y=o;if(c)y%=m,y<0&&(y+=m),g=0;else{if(y<0){f!=Au.BEFORE&&(f=Au.BEFORE,t.computeWorldVertices(i,2,4,l,0,2)),this.addBeforePosition(y,l,0,h,s);continue}if(y>m){f!=Au.AFTER&&(f=Au.AFTER,t.computeWorldVertices(i,u-6,4,l,0,2)),this.addAfterPosition(y-m,l,0,h,s);continue}}for(;;g++){const t=p[g];if(!(y>t)){if(0==g)y/=t;else{const e=p[g-1];y=(y-e)/(t-e)}break}}g!=f&&(f=g,c&&g==d?(t.computeWorldVertices(i,u-4,4,l,0,2),t.computeWorldVertices(i,0,4,l,4,2)):t.computeWorldVertices(i,6*g+2,8,l,0,2)),this.addCurvePosition(y,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,s,r||n>0&&0==e)}return h}c?(u+=2,l=kh.setArraySize(this.world,u),t.computeWorldVertices(i,2,u-4,l,0,2),t.computeWorldVertices(i,0,2,l,u-4,2),l[u-2]=l[0],l[u-1]=l[1]):(d--,u-=4,l=kh.setArraySize(this.world,u),t.computeWorldVertices(i,2,u,l,0,2));const p=kh.setArraySize(this.curves,d);let m=0,g=l[0],y=l[1],b=0,x=0,_=0,v=0,w=0,E=0,T=0,A=0,S=0,R=0,I=0,M=0,P=0,C=0;for(let t=0,e=2;t<d;t++,e+=6)b=l[e],x=l[e+1],_=l[e+2],v=l[e+3],w=l[e+4],E=l[e+5],T=.1875*(g-2*b+_),A=.1875*(y-2*x+v),S=.09375*(3*(b-_)-g+w),R=.09375*(3*(x-v)-y+E),I=2*T+S,M=2*A+R,P=.75*(b-g)+T+.16666667*S,C=.75*(x-y)+A+.16666667*R,m+=Math.sqrt(P*P+C*C),P+=I,C+=M,I+=S,M+=R,m+=Math.sqrt(P*P+C*C),P+=I,C+=M,m+=Math.sqrt(P*P+C*C),P+=I+S,C+=M+R,m+=Math.sqrt(P*P+C*C),p[t]=m,g=w,y=E;if(n&&(o*=m),s)for(let t=0;t<e;t++)a[t]*=m;const k=this.segments;let O=0;for(let t=0,n=0,s=0,i=0;t<e;t++,n+=3){const e=a[t];o+=e;let d=o;if(c)d%=m,d<0&&(d+=m),s=0;else{if(d<0){this.addBeforePosition(d,l,0,h,n);continue}if(d>m){this.addAfterPosition(d-m,l,u-4,h,n);continue}}for(;;s++){const t=p[s];if(!(d>t)){if(0==s)d/=t;else{const e=p[s-1];d=(d-e)/(t-e)}break}}if(s!=f){f=s;let t=6*s;for(g=l[t],y=l[t+1],b=l[t+2],x=l[t+3],_=l[t+4],v=l[t+5],w=l[t+6],E=l[t+7],T=.03*(g-2*b+_),A=.03*(y-2*x+v),S=.006*(3*(b-_)-g+w),R=.006*(3*(x-v)-y+E),I=2*T+S,M=2*A+R,P=.3*(b-g)+T+.16666667*S,C=.3*(x-y)+A+.16666667*R,O=Math.sqrt(P*P+C*C),k[0]=O,t=1;t<8;t++)P+=I,C+=M,I+=S,M+=R,O+=Math.sqrt(P*P+C*C),k[t]=O;P+=I,C+=M,O+=Math.sqrt(P*P+C*C),k[8]=O,P+=I+S,C+=M+R,O+=Math.sqrt(P*P+C*C),k[9]=O,i=0}for(d*=O;;i++){const t=k[i];if(!(d>t)){if(0==i)d/=t;else{const e=k[i-1];d=i+(d-e)/(t-e)}break}}this.addCurvePosition(.1*d,g,y,b,x,_,v,w,E,h,n,r||t>0&&0==e)}return h}addBeforePosition(t,e,r,n,s){const i=e[r],o=e[r+1],a=e[r+2]-i,h=e[r+3]-o,l=Math.atan2(h,a);n[s]=i+t*Math.cos(l),n[s+1]=o+t*Math.sin(l),n[s+2]=l}addAfterPosition(t,e,r,n,s){const i=e[r+2],o=e[r+3],a=i-e[r],h=o-e[r+1],l=Math.atan2(h,a);n[s]=i+t*Math.cos(l),n[s+1]=o+t*Math.sin(l),n[s+2]=l}addCurvePosition(t,e,r,n,s,i,o,a,h,l,c,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,y=p*t,b=3*y,x=p*b,_=b*t,v=e*g+n*x+i*_+a*f,w=r*g+s*x+o*_+h*f;l[c]=v,l[c+1]=w,u&&(l[c+2]=Math.atan2(w-(r*m+s*y*2+o*d),v-(e*m+n*y*2+i*d)))}getOrder(){return this.data.order}};let Su=Au;Su.NONE=-1,Su.BEFORE=-2,Su.AFTER=-3,Su.epsilon=1e-5;class Ru{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new Fh,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let r=0;r<t.bones.length;r++)this.bones.push(e.findBone(t.bones[r].name));this.target=e.findBone(t.target.name)}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target,i=s.matrix,o=i.a,a=i.c,h=i.b,l=i.d,c=o*l-a*h>0?Rh.degRad:-Rh.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let i=0,c=f.length;i<c;i++){const c=f[i];let p=!1;const m=c.matrix;if(0!=t){const e=m.a,r=m.c,n=m.b,s=m.d;let i=Math.atan2(h,o)-Math.atan2(n,e)+u;i>Rh.PI?i-=Rh.PI2:i<-Rh.PI&&(i+=Rh.PI2),i*=t;const a=Math.cos(i),l=Math.sin(i);m.a=a*e-l*n,m.c=a*r-l*s,m.b=l*e+a*n,m.d=l*r+a*s,p=!0}if(0!=e){const t=this.temp;s.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,p=!0}if(r>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(o*o+h*h);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*r)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(a*a+l*l),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*r)/t),m.c*=t,m.d*=t,p=!0}if(n>0){const t=m.c,e=m.d,r=Math.atan2(e,t);let s=Math.atan2(l,a)-Math.atan2(h,o)-(r-Math.atan2(m.b,m.a));s>Rh.PI?s-=Rh.PI2:s<-Rh.PI&&(s+=Rh.PI2),s=r+(s+d)*n;const i=Math.sqrt(t*t+e*e);m.c=Math.cos(s)*i,m.d=Math.sin(s)*i,p=!0}p&&(c.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target,i=s.matrix,o=i.a,a=i.c,h=i.b,l=i.d,c=o*l-a*h>0?Rh.degRad:-Rh.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let i=0,c=f.length;i<c;i++){const c=f[i];let p=!1;const m=c.matrix;if(0!=t){const e=m.a,r=m.c,n=m.b,s=m.d;let i=Math.atan2(h,o)+u;i>Rh.PI?i-=Rh.PI2:i<-Rh.PI&&(i+=Rh.PI2),i*=t;const a=Math.cos(i),l=Math.sin(i);m.a=a*e-l*n,m.c=a*r-l*s,m.b=l*e+a*n,m.d=l*r+a*s,p=!0}if(0!=e){const t=this.temp;s.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,p=!0}if(r>0){let t=(Math.sqrt(o*o+h*h)-1+this.data.offsetScaleX)*r+1;m.a*=t,m.b*=t,t=(Math.sqrt(a*a+l*l)-1+this.data.offsetScaleY)*r+1,m.c*=t,m.d*=t,p=!0}if(n>0){let t=Math.atan2(l,a)-Math.atan2(h,o);t>Rh.PI?t-=Rh.PI2:t<-Rh.PI&&(t+=Rh.PI2);const e=m.c,r=m.d;t=Math.atan2(r,e)+(t-Rh.PI/2+d)*n;const s=Math.sqrt(e*e+r*r);m.c=Math.cos(t)*s,m.d=Math.sin(t)*s,p=!0}p&&(c.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target;s.appliedValid||s.updateAppliedTransform();const i=this.bones;for(let o=0,a=i.length;o<a;o++){const a=i[o];a.appliedValid||a.updateAppliedTransform();let h=a.arotation;if(0!=t){let e=s.arotation-h+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),h+=e*t}let l=a.ax,c=a.ay;0!=e&&(l+=(s.ax-l+this.data.offsetX)*e,c+=(s.ay-c+this.data.offsetY)*e);let u=a.ascaleX,d=a.ascaleY;r>0&&(u>1e-5&&(u=(u+(s.ascaleX-u+this.data.offsetScaleX)*r)/u),d>1e-5&&(d=(d+(s.ascaleY-d+this.data.offsetScaleY)*r)/d));const f=a.ashearY;if(n>0){let t=s.ashearY-f+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),a.shearY+=t*n}a.updateWorldTransformWith(l,c,h,u,d,a.ashearX,f)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target;s.appliedValid||s.updateAppliedTransform();const i=this.bones;for(let o=0,a=i.length;o<a;o++){const a=i[o];a.appliedValid||a.updateAppliedTransform();let h=a.arotation;0!=t&&(h+=(s.arotation+this.data.offsetRotation)*t);let l=a.ax,c=a.ay;0!=e&&(l+=(s.ax+this.data.offsetX)*e,c+=(s.ay+this.data.offsetY)*e);let u=a.ascaleX,d=a.ascaleY;r>0&&(u>1e-5&&(u*=(s.ascaleX-1+this.data.offsetScaleX)*r+1),d>1e-5&&(d*=(s.ascaleY-1+this.data.offsetScaleY)*r+1));let f=a.ashearY;n>0&&(f+=(s.ashearY+this.data.offsetShearY)*n),a.updateWorldTransformWith(l,c,h,u,d,a.ashearX,f)}}getOrder(){return this.data.order}}const Iu=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const r=t.bones[e];let n;if(null==r.parent)n=new yu(r,this,null);else{const t=this.bones[r.parent.index];n=new yu(r,this,t),t.children.push(n)}this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const r=t.slots[e],n=this.bones[r.boneData.index],s=new Sc(r,n);this.slots.push(s),this.drawOrder.push(s)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const r=t.ikConstraints[e];this.ikConstraints.push(new vu(r,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const r=t.transformConstraints[e];this.transformConstraints.push(new Ru(r,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const r=t.pathConstraints[e];this.pathConstraints.push(new Su(r,this))}this.color=new Ah(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let e=0,r=t.length;e<r;e++)t[e].sorted=!1;const e=this.ikConstraints,r=this.transformConstraints,n=this.pathConstraints,s=e.length,i=r.length,o=n.length,a=s+i+o;t:for(let t=0;t<a;t++){for(let r=0;r<s;r++){const n=e[r];if(n.data.order==t){this.sortIkConstraint(n);continue t}}for(let e=0;e<i;e++){const n=r[e];if(n.data.order==t){this.sortTransformConstraint(n);continue t}}for(let e=0;e<o;e++){const r=n[e];if(r.data.order==t){this.sortPathConstraint(r);continue t}}}for(let e=0,r=t.length;e<r;e++)this.sortBone(t[e])}sortIkConstraint(t){const e=t.target;this.sortBone(e);const r=t.bones,n=r[0];if(this.sortBone(n),r.length>1){const t=r[r.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(n.children),r[r.length-1].sorted=!0}sortPathConstraint(t){const e=t.target,r=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,r,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,r,n);for(let t=0,e=this.data.skins.length;t<e;t++)this.sortPathConstraintAttachment(this.data.skins[t],r,n);const s=e.getAttachment();s instanceof Tc&&this.sortPathConstraintAttachmentWith(s,n);const i=t.bones,o=i.length;for(let t=0;t<o;t++)this.sortBone(i[t]);this._updateCache.push(t);for(let t=0;t<o;t++)this.sortReset(i[t].children);for(let t=0;t<o;t++)i[t].sorted=!0}sortTransformConstraint(t){this.sortBone(t.target);const e=t.bones,r=e.length;if(t.data.local)for(let t=0;t<r;t++){const r=e[t];this.sortBone(r.parent),this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}else for(let t=0;t<r;t++)this.sortBone(e[t]);this._updateCache.push(t);for(let t=0;t<r;t++)this.sortReset(e[t].children);for(let t=0;t<r;t++)e[t].sorted=!0}sortPathConstraintAttachment(t,e,r){const n=t.attachments[e];if(n)for(const t in n)this.sortPathConstraintAttachmentWith(n[t],r)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof Tc))return;const r=t.bones;if(null==r)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<r.length;){const n=r[e++];for(let s=e+n;e<s;e++){const n=r[e];this.sortBone(t[n])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,r=t.length;e<r;e++){const r=t[e];r.sorted&&this.sortReset(r.children),r.sorted=!1}}updateWorldTransform(){const t=this.updateCacheReset;for(let e=0,r=t.length;e<r;e++){const r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0}const e=this._updateCache;for(let t=0,r=e.length;t<r;t++)e[t].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let e=0,r=t.length;e<r;e++)t[e].setToSetupPose();const e=this.ikConstraints;for(let t=0,r=e.length;t<r;t++){const r=e[t];r.bendDirection=r.data.bendDirection,r.mix=r.data.mix}const r=this.transformConstraints;for(let t=0,e=r.length;t<e;t++){const e=r[t],n=e.data;e.rotateMix=n.rotateMix,e.translateMix=n.translateMix,e.scaleMix=n.scaleMix,e.shearMix=n.shearMix}const n=this.pathConstraints;for(let t=0,e=n.length;t<e;t++){const e=n[t],r=e.data;e.position=r.position,e.spacing=r.spacing,e.rotateMix=r.rotateMix,e.translateMix=r.translateMix}}setSlotsToSetupPose(){const t=this.slots;kh.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,r=t.length;e<r;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return r;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return r;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let r=0,n=e.length;r<n;r++){const n=e[r],s=n.data.attachmentName;if(null!=s){const e=t.getAttachment(r,s);null!=e&&n.setAttachment(e)}}}this.skin=t}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const r=this.skin.getAttachment(t,e);if(null!=r)return r}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const r=this.slots;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(s.data.name==t){let r=null;if(null!=e&&(r=this.getAttachment(n,e),null==r))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void s.setAttachment(r)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}getBounds(t,e,r){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const n=this.drawOrder;let s=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let t=0,e=n.length;t<e;t++){const e=n[t];let h=0,l=null;const c=e.getAttachment();if(c instanceof Ic)h=8,l=kh.setArraySize(r,h,0),c.computeWorldVertices(e.bone,l,0,2);else if(c instanceof Ec){const t=c;h=t.worldVerticesLength,l=kh.setArraySize(r,h,0),t.computeWorldVertices(e,0,h,l,0,2)}if(null!=l)for(let t=0,e=l.length;t<e;t+=2){const e=l[t],r=l[t+1];s=Math.min(s,e),i=Math.min(i,r),o=Math.max(o,e),a=Math.max(a,r)}}t.set(s,i),e.set(o-s,a-i)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){Iu.deprecatedWarning1||(Iu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){Iu.deprecatedWarning1||(Iu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let Mu=Iu;Mu.deprecatedWarning1=!1;class Pu extends Nh{}class Cu{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1}}class ku{constructor(t,e,r){if(this.color=new Ah(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==r)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=r}}class Ou{constructor(t){if(this.order=0,this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1,null==t)throw new Error("name cannot be null.");this.name=t}}class Fu{constructor(t){if(this.attachments=new Array,null==t)throw new Error("name cannot be null.");this.name=t}addAttachment(t,e,r){if(null==r)throw new Error("attachment cannot be null.");const n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=r}getAttachment(t,e){const r=this.attachments[t];return r?r[e]:null}attachAll(t,e){let r=0;for(let n=0;n<t.slots.length;n++){const s=t.slots[n],i=s.getAttachment();if(i&&r<e.attachments.length){const t=e.attachments[r];for(const e in t)if(i==t[e]){const t=this.getAttachment(r,e);null!=t&&s.setAttachment(t);break}}r++}}}class Nu{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,r=new Cu,n="string"==typeof t?JSON.parse(t):t,s=n.skeleton;if(null!=s&&(r.hash=s.hash,r.version=s.spine,r.width=s.width,r.height=s.height,r.fps=s.fps,r.imagesPath=s.images),n.bones)for(let t=0;t<n.bones.length;t++){const s=n.bones[t];let i=null;const o=this.getValue(s,"parent",null);if(null!=o&&(i=r.findBone(o),null==i))throw new Error(`Parent bone not found: ${o}`);const a=new bu(r.bones.length,s.name,i);a.length=this.getValue(s,"length",0)*e,a.x=this.getValue(s,"x",0)*e,a.y=this.getValue(s,"y",0)*e,a.rotation=this.getValue(s,"rotation",0),a.scaleX=this.getValue(s,"scaleX",1),a.scaleY=this.getValue(s,"scaleY",1),a.shearX=this.getValue(s,"shearX",0),a.shearY=this.getValue(s,"shearY",0),a.transformMode=Nu.transformModeFromString(this.getValue(s,"transform","normal")),r.bones.push(a)}if(n.slots)for(let t=0;t<n.slots.length;t++){const e=n.slots[t],s=e.name,i=e.bone,o=r.findBone(i);if(null==o)throw new Error(`Slot bone not found: ${i}`);const a=new ku(r.slots.length,s,o),h=this.getValue(e,"color",null);null!=h&&a.color.setFromString(h);const l=this.getValue(e,"dark",null);null!=l&&(a.darkColor=new Ah(1,1,1,1),a.darkColor.setFromString(l)),a.attachmentName=this.getValue(e,"attachment",null),a.blendMode=Nu.blendModeFromString(this.getValue(e,"blend","normal")),r.slots.push(a)}if(n.ik)for(let t=0;t<n.ik.length;t++){const e=n.ik[t],s=new wu(e.name);s.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const n=e.bones[t],i=r.findBone(n);if(null==i)throw new Error(`IK bone not found: ${n}`);s.bones.push(i)}const i=e.target;if(s.target=r.findBone(i),null==s.target)throw new Error(`IK target bone not found: ${i}`);s.bendDirection=this.getValue(e,"bendPositive",!0)?1:-1,s.mix=this.getValue(e,"mix",1),r.ikConstraints.push(s)}if(n.transform)for(let t=0;t<n.transform.length;t++){const s=n.transform[t],i=new Ou(s.name);i.order=this.getValue(s,"order",0);for(let t=0;t<s.bones.length;t++){const e=s.bones[t],n=r.findBone(e);if(null==n)throw new Error(`Transform constraint bone not found: ${e}`);i.bones.push(n)}const o=s.target;if(i.target=r.findBone(o),null==i.target)throw new Error(`Transform constraint target bone not found: ${o}`);i.local=this.getValue(s,"local",!1),i.relative=this.getValue(s,"relative",!1),i.offsetRotation=this.getValue(s,"rotation",0),i.offsetX=this.getValue(s,"x",0)*e,i.offsetY=this.getValue(s,"y",0)*e,i.offsetScaleX=this.getValue(s,"scaleX",0),i.offsetScaleY=this.getValue(s,"scaleY",0),i.offsetShearY=this.getValue(s,"shearY",0),i.rotateMix=this.getValue(s,"rotateMix",1),i.translateMix=this.getValue(s,"translateMix",1),i.scaleMix=this.getValue(s,"scaleMix",1),i.shearMix=this.getValue(s,"shearMix",1),r.transformConstraints.push(i)}if(n.path)for(let t=0;t<n.path.length;t++){const s=n.path[t],i=new Eu(s.name);i.order=this.getValue(s,"order",0);for(let t=0;t<s.bones.length;t++){const e=s.bones[t],n=r.findBone(e);if(null==n)throw new Error(`Transform constraint bone not found: ${e}`);i.bones.push(n)}const o=s.target;if(i.target=r.findSlot(o),null==i.target)throw new Error(`Path target slot not found: ${o}`);i.positionMode=Nu.positionModeFromString(this.getValue(s,"positionMode","percent")),i.spacingMode=Nu.spacingModeFromString(this.getValue(s,"spacingMode","length")),i.rotateMode=Nu.rotateModeFromString(this.getValue(s,"rotateMode","tangent")),i.offsetRotation=this.getValue(s,"rotation",0),i.position=this.getValue(s,"position",0),i.positionMode==ch.Fixed&&(i.position*=e),i.spacing=this.getValue(s,"spacing",0),i.spacingMode!=Tu.Length&&i.spacingMode!=Tu.Fixed||(i.spacing*=e),i.rotateMix=this.getValue(s,"rotateMix",1),i.translateMix=this.getValue(s,"translateMix",1),r.pathConstraints.push(i)}if(n.skins)for(const t in n.skins){const e=n.skins[t],s=new Fu(t);for(const t in e){const n=r.findSlotIndex(t);if(-1==n)throw new Error(`Slot not found: ${t}`);const i=e[t];for(const t in i){const e=this.readAttachment(i[t],s,n,t,r);null!=e&&s.addAttachment(n,t,e)}}r.skins.push(s),"default"==s.name&&(r.defaultSkin=s)}for(let t=0,e=this.linkedMeshes.length;t<e;t++){const e=this.linkedMeshes[t],n=null==e.skin?r.defaultSkin:r.findSkin(e.skin);if(null==n)throw new Error(`Skin not found: ${e.skin}`);const s=n.getAttachment(e.slotIndex,e.parent);if(null==s)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.setParentMesh(s)}if(this.linkedMeshes.length=0,n.events)for(const t in n.events){const e=n.events[t],s=new _u(t);s.intValue=this.getValue(e,"int",0),s.floatValue=this.getValue(e,"float",0),s.stringValue=this.getValue(e,"string",""),s.audioPath=this.getValue(e,"audio",null),null!=s.audioPath&&(s.volume=this.getValue(e,"volume",1),s.balance=this.getValue(e,"balance",0)),r.events.push(s)}if(n.animations)for(const t in n.animations){const e=n.animations[t];this.readAnimation(e,t,r)}return r}readAttachment(t,e,r,n,s){const i=this.scale;switch(n=this.getValue(t,"name",n),this.getValue(t,"type","region")){case"region":{const r=this.getValue(t,"path",n),s=this.attachmentLoader.newRegionAttachment(e,n,r);if(null==s)return null;s.path=r,s.x=this.getValue(t,"x",0)*i,s.y=this.getValue(t,"y",0)*i,s.scaleX=this.getValue(t,"scaleX",1),s.scaleY=this.getValue(t,"scaleY",1),s.rotation=this.getValue(t,"rotation",0),s.width=t.width*i,s.height=t.height*i;const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}case"boundingbox":{const r=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(null==r)return null;this.readVertices(t,r,t.vertexCount<<1);const s=this.getValue(t,"color",null);return null!=s&&r.color.setFromString(s),r}case"mesh":case"linkedmesh":{const s=this.getValue(t,"path",n),i=this.attachmentLoader.newMeshAttachment(e,n,s);if(null==i)return null;i.path=s;const o=this.getValue(t,"color",null);null!=o&&i.color.setFromString(o);const a=this.getValue(t,"parent",null);if(null!=a)return i.inheritDeform=this.getValue(t,"deform",!0),this.linkedMeshes.push(new Bu(i,this.getValue(t,"skin",null),r,a)),i;const h=t.uvs;return this.readVertices(t,i,h.length),i.triangles=t.triangles,i.regionUVs=new Float32Array(h),i.hullLength=2*this.getValue(t,"hull",0),i}case"path":{const r=this.attachmentLoader.newPathAttachment(e,n);if(null==r)return null;r.closed=this.getValue(t,"closed",!1),r.constantSpeed=this.getValue(t,"constantSpeed",!0);const s=t.vertexCount;this.readVertices(t,r,s<<1);const o=kh.newArray(s/3,0);for(let e=0;e<t.lengths.length;e++)o[e]=t.lengths[e]*i;r.lengths=o;const a=this.getValue(t,"color",null);return null!=a&&r.color.setFromString(a),r}case"point":{const r=this.attachmentLoader.newPointAttachment(e,n);if(null==r)return null;r.x=this.getValue(t,"x",0)*i,r.y=this.getValue(t,"y",0)*i,r.rotation=this.getValue(t,"rotation",0);const s=this.getValue(t,"color",null);return null!=s&&r.color.setFromString(s),r}case"clipping":{const r=this.attachmentLoader.newClippingAttachment(e,n);if(null==r)return null;const i=this.getValue(t,"end",null);if(null!=i){const t=s.findSlot(i);if(null==t)throw new Error(`Clipping end slot not found: ${i}`);r.endSlot=t}const o=t.vertexCount;this.readVertices(t,r,o<<1);const a=this.getValue(t,"color",null);return null!=a&&r.color.setFromString(a),r}}return null}readVertices(t,e,r){const n=this.scale;e.worldVerticesLength=r;const s=t.vertices;if(r==s.length){const t=kh.toFloatArray(s);if(1!=n)for(let e=0,r=s.length;e<r;e++)t[e]*=n;return void(e.vertices=t)}const i=new Array,o=new Array;for(let t=0,e=s.length;t<e;){const e=s[t++];o.push(e);for(let r=t+4*e;t<r;t+=4)o.push(s[t]),i.push(s[t+1]*n),i.push(s[t+2]*n),i.push(s[t+3])}e.bones=o,e.vertices=kh.toFloatArray(i)}readAnimation(t,e,r){const n=this.scale,s=new Array;let i=0;if(t.slots)for(const e in t.slots){const n=t.slots[e],o=r.findSlotIndex(e);if(-1==o)throw new Error(`Slot not found: ${e}`);for(const t in n){const r=n[t];if("attachment"==t){const t=new Hc(r.length);t.slotIndex=o;let e=0;for(let n=0;n<r.length;n++){const s=r[n];t.setFrame(e++,s.time,s.name)}s.push(t),i=Math.max(i,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new Yc(r.length);t.slotIndex=o;let e=0;for(let n=0;n<r.length;n++){const s=r[n],i=new Ah;i.setFromString(s.color||"ffffffff"),t.setFrame(e,s.time,i.r,i.g,i.b,i.a),this.readCurve(s,t,e),e++}s.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*Yc.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${e})`);{const t=new Wc(r.length);t.slotIndex=o;let e=0;for(let n=0;n<r.length;n++){const s=r[n],i=new Ah,o=new Ah;i.setFromString(s.light),o.setFromString(s.dark),t.setFrame(e,s.time,i.r,i.g,i.b,i.a,o.r,o.g,o.b),this.readCurve(s,t,e),e++}s.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*Wc.ENTRIES])}}}}if(t.bones)for(const e in t.bones){const o=t.bones[e],a=r.findBoneIndex(e);if(-1==a)throw new Error(`Bone not found: ${e}`);for(const t in o){const r=o[t];if("rotate"===t){const t=new Dc(r.length);t.boneIndex=a;let e=0;for(let n=0;n<r.length;n++){const s=r[n];t.setFrame(e,s.time,s.angle),this.readCurve(s,t,e),e++}s.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*Dc.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${e})`);{let e=null,o=1;"scale"===t?e=new Uc(r.length):"shear"===t?e=new Xc(r.length):(e=new Vc(r.length),o=n),e.boneIndex=a;let h=0;for(let t=0;t<r.length;t++){const n=r[t],s=this.getValue(n,"x",0),i=this.getValue(n,"y",0);e.setFrame(h,n.time,s*o,i*o),this.readCurve(n,e,h),h++}s.push(e),i=Math.max(i,e.frames[(e.getFrameCount()-1)*Vc.ENTRIES])}}}}if(t.ik)for(const e in t.ik){const n=t.ik[e],o=r.findIkConstraint(e),a=new Qc(n.length);a.ikConstraintIndex=r.ikConstraints.indexOf(o);let h=0;for(let t=0;t<n.length;t++){const e=n[t];a.setFrame(h,e.time,this.getValue(e,"mix",1),this.getValue(e,"bendPositive",!0)?1:-1,this.getValue(e,"compress",!1),this.getValue(e,"stretch",!1)),this.readCurve(e,a,h),h++}s.push(a),i=Math.max(i,a.frames[(a.getFrameCount()-1)*Qc.ENTRIES])}if(t.transform)for(const e in t.transform){const n=t.transform[e],o=r.findTransformConstraint(e),a=new tu(n.length);a.transformConstraintIndex=r.transformConstraints.indexOf(o);let h=0;for(let t=0;t<n.length;t++){const e=n[t];a.setFrame(h,e.time,this.getValue(e,"rotateMix",1),this.getValue(e,"translateMix",1),this.getValue(e,"scaleMix",1),this.getValue(e,"shearMix",1)),this.readCurve(e,a,h),h++}s.push(a),i=Math.max(i,a.frames[(a.getFrameCount()-1)*tu.ENTRIES])}if(t.paths)for(const e in t.paths){const o=t.paths[e],a=r.findPathConstraintIndex(e);if(-1==a)throw new Error(`Path constraint not found: ${e}`);const h=r.pathConstraints[a];for(const t in o){const e=o[t];if("position"===t||"spacing"===t){let r=null,o=1;"spacing"===t?(r=new nu(e.length),h.spacingMode!=Tu.Length&&h.spacingMode!=Tu.Fixed||(o=n)):(r=new ru(e.length),h.positionMode==ch.Fixed&&(o=n)),r.pathConstraintIndex=a;let l=0;for(let n=0;n<e.length;n++){const s=e[n];r.setFrame(l,s.time,this.getValue(s,t,0)*o),this.readCurve(s,r,l),l++}s.push(r),i=Math.max(i,r.frames[(r.getFrameCount()-1)*ru.ENTRIES])}else if("mix"===t){const t=new iu(e.length);t.pathConstraintIndex=a;let r=0;for(let n=0;n<e.length;n++){const s=e[n];t.setFrame(r,s.time,this.getValue(s,"rotateMix",1),this.getValue(s,"translateMix",1)),this.readCurve(s,t,r),r++}s.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*iu.ENTRIES])}}}if(t.deform)for(const e in t.deform){const o=t.deform[e],a=r.findSkin(e);if(null!=a)for(const t in o){const e=o[t],h=r.findSlotIndex(t);if(-1==h)throw new Error(`Slot not found: ${e.name}`);for(const t in e){const r=e[t],o=a.getAttachment(h,t);if(null==o)throw new Error(`Deform attachment not found: ${r.name}`);const l=null!=o.bones,c=o.vertices,u=l?c.length/3*2:c.length,d=new zc(r.length);d.slotIndex=h,d.attachment=o;let f=0;for(let t=0;t<r.length;t++){const e=r[t];let s;const i=this.getValue(e,"vertices",null);if(null==i)s=l?kh.newFloatArray(u):c;else{s=kh.newFloatArray(u);const t=this.getValue(e,"offset",0);if(kh.arrayCopy(i,0,s,t,i.length),1!=n)for(let e=t,r=e+i.length;e<r;e++)s[e]*=n;if(!l)for(let t=0;t<u;t++)s[t]+=c[t]}d.setFrame(f,e.time,s),this.readCurve(e,d,f),f++}s.push(d),i=Math.max(i,d.frames[d.getFrameCount()-1])}}else Bh}let o=t.drawOrder;if(null==o&&(o=t.draworder),null!=o){const t=new Kc(o.length),e=r.slots.length;let n=0;for(let s=0;s<o.length;s++){const i=o[s];let a=null;const h=this.getValue(i,"offsets",null);if(null!=h){a=kh.newArray(e,-1);const t=kh.newArray(e-h.length,0);let n=0,s=0;for(let e=0;e<h.length;e++){const i=h[e],o=r.findSlotIndex(i.slot);if(-1==o)throw new Error(`Slot not found: ${i.slot}`);for(;n!=o;)t[s++]=n++;a[n+i.offset]=n++}for(;n<e;)t[s++]=n++;for(let r=e-1;r>=0;r--)-1==a[r]&&(a[r]=t[--s])}t.setFrame(n++,i.time,a)}s.push(t),i=Math.max(i,t.frames[t.getFrameCount()-1])}if(t.events){const e=new qc(t.events.length);let n=0;for(let s=0;s<t.events.length;s++){const i=t.events[s],o=r.findEvent(i.name);if(null==o)throw new Error(`Event not found: ${i.name}`);const a=new xu(kh.toSinglePrecision(i.time),o);a.intValue=this.getValue(i,"int",o.intValue),a.floatValue=this.getValue(i,"float",o.floatValue),a.stringValue=this.getValue(i,"string",o.stringValue),null!=a.data.audioPath&&(a.volume=this.getValue(i,"volume",1),a.balance=this.getValue(i,"balance",0)),e.setFrame(n++,a)}s.push(e),i=Math.max(i,e.frames[e.getFrameCount()-1])}if(isNaN(i))throw new Error("Error while parsing animation, duration is NaN");r.animations.push(new kc(e,s,i))}readCurve(t,e,r){if(t.curve)if("stepped"===t.curve)e.setStepped(r);else if("[object Array]"===Object.prototype.toString.call(t.curve)){const n=t.curve;e.setCurve(r,n[0],n[1],n[2],n[3])}}getValue(t,e,r){return void 0!==t[e]?t[e]:r}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return v.NORMAL;if("additive"==t)return v.ADD;if("multiply"==t)return v.MULTIPLY;if("screen"==t)return v.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return ch.Fixed;if("percent"==t)return ch.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return Tu.Length;if("fixed"==t)return Tu.Fixed;if("percent"==t)return Tu.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return uh.Tangent;if("chain"==t)return uh.Chain;if("chainscale"==t)return uh.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return dh.Normal;if("onlytranslation"==t)return dh.OnlyTranslation;if("norotationorreflection"==t)return dh.NoRotationOrReflection;if("noscale"==t)return dh.NoScale;if("noscaleorreflection"==t)return dh.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}}class Bu{constructor(t,e,r,n){this.mesh=t,this.skin=e,this.slotIndex=r,this.parent=n}}class Du extends Xh{createSkeleton(t){this.skeleton=new Mu(t),this.skeleton.updateWorldTransform(),this.stateData=new mu(t),this.state=new au(this.stateData)}}class Lu{constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}const Vu=class extends Lu{constructor(t){super(t),this.id=Vu.nextID++,this.bones=null,this.vertices=[],this.worldVerticesLength=0,this.timelineAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,r,n,s,i){r=s+(r>>1)*i;const o=t.bone.skeleton,a=t.deform;let h=this.vertices;const l=this.bones;if(!l){a.length>0&&(h=a);const o=t.bone.matrix,l=o.tx,c=o.ty,u=o.a,d=o.c,f=o.b,p=o.d;for(let t=e,o=s;o<r;t+=2,o+=i){const e=h[t],r=h[t+1];n[o]=e*u+r*d+l,n[o+1]=e*f+r*p+c}return}let c=0,u=0;for(let t=0;t<e;t+=2){const t=l[c];c+=t+1,u+=t}const d=o.bones;if(0==a.length)for(let t=s,e=3*u;t<r;t+=i){let r=0,s=0,i=l[c++];for(i+=c;c<i;c++,e+=3){const t=d[l[c]].matrix,n=h[e],i=h[e+1],o=h[e+2];r+=(n*t.a+i*t.c+t.tx)*o,s+=(n*t.b+i*t.d+t.ty)*o}n[t]=r,n[t+1]=s}else{const t=a;for(let e=s,o=3*u,a=u<<1;e<r;e+=i){let r=0,s=0,i=l[c++];for(i+=c;c<i;c++,o+=3,a+=2){const e=d[l[c]].matrix,n=h[o]+t[a],i=h[o+1]+t[a+1],u=h[o+2];r+=(n*e.a+i*e.c+e.tx)*u,s+=(n*e.b+i*e.d+e.ty)*u}n[e]=r,n[e+1]=s}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),kh.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices&&(t.vertices=kh.newFloatArray(this.vertices.length),kh.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)),t.worldVerticesLength=this.worldVerticesLength,t.timelineAttachment=this.timelineAttachment}};let Uu=Vu;Uu.nextID=0;class Xu extends Uu{constructor(t){super(t),this.type=oh.BoundingBox,this.color=new Ah(1,1,1,1)}copy(){const t=new Xu(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class ju extends Uu{constructor(t){super(t),this.type=oh.Clipping,this.endSlot=null,this.color=new Ah(.2275,.2275,.8078,1)}copy(){const t=new ju(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class Yu extends Uu{constructor(t,e){super(t),this.type=oh.Mesh,this.region=null,this.triangles=[],this.color=new Ah(1,1,1,1),this.width=0,this.height=0,this.hullLength=0,this.edges=[],this.parentMesh=null,this.sequence=null,this.tempColor=new Ah(0,0,0,0),this.path=e}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();const t=new Yu(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),kh.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),kh.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=null!=this.sequence?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),kh.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,e,r,n,s,i){null!=this.sequence&&this.sequence.apply(t,this),super.computeWorldVertices(t,e,r,n,s,i)}newLinkedMesh(){const t=new Yu(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),t}}class Gu extends Uu{constructor(t){super(t),this.type=oh.Path,this.lengths=[],this.closed=!1,this.constantSpeed=!1,this.color=new Ah(1,1,1,1)}copy(){const t=new Gu(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),kh.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class Wu extends Uu{constructor(t){super(t),this.type=oh.Point,this.x=0,this.y=0,this.rotation=0,this.color=new Ah(.38,.94,0,1)}computeWorldPosition(t,e){const r=t.matrix;return e.x=this.x*r.a+this.y*r.c+t.worldX,e.y=this.x*r.b+this.y*r.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,r=Rh.cosDeg(this.rotation),n=Rh.sinDeg(this.rotation),s=r*e.a+n*e.c,i=r*e.b+n*e.d;return Math.atan2(i,s)*Rh.radDeg}copy(){const t=new Wu(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}const Hu=class extends Lu{constructor(t,e){super(t),this.type=oh.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Ah(1,1,1,1),this.rendererObject=null,this.region=null,this.sequence=null,this.offset=kh.newFloatArray(8),this.uvs=kh.newFloatArray(8),this.tempColor=new Ah(1,1,1,1),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");const t=this.region,e=this.width/this.region.originalWidth*this.scaleX,r=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*e,s=-this.height/2*this.scaleY+this.region.offsetY*r,i=n+this.region.width*e,o=s+this.region.height*r,a=this.rotation*Math.PI/180,h=Math.cos(a),l=Math.sin(a),c=this.x,u=this.y,d=n*h+c,f=n*l,p=s*h+u,m=s*l,g=i*h+c,y=i*l,b=o*h+u,x=o*l,_=this.offset;_[0]=d-m,_[1]=p+f,_[2]=d-x,_[3]=b+f,_[4]=g-x,_[5]=b+y,_[6]=g-m,_[7]=p+y;const v=this.uvs;90==t.degrees?(v[2]=t.u,v[3]=t.v2,v[4]=t.u,v[5]=t.v,v[6]=t.u2,v[7]=t.v,v[0]=t.u2,v[1]=t.v2):(v[0]=t.u,v[1]=t.v2,v[2]=t.u,v[3]=t.v,v[4]=t.u2,v[5]=t.v,v[6]=t.u2,v[7]=t.v2)}computeWorldVertices(t,e,r,n){null!=this.sequence&&this.sequence.apply(t,this);const s=t.bone,i=this.offset,o=s.matrix,a=o.tx,h=o.ty,l=o.a,c=o.c,u=o.b,d=o.d;let f=0,p=0;f=i[0],p=i[1],e[r]=f*l+p*c+a,e[r+1]=f*u+p*d+h,r+=n,f=i[2],p=i[3],e[r]=f*l+p*c+a,e[r+1]=f*u+p*d+h,r+=n,f=i[4],p=i[5],e[r]=f*l+p*c+a,e[r+1]=f*u+p*d+h,r+=n,f=i[6],p=i[7],e[r]=f*l+p*c+a,e[r+1]=f*u+p*d+h}copy(){const t=new Hu(this.name,this.path);return t.region=this.region,t.rendererObject=this.rendererObject,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,kh.arrayCopy(this.uvs,0,t.uvs,0,8),kh.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t.sequence=null!=this.sequence?this.sequence.copy():null,t}};let $u=Hu;$u.X1=0,$u.Y1=1,$u.C1R=2,$u.C1G=3,$u.C1B=4,$u.C1A=5,$u.U1=6,$u.V1=7,$u.X2=8,$u.Y2=9,$u.C2R=10,$u.C2G=11,$u.C2B=12,$u.C2A=13,$u.U2=14,$u.V2=15,$u.X3=16,$u.Y3=17,$u.C3R=18,$u.C3G=19,$u.C3B=20,$u.C3A=21,$u.U3=22,$u.V3=23,$u.X4=24,$u.Y4=25,$u.C4R=26,$u.C4G=27,$u.C4B=28,$u.C4A=29,$u.U4=30,$u.V4=31;const zu=class{constructor(t){this.id=zu.nextID(),this.start=0,this.digits=0,this.setupIndex=0,this.regions=new Array(t)}copy(){const t=new zu(this.regions.length);return kh.arrayCopy(this.regions,0,t.regions,0,this.regions.length),t.start=this.start,t.digits=this.digits,t.setupIndex=this.setupIndex,t}apply(t,e){let r=t.sequenceIndex;-1==r&&(r=this.setupIndex),r>=this.regions.length&&(r=this.regions.length-1);const n=this.regions[r];e.region!=n&&(e.region=n)}getPath(t,e){let r=t;const n=(this.start+e).toString();for(let t=this.digits-n.length;t>0;t--)r+="0";return r+=n,r}static nextID(){return zu._nextID++}};let qu=zu;qu._nextID=0;var Ku=(t=>(t[t.hold=0]="hold",t[t.once=1]="once",t[t.loop=2]="loop",t[t.pingpong=3]="pingpong",t[t.onceReverse=4]="onceReverse",t[t.loopReverse=5]="loopReverse",t[t.pingpongReverse=6]="pingpongReverse",t))(Ku||{});const Zu=[0,1,2,3,4,5,6];class Qu{constructor(t,e,r){if(this.timelines=[],this.timelineIds=new Eh,!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=r}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(let e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,r,n,s,i,o,a){if(!t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(r%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let n=0,l=h.length;n<l;n++)h[n].apply(t,e,r,s,i,o,a)}}class Ju{constructor(t,e){this.propertyIds=e,this.frames=kh.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){const r=t.length;for(let n=1;n<r;n++)if(t[n]>e)return n-1;return r-1}static search(t,e,r){const n=t.length;for(let s=r;s<n;s+=r)if(t[s]>e)return s-r;return n-r}}class td extends Ju{constructor(t,e,r){super(t,r),this.curves=kh.newFloatArray(t+18*e),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){const e=this.getFrameCount()+18*t;if(this.curves.length>e){const t=kh.newFloatArray(e);kh.arrayCopy(this.curves,0,t,0,e),this.curves=t}}setBezier(t,e,r,n,s,i,o,a,h,l,c){const u=this.curves;let d=this.getFrameCount()+18*t;0==r&&(u[e]=2+d);const f=.03*(n-2*i+a),p=.03*(s-2*o+h),m=.006*(3*(i-a)-n+l),g=.006*(3*(o-h)-s+c);let y=2*f+m,b=2*p+g,x=.3*(i-n)+f+.16666667*m,_=.3*(o-s)+p+.16666667*g,v=n+x,w=s+_;for(let t=d+18;d<t;d+=2)u[d]=v,u[d+1]=w,x+=y,_+=b,y+=m,b+=g,v+=x,w+=_}getBezierValue(t,e,r,n){const s=this.curves;if(s[n]>t){const i=this.frames[e],o=this.frames[e+r];return o+(t-i)/(s[n]-i)*(s[n+1]-o)}const i=n+18;for(n+=2;n<i;n+=2)if(s[n]>=t){const e=s[n-2],r=s[n-1];return r+(t-e)/(s[n]-e)*(s[n+1]-r)}e+=this.getFrameEntries();const o=s[i-2],a=s[i-1];return a+(t-o)/(this.frames[e]-o)*(this.frames[e+r]-a)}}class ed extends td{constructor(t,e,r){super(t,e,[r])}getFrameEntries(){return 2}setFrame(t,e,r){t<<=1,this.frames[t]=e,this.frames[t+1]=r}getCurveValue(t){const e=this.frames;let r=e.length-2;for(let n=2;n<=r;n+=2)if(e[n]>t){r=n-2;break}const n=this.curves[r>>1];switch(n){case 0:const n=e[r],s=e[r+1];return s+(t-n)/(e[r+2]-n)*(e[r+2+1]-s);case 1:return e[r+1]}return this.getBezierValue(t,r,1,n-2)}}class rd extends td{constructor(t,e,r,n){super(t,e,[r,n])}getFrameEntries(){return 3}setFrame(t,e,r,n){t*=3,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n}}class nd extends ed{constructor(t,e,r){super(t,e,`0|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(r<this.frames[0]){switch(i){case hh.setup:return void(a.rotation=a.data.rotation);case hh.first:a.rotation+=(a.data.rotation-a.rotation)*s}return}let h=this.getCurveValue(r);switch(i){case hh.setup:a.rotation=a.data.rotation+h*s;break;case hh.first:case hh.replace:h+=a.data.rotation-a.rotation;case hh.add:a.rotation+=h*s}}}class sd extends rd{constructor(t,e,r){super(t,e,`1|${r}`,`2|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;const h=this.frames;if(r<h[0]){switch(i){case hh.setup:return a.x=a.data.x,void(a.y=a.data.y);case hh.first:a.x+=(a.data.x-a.x)*s,a.y+=(a.data.y-a.y)*s}return}let l=0,c=0;const u=Ju.search(h,r,3),d=this.curves[u/3];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(r-t)/(h[u+3]-t);l+=(h[u+3+1]-l)*e,c+=(h[u+3+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(r,u,1,d-2),c=this.getBezierValue(r,u,2,d+18-2)}switch(i){case hh.setup:a.x=a.data.x+l*s,a.y=a.data.y+c*s;break;case hh.first:case hh.replace:a.x+=(a.data.x+l-a.x)*s,a.y+=(a.data.y+c-a.y)*s;break;case hh.add:a.x+=l*s,a.y+=c*s}}}class id extends ed{constructor(t,e,r){super(t,e,`1|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(r<this.frames[0]){switch(i){case hh.setup:return void(a.x=a.data.x);case hh.first:a.x+=(a.data.x-a.x)*s}return}const h=this.getCurveValue(r);switch(i){case hh.setup:a.x=a.data.x+h*s;break;case hh.first:case hh.replace:a.x+=(a.data.x+h-a.x)*s;break;case hh.add:a.x+=h*s}}}class od extends ed{constructor(t,e,r){super(t,e,`2|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(r<this.frames[0]){switch(i){case hh.setup:return void(a.y=a.data.y);case hh.first:a.y+=(a.data.y-a.y)*s}return}const h=this.getCurveValue(r);switch(i){case hh.setup:a.y=a.data.y+h*s;break;case hh.first:case hh.replace:a.y+=(a.data.y+h-a.y)*s;break;case hh.add:a.y+=h*s}}}class ad extends rd{constructor(t,e,r){super(t,e,`3|${r}`,`4|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;const h=this.frames;if(r<h[0]){switch(i){case hh.setup:return a.scaleX=a.data.scaleX,void(a.scaleY=a.data.scaleY);case hh.first:a.scaleX+=(a.data.scaleX-a.scaleX)*s,a.scaleY+=(a.data.scaleY-a.scaleY)*s}return}let l,c;const u=Ju.search(h,r,3),d=this.curves[u/3];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(r-t)/(h[u+3]-t);l+=(h[u+3+1]-l)*e,c+=(h[u+3+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(r,u,1,d-2),c=this.getBezierValue(r,u,2,d+18-2)}if(l*=a.data.scaleX,c*=a.data.scaleY,1==s)i==hh.add?(a.scaleX+=l-a.data.scaleX,a.scaleY+=c-a.data.scaleY):(a.scaleX=l,a.scaleY=c);else{let t=0,e=0;if(o==lh.mixOut)switch(i){case hh.setup:t=a.data.scaleX,e=a.data.scaleY,a.scaleX=t+(Math.abs(l)*Rh.signum(t)-t)*s,a.scaleY=e+(Math.abs(c)*Rh.signum(e)-e)*s;break;case hh.first:case hh.replace:t=a.scaleX,e=a.scaleY,a.scaleX=t+(Math.abs(l)*Rh.signum(t)-t)*s,a.scaleY=e+(Math.abs(c)*Rh.signum(e)-e)*s;break;case hh.add:a.scaleX+=(l-a.data.scaleX)*s,a.scaleY+=(c-a.data.scaleY)*s}else switch(i){case hh.setup:t=Math.abs(a.data.scaleX)*Rh.signum(l),e=Math.abs(a.data.scaleY)*Rh.signum(c),a.scaleX=t+(l-t)*s,a.scaleY=e+(c-e)*s;break;case hh.first:case hh.replace:t=Math.abs(a.scaleX)*Rh.signum(l),e=Math.abs(a.scaleY)*Rh.signum(c),a.scaleX=t+(l-t)*s,a.scaleY=e+(c-e)*s;break;case hh.add:a.scaleX+=(l-a.data.scaleX)*s,a.scaleY+=(c-a.data.scaleY)*s}}}}class hd extends ed{constructor(t,e,r){super(t,e,`3|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(r<this.frames[0]){switch(i){case hh.setup:return void(a.scaleX=a.data.scaleX);case hh.first:a.scaleX+=(a.data.scaleX-a.scaleX)*s}return}const h=this.getCurveValue(r)*a.data.scaleX;if(1==s)i==hh.add?a.scaleX+=h-a.data.scaleX:a.scaleX=h;else{let t=0;if(o==lh.mixOut)switch(i){case hh.setup:t=a.data.scaleX,a.scaleX=t+(Math.abs(h)*Rh.signum(t)-t)*s;break;case hh.first:case hh.replace:t=a.scaleX,a.scaleX=t+(Math.abs(h)*Rh.signum(t)-t)*s;break;case hh.add:a.scaleX+=(h-a.data.scaleX)*s}else switch(i){case hh.setup:t=Math.abs(a.data.scaleX)*Rh.signum(h),a.scaleX=t+(h-t)*s;break;case hh.first:case hh.replace:t=Math.abs(a.scaleX)*Rh.signum(h),a.scaleX=t+(h-t)*s;break;case hh.add:a.scaleX+=(h-a.data.scaleX)*s}}}}class ld extends ed{constructor(t,e,r){super(t,e,`4|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(r<this.frames[0]){switch(i){case hh.setup:return void(a.scaleY=a.data.scaleY);case hh.first:a.scaleY+=(a.data.scaleY-a.scaleY)*s}return}const h=this.getCurveValue(r)*a.data.scaleY;if(1==s)i==hh.add?a.scaleY+=h-a.data.scaleY:a.scaleY=h;else{let t=0;if(o==lh.mixOut)switch(i){case hh.setup:t=a.data.scaleY,a.scaleY=t+(Math.abs(h)*Rh.signum(t)-t)*s;break;case hh.first:case hh.replace:t=a.scaleY,a.scaleY=t+(Math.abs(h)*Rh.signum(t)-t)*s;break;case hh.add:a.scaleY+=(h-a.data.scaleY)*s}else switch(i){case hh.setup:t=Math.abs(a.data.scaleY)*Rh.signum(h),a.scaleY=t+(h-t)*s;break;case hh.first:case hh.replace:t=Math.abs(a.scaleY)*Rh.signum(h),a.scaleY=t+(h-t)*s;break;case hh.add:a.scaleY+=(h-a.data.scaleY)*s}}}}class cd extends rd{constructor(t,e,r){super(t,e,`5|${r}`,`6|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;const h=this.frames;if(r<h[0]){switch(i){case hh.setup:return a.shearX=a.data.shearX,void(a.shearY=a.data.shearY);case hh.first:a.shearX+=(a.data.shearX-a.shearX)*s,a.shearY+=(a.data.shearY-a.shearY)*s}return}let l=0,c=0;const u=Ju.search(h,r,3),d=this.curves[u/3];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(r-t)/(h[u+3]-t);l+=(h[u+3+1]-l)*e,c+=(h[u+3+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(r,u,1,d-2),c=this.getBezierValue(r,u,2,d+18-2)}switch(i){case hh.setup:a.shearX=a.data.shearX+l*s,a.shearY=a.data.shearY+c*s;break;case hh.first:case hh.replace:a.shearX+=(a.data.shearX+l-a.shearX)*s,a.shearY+=(a.data.shearY+c-a.shearY)*s;break;case hh.add:a.shearX+=l*s,a.shearY+=c*s}}}class ud extends ed{constructor(t,e,r){super(t,e,`5|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(r<this.frames[0]){switch(i){case hh.setup:return void(a.shearX=a.data.shearX);case hh.first:a.shearX+=(a.data.shearX-a.shearX)*s}return}const h=this.getCurveValue(r);switch(i){case hh.setup:a.shearX=a.data.shearX+h*s;break;case hh.first:case hh.replace:a.shearX+=(a.data.shearX+h-a.shearX)*s;break;case hh.add:a.shearX+=h*s}}}class dd extends ed{constructor(t,e,r){super(t,e,`6|${r}`),this.boneIndex=0,this.boneIndex=r}apply(t,e,r,n,s,i,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(r<this.frames[0]){switch(i){case hh.setup:return void(a.shearY=a.data.shearY);case hh.first:a.shearY+=(a.data.shearY-a.shearY)*s}return}const h=this.getCurveValue(r);switch(i){case hh.setup:a.shearY=a.data.shearY+h*s;break;case hh.first:case hh.replace:a.shearY+=(a.data.shearY+h-a.shearY)*s;break;case hh.add:a.shearY+=h*s}}}class fd extends td{constructor(t,e,r){super(t,e,[`7|${r}`,`8|${r}`]),this.slotIndex=0,this.slotIndex=r}getFrameEntries(){return 5}setFrame(t,e,r,n,s,i){t*=5,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n,this.frames[t+3]=s,this.frames[t+4]=i}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=this.frames,l=a.color;if(r<h[0]){const t=a.data.color;switch(i){case hh.setup:return void l.setFromColor(t);case hh.first:l.add((t.r-l.r)*s,(t.g-l.g)*s,(t.b-l.b)*s,(t.a-l.a)*s)}return}let c=0,u=0,d=0,f=0;const p=Ju.search(h,r,5),m=this.curves[p/5];switch(m){case 0:const t=h[p];c=h[p+1],u=h[p+2],d=h[p+3],f=h[p+4];const e=(r-t)/(h[p+5]-t);c+=(h[p+5+1]-c)*e,u+=(h[p+5+2]-u)*e,d+=(h[p+5+3]-d)*e,f+=(h[p+5+4]-f)*e;break;case 1:c=h[p+1],u=h[p+2],d=h[p+3],f=h[p+4];break;default:c=this.getBezierValue(r,p,1,m-2),u=this.getBezierValue(r,p,2,m+18-2),d=this.getBezierValue(r,p,3,m+36-2),f=this.getBezierValue(r,p,4,m+54-2)}1==s?l.set(c,u,d,f):(i==hh.setup&&l.setFromColor(a.data.color),l.add((c-l.r)*s,(u-l.g)*s,(d-l.b)*s,(f-l.a)*s))}}class pd extends td{constructor(t,e,r){super(t,e,[`7|${r}`]),this.slotIndex=0,this.slotIndex=r}getFrameEntries(){return 4}setFrame(t,e,r,n,s){t<<=2,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n,this.frames[t+3]=s}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=this.frames,l=a.color;if(r<h[0]){const t=a.data.color;switch(i){case hh.setup:return l.r=t.r,l.g=t.g,void(l.b=t.b);case hh.first:l.r+=(t.r-l.r)*s,l.g+=(t.g-l.g)*s,l.b+=(t.b-l.b)*s}return}let c=0,u=0,d=0;const f=Ju.search(h,r,4),p=this.curves[f>>2];switch(p){case 0:const t=h[f];c=h[f+1],u=h[f+2],d=h[f+3];const e=(r-t)/(h[f+4]-t);c+=(h[f+4+1]-c)*e,u+=(h[f+4+2]-u)*e,d+=(h[f+4+3]-d)*e;break;case 1:c=h[f+1],u=h[f+2],d=h[f+3];break;default:c=this.getBezierValue(r,f,1,p-2),u=this.getBezierValue(r,f,2,p+18-2),d=this.getBezierValue(r,f,3,p+36-2)}if(1==s)l.r=c,l.g=u,l.b=d;else{if(i==hh.setup){const t=a.data.color;l.r=t.r,l.g=t.g,l.b=t.b}l.r+=(c-l.r)*s,l.g+=(u-l.g)*s,l.b+=(d-l.b)*s}}}class md extends ed{constructor(t,e,r){super(t,e,`8|${r}`),this.slotIndex=0,this.slotIndex=r}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=a.color;if(r<this.frames[0]){const t=a.data.color;switch(i){case hh.setup:return void(h.a=t.a);case hh.first:h.a+=(t.a-h.a)*s}return}const l=this.getCurveValue(r);1==s?h.a=l:(i==hh.setup&&(h.a=a.data.color.a),h.a+=(l-h.a)*s)}}class gd extends td{constructor(t,e,r){super(t,e,[`7|${r}`,`8|${r}`,`9|${r}`]),this.slotIndex=0,this.slotIndex=r}getFrameEntries(){return 8}setFrame(t,e,r,n,s,i,o,a,h){t<<=3,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n,this.frames[t+3]=s,this.frames[t+4]=i,this.frames[t+5]=o,this.frames[t+6]=a,this.frames[t+7]=h}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=this.frames,l=a.color,c=a.darkColor;if(r<h[0]){const t=a.data.color,e=a.data.darkColor;switch(i){case hh.setup:return l.setFromColor(t),c.r=e.r,c.g=e.g,void(c.b=e.b);case hh.first:l.add((t.r-l.r)*s,(t.g-l.g)*s,(t.b-l.b)*s,(t.a-l.a)*s),c.r+=(e.r-c.r)*s,c.g+=(e.g-c.g)*s,c.b+=(e.b-c.b)*s}return}let u=0,d=0,f=0,p=0,m=0,g=0,y=0;const b=Ju.search(h,r,8),x=this.curves[b>>3];switch(x){case 0:const t=h[b];u=h[b+1],d=h[b+2],f=h[b+3],p=h[b+4],m=h[b+5],g=h[b+6],y=h[b+7];const e=(r-t)/(h[b+8]-t);u+=(h[b+8+1]-u)*e,d+=(h[b+8+2]-d)*e,f+=(h[b+8+3]-f)*e,p+=(h[b+8+4]-p)*e,m+=(h[b+8+5]-m)*e,g+=(h[b+8+6]-g)*e,y+=(h[b+8+7]-y)*e;break;case 1:u=h[b+1],d=h[b+2],f=h[b+3],p=h[b+4],m=h[b+5],g=h[b+6],y=h[b+7];break;default:u=this.getBezierValue(r,b,1,x-2),d=this.getBezierValue(r,b,2,x+18-2),f=this.getBezierValue(r,b,3,x+36-2),p=this.getBezierValue(r,b,4,x+54-2),m=this.getBezierValue(r,b,5,x+72-2),g=this.getBezierValue(r,b,6,x+90-2),y=this.getBezierValue(r,b,7,x+108-2)}if(1==s)l.set(u,d,f,p),c.r=m,c.g=g,c.b=y;else{if(i==hh.setup){l.setFromColor(a.data.color);const t=a.data.darkColor;c.r=t.r,c.g=t.g,c.b=t.b}l.add((u-l.r)*s,(d-l.g)*s,(f-l.b)*s,(p-l.a)*s),c.r+=(m-c.r)*s,c.g+=(g-c.g)*s,c.b+=(y-c.b)*s}}}class yd extends td{constructor(t,e,r){super(t,e,[`7|${r}`,`9|${r}`]),this.slotIndex=0,this.slotIndex=r}getFrameEntries(){return 7}setFrame(t,e,r,n,s,i,o,a){t*=7,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n,this.frames[t+3]=s,this.frames[t+4]=i,this.frames[t+5]=o,this.frames[t+6]=a}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=this.frames,l=a.color,c=a.darkColor;if(r<h[0]){const t=a.data.color,e=a.data.darkColor;switch(i){case hh.setup:return l.r=t.r,l.g=t.g,l.b=t.b,c.r=e.r,c.g=e.g,void(c.b=e.b);case hh.first:l.r+=(t.r-l.r)*s,l.g+=(t.g-l.g)*s,l.b+=(t.b-l.b)*s,c.r+=(e.r-c.r)*s,c.g+=(e.g-c.g)*s,c.b+=(e.b-c.b)*s}return}let u=0,d=0,f=0,p=0,m=0,g=0;const y=Ju.search(h,r,7),b=this.curves[y/7];switch(b){case 0:const t=h[y];u=h[y+1],d=h[y+2],f=h[y+3],p=h[y+4],m=h[y+5],g=h[y+6];const e=(r-t)/(h[y+7]-t);u+=(h[y+7+1]-u)*e,d+=(h[y+7+2]-d)*e,f+=(h[y+7+3]-f)*e,p+=(h[y+7+4]-p)*e,m+=(h[y+7+5]-m)*e,g+=(h[y+7+6]-g)*e;break;case 1:u=h[y+1],d=h[y+2],f=h[y+3],p=h[y+4],m=h[y+5],g=h[y+6];break;default:u=this.getBezierValue(r,y,1,b-2),d=this.getBezierValue(r,y,2,b+18-2),f=this.getBezierValue(r,y,3,b+36-2),p=this.getBezierValue(r,y,4,b+54-2),m=this.getBezierValue(r,y,5,b+72-2),g=this.getBezierValue(r,y,6,b+90-2)}if(1==s)l.r=u,l.g=d,l.b=f,c.r=p,c.g=m,c.b=g;else{if(i==hh.setup){const t=a.data.color,e=a.data.darkColor;l.r=t.r,l.g=t.g,l.b=t.b,c.r=e.r,c.g=e.g,c.b=e.b}l.r+=(u-l.r)*s,l.g+=(d-l.g)*s,l.b+=(f-l.b)*s,c.r+=(p-c.r)*s,c.g+=(m-c.g)*s,c.b+=(g-c.b)*s}}}class bd extends Ju{constructor(t,e){super(t,[`10|${e}`]),this.slotIndex=0,this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,r){this.frames[t]=e,this.attachmentNames[t]=r}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];a.bone.active&&(o!=lh.mixOut?r<this.frames[0]?i!=hh.setup&&i!=hh.first||this.setAttachment(t,a,a.data.attachmentName):this.setAttachment(t,a,this.attachmentNames[Ju.search1(this.frames,r)]):i==hh.setup&&this.setAttachment(t,a,a.data.attachmentName))}setAttachment(t,e,r){e.setAttachment(r?t.getAttachment(this.slotIndex,r):null)}}class xd extends td{constructor(t,e,r,n){super(t,e,[`11|${r}|${n.id}`]),this.slotIndex=0,this.slotIndex=r,this.attachment=n,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,r){this.frames[t]=e,this.vertices[t]=r}setBezier(t,e,r,n,s,i,o,a,h,l,c){const u=this.curves;let d=this.getFrameCount()+18*t;0==r&&(u[e]=2+d);const f=.03*(n-2*i+a),p=.03*h-.06*o,m=.006*(3*(i-a)-n+l),g=.018*(o-h+.33333333);let y=2*f+m,b=2*p+g,x=.3*(i-n)+f+.16666667*m,_=.3*o+p+.16666667*g,v=n+x,w=_;for(let t=d+18;d<t;d+=2)u[d]=v,u[d+1]=w,x+=y,_+=b,y+=m,b+=g,v+=x,w+=_}getCurvePercent(t,e){const r=this.curves;let n=r[e];switch(n){case 0:const r=this.frames[e];return(t-r)/(this.frames[e+this.getFrameEntries()]-r);case 1:return 0}if(n-=2,r[n]>t){const s=this.frames[e];return r[n+1]*(t-s)/(r[n]-s)}const s=n+18;for(n+=2;n<s;n+=2)if(r[n]>=t){const e=r[n-2],s=r[n-1];return s+(t-e)/(r[n]-e)*(r[n+1]-s)}const i=r[s-2],o=r[s-1];return o+(1-o)*(t-i)/(this.frames[e+this.getFrameEntries()]-i)}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=a.getAttachment();if(!h)return;if(!(h instanceof Uu)||h.timelineAttachment!=this.attachment)return;const l=a.deform;0==l.length&&(i=hh.setup);const c=this.vertices,u=c[0].length,d=this.frames;if(r<d[0]){switch(i){case hh.setup:return void(l.length=0);case hh.first:if(1==s)return void(l.length=0);l.length=u;const t=h;if(t.bones){s=1-s;for(let t=0;t<u;t++)l[t]*=s}else{const e=t.vertices;for(let t=0;t<u;t++)l[t]+=(e[t]-l[t])*s}}return}if(l.length=u,r>=d[d.length-1]){const t=c[d.length-1];if(1==s)if(i==hh.add){const e=h;if(e.bones)for(let e=0;e<u;e++)l[e]+=t[e];else{const r=e.vertices;for(let e=0;e<u;e++)l[e]+=t[e]-r[e]}}else kh.arrayCopy(t,0,l,0,u);else switch(i){case hh.setup:{const e=h;if(e.bones)for(let e=0;e<u;e++)l[e]=t[e]*s;else{const r=e.vertices;for(let e=0;e<u;e++){const n=r[e];l[e]=n+(t[e]-n)*s}}break}case hh.first:case hh.replace:for(let e=0;e<u;e++)l[e]+=(t[e]-l[e])*s;break;case hh.add:const e=h;if(e.bones)for(let e=0;e<u;e++)l[e]+=t[e]*s;else{const r=e.vertices;for(let e=0;e<u;e++)l[e]+=(t[e]-r[e])*s}}return}const f=Ju.search1(d,r),p=this.getCurvePercent(r,f),m=c[f],g=c[f+1];if(1==s)if(i==hh.add){const t=h;if(t.bones)for(let t=0;t<u;t++){const e=m[t];l[t]+=e+(g[t]-e)*p}else{const e=t.vertices;for(let t=0;t<u;t++){const r=m[t];l[t]+=r+(g[t]-r)*p-e[t]}}}else for(let t=0;t<u;t++){const e=m[t];l[t]=e+(g[t]-e)*p}else switch(i){case hh.setup:{const t=h;if(t.bones)for(let t=0;t<u;t++){const e=m[t];l[t]=(e+(g[t]-e)*p)*s}else{const e=t.vertices;for(let t=0;t<u;t++){const r=m[t],n=e[t];l[t]=n+(r+(g[t]-r)*p-n)*s}}break}case hh.first:case hh.replace:for(let t=0;t<u;t++){const e=m[t];l[t]+=(e+(g[t]-e)*p-l[t])*s}break;case hh.add:const t=h;if(t.bones)for(let t=0;t<u;t++){const e=m[t];l[t]+=(e+(g[t]-e)*p)*s}else{const e=t.vertices;for(let t=0;t<u;t++){const r=m[t];l[t]+=(r+(g[t]-r)*p-e[t])*s}}}}}const _d=class extends Ju{constructor(t){super(t,_d.propertyIds),this.events=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,r,n,s,i,o){if(!n)return;const a=this.frames,h=this.frames.length;if(e>r)this.apply(t,e,Number.MAX_VALUE,n,s,i,o),e=-1;else if(e>=a[h-1])return;if(r<a[0])return;let l=0;if(e<a[0])l=0;else{l=Ju.search1(a,e)+1;const t=a[l];for(;l>0&&a[l-1]==t;)l--}for(;l<h&&r>=a[l];l++)n.push(this.events[l])}};let vd=_d;vd.propertyIds=["12"];const wd=class extends Ju{constructor(t){super(t,wd.propertyIds),this.drawOrders=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,r){this.frames[t]=e,this.drawOrders[t]=r}apply(t,e,r,n,s,i,o){if(o==lh.mixOut)return void(i==hh.setup&&kh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));if(r<this.frames[0])return void(i!=hh.setup&&i!=hh.first||kh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));const a=Ju.search1(this.frames,r),h=this.drawOrders[a];if(h){const e=t.drawOrder,r=t.slots;for(let t=0,n=h.length;t<n;t++)e[t]=r[h[t]]}else kh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}};let Ed=wd;Ed.propertyIds=["13"];class Td extends td{constructor(t,e,r){super(t,e,[`14|${r}`]),this.ikConstraintIndex=0,this.ikConstraintIndex=r}getFrameEntries(){return 6}setFrame(t,e,r,n,s,i,o){t*=6,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n,this.frames[t+3]=s,this.frames[t+4]=i?1:0,this.frames[t+5]=o?1:0}apply(t,e,r,n,s,i,o){const a=t.ikConstraints[this.ikConstraintIndex];if(!a.active)return;const h=this.frames;if(r<h[0]){switch(i){case hh.setup:return a.mix=a.data.mix,a.softness=a.data.softness,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,void(a.stretch=a.data.stretch);case hh.first:a.mix+=(a.data.mix-a.mix)*s,a.softness+=(a.data.softness-a.softness)*s,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch}return}let l=0,c=0;const u=Ju.search(h,r,6),d=this.curves[u/6];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(r-t)/(h[u+6]-t);l+=(h[u+6+1]-l)*e,c+=(h[u+6+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(r,u,1,d-2),c=this.getBezierValue(r,u,2,d+18-2)}i==hh.setup?(a.mix=a.data.mix+(l-a.data.mix)*s,a.softness=a.data.softness+(c-a.data.softness)*s,o==lh.mixOut?(a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch):(a.bendDirection=h[u+3],a.compress=0!=h[u+4],a.stretch=0!=h[u+5])):(a.mix+=(l-a.mix)*s,a.softness+=(c-a.softness)*s,o==lh.mixIn&&(a.bendDirection=h[u+3],a.compress=0!=h[u+4],a.stretch=0!=h[u+5]))}}class Ad extends td{constructor(t,e,r){super(t,e,[`15|${r}`]),this.transformConstraintIndex=0,this.transformConstraintIndex=r}getFrameEntries(){return 7}setFrame(t,e,r,n,s,i,o,a){const h=this.frames;h[t*=7]=e,h[t+1]=r,h[t+2]=n,h[t+3]=s,h[t+4]=i,h[t+5]=o,h[t+6]=a}apply(t,e,r,n,s,i,o){const a=t.transformConstraints[this.transformConstraintIndex];if(!a.active)return;const h=this.frames;if(r<h[0]){const t=a.data;switch(i){case hh.setup:return a.mixRotate=t.mixRotate,a.mixX=t.mixX,a.mixY=t.mixY,a.mixScaleX=t.mixScaleX,a.mixScaleY=t.mixScaleY,void(a.mixShearY=t.mixShearY);case hh.first:a.mixRotate+=(t.mixRotate-a.mixRotate)*s,a.mixX+=(t.mixX-a.mixX)*s,a.mixY+=(t.mixY-a.mixY)*s,a.mixScaleX+=(t.mixScaleX-a.mixScaleX)*s,a.mixScaleY+=(t.mixScaleY-a.mixScaleY)*s,a.mixShearY+=(t.mixShearY-a.mixShearY)*s}return}let l,c,u,d,f,p;const m=Ju.search(h,r,7),g=this.curves[m/7];switch(g){case 0:const t=h[m];l=h[m+1],c=h[m+2],u=h[m+3],d=h[m+4],f=h[m+5],p=h[m+6];const e=(r-t)/(h[m+7]-t);l+=(h[m+7+1]-l)*e,c+=(h[m+7+2]-c)*e,u+=(h[m+7+3]-u)*e,d+=(h[m+7+4]-d)*e,f+=(h[m+7+5]-f)*e,p+=(h[m+7+6]-p)*e;break;case 1:l=h[m+1],c=h[m+2],u=h[m+3],d=h[m+4],f=h[m+5],p=h[m+6];break;default:l=this.getBezierValue(r,m,1,g-2),c=this.getBezierValue(r,m,2,g+18-2),u=this.getBezierValue(r,m,3,g+36-2),d=this.getBezierValue(r,m,4,g+54-2),f=this.getBezierValue(r,m,5,g+72-2),p=this.getBezierValue(r,m,6,g+90-2)}if(i==hh.setup){const t=a.data;a.mixRotate=t.mixRotate+(l-t.mixRotate)*s,a.mixX=t.mixX+(c-t.mixX)*s,a.mixY=t.mixY+(u-t.mixY)*s,a.mixScaleX=t.mixScaleX+(d-t.mixScaleX)*s,a.mixScaleY=t.mixScaleY+(f-t.mixScaleY)*s,a.mixShearY=t.mixShearY+(p-t.mixShearY)*s}else a.mixRotate+=(l-a.mixRotate)*s,a.mixX+=(c-a.mixX)*s,a.mixY+=(u-a.mixY)*s,a.mixScaleX+=(d-a.mixScaleX)*s,a.mixScaleY+=(f-a.mixScaleY)*s,a.mixShearY+=(p-a.mixShearY)*s}}class Sd extends ed{constructor(t,e,r){super(t,e,`16|${r}`),this.pathConstraintIndex=0,this.pathConstraintIndex=r}apply(t,e,r,n,s,i,o){const a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;if(r<this.frames[0]){switch(i){case hh.setup:return void(a.position=a.data.position);case hh.first:a.position+=(a.data.position-a.position)*s}return}const h=this.getCurveValue(r);i==hh.setup?a.position=a.data.position+(h-a.data.position)*s:a.position+=(h-a.position)*s}}class Rd extends ed{constructor(t,e,r){super(t,e,`17|${r}`),this.pathConstraintIndex=0,this.pathConstraintIndex=r}apply(t,e,r,n,s,i,o){const a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;if(r<this.frames[0]){switch(i){case hh.setup:return void(a.spacing=a.data.spacing);case hh.first:a.spacing+=(a.data.spacing-a.spacing)*s}return}const h=this.getCurveValue(r);i==hh.setup?a.spacing=a.data.spacing+(h-a.data.spacing)*s:a.spacing+=(h-a.spacing)*s}}class Id extends td{constructor(t,e,r){super(t,e,[`18|${r}`]),this.pathConstraintIndex=0,this.pathConstraintIndex=r}getFrameEntries(){return 4}setFrame(t,e,r,n,s){const i=this.frames;i[t<<=2]=e,i[t+1]=r,i[t+2]=n,i[t+3]=s}apply(t,e,r,n,s,i,o){const a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;const h=this.frames;if(r<h[0]){switch(i){case hh.setup:return a.mixRotate=a.data.mixRotate,a.mixX=a.data.mixX,void(a.mixY=a.data.mixY);case hh.first:a.mixRotate+=(a.data.mixRotate-a.mixRotate)*s,a.mixX+=(a.data.mixX-a.mixX)*s,a.mixY+=(a.data.mixY-a.mixY)*s}return}let l,c,u;const d=Ju.search(h,r,4),f=this.curves[d>>2];switch(f){case 0:const t=h[d];l=h[d+1],c=h[d+2],u=h[d+3];const e=(r-t)/(h[d+4]-t);l+=(h[d+4+1]-l)*e,c+=(h[d+4+2]-c)*e,u+=(h[d+4+3]-u)*e;break;case 1:l=h[d+1],c=h[d+2],u=h[d+3];break;default:l=this.getBezierValue(r,d,1,f-2),c=this.getBezierValue(r,d,2,f+18-2),u=this.getBezierValue(r,d,3,f+36-2)}if(i==hh.setup){const t=a.data;a.mixRotate=t.mixRotate+(l-t.mixRotate)*s,a.mixX=t.mixX+(c-t.mixX)*s,a.mixY=t.mixY+(u-t.mixY)*s}else a.mixRotate+=(l-a.mixRotate)*s,a.mixX+=(c-a.mixX)*s,a.mixY+=(u-a.mixY)*s}}const Md=class extends Ju{constructor(t,e,r){super(t,[`19|${e}|${r.sequence.id}`]),this.slotIndex=e,this.attachment=r}getFrameEntries(){return Md.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(t,e,r,n,s){const i=this.frames;i[t*=Md.ENTRIES]=e,i[t+Md.MODE]=r|n<<4,i[t+Md.DELAY]=s}apply(t,e,r,n,s,i,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const h=a.attachment,l=this.attachment;if(!(h==l||h instanceof Uu&&h.timelineAttachment==l))return;const c=this.frames;if(r<c[0])return void(i!=hh.setup&&i!=hh.first||(a.sequenceIndex=-1));const u=Ju.search(c,r,Md.ENTRIES),d=c[u],f=c[u+Md.MODE],p=c[u+Md.DELAY];if(!this.attachment.sequence)return;let m=f>>4;const g=this.attachment.sequence.regions.length,y=Zu[15&f];if(y!=Ku.hold)switch(m+=(r-d)/p+1e-5|0,y){case Ku.once:m=Math.min(g-1,m);break;case Ku.loop:m%=g;break;case Ku.pingpong:{const t=(g<<1)-2;m=0==t?0:m%t,m>=g&&(m=t-m);break}case Ku.onceReverse:m=Math.max(g-1-m,0);break;case Ku.loopReverse:m=g-1-m%g;break;case Ku.pingpongReverse:{const t=(g<<1)-2;m=0==t?0:(m+g-1)%t,m>=g&&(m=t-m)}}a.sequenceIndex=m}};let Pd=Md;Pd.ENTRIES=3,Pd.MODE=1,Pd.DELAY=2;const Cd=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new Nd(this),this.propertyIDs=new Eh,this.animationsChanged=!1,this.trackEntryPool=new Oh((()=>new Fd)),this.data=t}static emptyAnimation(){return Cd._emptyAnimation}update(t){t*=this.timeScale;const e=this.tracks;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(!n)continue;n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;let s=t*n.timeScale;if(n.delay>0){if(n.delay-=s,n.delay>0)continue;s=-n.delay,n.delay=0}let i=n.next;if(i){const e=n.trackLast-i.delay;if(e>=0){for(i.delay=0,i.trackTime+=0==n.timeScale?0:(e/n.timeScale+t)*i.timeScale,n.trackTime+=s,this.setCurrent(r,i,!0);i.mixingFrom;)i.mixTime+=t,i=i.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&!n.mixingFrom){e[r]=null,this.queue.end(n),this.clearNext(n);continue}if(n.mixingFrom&&this.updateMixingFrom(n,t)){let t=n.mixingFrom;for(n.mixingFrom=null,t&&(t.mixingTo=null);t;)this.queue.end(t),t=t.mixingFrom}n.trackTime+=s}this.queue.drain()}updateMixingFrom(t,e){const r=t.mixingFrom;if(!r)return!0;const n=this.updateMixingFrom(r,e);return r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=r.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=r.mixingFrom,r.mixingFrom&&(r.mixingFrom.mixingTo=t),t.interruptAlpha=r.interruptAlpha,this.queue.end(r)),n):(r.trackTime+=e*r.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,r=this.tracks;let n=!1;for(let s=0,i=r.length;s<i;s++){const i=r[s];if(!i||i.delay>0)continue;n=!0;const o=0==s?hh.first:i.mixBlend;let a=i.alpha;i.mixingFrom?a*=this.applyMixingFrom(i,t,o):i.trackTime>=i.trackEnd&&!i.next&&(a=0);const h=i.animationLast,l=i.getAnimationTime();let c=l,u=e;i.reverse&&(c=i.animation.duration-c,u=null);const d=i.animation.timelines,f=d.length;if(0==s&&1==a||o==hh.add)for(let e=0;e<f;e++){kh.webkit602BugfixHelper(a,o);const r=d[e];r instanceof bd?this.applyAttachmentTimeline(r,t,c,o,!0):r.apply(t,h,c,u,a,o,lh.mixIn)}else{const e=i.timelineMode,r=i.shortestRotation,n=!r&&i.timelinesRotation.length!=f<<1;n&&(i.timelinesRotation.length=f<<1);for(let s=0;s<f;s++){const l=d[s],f=e[s]==Ld?o:hh.setup;!r&&l instanceof nd?this.applyRotateTimeline(l,t,c,a,f,i.timelinesRotation,s<<1,n):l instanceof bd?this.applyAttachmentTimeline(l,t,c,o,!0):(kh.webkit602BugfixHelper(a,o),l.apply(t,h,c,u,a,f,lh.mixIn))}}this.queueEvents(i,l),e.length=0,i.nextAnimationLast=l,i.nextTrackLast=i.trackTime}const s=this.unkeyedState+Yd,i=t.slots;for(let e=0,r=t.slots.length;e<r;e++){const r=i[e];if(r.attachmentState==s){const e=r.data.attachmentName;r.setAttachment(e?t.getAttachment(r.data.index,e):null)}}return this.unkeyedState+=2,this.queue.drain(),n}applyMixingFrom(t,e,r){const n=t.mixingFrom;n.mixingFrom&&this.applyMixingFrom(n,e,r);let s=0;0==t.mixDuration?(s=1,r==hh.first&&(r=hh.setup)):(s=t.mixTime/t.mixDuration,s>1&&(s=1),r!=hh.first&&(r=n.mixBlend));const i=s<n.attachmentThreshold,o=s<n.drawOrderThreshold,a=n.animation.timelines,h=a.length,l=n.alpha*t.interruptAlpha,c=l*(1-s),u=n.animationLast,d=n.getAnimationTime();let f=d,p=null;if(n.reverse?f=n.animation.duration-f:s<n.eventThreshold&&(p=this.events),r==hh.add)for(let t=0;t<h;t++)a[t].apply(e,u,f,p,c,r,lh.mixOut);else{const t=n.timelineMode,s=n.timelineHoldMix,d=n.shortestRotation,m=!d&&n.timelinesRotation.length!=h<<1;m&&(n.timelinesRotation.length=h<<1),n.totalAlpha=0;for(let g=0;g<h;g++){const h=a[g];let y,b=lh.mixOut,x=0;switch(t[g]){case Ld:if(!o&&h instanceof Ed)continue;y=r,x=c;break;case Vd:y=hh.setup,x=c;break;case Ud:y=r,x=l;break;case Xd:y=hh.setup,x=l;break;default:y=hh.setup;const t=s[g];x=l*Math.max(0,1-t.mixTime/t.mixDuration)}n.totalAlpha+=x,!d&&h instanceof nd?this.applyRotateTimeline(h,e,f,x,y,n.timelinesRotation,g<<1,m):h instanceof bd?this.applyAttachmentTimeline(h,e,f,y,i):(kh.webkit602BugfixHelper(x,r),o&&h instanceof Ed&&y==hh.setup&&(b=lh.mixIn),h.apply(e,u,f,p,x,y,b))}}return t.mixDuration>0&&this.queueEvents(n,d),this.events.length=0,n.nextAnimationLast=d,n.nextTrackLast=n.trackTime,s}applyAttachmentTimeline(t,e,r,n,s){const i=e.slots[t.slotIndex];i.bone.active&&(r<t.frames[0]?n!=hh.setup&&n!=hh.first||this.setAttachment(e,i,i.data.attachmentName,s):this.setAttachment(e,i,t.attachmentNames[Ju.search1(t.frames,r)],s),i.attachmentState<=this.unkeyedState&&(i.attachmentState=this.unkeyedState+Yd))}setAttachment(t,e,r,n){e.setAttachment(r?t.getAttachment(e.data.index,r):null),n&&(e.attachmentState=this.unkeyedState+Gd)}applyRotateTimeline(t,e,r,n,s,i,o,a){if(a&&(i[o]=0),1==n)return void t.apply(e,0,r,null,1,s,lh.mixIn);const h=e.bones[t.boneIndex];if(!h.active)return;let l=0,c=0;if(r<t.frames[0])switch(s){case hh.setup:h.rotation=h.data.rotation;default:return;case hh.first:l=h.rotation,c=h.data.rotation}else l=s==hh.setup?h.data.rotation:h.rotation,c=h.data.rotation+t.getCurveValue(r);let u=0,d=c-l;if(d-=360*(16384-(16384.499999999996-d/360|0)),0==d)u=i[o];else{let t=0,e=0;a?(t=0,e=d):(t=i[o],e=i[o+1]);const r=d>0;let n=t>=0;Rh.signum(e)!=Rh.signum(d)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Rh.signum(t)),n=r),u=d+t-t%360,n!=r&&(u+=360*Rh.signum(t)),i[o]=u}i[o+1]=d,h.rotation=l+u*n}queueEvents(t,e){const r=t.animationStart,n=t.animationEnd,s=n-r,i=t.trackLast%s,o=this.events;let a=0;const h=o.length;for(;a<h;a++){const e=o[a];if(e.time<i)break;e.time>n||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==s||i>t.trackTime%s:e>=n&&t.animationLast<n,l&&this.queue.complete(t);a<h;a++){const e=o[a];e.time<r||this.queue.event(t,e)}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let r=e;for(;;){const t=r.mixingFrom;if(!t)break;this.queue.end(t),r.mixingFrom=null,r.mixingTo=null,r=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,r){const n=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,n&&(r&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,r=!1){const n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,n,r)}setAnimationWith(t,e,r=!1){if(!e)throw new Error("animation cannot be null.");let n=!0,s=this.expandToIndex(t);s&&(-1==s.nextTrackLast?(this.tracks[t]=s.mixingFrom,this.queue.interrupt(s),this.queue.end(s),this.clearNext(s),s=s.mixingFrom,n=!1):this.clearNext(s));const i=this.trackEntry(t,e,r,s);return this.setCurrent(t,i,n),this.queue.drain(),i}addAnimation(t,e,r=!1,n=0){const s=this.data.skeletonData.findAnimation(e);if(!s)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,s,r,n)}addAnimationWith(t,e,r=!1,n=0){if(!e)throw new Error("animation cannot be null.");let s=this.expandToIndex(t);if(s)for(;s.next;)s=s.next;const i=this.trackEntry(t,e,r,s);return s?(s.next=i,i.previous=s,n<=0&&(n+=s.getTrackComplete()-i.mixDuration)):(this.setCurrent(t,i,!0),this.queue.drain()),i.delay=n,i}setEmptyAnimation(t,e=0){const r=this.setAnimationWith(t,Cd.emptyAnimation(),!1);return r.mixDuration=e,r.trackEnd=e,r}addEmptyAnimation(t,e=0,r=0){const n=this.addAnimationWith(t,Cd.emptyAnimation(),!1,r);return r<=0&&(n.delay+=n.mixDuration-e),n.mixDuration=e,n.trackEnd=e,n}setEmptyAnimations(t=0){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,r=this.tracks.length;e<r;e++){const r=this.tracks[e];r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(kh.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,r,n){const s=this.trackEntryPool.obtain();return s.reset(),s.trackIndex=t,s.animation=e,s.loop=r,s.holdPrevious=!1,s.reverse=!1,s.shortestRotation=!1,s.eventThreshold=0,s.attachmentThreshold=0,s.drawOrderThreshold=0,s.animationStart=0,s.animationEnd=e.duration,s.animationLast=-1,s.nextAnimationLast=-1,s.delay=0,s.trackTime=0,s.trackLast=-1,s.nextTrackLast=-1,s.trackEnd=Number.MAX_VALUE,s.timeScale=1,s.alpha=1,s.mixTime=0,s.mixDuration=n?this.data.getMix(n.animation,e):0,s.interruptAlpha=1,s.totalAlpha=0,s.mixBlend=hh.replace,s}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();const t=this.tracks;for(let e=0,r=t.length;e<r;e++){let r=t[e];if(r){for(;r.mixingFrom;)r=r.mixingFrom;do{r.mixingTo&&r.mixBlend==hh.add||this.computeHold(r),r=r.mixingTo}while(r)}}}computeHold(t){const e=t.mixingTo,r=t.animation.timelines,n=t.animation.timelines.length,s=t.timelineMode;s.length=n;const i=t.timelineHoldMix;i.length=0;const o=this.propertyIDs;if(e&&e.holdPrevious)for(let t=0;t<n;t++)s[t]=o.addAll(r[t].getPropertyIds())?Xd:Ud;else t:for(let a=0;a<n;a++){const n=r[a],h=n.getPropertyIds();if(o.addAll(h))if(!e||n instanceof bd||n instanceof Ed||n instanceof vd||!e.animation.hasTimeline(h))s[a]=Vd;else{for(let r=e.mixingTo;r;r=r.mixingTo)if(!r.animation.hasTimeline(h)){if(t.mixDuration>0){s[a]=jd,i[a]=r;continue t}break}s[a]=Xd}else s[a]=Ld}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,r){Cd.deprecatedWarning1||(Cd.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,r)}addAnimationByName(t,e,r,n){Cd.deprecatedWarning2||(Cd.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,r,n)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return Cd.deprecatedWarning3||(Cd.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let kd=Cd;kd._emptyAnimation=new Qu("<empty>",[],0),kd.deprecatedWarning1=!1,kd.deprecatedWarning2=!1,kd.deprecatedWarning3=!1;const Od=class{constructor(){this.animation=null,this.previous=null,this.next=null,this.mixingFrom=null,this.mixingTo=null,this.listener=null,this.trackIndex=0,this.loop=!1,this.holdPrevious=!1,this.reverse=!1,this.shortestRotation=!1,this.eventThreshold=0,this.attachmentThreshold=0,this.drawOrderThreshold=0,this.animationStart=0,this.animationEnd=0,this.animationLast=0,this.nextAnimationLast=0,this.delay=0,this.trackTime=0,this.trackLast=0,this.nextTrackLast=0,this.trackEnd=0,this.timeScale=0,this.alpha=0,this.mixTime=0,this.mixDuration=0,this.interruptAlpha=0,this.totalAlpha=0,this.mixBlend=hh.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){const t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}get time(){return Od.deprecatedWarning1||(Od.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){Od.deprecatedWarning1||(Od.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return Od.deprecatedWarning2||(Od.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){Od.deprecatedWarning2||(Od.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let Fd=Od;Fd.deprecatedWarning1=!1,Fd.deprecatedWarning2=!1;class Nd{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(Bd.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Bd.interrupt),this.objects.push(t)}end(t){this.objects.push(Bd.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Bd.dispose),this.objects.push(t)}complete(t){this.objects.push(Bd.complete),this.objects.push(t)}event(t,e){this.objects.push(Bd.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let r=0;r<t.length;r+=2){const n=t[r],s=t[r+1];switch(n){case Bd.start:s.listener&&s.listener.start&&s.listener.start(s);for(let t=0;t<e.length;t++){const r=e[t];r.start&&r.start(s)}break;case Bd.interrupt:s.listener&&s.listener.interrupt&&s.listener.interrupt(s);for(let t=0;t<e.length;t++){const r=e[t];r.interrupt&&r.interrupt(s)}break;case Bd.end:s.listener&&s.listener.end&&s.listener.end(s);for(let t=0;t<e.length;t++){const r=e[t];r.end&&r.end(s)}case Bd.dispose:s.listener&&s.listener.dispose&&s.listener.dispose(s);for(let t=0;t<e.length;t++){const r=e[t];r.dispose&&r.dispose(s)}this.animState.trackEntryPool.free(s);break;case Bd.complete:s.listener&&s.listener.complete&&s.listener.complete(s);for(let t=0;t<e.length;t++){const r=e[t];r.complete&&r.complete(s)}break;case Bd.event:const n=t[2+r++];s.listener&&s.listener.event&&s.listener.event(s,n);for(let t=0;t<e.length;t++){const r=e[t];r.event&&r.event(s,n)}}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var Bd=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(Bd||{});class Dd{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}}const Ld=0,Vd=1,Ud=2,Xd=3,jd=4,Yd=1,Gd=2;class Wd{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,r){const n=this.skeletonData.findAnimation(t);if(!n)throw new Error(`Animation not found: ${t}`);const s=this.skeletonData.findAnimation(e);if(!s)throw new Error(`Animation not found: ${e}`);this.setMixWith(n,s,r)}setMixWith(t,e,r){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");const n=`${t.name}.${e.name}`;this.animationToMixTime[n]=r}getMix(t,e){const r=`${t.name}.${e.name}`,n=this.animationToMixTime[r];return void 0===n?this.defaultMix:n}}class Hd{constructor(t){this.atlas=t}loadSequence(t,e,r){const n=r.regions;for(let s=0,i=n.length;s<i;s++){const i=r.getPath(e,s),o=this.atlas.findRegion(i);if(null==o)throw new Error(`Region not found in atlas: ${i} (sequence: ${t})`);n[s]=o,n[s].renderObject=n[s]}}newRegionAttachment(t,e,r,n){const s=new $u(e,r);if(null!=n)this.loadSequence(e,r,n);else{const t=this.atlas.findRegion(r);if(!t)throw new Error(`Region not found in atlas: ${r} (region attachment: ${e})`);t.renderObject=t,s.region=t}return s}newMeshAttachment(t,e,r,n){const s=new Yu(e,r);if(null!=n)this.loadSequence(e,r,n);else{const t=this.atlas.findRegion(r);if(!t)throw new Error(`Region not found in atlas: ${r} (mesh attachment: ${e})`);t.renderObject=t,s.region=t}return s}newBoundingBoxAttachment(t,e){return new Xu(e)}newPathAttachment(t,e){return new Gu(e)}newPointAttachment(t,e){return new Wu(e)}newClippingAttachment(t,e){return new ju(e)}}class $d{constructor(t,e,r){if(this.matrix=new We,this.parent=null,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.sorted=!1,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=r,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,r,n,s,i,o){this.ax=t,this.ay=e,this.arotation=r,this.ascaleX=n,this.ascaleY=s,this.ashearX=i,this.ashearY=o;const a=this.parent,h=this.matrix,l=this.skeleton.scaleX,c=-this.skeleton.scaleY;if(!a){const a=this.skeleton,u=r+90+o;return h.a=Rh.cosDeg(r+i)*n*l,h.c=Rh.cosDeg(u)*s*l,h.b=Rh.sinDeg(r+i)*n*c,h.d=Rh.sinDeg(u)*s*c,h.tx=t*l+a.x,void(h.ty=e*c+a.y)}let u=a.matrix.a,d=a.matrix.c,f=a.matrix.b,p=a.matrix.d;switch(h.tx=u*t+d*e+a.matrix.tx,h.ty=f*t+p*e+a.matrix.ty,this.data.transformMode){case dh.Normal:{const t=r+90+o,e=Rh.cosDeg(r+i)*n,a=Rh.cosDeg(t)*s,l=Rh.sinDeg(r+i)*n,c=Rh.sinDeg(t)*s;return h.a=u*e+d*l,h.c=u*a+d*c,h.b=f*e+p*l,void(h.d=f*a+p*c)}case dh.OnlyTranslation:{const t=r+90+o;h.a=Rh.cosDeg(r+i)*n,h.c=Rh.cosDeg(t)*s,h.b=Rh.sinDeg(r+i)*n,h.d=Rh.sinDeg(t)*s;break}case dh.NoRotationOrReflection:{let t=u*u+f*f,e=0;t>1e-4?(t=Math.abs(u*p-d*f)/t,u/=l,f/=c,d=f*t,p=u*t,e=Math.atan2(f,u)*Rh.radDeg):(u=0,f=0,e=90-Math.atan2(p,d)*Rh.radDeg);const a=r+i-e,m=r+o-e+90,g=Rh.cosDeg(a)*n,y=Rh.cosDeg(m)*s,b=Rh.sinDeg(a)*n,x=Rh.sinDeg(m)*s;h.a=u*g-d*b,h.c=u*y-d*x,h.b=f*g+p*b,h.d=f*y+p*x;break}case dh.NoScale:case dh.NoScaleOrReflection:{const t=Rh.cosDeg(r),e=Rh.sinDeg(r);let a=(u*t+d*e)/l,m=(f*t+p*e)/c,g=Math.sqrt(a*a+m*m);g>1e-5&&(g=1/g),a*=g,m*=g,g=Math.sqrt(a*a+m*m),this.data.transformMode==dh.NoScale&&u*p-d*f<0!=(l<0!=c<0)&&(g=-g);const y=Math.PI/2+Math.atan2(m,a),b=Math.cos(y)*g,x=Math.sin(y)*g,_=Rh.cosDeg(i)*n,v=Rh.cosDeg(90+o)*s,w=Rh.sinDeg(i)*n,E=Rh.sinDeg(90+o)*s;h.a=a*_+b*w,h.c=a*v+b*E,h.b=m*_+x*w,h.d=m*v+x*E;break}}h.a*=l,h.c*=l,h.b*=c,h.d*=c}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*Rh.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*Rh.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.b*t.b)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.c*t.c+t.d*t.d)}updateAppliedTransform(){const t=this.parent,e=this.matrix;if(!t)return this.ax=e.tx-this.skeleton.x,this.ay=e.ty-this.skeleton.y,this.arotation=Math.atan2(e.b,e.a)*Rh.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*Rh.radDeg);const r=t.matrix,n=1/(r.a*r.d-r.b*r.c),s=e.tx-r.tx,i=e.ty-r.ty;this.ax=s*r.d*n-i*r.c*n,this.ay=i*r.a*n-s*r.b*n;const o=n*r.d,a=n*r.a,h=n*r.c,l=n*r.b,c=o*e.a-h*e.b,u=o*e.c-h*e.d,d=a*e.b-l*e.a,f=a*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*f,t)*Rh.radDeg,this.arotation=Math.atan2(d,c)*Rh.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*Rh.radDeg}worldToLocal(t){const e=this.matrix,r=e.a,n=e.c,s=e.b,i=e.d,o=1/(r*i-n*s),a=t.x-e.tx,h=t.y-e.ty;return t.x=a*i*o-h*n*o,t.y=h*r*o-a*s*o,t}localToWorld(t){const e=this.matrix,r=t.x,n=t.y;return t.x=r*e.a+n*e.c+e.tx,t.y=r*e.b+n*e.d+e.ty,t}worldToLocalRotation(t){const e=Rh.sinDeg(t),r=Rh.cosDeg(t),n=this.matrix;return Math.atan2(n.a*e-n.b*r,n.d*r-n.c*e)*Rh.radDeg}localToWorldRotation(t){t-=this.rotation-this.shearX;const e=Rh.sinDeg(t),r=Rh.cosDeg(t),n=this.matrix;return Math.atan2(r*n.b+e*n.d,r*n.a+e*n.c)*Rh.radDeg}rotateWorld(t){const e=this.matrix,r=e.a,n=e.c,s=e.b,i=e.d,o=Rh.cosDeg(t),a=Rh.sinDeg(t);e.a=o*r-a*s,e.c=o*n-a*i,e.b=a*r+o*s,e.d=a*n+o*i}}class zd{constructor(t,e,r){if(this.index=0,this.parent=null,this.length=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=dh.Normal,this.skinRequired=!1,this.color=new Ah,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=r}}class qd{constructor(t,e,r){this.name=t,this.order=e,this.skinRequired=r}}class Kd{constructor(t,e){if(this.intValue=0,this.floatValue=0,this.stringValue=null,this.time=0,this.volume=0,this.balance=0,!e)throw new Error("data cannot be null.");this.time=t,this.data=e}}class Zd{constructor(t){this.intValue=0,this.floatValue=0,this.stringValue=null,this.audioPath=null,this.volume=0,this.balance=0,this.name=t}}class Qd{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let r=0;r<t.bones.length;r++){const n=e.findBone(t.bones[r].name);if(!n)throw new Error(`Couldn't find bone ${t.bones[r].name}`);this.bones.push(n)}const r=e.findBone(t.target.name);if(!r)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=r}isActive(){return this.active}update(){if(0==this.mix)return;const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(t,e,r,n,s,i,o){const a=t.parent.matrix;if(!a)throw new Error("IK bone must have parent.");const h=a.a;let l=a.c;const c=a.b;let u=a.d,d=-t.ashearX-t.arotation,f=0,p=0;const m=t.skeleton.scaleX,g=-t.skeleton.scaleY;switch(t.data.transformMode){case dh.OnlyTranslation:f=e-t.worldX,p=r-t.worldY,p=-p;break;case dh.NoRotationOrReflection:const n=Math.abs(h*u-l*c)/(h*h+c*c),s=h/m,i=c/g;l=-i*n*m,u=s*n*g,d+=Math.atan2(i,s)*Rh.radDeg;default:const o=e-a.tx,y=r-a.ty,b=h*u-l*c;f=(o*u-y*l)/b-t.ax,p=(y*h-o*c)/b-t.ay}d+=Math.atan2(p,f)*Rh.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);let y=t.ascaleX,b=t.ascaleY;if(n||s){switch(t.data.transformMode){case dh.NoScale:case dh.NoScaleOrReflection:f=e-t.worldX,p=r-t.worldY}const a=t.data.length*y,h=Math.sqrt(f*f+p*p);if(n&&h<a||s&&h>a&&a>1e-4){const t=(h/a-1)*o+1;y*=t,i&&(b*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*o,y,b,t.ashearX,t.ashearY)}apply2(t,e,r,n,s,i,o,a,h){const l=t.ax,c=t.ay;let u=t.ascaleX,d=t.ascaleY,f=u,p=d,m=e.ascaleX;const g=t.matrix;let y=0,b=0,x=0;u<0?(u=-u,y=180,x=-1):(y=0,x=1),d<0&&(d=-d,x=-x),m<0?(m=-m,b=180):b=0;const _=e.ax;let v=0,w=0,E=0,T=g.a,A=g.c,S=g.b,R=g.d;const I=Math.abs(u-d)<=1e-4;!I||i?(v=0,w=T*_+g.tx,E=S*_+g.ty):(v=e.ay,w=T*_+A*v+g.tx,E=S*_+R*v+g.ty);const M=t.parent.matrix;if(!M)throw new Error("IK parent must itself have a parent.");T=M.a,A=M.c,S=M.b,R=M.d;const P=1/(T*R-A*S);let C=w-M.tx,k=E-M.ty;const O=(C*R-k*A)*P-l,F=(k*T-C*S)*P-c,N=Math.sqrt(O*O+F*F);let B,D,L=e.data.length*m;if(N<1e-4)return this.apply1(t,r,n,!1,i,!1,h),void e.updateWorldTransformWith(_,v,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);C=r-M.tx,k=n-M.ty;let V=(C*R-k*A)*P-l,U=(k*T-C*S)*P-c,X=V*V+U*U;if(0!=a){a*=u*(m+1)*.5;const t=Math.sqrt(X),e=t-N-L*u+a;if(e>0){let r=Math.min(1,e/(2*a))-1;r=(e-a*(1-r*r))/t,V-=r*V,U-=r*U,X=V*V+U*U}}t:if(I){L*=u;let t=(X-N*N-L*L)/(2*N*L);t<-1?(t=-1,D=Math.PI*s):t>1?(t=1,D=0,i&&(T=(Math.sqrt(X)/(N+L)-1)*h+1,f*=T,o&&(p*=T))):D=Math.acos(t)*s,T=N+L*t,A=L*Math.sin(D),B=Math.atan2(U*T-V*A,V*T+U*A)}else{T=u*L,A=d*L;const t=T*T,e=A*A,r=Math.atan2(U,V);S=e*N*N+t*X-t*e;const n=-2*e*N,i=e-t;if(R=n*n-4*i*S,R>=0){let t=Math.sqrt(R);n<0&&(t=-t),t=.5*-(n+t);const e=t/i,o=S/t,a=Math.abs(e)<Math.abs(o)?e:o;if(a*a<=X){k=Math.sqrt(X-a*a)*s,B=r-Math.atan2(k,a),D=Math.atan2(k/d,(a-N)/u);break t}}let o=Rh.PI,a=N-T,h=a*a,l=0,c=0,f=N+T,p=f*f,m=0;S=-T*N/(t-e),S>=-1&&S<=1&&(S=Math.acos(S),C=T*Math.cos(S)+N,k=A*Math.sin(S),R=C*C+k*k,R<h&&(o=S,h=R,a=C,l=k),R>p&&(c=S,p=R,f=C,m=k)),X<=.5*(h+p)?(B=r-Math.atan2(l*s,a),D=o*s):(B=r-Math.atan2(m*s,f),D=c*s)}const j=Math.atan2(v,_)*x;let Y=t.arotation;B=(B-j)*Rh.radDeg+y-Y,B>180?B-=360:B<-180&&(B+=360),t.updateWorldTransformWith(l,c,Y+B*h,f,p,0,0),Y=e.arotation,D=((D+j)*Rh.radDeg-e.ashearX)*x+b-Y,D>180?D-=360:D<-180&&(D+=360),e.updateWorldTransformWith(_,v,Y+D*h,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class Jd extends qd{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class tf extends qd{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.positionMode=ch.Fixed,this.spacingMode=ef.Fixed,this.rotateMode=uh.Chain,this.offsetRotation=0,this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}}var ef=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t[t.Proportional=3]="Proportional",t))(ef||{});const rf=class{constructor(t,e){if(this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let r=0,n=t.bones.length;r<n;r++){const n=e.findBone(t.bones[r].name);if(!n)throw new Error(`Couldn't find bone ${t.bones[r].name}.`);this.bones.push(n)}const r=e.findSlot(t.target.name);if(!r)throw new Error(`Couldn't find target bone ${t.target.name}`);this.target=r,this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}update(){const t=this.target.getAttachment();if(!(t instanceof Gu))return;const e=this.mixRotate,r=this.mixX,n=this.mixY;if(0==e&&0==r&&0==n)return;const s=this.data,i=s.rotateMode==uh.Tangent,o=s.rotateMode==uh.ChainScale,a=this.bones,h=a.length,l=i?h:h+1,c=kh.setArraySize(this.spaces,l),u=o?this.lengths=kh.setArraySize(this.lengths,h):[],d=this.spacing;switch(s.spacingMode){case ef.Percent:if(o)for(let t=0,e=l-1;t<e;t++){const e=a[t],r=e.data.length;if(r<rf.epsilon)u[t]=0;else{const n=r*e.matrix.a,s=r*e.matrix.b;u[t]=Math.sqrt(n*n+s*s)}}kh.arrayFill(c,1,l,d);break;case ef.Proportional:let t=0;for(let e=0,r=l-1;e<r;){const r=a[e],n=r.data.length;if(n<rf.epsilon)o&&(u[e]=0),c[++e]=d;else{const s=n*r.matrix.a,i=n*r.matrix.b,a=Math.sqrt(s*s+i*i);o&&(u[e]=a),c[++e]=a,t+=a}}if(t>0){t=l/t*d;for(let e=1;e<l;e++)c[e]*=t}break;default:const e=s.spacingMode==ef.Length;for(let t=0,r=l-1;t<r;){const r=a[t],n=r.data.length;if(n<rf.epsilon)o&&(u[t]=0),c[++t]=d;else{const s=n*r.matrix.a,i=n*r.matrix.b,a=Math.sqrt(s*s+i*i);o&&(u[t]=a),c[++t]=(e?n+d:d)*a/n}}}const f=this.computeWorldPositions(t,l,i);let p=f[0],m=f[1],g=s.offsetRotation,y=!1;if(0==g)y=s.rotateMode==uh.Chain;else{y=!1;const t=this.target.bone.matrix;g*=t.a*t.d-t.b*t.c>0?Rh.degRad:-Rh.degRad}for(let t=0,s=3;t<h;t++,s+=3){const h=a[t],l=h.matrix;l.tx+=(p-l.tx)*r,l.ty+=(m-l.ty)*n;const d=f[s],b=f[s+1],x=d-p,_=b-m;if(o){const r=u[t];if(0!=r){const t=(Math.sqrt(x*x+_*_)/r-1)*e+1;l.a*=t,l.b*=t}}if(p=d,m=b,e>0){const r=l.a,n=l.c,o=l.b,a=l.d;let u=0,d=0,b=0;if(u=i?f[s-1]:0==c[t+1]?f[s+2]:Math.atan2(_,x),u-=Math.atan2(o,r),y){d=Math.cos(u),b=Math.sin(u);const t=h.data.length;p+=(t*(d*r-b*o)-x)*e,m+=(t*(b*r+d*o)-_)*e}else u+=g;u>Rh.PI?u-=Rh.PI2:u<-Rh.PI&&(u+=Rh.PI2),u*=e,d=Math.cos(u),b=Math.sin(u),l.a=d*r-b*o,l.c=d*n-b*a,l.b=b*r+d*o,l.d=b*n+d*a}h.updateAppliedTransform()}}computeWorldPositions(t,e,r){const n=this.target;let s=this.position;const i=this.spaces,o=kh.setArraySize(this.positions,3*e+2);let a=this.world;const h=t.closed;let l=t.worldVerticesLength,c=l/6,u=rf.NONE;if(!t.constantSpeed){const d=t.lengths;c-=h?1:2;const f=d[c];let p;switch(this.data.positionMode==ch.Percent&&(s*=f),this.data.spacingMode){case ef.Percent:p=f;break;case ef.Proportional:p=f/e;break;default:p=1}a=kh.setArraySize(this.world,8);for(let m=0,g=0,y=0;m<e;m++,g+=3){const e=i[m]*p;s+=e;let b=s;if(h)b%=f,b<0&&(b+=f),y=0;else{if(b<0){u!=rf.BEFORE&&(u=rf.BEFORE,t.computeWorldVertices(n,2,4,a,0,2)),this.addBeforePosition(b,a,0,o,g);continue}if(b>f){u!=rf.AFTER&&(u=rf.AFTER,t.computeWorldVertices(n,l-6,4,a,0,2)),this.addAfterPosition(b-f,a,0,o,g);continue}}for(;;y++){const t=d[y];if(!(b>t)){if(0==y)b/=t;else{const e=d[y-1];b=(b-e)/(t-e)}break}}y!=u&&(u=y,h&&y==c?(t.computeWorldVertices(n,l-4,4,a,0,2),t.computeWorldVertices(n,0,4,a,4,2)):t.computeWorldVertices(n,6*y+2,8,a,0,2)),this.addCurvePosition(b,a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],o,g,r||m>0&&0==e)}return o}h?(l+=2,a=kh.setArraySize(this.world,l),t.computeWorldVertices(n,2,l-4,a,0,2),t.computeWorldVertices(n,0,2,a,l-4,2),a[l-2]=a[0],a[l-1]=a[1]):(c--,l-=4,a=kh.setArraySize(this.world,l),t.computeWorldVertices(n,2,l,a,0,2));const d=kh.setArraySize(this.curves,c);let f,p=0,m=a[0],g=a[1],y=0,b=0,x=0,_=0,v=0,w=0,E=0,T=0,A=0,S=0,R=0,I=0,M=0,P=0;for(let t=0,e=2;t<c;t++,e+=6)y=a[e],b=a[e+1],x=a[e+2],_=a[e+3],v=a[e+4],w=a[e+5],E=.1875*(m-2*y+x),T=.1875*(g-2*b+_),A=.09375*(3*(y-x)-m+v),S=.09375*(3*(b-_)-g+w),R=2*E+A,I=2*T+S,M=.75*(y-m)+E+.16666667*A,P=.75*(b-g)+T+.16666667*S,p+=Math.sqrt(M*M+P*P),M+=R,P+=I,R+=A,I+=S,p+=Math.sqrt(M*M+P*P),M+=R,P+=I,p+=Math.sqrt(M*M+P*P),M+=R+A,P+=I+S,p+=Math.sqrt(M*M+P*P),d[t]=p,m=v,g=w;switch(this.data.positionMode==ch.Percent&&(s*=p),this.data.spacingMode){case ef.Percent:f=p;break;case ef.Proportional:f=p/e;break;default:f=1}const C=this.segments;let k=0;for(let t=0,n=0,c=0,O=0;t<e;t++,n+=3){const e=i[t]*f;s+=e;let F=s;if(h)F%=p,F<0&&(F+=p),c=0;else{if(F<0){this.addBeforePosition(F,a,0,o,n);continue}if(F>p){this.addAfterPosition(F-p,a,l-4,o,n);continue}}for(;;c++){const t=d[c];if(!(F>t)){if(0==c)F/=t;else{const e=d[c-1];F=(F-e)/(t-e)}break}}if(c!=u){u=c;let t=6*c;for(m=a[t],g=a[t+1],y=a[t+2],b=a[t+3],x=a[t+4],_=a[t+5],v=a[t+6],w=a[t+7],E=.03*(m-2*y+x),T=.03*(g-2*b+_),A=.006*(3*(y-x)-m+v),S=.006*(3*(b-_)-g+w),R=2*E+A,I=2*T+S,M=.3*(y-m)+E+.16666667*A,P=.3*(b-g)+T+.16666667*S,k=Math.sqrt(M*M+P*P),C[0]=k,t=1;t<8;t++)M+=R,P+=I,R+=A,I+=S,k+=Math.sqrt(M*M+P*P),C[t]=k;M+=R,P+=I,k+=Math.sqrt(M*M+P*P),C[8]=k,M+=R+A,P+=I+S,k+=Math.sqrt(M*M+P*P),C[9]=k,O=0}for(F*=k;;O++){const t=C[O];if(!(F>t)){if(0==O)F/=t;else{const e=C[O-1];F=O+(F-e)/(t-e)}break}}this.addCurvePosition(.1*F,m,g,y,b,x,_,v,w,o,n,r||t>0&&0==e)}return o}addBeforePosition(t,e,r,n,s){const i=e[r],o=e[r+1],a=e[r+2]-i,h=e[r+3]-o,l=Math.atan2(h,a);n[s]=i+t*Math.cos(l),n[s+1]=o+t*Math.sin(l),n[s+2]=l}addAfterPosition(t,e,r,n,s){const i=e[r+2],o=e[r+3],a=i-e[r],h=o-e[r+1],l=Math.atan2(h,a);n[s]=i+t*Math.cos(l),n[s+1]=o+t*Math.sin(l),n[s+2]=l}addCurvePosition(t,e,r,n,s,i,o,a,h,l,c,u){if(0==t||isNaN(t))return l[c]=e,l[c+1]=r,void(l[c+2]=Math.atan2(s-r,n-e));const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,y=p*t,b=3*y,x=p*b,_=b*t,v=e*g+n*x+i*_+a*f,w=r*g+s*x+o*_+h*f;l[c]=v,l[c+1]=w,u&&(l[c+2]=t<.001?Math.atan2(s-r,n-e):Math.atan2(w-(r*m+s*y*2+o*d),v-(e*m+n*y*2+i*d)))}};let nf=rf;nf.NONE=-1,nf.BEFORE=-2,nf.AFTER=-3,nf.epsilon=1e-5;class sf{constructor(t,e){if(this.darkColor=null,this.attachment=null,this.attachmentState=0,this.sequenceIndex=-1,this.deform=new Array,!t)throw new Error("data cannot be null.");if(!e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Ah,this.darkColor=t.darkColor?new Ah:null,this.setToSetupPose(),this.blendMode=this.data.blendMode}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(t instanceof Uu&&this.attachment instanceof Uu&&t.timelineAttachment==this.attachment.timelineAttachment||(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class of{constructor(t,e){if(this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.temp=new Fh,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(let r=0;r<t.bones.length;r++){const n=e.findBone(t.bones[r].name);if(!n)throw new Error(`Couldn't find bone ${t.bones[r].name}.`);this.bones.push(n)}const r=e.findBone(t.target.name);if(!r)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=r}isActive(){return this.active}update(){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleX&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){const t=this.mixRotate,e=this.mixX,r=this.mixY,n=this.mixScaleX,s=this.mixScaleY,i=this.mixShearY,o=0!=e||0!=r,a=this.target,h=a.matrix,l=h.a,c=h.c,u=h.b,d=h.d,f=l*d-c*u>0?Rh.degRad:-Rh.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let h=0,f=g.length;h<f;h++){const f=g[h],y=f.matrix;if(0!=t){const e=y.a,r=y.c,n=y.b,s=y.d;let i=Math.atan2(u,l)-Math.atan2(n,e)+p;i>Rh.PI?i-=Rh.PI2:i<-Rh.PI&&(i+=Rh.PI2),i*=t;const o=Math.cos(i),a=Math.sin(i);y.a=o*e-a*n,y.c=o*r-a*s,y.b=a*e+o*n,y.d=a*r+o*s}if(o){const t=this.temp;a.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),y.tx+=(t.x-y.tx)*e,y.ty+=(t.y-y.ty)*r}if(0!=n){let t=Math.sqrt(y.a*y.a+y.b*y.b);0!=t&&(t=(t+(Math.sqrt(l*l+u*u)-t+this.data.offsetScaleX)*n)/t),y.a*=t,y.b*=t}if(0!=s){let t=Math.sqrt(y.c*y.c+y.d*y.d);0!=t&&(t=(t+(Math.sqrt(c*c+d*d)-t+this.data.offsetScaleY)*s)/t),y.c*=t,y.d*=t}if(i>0){const t=y.c,e=y.d,r=Math.atan2(e,t);let n=Math.atan2(d,c)-Math.atan2(u,l)-(r-Math.atan2(y.b,y.a));n>Rh.PI?n-=Rh.PI2:n<-Rh.PI&&(n+=Rh.PI2),n=r+(n+m)*i;const s=Math.sqrt(t*t+e*e);y.c=Math.cos(n)*s,y.d=Math.sin(n)*s}f.updateAppliedTransform()}}applyRelativeWorld(){const t=this.mixRotate,e=this.mixX,r=this.mixY,n=this.mixScaleX,s=this.mixScaleY,i=this.mixShearY,o=0!=e||0!=r,a=this.target,h=a.matrix,l=h.a,c=h.c,u=h.b,d=h.d,f=l*d-c*u>0?Rh.degRad:-Rh.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let h=0,f=g.length;h<f;h++){const f=g[h],y=f.matrix;if(0!=t){const e=y.a,r=y.c,n=y.b,s=y.d;let i=Math.atan2(u,l)+p;i>Rh.PI?i-=Rh.PI2:i<-Rh.PI&&(i+=Rh.PI2),i*=t;const o=Math.cos(i),a=Math.sin(i);y.a=o*e-a*n,y.c=o*r-a*s,y.b=a*e+o*n,y.d=a*r+o*s}if(o){const t=this.temp;a.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),y.tx+=t.x*e,y.ty+=t.y*r}if(0!=n){const t=(Math.sqrt(l*l+u*u)-1+this.data.offsetScaleX)*n+1;y.a*=t,y.b*=t}if(0!=s){const t=(Math.sqrt(c*c+d*d)-1+this.data.offsetScaleY)*s+1;y.c*=t,y.d*=t}if(i>0){let t=Math.atan2(d,c)-Math.atan2(u,l);t>Rh.PI?t-=Rh.PI2:t<-Rh.PI&&(t+=Rh.PI2);const e=y.c,r=y.d;t=Math.atan2(r,e)+(t-Rh.PI/2+m)*i;const n=Math.sqrt(e*e+r*r);y.c=Math.cos(t)*n,y.d=Math.sin(t)*n}f.updateAppliedTransform()}}applyAbsoluteLocal(){const t=this.mixRotate,e=this.mixX,r=this.mixY,n=this.mixScaleX,s=this.mixScaleY,i=this.mixShearY,o=this.target,a=this.bones;for(let h=0,l=a.length;h<l;h++){const l=a[h];let c=l.arotation;if(0!=t){let e=o.arotation-c+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),c+=e*t}let u=l.ax,d=l.ay;u+=(o.ax-u+this.data.offsetX)*e,d+=(o.ay-d+this.data.offsetY)*r;let f=l.ascaleX,p=l.ascaleY;0!=n&&0!=f&&(f=(f+(o.ascaleX-f+this.data.offsetScaleX)*n)/f),0!=s&&0!=p&&(p=(p+(o.ascaleY-p+this.data.offsetScaleY)*s)/p);let m=l.ashearY;if(0!=i){let t=o.ashearY-m+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),m+=t*i}l.updateWorldTransformWith(u,d,c,f,p,l.ashearX,m)}}applyRelativeLocal(){const t=this.mixRotate,e=this.mixX,r=this.mixY,n=this.mixScaleX,s=this.mixScaleY,i=this.mixShearY,o=this.target,a=this.bones;for(let h=0,l=a.length;h<l;h++){const l=a[h],c=l.arotation+(o.arotation+this.data.offsetRotation)*t,u=l.ax+(o.ax+this.data.offsetX)*e,d=l.ay+(o.ay+this.data.offsetY)*r,f=l.ascaleX*((o.ascaleX-1+this.data.offsetScaleX)*n+1),p=l.ascaleY*((o.ascaleY-1+this.data.offsetScaleY)*s+1),m=l.ashearY+(o.ashearY+this.data.offsetShearY)*i;l.updateWorldTransformWith(u,d,c,f,p,l.ashearX,m)}}}const af=class{constructor(t){if(this._updateCache=new Array,this.skin=null,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const r=t.bones[e];let n;if(r.parent){const t=this.bones[r.parent.index];n=new $d(r,this,t),t.children.push(n)}else n=new $d(r,this,null);this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const r=t.slots[e],n=this.bones[r.boneData.index],s=new sf(r,n);this.slots.push(s),this.drawOrder.push(s)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const r=t.ikConstraints[e];this.ikConstraints.push(new Qd(r,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const r=t.transformConstraints[e];this.transformConstraints.push(new of(r,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const r=t.pathConstraints[e];this.pathConstraints.push(new nf(r,this))}this.color=new Ah(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0;const t=this.bones;for(let e=0,r=t.length;e<r;e++){const r=t[e];r.sorted=r.data.skinRequired,r.active=!r.sorted}if(this.skin){const t=this.skin.bones;for(let e=0,r=this.skin.bones.length;e<r;e++){let r=this.bones[t[e].index];do{r.sorted=!1,r.active=!0,r=r.parent}while(r)}}const e=this.ikConstraints,r=this.transformConstraints,n=this.pathConstraints,s=e.length,i=r.length,o=n.length,a=s+i+o;t:for(let t=0;t<a;t++){for(let r=0;r<s;r++){const n=e[r];if(n.data.order==t){this.sortIkConstraint(n);continue t}}for(let e=0;e<i;e++){const n=r[e];if(n.data.order==t){this.sortTransformConstraint(n);continue t}}for(let e=0;e<o;e++){const r=n[e];if(r.data.order==t){this.sortPathConstraint(r);continue t}}}for(let e=0,r=t.length;e<r;e++)this.sortBone(t[e])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&kh.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const r=t.bones,n=r[0];if(this.sortBone(n),1==r.length)this._updateCache.push(t),this.sortReset(n.children);else{const e=r[r.length-1];this.sortBone(e),this._updateCache.push(t),this.sortReset(n.children),e.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&kh.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,r=e.data.index,n=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,r,n),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,r,n);for(let t=0,e=this.data.skins.length;t<e;t++)this.sortPathConstraintAttachment(this.data.skins[t],r,n);const s=e.getAttachment();s instanceof Gu&&this.sortPathConstraintAttachmentWith(s,n);const i=t.bones,o=i.length;for(let t=0;t<o;t++)this.sortBone(i[t]);this._updateCache.push(t);for(let t=0;t<o;t++)this.sortReset(i[t].children);for(let t=0;t<o;t++)i[t].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&kh.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,r=e.length;if(t.data.local)for(let t=0;t<r;t++){const r=e[t];this.sortBone(r.parent),this.sortBone(r)}else for(let t=0;t<r;t++)this.sortBone(e[t]);this._updateCache.push(t);for(let t=0;t<r;t++)this.sortReset(e[t].children);for(let t=0;t<r;t++)e[t].sorted=!0}sortPathConstraintAttachment(t,e,r){const n=t.attachments[e];if(n)for(const t in n)this.sortPathConstraintAttachmentWith(n[t],r)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof Gu))return;const r=t.bones;if(r){const t=this.bones;for(let e=0,n=r.length;e<n;){let n=r[e++];for(n+=e;e<n;)this.sortBone(t[r[e++]])}}else this.sortBone(e)}sortBone(t){if(!t)return;if(t.sorted)return;const e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,r=t.length;e<r;e++){const r=t[e];r.active&&(r.sorted&&this.sortReset(r.children),r.sorted=!1)}}updateWorldTransform(){const t=this.bones;for(let e=0,r=t.length;e<r;e++){const r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY}const e=this._updateCache;for(let t=0,r=e.length;t<r;t++)e[t].update()}updateWorldTransformWith(t){const e=this.getRootBone(),r=t.matrix.a,n=t.matrix.c,s=t.matrix.b,i=t.matrix.d;e.matrix.tx=r*this.x+n*this.y+t.worldX,e.matrix.ty=s*this.x+i*this.y+t.worldY;const o=e.rotation+90+e.shearY,a=Rh.cosDeg(e.rotation+e.shearX)*e.scaleX,h=Rh.cosDeg(o)*e.scaleY,l=Rh.sinDeg(e.rotation+e.shearX)*e.scaleX,c=Rh.sinDeg(o)*e.scaleY,u=this.scaleX,d=-this.scaleY;e.matrix.a=(r*a+n*l)*u,e.matrix.c=(r*h+n*c)*u,e.matrix.b=(s*a+i*l)*d,e.matrix.d=(s*h+i*c)*d;const f=this._updateCache;for(let t=0,r=f.length;t<r;t++){const r=f[t];r!=e&&r.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let e=0,r=t.length;e<r;e++)t[e].setToSetupPose();const e=this.ikConstraints;for(let t=0,r=e.length;t<r;t++){const r=e[t];r.mix=r.data.mix,r.softness=r.data.softness,r.bendDirection=r.data.bendDirection,r.compress=r.data.compress,r.stretch=r.data.stretch}const r=this.transformConstraints;for(let t=0,e=r.length;t<e;t++){const e=r[t],n=e.data;e.mixRotate=n.mixRotate,e.mixX=n.mixX,e.mixY=n.mixY,e.mixScaleX=n.mixScaleX,e.mixScaleY=n.mixScaleY,e.mixShearY=n.mixShearY}const n=this.pathConstraints;for(let t=0,e=n.length;t<e;t++){const e=n[t],r=e.data;e.position=r.position,e.spacing=r.spacing,e.mixRotate=r.mixRotate,e.mixX=r.mixX,e.mixY=r.mixY}}setSlotsToSetupPose(){const t=this.slots;kh.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,r=t.length;e<r;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return r;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return r;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(!e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let r=0,n=e.length;r<n;r++){const n=e[r],s=n.data.attachmentName;if(s){const e=t.getAttachment(r,s);e&&n.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){const r=this.data.findSlot(t);if(!r)throw new Error(`Can't find slot with name ${t}`);return this.getAttachment(r.index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){const r=this.skin.getAttachment(t,e);if(r)return r}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");const r=this.slots;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(s.data.name==t){let r=null;if(e&&(r=this.getAttachment(n,e),!r))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void s.setAttachment(r)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.data.name==t)return n}return null}getBoundsRect(){const t=new Fh,e=new Fh;return this.getBounds(t,e),{x:t.x,y:t.y,width:e.x,height:e.y}}getBounds(t,e,r=new Array(2)){if(!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");const n=this.drawOrder;let s=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let t=0,e=n.length;t<e;t++){const e=n[t];if(!e.bone.active)continue;let h=0,l=null;const c=e.getAttachment();if(c instanceof $u)h=8,l=kh.setArraySize(r,h,0),c.computeWorldVertices(e,l,0,2);else if(c instanceof Yu){const t=c;h=t.worldVerticesLength,l=kh.setArraySize(r,h,0),t.computeWorldVertices(e,0,h,l,0,2)}if(l)for(let t=0,e=l.length;t<e;t+=2){const e=l[t],r=l[t+1];s=Math.min(s,e),i=Math.min(i,r),o=Math.max(o,e),a=Math.max(a,r)}}t.set(s,i),e.set(o-s,a-i)}get flipX(){return-1==this.scaleX}set flipX(t){af.deprecatedWarning1||(af.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){af.deprecatedWarning1||(af.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let hf=af;hf.deprecatedWarning1=!1;class lf{constructor(){this.name=null,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=null,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=0,this.y=0,this.width=0,this.height=0,this.version=null,this.hash=null,this.fps=0,this.imagesPath=null,this.audioPath=null}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1}findSkin(t){if(!t)throw new Error("skinName cannot be null.");const e=this.skins;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");const e=this.animations;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.name==t)return n}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1}}class cf{constructor(t,e,r){if(this.index=0,this.color=new Ah(1,1,1,1),this.darkColor=null,this.attachmentName=null,this.blendMode=v.NORMAL,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!r)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=r}}class uf extends qd{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class df{constructor(t,e,r){this.slotIndex=t,this.name=e,this.attachment=r}}class ff{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,r){if(!r)throw new Error("attachment cannot be null.");const n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=r}addSkin(t){for(let e=0;e<t.bones.length;e++){const r=t.bones[e];let n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==r){n=!0;break}n||this.bones.push(r)}for(let e=0;e<t.constraints.length;e++){const r=t.constraints[e];let n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==r){n=!0;break}n||this.constraints.push(r)}const e=t.getAttachments();for(let t=0;t<e.length;t++){const r=e[t];this.setAttachment(r.slotIndex,r.name,r.attachment)}}copySkin(t){for(let e=0;e<t.bones.length;e++){const r=t.bones[e];let n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==r){n=!0;break}n||this.bones.push(r)}for(let e=0;e<t.constraints.length;e++){const r=t.constraints[e];let n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==r){n=!0;break}n||this.constraints.push(r)}const e=t.getAttachments();for(let t=0;t<e.length;t++){const r=e[t];r.attachment&&(r.attachment instanceof Yu?(r.attachment=r.attachment.newLinkedMesh(),this.setAttachment(r.slotIndex,r.name,r.attachment)):(r.attachment=r.attachment.copy(),this.setAttachment(r.slotIndex,r.name,r.attachment)))}}getAttachment(t,e){const r=this.attachments[t];return r?r[e]:null}removeAttachment(t,e){const r=this.attachments[t];r&&delete r[e]}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const r=this.attachments[e];if(r)for(const n in r){const s=r[n];s&&t.push(new df(e,n,s))}}return t}getAttachmentsForSlot(t,e){const r=this.attachments[t];if(r)for(const n in r){const s=r[n];s&&e.push(new df(t,n,s))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let r=0;for(let n=0;n<t.slots.length;n++){const s=t.slots[n],i=s.getAttachment();if(i&&r<e.attachments.length){const t=e.attachments[r];for(const e in t)if(i==t[e]){const t=this.getAttachment(r,e);t&&s.setAttachment(t);break}}r++}}}class pf{constructor(t){this.ver40=!1,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,r=new lf;r.name="";const n=new ah(t),s=n.readInt32(),i=n.readInt32();r.hash=0==i&&0==s?null:i.toString(16)+s.toString(16),r.version=n.readString();const o=r.version.substr(0,3);if("4.0"!==o&&"4.1"!==o){const t=`Spine 4.1 loader cant load version ${r.version}. Please configure your pixi-spine bundle`;console.error(t)}this.ver40="4.0"===o,r.x=n.readFloat(),r.y=n.readFloat(),r.width=n.readFloat(),r.height=n.readFloat();const a=n.readBoolean();a&&(r.fps=n.readFloat(),r.imagesPath=n.readString(),r.audioPath=n.readString());let h=0;h=n.readInt(!0);for(let t=0;t<h;t++){const t=n.readString();if(!t)throw new Error("String in string table must not be null.");n.strings.push(t)}h=n.readInt(!0);for(let t=0;t<h;t++){const s=n.readString();if(!s)throw new Error("Bone name must not be null.");const i=0==t?null:r.bones[n.readInt(!0)],o=new zd(t,s,i);o.rotation=n.readFloat(),o.x=n.readFloat()*e,o.y=n.readFloat()*e,o.scaleX=n.readFloat(),o.scaleY=n.readFloat(),o.shearX=n.readFloat(),o.shearY=n.readFloat(),o.length=n.readFloat()*e,o.transformMode=n.readInt(!0),o.skinRequired=n.readBoolean(),a&&Ah.rgba8888ToColor(o.color,n.readInt32()),r.bones.push(o)}h=n.readInt(!0);for(let t=0;t<h;t++){const e=n.readString();if(!e)throw new Error("Slot name must not be null.");const s=r.bones[n.readInt(!0)],i=new cf(t,e,s);Ah.rgba8888ToColor(i.color,n.readInt32());const o=n.readInt32();-1!=o&&Ah.rgb888ToColor(i.darkColor=new Ah,o),i.attachmentName=n.readStringRef(),i.blendMode=n.readInt(!0),r.slots.push(i)}h=n.readInt(!0);for(let t,s=0;s<h;s++){const s=n.readString();if(!s)throw new Error("IK constraint data name must not be null.");const i=new Jd(s);i.order=n.readInt(!0),i.skinRequired=n.readBoolean(),t=n.readInt(!0);for(let e=0;e<t;e++)i.bones.push(r.bones[n.readInt(!0)]);i.target=r.bones[n.readInt(!0)],i.mix=n.readFloat(),i.softness=n.readFloat()*e,i.bendDirection=n.readByte(),i.compress=n.readBoolean(),i.stretch=n.readBoolean(),i.uniform=n.readBoolean(),r.ikConstraints.push(i)}h=n.readInt(!0);for(let t,s=0;s<h;s++){const s=n.readString();if(!s)throw new Error("Transform constraint data name must not be null.");const i=new uf(s);i.order=n.readInt(!0),i.skinRequired=n.readBoolean(),t=n.readInt(!0);for(let e=0;e<t;e++)i.bones.push(r.bones[n.readInt(!0)]);i.target=r.bones[n.readInt(!0)],i.local=n.readBoolean(),i.relative=n.readBoolean(),i.offsetRotation=n.readFloat(),i.offsetX=n.readFloat()*e,i.offsetY=n.readFloat()*e,i.offsetScaleX=n.readFloat(),i.offsetScaleY=n.readFloat(),i.offsetShearY=n.readFloat(),i.mixRotate=n.readFloat(),i.mixX=n.readFloat(),i.mixY=n.readFloat(),i.mixScaleX=n.readFloat(),i.mixScaleY=n.readFloat(),i.mixShearY=n.readFloat(),r.transformConstraints.push(i)}h=n.readInt(!0);for(let t,s=0;s<h;s++){const s=n.readString();if(!s)throw new Error("Path constraint data name must not be null.");const i=new tf(s);i.order=n.readInt(!0),i.skinRequired=n.readBoolean(),t=n.readInt(!0);for(let e=0;e<t;e++)i.bones.push(r.bones[n.readInt(!0)]);i.target=r.slots[n.readInt(!0)],i.positionMode=n.readInt(!0),i.spacingMode=n.readInt(!0),i.rotateMode=n.readInt(!0),i.offsetRotation=n.readFloat(),i.position=n.readFloat(),i.positionMode==ch.Fixed&&(i.position*=e),i.spacing=n.readFloat(),i.spacingMode!=ef.Length&&i.spacingMode!=ef.Fixed||(i.spacing*=e),i.mixRotate=n.readFloat(),i.mixX=n.readFloat(),i.mixY=n.readFloat(),r.pathConstraints.push(i)}const l=this.readSkin(n,r,!0,a);l&&(r.defaultSkin=l,r.skins.push(l));{let t=r.skins.length;for(kh.setArraySize(r.skins,h=t+n.readInt(!0));t<h;t++){const e=this.readSkin(n,r,!1,a);if(!e)throw new Error("readSkin() should not have returned null.");r.skins[t]=e}}h=this.linkedMeshes.length;for(let t=0;t<h;t++){const e=this.linkedMeshes[t],n=e.skin?r.findSkin(e.skin):r.defaultSkin;if(!n)throw new Error("Not skin found for linked mesh.");if(!e.parent)throw new Error("Linked mesh parent must not be null");const s=n.getAttachment(e.slotIndex,e.parent);if(!s)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.timelineAttachment=e.inheritTimeline?s:e.mesh,e.mesh.setParentMesh(s)}this.linkedMeshes.length=0,h=n.readInt(!0);for(let t=0;t<h;t++){const t=n.readStringRef();if(!t)throw new Error;const e=new Zd(t);e.intValue=n.readInt(!1),e.floatValue=n.readFloat(),e.stringValue=n.readString(),e.audioPath=n.readString(),e.audioPath&&(e.volume=n.readFloat(),e.balance=n.readFloat()),r.events.push(e)}h=n.readInt(!0);for(let t=0;t<h;t++){const t=n.readString();if(!t)throw new Error("Animatio name must not be null.");r.animations.push(this.readAnimation(n,t,r))}return r}readSkin(t,e,r,n){let s=null,i=0;if(r){if(i=t.readInt(!0),0==i)return null;s=new ff("default")}else{const r=t.readStringRef();if(!r)throw new Error("Skin name must not be null.");s=new ff(r),s.bones.length=t.readInt(!0);for(let r=0,n=s.bones.length;r<n;r++)s.bones[r]=e.bones[t.readInt(!0)];for(let r=0,n=t.readInt(!0);r<n;r++)s.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let r=0,n=t.readInt(!0);r<n;r++)s.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let r=0,n=t.readInt(!0);r<n;r++)s.constraints.push(e.pathConstraints[t.readInt(!0)]);i=t.readInt(!0)}for(let r=0;r<i;r++){const r=t.readInt(!0);for(let i=0,o=t.readInt(!0);i<o;i++){const i=t.readStringRef();if(!i)throw new Error("Attachment name must not be null");const o=this.readAttachment(t,e,s,r,i,n);o&&s.setAttachment(r,i,o)}}return s}readAttachment(t,e,r,n,s,i){const o=this.scale;let a=t.readStringRef();switch(a||(a=s),t.readByte()){case oh.Region:{let e=t.readStringRef();const n=t.readFloat(),s=t.readFloat(),i=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readInt32(),f=this.readSequence(t);e||(e=a);const p=this.attachmentLoader.newRegionAttachment(r,a,e,f);return p?(p.path=e,p.x=s*o,p.y=i*o,p.scaleX=h,p.scaleY=l,p.rotation=n,p.width=c*o,p.height=u*o,Ah.rgba8888ToColor(p.color,d),p.sequence=f,null==f&&p.updateRegion(),p):null}case oh.BoundingBox:{const e=t.readInt(!0),n=this.readVertices(t,e),s=i?t.readInt32():0,o=this.attachmentLoader.newBoundingBoxAttachment(r,a);return o?(o.worldVerticesLength=e<<1,o.vertices=n.vertices,o.bones=n.bones,i&&Ah.rgba8888ToColor(o.color,s),o):null}case oh.Mesh:{let e=t.readStringRef();const n=t.readInt32(),s=t.readInt(!0),h=this.readFloatArray(t,s<<1,1),l=this.readShortArray(t),c=this.readVertices(t,s),u=t.readInt(!0),d=this.readSequence(t);let f=[],p=0,m=0;i&&(f=this.readShortArray(t),p=t.readFloat(),m=t.readFloat()),e||(e=a);const g=this.attachmentLoader.newMeshAttachment(r,a,e,d);return g?(g.path=e,Ah.rgba8888ToColor(g.color,n),g.bones=c.bones,g.vertices=c.vertices,g.worldVerticesLength=s<<1,g.triangles=l,g.regionUVs=new Float32Array(h),g.hullLength=u<<1,g.sequence=d,i&&(g.edges=f,g.width=p*o,g.height=m*o),g):null}case oh.LinkedMesh:{let e=t.readStringRef();const s=t.readInt32(),h=t.readStringRef(),l=t.readStringRef(),c=t.readBoolean(),u=this.readSequence(t);let d=0,f=0;i&&(d=t.readFloat(),f=t.readFloat()),e||(e=a);const p=this.attachmentLoader.newMeshAttachment(r,a,e,u);return p?(p.path=e,Ah.rgba8888ToColor(p.color,s),p.sequence=u,i&&(p.width=d*o,p.height=f*o),this.linkedMeshes.push(new mf(p,h,n,l,c)),p):null}case oh.Path:{const e=t.readBoolean(),n=t.readBoolean(),s=t.readInt(!0),h=this.readVertices(t,s),l=kh.newArray(s/3,0);for(let e=0,r=l.length;e<r;e++)l[e]=t.readFloat()*o;const c=i?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(r,a);return u?(u.closed=e,u.constantSpeed=n,u.worldVerticesLength=s<<1,u.vertices=h.vertices,u.bones=h.bones,u.lengths=l,i&&Ah.rgba8888ToColor(u.color,c),u):null}case oh.Point:{const e=t.readFloat(),n=t.readFloat(),s=t.readFloat(),h=i?t.readInt32():0,l=this.attachmentLoader.newPointAttachment(r,a);return l?(l.x=n*o,l.y=s*o,l.rotation=e,i&&Ah.rgba8888ToColor(l.color,h),l):null}case oh.Clipping:{const n=t.readInt(!0),s=t.readInt(!0),o=this.readVertices(t,s),h=i?t.readInt32():0,l=this.attachmentLoader.newClippingAttachment(r,a);return l?(l.endSlot=e.slots[n],l.worldVerticesLength=s<<1,l.vertices=o.vertices,l.bones=o.bones,i&&Ah.rgba8888ToColor(l.color,h),l):null}}return null}readSequence(t){if(this.ver40||!t.readBoolean())return null;const e=new qu(t.readInt(!0));return e.start=t.readInt(!0),e.digits=t.readInt(!0),e.setupIndex=t.readInt(!0),e}readDeformTimelineType(t){return this.ver40?Bf:t.readByte()}readVertices(t,e){const r=this.scale,n=e<<1,s=new gf;if(!t.readBoolean())return s.vertices=this.readFloatArray(t,n,r),s;const i=new Array,o=new Array;for(let n=0;n<e;n++){const e=t.readInt(!0);o.push(e);for(let n=0;n<e;n++)o.push(t.readInt(!0)),i.push(t.readFloat()*r),i.push(t.readFloat()*r),i.push(t.readFloat())}return s.vertices=kh.toFloatArray(i),s.bones=o,s}readFloatArray(t,e,r){const n=new Array(e);if(1==r)for(let r=0;r<e;r++)n[r]=t.readFloat();else for(let s=0;s<e;s++)n[s]=t.readFloat()*r;return n}readShortArray(t){const e=t.readInt(!0),r=new Array(e);for(let n=0;n<e;n++)r[n]=t.readShort();return r}readAnimation(t,e,r){t.readInt(!0);const n=new Array,s=this.scale;for(let e=0,r=t.readInt(!0);e<r;e++){const e=t.readInt(!0);for(let r=0,s=t.readInt(!0);r<s;r++){const r=t.readByte(),s=t.readInt(!0),i=s-1;switch(r){case Pf:{const r=new bd(s,e);for(let e=0;e<s;e++)r.setFrame(e,t.readFloat(),t.readStringRef());n.push(r);break}case Cf:{const r=t.readInt(!0),o=new fd(s,r,e);let a=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;for(let e=0,r=0;o.setFrame(e,a,h,l,c,u),e!=i;e++){const n=t.readFloat(),s=t.readUnsignedByte()/255,i=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;switch(t.readByte()){case Xf:o.setStepped(e);break;case jf:xf(t,o,r++,e,0,a,n,h,s,1),xf(t,o,r++,e,1,a,n,l,i,1),xf(t,o,r++,e,2,a,n,c,d,1),xf(t,o,r++,e,3,a,n,u,f,1)}a=n,h=s,l=i,c=d,u=f}n.push(o);break}case kf:{const r=t.readInt(!0),o=new pd(s,r,e);let a=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255;for(let e=0,r=0;o.setFrame(e,a,h,l,c),e!=i;e++){const n=t.readFloat(),s=t.readUnsignedByte()/255,i=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;switch(t.readByte()){case Xf:o.setStepped(e);break;case jf:xf(t,o,r++,e,0,a,n,h,s,1),xf(t,o,r++,e,1,a,n,l,i,1),xf(t,o,r++,e,2,a,n,c,u,1)}a=n,h=s,l=i,c=u}n.push(o);break}case Of:{const r=t.readInt(!0),o=new gd(s,r,e);let a=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255;for(let e=0,r=0;o.setFrame(e,a,h,l,c,u,d,f,p),e!=i;e++){const n=t.readFloat(),s=t.readUnsignedByte()/255,i=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,b=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255;switch(t.readByte()){case Xf:o.setStepped(e);break;case jf:xf(t,o,r++,e,0,a,n,h,s,1),xf(t,o,r++,e,1,a,n,l,i,1),xf(t,o,r++,e,2,a,n,c,m,1),xf(t,o,r++,e,3,a,n,u,g,1),xf(t,o,r++,e,4,a,n,d,y,1),xf(t,o,r++,e,5,a,n,f,b,1),xf(t,o,r++,e,6,a,n,p,x,1)}a=n,h=s,l=i,c=m,u=g,d=y,f=b,p=x}n.push(o);break}case Ff:{const r=t.readInt(!0),o=new yd(s,r,e);let a=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;for(let e=0,r=0;o.setFrame(e,a,h,l,c,u,d,f),e!=i;e++){const n=t.readFloat(),s=t.readUnsignedByte()/255,i=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255;switch(t.readByte()){case Xf:o.setStepped(e);break;case jf:xf(t,o,r++,e,0,a,n,h,s,1),xf(t,o,r++,e,1,a,n,l,i,1),xf(t,o,r++,e,2,a,n,c,p,1),xf(t,o,r++,e,3,a,n,u,m,1),xf(t,o,r++,e,4,a,n,d,g,1),xf(t,o,r++,e,5,a,n,f,y,1)}a=n,h=s,l=i,c=p,u=m,d=g,f=y}n.push(o);break}case Nf:{const r=new md(s,t.readInt(!0),e);let o=t.readFloat(),a=t.readUnsignedByte()/255;for(let e=0,n=0;r.setFrame(e,o,a),e!=i;e++){const s=t.readFloat(),i=t.readUnsignedByte()/255;switch(t.readByte()){case Xf:r.setStepped(e);break;case jf:xf(t,r,n++,e,0,o,s,a,i,1)}o=s,a=i}n.push(r)}}}}for(let e=0,r=t.readInt(!0);e<r;e++){const e=t.readInt(!0);for(let r=0,i=t.readInt(!0);r<i;r++){const r=t.readByte(),i=t.readInt(!0),o=t.readInt(!0);switch(r){case _f:n.push(yf(t,new nd(i,o,e),1));break;case vf:n.push(bf(t,new sd(i,o,e),s));break;case wf:n.push(yf(t,new id(i,o,e),s));break;case Ef:n.push(yf(t,new od(i,o,e),s));break;case Tf:n.push(bf(t,new ad(i,o,e),1));break;case Af:n.push(yf(t,new hd(i,o,e),1));break;case Sf:n.push(yf(t,new ld(i,o,e),1));break;case Rf:n.push(bf(t,new cd(i,o,e),1));break;case If:n.push(yf(t,new ud(i,o,e),1));break;case Mf:n.push(yf(t,new dd(i,o,e),1))}}}for(let e=0,r=t.readInt(!0);e<r;e++){const e=t.readInt(!0),r=t.readInt(!0),i=r-1,o=new Td(r,t.readInt(!0),e);let a=t.readFloat(),h=t.readFloat(),l=t.readFloat()*s;for(let e=0,r=0;o.setFrame(e,a,h,l,t.readByte(),t.readBoolean(),t.readBoolean()),e!=i;e++){const n=t.readFloat(),i=t.readFloat(),c=t.readFloat()*s;switch(t.readByte()){case Xf:o.setStepped(e);break;case jf:xf(t,o,r++,e,0,a,n,h,i,1),xf(t,o,r++,e,1,a,n,l,c,s)}a=n,h=i,l=c}n.push(o)}for(let e=0,r=t.readInt(!0);e<r;e++){const e=t.readInt(!0),r=t.readInt(!0),s=r-1,i=new Ad(r,t.readInt(!0),e);let o=t.readFloat(),a=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readFloat();for(let e=0,r=0;i.setFrame(e,o,a,h,l,c,u,d),e!=s;e++){const n=t.readFloat(),s=t.readFloat(),f=t.readFloat(),p=t.readFloat(),m=t.readFloat(),g=t.readFloat(),y=t.readFloat();switch(t.readByte()){case Xf:i.setStepped(e);break;case jf:xf(t,i,r++,e,0,o,n,a,s,1),xf(t,i,r++,e,1,o,n,h,f,1),xf(t,i,r++,e,2,o,n,l,p,1),xf(t,i,r++,e,3,o,n,c,m,1),xf(t,i,r++,e,4,o,n,u,g,1),xf(t,i,r++,e,5,o,n,d,y,1)}o=n,a=s,h=f,l=p,c=m,u=g,d=y}n.push(i)}for(let e=0,i=t.readInt(!0);e<i;e++){const e=t.readInt(!0),i=r.pathConstraints[e];for(let r=0,o=t.readInt(!0);r<o;r++)switch(t.readByte()){case Lf:n.push(yf(t,new Sd(t.readInt(!0),t.readInt(!0),e),i.positionMode==ch.Fixed?s:1));break;case Vf:n.push(yf(t,new Rd(t.readInt(!0),t.readInt(!0),e),i.spacingMode==ef.Length||i.spacingMode==ef.Fixed?s:1));break;case Uf:const r=new Id(t.readInt(!0),t.readInt(!0),e);let o=t.readFloat(),a=t.readFloat(),h=t.readFloat(),l=t.readFloat();for(let e=0,n=0,s=r.getFrameCount()-1;r.setFrame(e,o,a,h,l),e!=s;e++){const s=t.readFloat(),i=t.readFloat(),c=t.readFloat(),u=t.readFloat();switch(t.readByte()){case Xf:r.setStepped(e);break;case jf:xf(t,r,n++,e,0,o,s,a,i,1),xf(t,r,n++,e,1,o,s,h,c,1),xf(t,r,n++,e,2,o,s,l,u,1)}o=s,a=i,h=c,l=u}n.push(r)}}for(let e=0,i=t.readInt(!0);e<i;e++){const e=r.skins[t.readInt(!0)];for(let r=0,i=t.readInt(!0);r<i;r++){const r=t.readInt(!0);for(let i=0,o=t.readInt(!0);i<o;i++){const i=t.readStringRef();if(!i)throw new Error("attachmentName must not be null.");const o=e.getAttachment(r,i),a=this.readDeformTimelineType(t),h=t.readInt(!0),l=h-1;switch(a){case Bf:{const e=o,i=e.bones,a=e.vertices,c=i?a.length/3*2:a.length,u=t.readInt(!0),d=new xd(h,u,r,e);let f=t.readFloat();for(let e=0,r=0;;e++){let n,o=t.readInt(!0);if(0==o)n=i?kh.newFloatArray(c):a;else{n=kh.newFloatArray(c);const e=t.readInt(!0);if(o+=e,1==s)for(let r=e;r<o;r++)n[r]=t.readFloat();else for(let r=e;r<o;r++)n[r]=t.readFloat()*s;if(!i)for(let t=0,e=n.length;t<e;t++)n[t]+=a[t]}if(d.setFrame(e,f,n),e==l)break;const h=t.readFloat();switch(t.readByte()){case Xf:d.setStepped(e);break;case jf:xf(t,d,r++,e,0,f,h,0,1,1)}f=h}n.push(d);break}case Df:{const e=new Pd(h,r,o);for(let r=0;r<h;r++){const n=t.readFloat(),s=t.readInt32();e.setFrame(r,n,Zu[15&s],s>>4,t.readFloat())}n.push(e);break}}}}}const i=t.readInt(!0);if(i>0){const e=new Ed(i),s=r.slots.length;for(let r=0;r<i;r++){const n=t.readFloat(),i=t.readInt(!0),o=kh.newArray(s,0);for(let t=s-1;t>=0;t--)o[t]=-1;const a=kh.newArray(s-i,0);let h=0,l=0;for(let e=0;e<i;e++){const e=t.readInt(!0);for(;h!=e;)a[l++]=h++;o[h+t.readInt(!0)]=h++}for(;h<s;)a[l++]=h++;for(let t=s-1;t>=0;t--)-1==o[t]&&(o[t]=a[--l]);e.setFrame(r,n,o)}n.push(e)}const o=t.readInt(!0);if(o>0){const e=new vd(o);for(let n=0;n<o;n++){const s=t.readFloat(),i=r.events[t.readInt(!0)],o=new Kd(s,i);o.intValue=t.readInt(!1),o.floatValue=t.readFloat(),o.stringValue=t.readBoolean()?t.readString():i.stringValue,o.data.audioPath&&(o.volume=t.readFloat(),o.balance=t.readFloat()),e.setFrame(n,o)}n.push(e)}let a=0;for(let t=0,e=n.length;t<e;t++)a=Math.max(a,n[t].getDuration());return new Qu(e,n,a)}}pf.BlendModeValues=[v.NORMAL,v.ADD,v.MULTIPLY,v.SCREEN];class mf{constructor(t,e,r,n,s){this.mesh=t,this.skin=e,this.slotIndex=r,this.parent=n,this.inheritTimeline=s}}class gf{constructor(t=null,e=null){this.bones=t,this.vertices=e}}function yf(t,e,r){let n=t.readFloat(),s=t.readFloat()*r;for(let i=0,o=0,a=e.getFrameCount()-1;e.setFrame(i,n,s),i!=a;i++){const a=t.readFloat(),h=t.readFloat()*r;switch(t.readByte()){case Xf:e.setStepped(i);break;case jf:xf(t,e,o++,i,0,n,a,s,h,r)}n=a,s=h}return e}function bf(t,e,r){let n=t.readFloat(),s=t.readFloat()*r,i=t.readFloat()*r;for(let o=0,a=0,h=e.getFrameCount()-1;e.setFrame(o,n,s,i),o!=h;o++){const h=t.readFloat(),l=t.readFloat()*r,c=t.readFloat()*r;switch(t.readByte()){case Xf:e.setStepped(o);break;case jf:xf(t,e,a++,o,0,n,h,s,l,r),xf(t,e,a++,o,1,n,h,i,c,r)}n=h,s=l,i=c}return e}function xf(t,e,r,n,s,i,o,a,h,l){e.setBezier(r,n,s,i,a,t.readFloat(),t.readFloat()*l,t.readFloat(),t.readFloat()*l,o,h)}const _f=0,vf=1,wf=2,Ef=3,Tf=4,Af=5,Sf=6,Rf=7,If=8,Mf=9,Pf=0,Cf=1,kf=2,Of=3,Ff=4,Nf=5,Bf=0,Df=1,Lf=0,Vf=1,Uf=2,Xf=1,jf=2;class Yf extends Nh{}class Gf{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,r=new lf,n="string"==typeof t?JSON.parse(t):t,s=n.skeleton;if(s){r.hash=s.hash,r.version=s.spine;const t=r.version.substr(0,3);if("4.0"!==t&&"4.1"!==t){const t=`Spine 4.1 loader cant load version ${s.spine}. Please configure your pixi-spine bundle`;console.error(t)}r.x=s.x,r.y=s.y,r.width=s.width,r.height=s.height,r.fps=s.fps,r.imagesPath=s.images}if(n.bones)for(let t=0;t<n.bones.length;t++){const s=n.bones[t];let i=null;const o=qf(s,"parent",null);if(null!=o&&(i=r.findBone(o),null==i))throw new Error(`Parent bone not found: ${o}`);const a=new zd(r.bones.length,s.name,i);a.length=qf(s,"length",0)*e,a.x=qf(s,"x",0)*e,a.y=qf(s,"y",0)*e,a.rotation=qf(s,"rotation",0),a.scaleX=qf(s,"scaleX",1),a.scaleY=qf(s,"scaleY",1),a.shearX=qf(s,"shearX",0),a.shearY=qf(s,"shearY",0),a.transformMode=kh.enumValue(dh,qf(s,"transform","Normal")),a.skinRequired=qf(s,"skin",!1);const h=qf(s,"color",null);h&&a.color.setFromString(h),r.bones.push(a)}if(n.slots)for(let t=0;t<n.slots.length;t++){const e=n.slots[t],s=r.findBone(e.bone);if(!s)throw new Error(`Couldn't find bone ${e.bone} for slot ${e.name}`);const i=new cf(r.slots.length,e.name,s),o=qf(e,"color",null);o&&i.color.setFromString(o);const a=qf(e,"dark",null);a&&(i.darkColor=Ah.fromString(a)),i.attachmentName=qf(e,"attachment",null),i.blendMode=Gf.blendModeFromString(qf(e,"blend","normal")),r.slots.push(i)}if(n.ik)for(let t=0;t<n.ik.length;t++){const s=n.ik[t],i=new Jd(s.name);i.order=qf(s,"order",0),i.skinRequired=qf(s,"skin",!1);for(let t=0;t<s.bones.length;t++){const e=s.bones[t],n=r.findBone(e);if(null==n)throw new Error(`IK bone not found: ${e}`);i.bones.push(n)}i.target=r.findBone(s.target),i.mix=qf(s,"mix",1),i.softness=qf(s,"softness",0)*e,i.bendDirection=qf(s,"bendPositive",!0)?1:-1,i.compress=qf(s,"compress",!1),i.stretch=qf(s,"stretch",!1),i.uniform=qf(s,"uniform",!1),r.ikConstraints.push(i)}if(n.transform)for(let t=0;t<n.transform.length;t++){const s=n.transform[t],i=new uf(s.name);i.order=qf(s,"order",0),i.skinRequired=qf(s,"skin",!1);for(let t=0;t<s.bones.length;t++){const e=s.bones[t],n=r.findBone(e);if(!n)throw new Error(`Couldn't find bone ${e} for transform constraint ${s.name}.`);i.bones.push(n)}const o=s.target,a=r.findBone(o);if(!a)throw new Error(`Couldn't find target bone ${o} for transform constraint ${s.name}.`);i.target=a,i.local=qf(s,"local",!1),i.relative=qf(s,"relative",!1),i.offsetRotation=qf(s,"rotation",0),i.offsetX=qf(s,"x",0)*e,i.offsetY=qf(s,"y",0)*e,i.offsetScaleX=qf(s,"scaleX",0),i.offsetScaleY=qf(s,"scaleY",0),i.offsetShearY=qf(s,"shearY",0),i.mixRotate=qf(s,"mixRotate",1),i.mixX=qf(s,"mixX",1),i.mixY=qf(s,"mixY",i.mixX),i.mixScaleX=qf(s,"mixScaleX",1),i.mixScaleY=qf(s,"mixScaleY",i.mixScaleX),i.mixShearY=qf(s,"mixShearY",1),r.transformConstraints.push(i)}if(n.path)for(let t=0;t<n.path.length;t++){const s=n.path[t],i=new tf(s.name);i.order=qf(s,"order",0),i.skinRequired=qf(s,"skin",!1);for(let t=0;t<s.bones.length;t++){const e=s.bones[t],n=r.findBone(e);if(!n)throw new Error(`Couldn't find bone ${e} for path constraint ${s.name}.`);i.bones.push(n)}const o=s.target,a=r.findSlot(o);if(!a)throw new Error(`Couldn't find target slot ${o} for path constraint ${s.name}.`);i.target=a,i.positionMode=kh.enumValue(ch,qf(s,"positionMode","Percent")),i.spacingMode=kh.enumValue(ef,qf(s,"spacingMode","Length")),i.rotateMode=kh.enumValue(uh,qf(s,"rotateMode","Tangent")),i.offsetRotation=qf(s,"rotation",0),i.position=qf(s,"position",0),i.positionMode==ch.Fixed&&(i.position*=e),i.spacing=qf(s,"spacing",0),i.spacingMode!=ef.Length&&i.spacingMode!=ef.Fixed||(i.spacing*=e),i.mixRotate=qf(s,"mixRotate",1),i.mixX=qf(s,"mixX",1),i.mixY=qf(s,"mixY",i.mixX),r.pathConstraints.push(i)}if(n.skins)for(let t=0;t<n.skins.length;t++){const e=n.skins[t],s=new ff(e.name);if(e.bones)for(let t=0;t<e.bones.length;t++){const n=e.bones[t],i=r.findBone(n);if(!i)throw new Error(`Couldn't find bone ${n} for skin ${e.name}.`);s.bones.push(i)}if(e.ik)for(let t=0;t<e.ik.length;t++){const n=e.ik[t],i=r.findIkConstraint(n);if(!i)throw new Error(`Couldn't find IK constraint ${n} for skin ${e.name}.`);s.constraints.push(i)}if(e.transform)for(let t=0;t<e.transform.length;t++){const n=e.transform[t],i=r.findTransformConstraint(n);if(!i)throw new Error(`Couldn't find transform constraint ${n} for skin ${e.name}.`);s.constraints.push(i)}if(e.path)for(let t=0;t<e.path.length;t++){const n=e.path[t],i=r.findPathConstraint(n);if(!i)throw new Error(`Couldn't find path constraint ${n} for skin ${e.name}.`);s.constraints.push(i)}for(const t in e.attachments){const n=r.findSlot(t);if(!n)throw new Error(`Couldn't find slot ${t} for skin ${e.name}.`);const i=e.attachments[t];for(const t in i){const e=this.readAttachment(i[t],s,n.index,t,r);e&&s.setAttachment(n.index,t,e)}}r.skins.push(s),"default"==s.name&&(r.defaultSkin=s)}for(let t=0,e=this.linkedMeshes.length;t<e;t++){const e=this.linkedMeshes[t],n=e.skin?r.findSkin(e.skin):r.defaultSkin;if(!n)throw new Error(`Skin not found: ${e.skin}`);const s=n.getAttachment(e.slotIndex,e.parent);if(!s)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.timelineAttachment=e.inheritTimeline?s:e.mesh,e.mesh.setParentMesh(s)}if(this.linkedMeshes.length=0,n.events)for(const t in n.events){const e=n.events[t],s=new Zd(t);s.intValue=qf(e,"int",0),s.floatValue=qf(e,"float",0),s.stringValue=qf(e,"string",""),s.audioPath=qf(e,"audio",null),s.audioPath&&(s.volume=qf(e,"volume",1),s.balance=qf(e,"balance",0)),r.events.push(s)}if(n.animations)for(const t in n.animations){const e=n.animations[t];this.readAnimation(e,t,r)}return r}readAttachment(t,e,r,n,s){const i=this.scale;switch(n=qf(t,"name",n),qf(t,"type","region")){case"region":{const r=qf(t,"path",n),s=this.readSequence(qf(t,"sequence",null)),o=this.attachmentLoader.newRegionAttachment(e,n,r,s);if(!o)return null;o.path=r,o.x=qf(t,"x",0)*i,o.y=qf(t,"y",0)*i,o.scaleX=qf(t,"scaleX",1),o.scaleY=qf(t,"scaleY",1),o.rotation=qf(t,"rotation",0),o.width=t.width*i,o.height=t.height*i,o.sequence=s;const a=qf(t,"color",null);return a&&o.color.setFromString(a),o}case"boundingbox":{const r=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(!r)return null;this.readVertices(t,r,t.vertexCount<<1);const s=qf(t,"color",null);return s&&r.color.setFromString(s),r}case"mesh":case"linkedmesh":{const s=qf(t,"path",n),o=this.readSequence(qf(t,"sequence",null)),a=this.attachmentLoader.newMeshAttachment(e,n,s,o);if(!a)return null;a.path=s;const h=qf(t,"color",null);h&&a.color.setFromString(h),a.width=qf(t,"width",0)*i,a.height=qf(t,"height",0)*i,a.sequence=o;const l=qf(t,"parent",null);if(l)return this.linkedMeshes.push(new Wf(a,qf(t,"skin",null),r,l,qf(t,"timelines",!0))),a;const c=t.uvs;return this.readVertices(t,a,c.length),a.triangles=t.triangles,a.regionUVs=new Float32Array(c),a.edges=qf(t,"edges",null),a.hullLength=2*qf(t,"hull",0),a}case"path":{const r=this.attachmentLoader.newPathAttachment(e,n);if(!r)return null;r.closed=qf(t,"closed",!1),r.constantSpeed=qf(t,"constantSpeed",!0);const s=t.vertexCount;this.readVertices(t,r,s<<1);const o=kh.newArray(s/3,0);for(let e=0;e<t.lengths.length;e++)o[e]=t.lengths[e]*i;r.lengths=o;const a=qf(t,"color",null);return a&&r.color.setFromString(a),r}case"point":{const r=this.attachmentLoader.newPointAttachment(e,n);if(!r)return null;r.x=qf(t,"x",0)*i,r.y=qf(t,"y",0)*i,r.rotation=qf(t,"rotation",0);const s=qf(t,"color",null);return s&&r.color.setFromString(s),r}case"clipping":{const r=this.attachmentLoader.newClippingAttachment(e,n);if(!r)return null;const i=qf(t,"end",null);if(null!=i){const t=s.findSlot(i);if(null==t)throw new Error(`Clipping end slot not found: ${i}`);r.endSlot=t}const o=t.vertexCount;this.readVertices(t,r,o<<1);const a=qf(t,"color",null);return a&&r.color.setFromString(a),r}}return null}readSequence(t){if(null==t)return null;const e=new qu(qf(t,"count",0));return e.start=qf(t,"start",1),e.digits=qf(t,"digits",0),e.setupIndex=qf(t,"setup",0),e}readVertices(t,e,r){const n=this.scale;e.worldVerticesLength=r;const s=t.vertices;if(r==s.length){const t=kh.toFloatArray(s);if(1!=n)for(let e=0,r=s.length;e<r;e++)t[e]*=n;return void(e.vertices=t)}const i=new Array,o=new Array;for(let t=0,e=s.length;t<e;){const e=s[t++];o.push(e);for(let r=t+4*e;t<r;t+=4)o.push(s[t]),i.push(s[t+1]*n),i.push(s[t+2]*n),i.push(s[t+3])}e.bones=o,e.vertices=kh.toFloatArray(i)}readAnimation(t,e,r){const n=this.scale,s=new Array;if(t.slots)for(const e in t.slots){const n=t.slots[e],i=r.findSlot(e);if(!i)throw new Error(`Slot not found: ${e}`);const o=i.index;for(const t in n){const e=n[t];if(!e)continue;const r=e.length;if("attachment"==t){const t=new bd(r,o);for(let n=0;n<r;n++){const r=e[n];t.setFrame(n,qf(r,"time",0),qf(r,"name",null))}s.push(t)}else if("rgba"==t){const t=new fd(r,r<<2,o);let n=e[0],i=qf(n,"time",0),a=Ah.fromString(n.color);for(let r=0,s=0;;r++){t.setFrame(r,i,a.r,a.g,a.b,a.a);const o=e[r+1];if(!o){t.shrink(s);break}const h=qf(o,"time",0),l=Ah.fromString(o.color),c=n.curve;c&&(s=zf(c,t,s,r,0,i,h,a.r,l.r,1),s=zf(c,t,s,r,1,i,h,a.g,l.g,1),s=zf(c,t,s,r,2,i,h,a.b,l.b,1),s=zf(c,t,s,r,3,i,h,a.a,l.a,1)),i=h,a=l,n=o}s.push(t)}else if("rgb"==t){const t=new pd(r,3*r,o);let n=e[0],i=qf(n,"time",0),a=Ah.fromString(n.color);for(let r=0,s=0;;r++){t.setFrame(r,i,a.r,a.g,a.b);const o=e[r+1];if(!o){t.shrink(s);break}const h=qf(o,"time",0),l=Ah.fromString(o.color),c=n.curve;c&&(s=zf(c,t,s,r,0,i,h,a.r,l.r,1),s=zf(c,t,s,r,1,i,h,a.g,l.g,1),s=zf(c,t,s,r,2,i,h,a.b,l.b,1)),i=h,a=l,n=o}s.push(t)}else if("alpha"==t)s.push(Hf(e,new md(r,r,o),0,1));else if("rgba2"==t){const t=new gd(r,7*r,o);let n=e[0],i=qf(n,"time",0),a=Ah.fromString(n.light),h=Ah.fromString(n.dark);for(let r=0,s=0;;r++){t.setFrame(r,i,a.r,a.g,a.b,a.a,h.r,h.g,h.b);const o=e[r+1];if(!o){t.shrink(s);break}const l=qf(o,"time",0),c=Ah.fromString(o.light),u=Ah.fromString(o.dark),d=n.curve;d&&(s=zf(d,t,s,r,0,i,l,a.r,c.r,1),s=zf(d,t,s,r,1,i,l,a.g,c.g,1),s=zf(d,t,s,r,2,i,l,a.b,c.b,1),s=zf(d,t,s,r,3,i,l,a.a,c.a,1),s=zf(d,t,s,r,4,i,l,h.r,u.r,1),s=zf(d,t,s,r,5,i,l,h.g,u.g,1),s=zf(d,t,s,r,6,i,l,h.b,u.b,1)),i=l,a=c,h=u,n=o}s.push(t)}else if("rgb2"==t){const t=new yd(r,6*r,o);let n=e[0],i=qf(n,"time",0),a=Ah.fromString(n.light),h=Ah.fromString(n.dark);for(let r=0,s=0;;r++){t.setFrame(r,i,a.r,a.g,a.b,h.r,h.g,h.b);const o=e[r+1];if(!o){t.shrink(s);break}const l=qf(o,"time",0),c=Ah.fromString(o.light),u=Ah.fromString(o.dark),d=n.curve;d&&(s=zf(d,t,s,r,0,i,l,a.r,c.r,1),s=zf(d,t,s,r,1,i,l,a.g,c.g,1),s=zf(d,t,s,r,2,i,l,a.b,c.b,1),s=zf(d,t,s,r,3,i,l,h.r,u.r,1),s=zf(d,t,s,r,4,i,l,h.g,u.g,1),s=zf(d,t,s,r,5,i,l,h.b,u.b,1)),i=l,a=c,h=u,n=o}s.push(t)}}}if(t.bones)for(const e in t.bones){const i=t.bones[e],o=r.findBone(e);if(!o)throw new Error(`Bone not found: ${e}`);const a=o.index;for(const t in i){const e=i[t],r=e.length;if(0!=r)if("rotate"===t)s.push(Hf(e,new nd(r,r,a),0,1));else if("translate"===t){const t=new sd(r,r<<1,a);s.push($f(e,t,"x","y",0,n))}else if("translatex"===t){const t=new id(r,r,a);s.push(Hf(e,t,0,n))}else if("translatey"===t){const t=new od(r,r,a);s.push(Hf(e,t,0,n))}else if("scale"===t){const t=new ad(r,r<<1,a);s.push($f(e,t,"x","y",1,1))}else if("scalex"===t){const t=new hd(r,r,a);s.push(Hf(e,t,1,1))}else if("scaley"===t){const t=new ld(r,r,a);s.push(Hf(e,t,1,1))}else if("shear"===t){const t=new cd(r,r<<1,a);s.push($f(e,t,"x","y",0,1))}else if("shearx"===t){const t=new ud(r,r,a);s.push(Hf(e,t,0,1))}else if("sheary"===t){const t=new dd(r,r,a);s.push(Hf(e,t,0,1))}}}if(t.ik)for(const e in t.ik){const i=t.ik[e];let o=i[0];if(!o)continue;const a=r.findIkConstraint(e);if(!a)throw new Error(`IK Constraint not found: ${e}`);const h=r.ikConstraints.indexOf(a),l=new Td(i.length,i.length<<1,h);let c=qf(o,"time",0),u=qf(o,"mix",1),d=qf(o,"softness",0)*n;for(let t=0,e=0;;t++){l.setFrame(t,c,u,d,qf(o,"bendPositive",!0)?1:-1,qf(o,"compress",!1),qf(o,"stretch",!1));const r=i[t+1];if(!r){l.shrink(e);break}const s=qf(r,"time",0),a=qf(r,"mix",1),h=qf(r,"softness",0)*n,f=o.curve;f&&(e=zf(f,l,e,t,0,c,s,u,a,1),e=zf(f,l,e,t,1,c,s,d,h,n)),c=s,u=a,d=h,o=r}s.push(l)}if(t.transform)for(const e in t.transform){const n=t.transform[e];let i=n[0];if(!i)continue;const o=r.findTransformConstraint(e);if(!o)throw new Error(`Transform constraint not found: ${e}`);const a=r.transformConstraints.indexOf(o),h=new Ad(n.length,6*n.length,a);let l=qf(i,"time",0),c=qf(i,"mixRotate",1),u=qf(i,"mixX",1),d=qf(i,"mixY",u),f=qf(i,"mixScaleX",1),p=qf(i,"mixScaleY",f);const m=qf(i,"mixShearY",1);for(let t=0,e=0;;t++){h.setFrame(t,l,c,u,d,f,p,m);const r=n[t+1];if(!r){h.shrink(e);break}const s=qf(r,"time",0),o=qf(r,"mixRotate",1),a=qf(r,"mixX",1),g=qf(r,"mixY",a),y=qf(r,"mixScaleX",1),b=qf(r,"mixScaleY",y),x=qf(r,"mixShearY",1),_=i.curve;_&&(e=zf(_,h,e,t,0,l,s,c,o,1),e=zf(_,h,e,t,1,l,s,u,a,1),e=zf(_,h,e,t,2,l,s,d,g,1),e=zf(_,h,e,t,3,l,s,f,y,1),e=zf(_,h,e,t,4,l,s,p,b,1),e=zf(_,h,e,t,5,l,s,m,x,1)),l=s,c=o,u=a,d=g,f=y,p=b,f=y,i=r}s.push(h)}if(t.path)for(const e in t.path){const i=t.path[e],o=r.findPathConstraint(e);if(!o)throw new Error(`Path constraint not found: ${e}`);const a=r.pathConstraints.indexOf(o);for(const t in i){const e=i[t];let r=e[0];if(!r)continue;const h=e.length;if("position"===t){const t=new Sd(h,h,a);s.push(Hf(e,t,0,o.positionMode==ch.Fixed?n:1))}else if("spacing"===t){const t=new Rd(h,h,a);s.push(Hf(e,t,0,o.spacingMode==ef.Length||o.spacingMode==ef.Fixed?n:1))}else if("mix"===t){const t=new Id(h,3*h,a);let n=qf(r,"time",0),i=qf(r,"mixRotate",1),o=qf(r,"mixX",1),l=qf(r,"mixY",o);for(let s=0,a=0;;s++){t.setFrame(s,n,i,o,l);const h=e[s+1];if(!h){t.shrink(a);break}const c=qf(h,"time",0),u=qf(h,"mixRotate",1),d=qf(h,"mixX",1),f=qf(h,"mixY",d),p=r.curve;p&&(a=zf(p,t,a,s,0,n,c,i,u,1),a=zf(p,t,a,s,1,n,c,o,d,1),a=zf(p,t,a,s,2,n,c,l,f,1)),n=c,i=u,o=d,l=f,r=h}s.push(t)}}}if(t.deform){t.attachments={};for(const e in t.deform){const r=t.deform[e],n=t.attachments[e]={};for(const t in r){const e=r[t],s=n[t]={};for(const t in e)s[t]={deform:e[t]}}}}if(t.attachments)for(const e in t.attachments){const i=t.attachments[e],o=r.findSkin(e);if(null!=o)for(const t in i){const e=i[t],a=r.findSlot(t);if(!a)throw new Error(`Slot not found: ${t}`);const h=a.index;for(const t in e){const r=e[t],i=o.getAttachment(h,t);for(const t in r){const e=r[t];let o=e[0];if(o)if("deform"==t){const t=i.bones,r=i.vertices,a=t?r.length/3*2:r.length,l=new xd(e.length,e.length,h,i);let c=qf(o,"time",0);for(let s=0,i=0;;s++){let h;const u=qf(o,"vertices",null);if(u){h=kh.newFloatArray(a);const e=qf(o,"offset",0);if(kh.arrayCopy(u,0,h,e,u.length),1!=n)for(let t=e,r=t+u.length;t<r;t++)h[t]*=n;if(!t)for(let t=0;t<a;t++)h[t]+=r[t]}else h=t?kh.newFloatArray(a):r;l.setFrame(s,c,h);const d=e[s+1];if(!d){l.shrink(i);break}const f=qf(d,"time",0),p=o.curve;p&&(i=zf(p,l,i,s,0,c,f,0,1,1)),c=f,o=d}s.push(l)}else if("sequence"==t){const t=new Pd(e.length,h,i);let r=0;for(let n=0;n<e.length;n++){const s=qf(o,"delay",r),i=qf(o,"time",0),a=Ku[qf(o,"mode","hold")],h=qf(o,"index",0);t.setFrame(n,i,a,h,s),r=s,o=e[n+1]}s.push(t)}}}}else Bh}if(t.drawOrder){const e=new Ed(t.drawOrder.length),n=r.slots.length;let i=0;for(let s=0;s<t.drawOrder.length;s++,i++){const o=t.drawOrder[s];let a=null;const h=qf(o,"offsets",null);if(h){a=kh.newArray(n,-1);const t=kh.newArray(n-h.length,0);let e=0,s=0;for(let n=0;n<h.length;n++){const i=h[n],o=r.findSlot(i.slot);if(!o)throw new Error(`Slot not found: ${o}`);const l=o.index;for(;e!=l;)t[s++]=e++;a[e+i.offset]=e++}for(;e<n;)t[s++]=e++;for(let e=n-1;e>=0;e--)-1==a[e]&&(a[e]=t[--s])}e.setFrame(i,qf(o,"time",0),a)}s.push(e)}if(t.events){const e=new vd(t.events.length);let n=0;for(let s=0;s<t.events.length;s++,n++){const i=t.events[s],o=r.findEvent(i.name);if(!o)throw new Error(`Event not found: ${i.name}`);const a=new Kd(kh.toSinglePrecision(qf(i,"time",0)),o);a.intValue=qf(i,"int",o.intValue),a.floatValue=qf(i,"float",o.floatValue),a.stringValue=qf(i,"string",o.stringValue),a.data.audioPath&&(a.volume=qf(i,"volume",1),a.balance=qf(i,"balance",0)),e.setFrame(n,a)}s.push(e)}let i=0;for(let t=0,e=s.length;t<e;t++)i=Math.max(i,s[t].getDuration());if(isNaN(i))throw new Error("Error while parsing animation, duration is NaN");r.animations.push(new Qu(e,s,i))}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return v.NORMAL;if("additive"==t)return v.ADD;if("multiply"==t)return v.MULTIPLY;if("screen"==t)return v.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}}class Wf{constructor(t,e,r,n,s){this.mesh=t,this.skin=e,this.slotIndex=r,this.parent=n,this.inheritTimeline=s}}function Hf(t,e,r,n){let s=t[0],i=qf(s,"time",0),o=qf(s,"value",r)*n,a=0;for(let h=0;;h++){e.setFrame(h,i,o);const l=t[h+1];if(!l)return e.shrink(a),e;const c=qf(l,"time",0),u=qf(l,"value",r)*n;s.curve&&(a=zf(s.curve,e,a,h,0,i,c,o,u,n)),i=c,o=u,s=l}}function $f(t,e,r,n,s,i){let o=t[0],a=qf(o,"time",0),h=qf(o,r,s)*i,l=qf(o,n,s)*i,c=0;for(let u=0;;u++){e.setFrame(u,a,h,l);const d=t[u+1];if(!d)return e.shrink(c),e;const f=qf(d,"time",0),p=qf(d,r,s)*i,m=qf(d,n,s)*i,g=o.curve;g&&(c=zf(g,e,c,u,0,a,f,h,p,i),c=zf(g,e,c,u,1,a,f,l,m,i)),a=f,h=p,l=m,o=d}}function zf(t,e,r,n,s,i,o,a,h,l){if("stepped"==t)return e.setStepped(n),r;const c=s<<2,u=t[c],d=t[c+1]*l,f=t[c+2],p=t[c+3]*l;return e.setBezier(r,n,s,i,a,u,d,f,p,o,h),r+1}function qf(t,e,r){return void 0!==t[e]?t[e]:r}class Kf extends Xh{createSkeleton(t){this.skeleton=new hf(t),this.skeleton.updateWorldTransform(),this.stateData=new Wd(t),this.state=new kd(this.stateData)}}var Zf=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.VER37=37]="VER37",t[t.VER38=38]="VER38",t[t.VER40=40]="VER40",t[t.VER41=41]="VER41",t))(Zf||{});function Qf(t){const e=t.substr(0,3),r=Math.floor(10*Number(e)+.001);return"3.7"===e?37:"3.8"===e?38:"4.0"===e?40:"4.1"===e?41:r<37?37:0}class Jf{constructor(){this.scale=1}readSkeletonData(t,e){let r=null,n=this.readVersionOldFormat(e),s=Qf(n);if(s===Zf.VER38&&(r=new uc(new Gl(t))),n=this.readVersionNewFormat(e),s=Qf(n),s!==Zf.VER40&&s!==Zf.VER41||(r=new pf(new Hd(t))),!r){const t=`Unsupported version of spine model ${n}, please update pixi-spine`;console.error(t)}return r.scale=this.scale,r.readSkeletonData(e)}readVersionOldFormat(t){const e=new ah(t);let r;try{e.readString(),r=e.readString()}catch(t){r=""}return r||""}readVersionNewFormat(t){const e=new ah(t);let r;e.readInt32(),e.readInt32();try{r=e.readString()}catch(t){r=""}return r||""}}class tp{constructor(){this.scale=1}readSkeletonData(t,e){const r=e.skeleton.spine,n=Qf(r);let s=null;if(n===Zf.VER37&&(s=new Nu(new gu(t))),n===Zf.VER38&&(s=new mc(new Gl(t))),n!==Zf.VER40&&n!==Zf.VER41||(s=new Gf(new Hd(t))),!s){const t=`Unsupported version of spine model ${r}, please update pixi-spine`;console.error(t)}return s.scale=this.scale,s.readSkeletonData(e)}}class ep extends Xh{createSkeleton(r){const s=Qf(r.version);let i=null;if(s===Zf.VER37&&(i=e),s===Zf.VER38&&(i=t),s!==Zf.VER40&&s!==Zf.VER41||(i=n),!i){const t=`Cant detect version of spine model ${r.version}`;console.error(t)}this.skeleton=new i.Skeleton(r),this.skeleton.updateWorldTransform(),this.stateData=new i.AnimationStateData(r),this.state=new i.AnimationState(this.stateData)}}function rp(t){return rp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rp(t)}function np(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==rp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==rp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===rp(s)?s:String(s)),n)}var s}function sp(t,e){return sp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},sp(t,e)}function ip(t){return ip=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ip(t)}(new class extends Wh{createBinaryParser(){return new Jf}createJsonParser(){return new tp}parseData(t,e,r){return{spineData:t.readSkeletonData(e,r),spineAtlas:e}}}).installLoader();var op={WAIT:"waiting_bet",LEVEL_1:"idle_s_1",TRANSITION_TO_LEVEL_2:"s1to2",LEVEL_2:"idle_s_2",TRANSITION_TO_LEVEL_3:"s2to3",LEVEL_3:"idle_s_3",TRANSITION_TO_LEVEL_4:"s3to4",LEVEL_4:"idle_s_4",CRASH:"crash",COLLECT:"collects"},ap=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&sp(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ip(n);if(s){var r=ip(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===rp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t}return e=o,r=[{key:"_init",value:function(){this.level=1,this.view=this.addChild(new ep(Ti.cache.get("submarine").spineData)),this._setAnimation(op.WAIT),this.collectView=this.addChild(new ep(Ti.cache.get("submarine").spineData)),this.collectView.visible=!1,app.observer.subscribe(this)}},{key:"notify",value:function(t){t===Wa&&this._upgrade()}},{key:"_setAnimation",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._listener&&this._removeListener(),this.view.state.setAnimation(0,t,e)}},{key:"_upgrade",value:function(){var t=this;this.level++,op["LEVEL_".concat(this.level)]&&(this._setAnimation(op["TRANSITION_TO_LEVEL_".concat(this.level)],!1),this._listener={complete:function(){return t._onComplete()}},this.view.state.addListener(this._listener))}},{key:"_onComplete",value:function(){this._setAnimation(op["LEVEL_".concat(this.level)]),this._removeListener()}},{key:"_removeListener",value:function(){this.view.state.removeListener(this._listener),this._listener=null}},{key:"play",value:function(){this._setAnimation(op.LEVEL_1)}},{key:"lose",value:function(){this._setAnimation(op.CRASH,!1)}},{key:"collect",value:function(){this.collectView.state.setAnimation(0,op.COLLECT,!1),this.collectView.visible=!0}},{key:"reset",value:function(){this.level=1,this._setAnimation(op.WAIT)}}],r&&np(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function hp(t){return hp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hp(t)}function lp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==hp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==hp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===hp(s)?s:String(s)),n)}var s}function cp(t,e){return cp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cp(t,e)}function up(t){return up=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},up(t)}var dp=1e3,fp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cp(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=up(n);if(s){var r=up(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===hp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this)).views=[],e._init(t),e}return e=o,r=[{key:"_init",value:function(t){this.pivot.set(500,400),this._addCreatures(t),this._addAnimation(t)}},{key:"_addCreatures",value:function(t){t=t>4?4:t;for(var e=1,r=1;7!==this.views.length;){var n="f_".concat(e,"_s_").concat(t);Ti.cache.has(n)||(n="f_3_s_".concat(t));var s=this.addChild(new ep(Ti.cache.get(n).spineData));s.scale.set(.6),s.state.setAnimation(0,"animation",!0),s.direction=r,s.scale.x*=s.direction,s.x=Math.random()*dp,s.y=100*e,this.views.push(s),r*=-1,e=e<=7?++e:1}}},{key:"_addAnimation",value:function(){app.ticker.add(this._onUpdate,this)}},{key:"_onUpdate",value:function(){for(var t=0;t<this.views.length;t++){var e=this.views[t];e.x+=e.direction,(e.position.x<0||e.position.x>dp)&&(e.direction*=-1),(e.scale.x>0&&e.direction<0||e.scale.x<0&&e.direction>0)&&(e.scale.x*=-1)}}}],r&&lp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function pp(t){return pp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pp(t)}function mp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==pp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==pp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===pp(s)?s:String(s)),n)}var s}function gp(t,e){return gp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gp(t,e)}function yp(t){return yp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yp(t)}var bp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gp(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yp(n);if(s){var r=yp(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===pp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._views=[],t._init(),t}return e=o,r=[{key:"_init",value:function(){for(var t=1;t<=6;t++){var e=t>5?5:t,r=this.addChild(bs.from("bg_move_".concat(e,"_stage")));r.addChild(new fp(e)),r.didEmitAboutStage=!1,r.level=e,r.anchor.set(.5),r.y=r.height*(t-1)-4*(t-1),this._views.push(r)}}},{key:"_onUpdate",value:function(){for(var t=0;t<this._views.length;t++){var e=this._views[t];e.y<-e.height&&t>=4?e.y=.97*e.height:e.y-=1,!e.didEmitAboutStage&&e.y<.5*-e.height&&(e.didEmitAboutStage=!0,app.observer.notify(Wa,t+1))}}},{key:"play",value:function(){app.ticker.add(this._onUpdate,this)}},{key:"stop",value:function(){app.ticker.remove(this._onUpdate,this)}},{key:"reset",value:function(){this._views.sort((function(t,e){return t.level-e.level})).forEach((function(t,e){t.y=t.height*e-4*e,t.didEmitAboutStage=!1}))}}],r&&mp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function xp(t){return xp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xp(t)}function _p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==xp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==xp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===xp(s)?s:String(s)),n)}var s}function vp(t,e){return vp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},vp(t,e)}function wp(t){return wp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wp(t)}var Ep=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vp(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=wp(n);if(s){var r=wp(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===xp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t}return e=o,(r=[{key:"_init",value:function(){this._displacementSprite=this.addChild(bs.from("bg_move_1_stage")),this._displacementSprite.texture.baseTexture.wrapMode=I.REPEAT,this._displacementSprite.anchor.set(.5),this._displacementSprite.delta=.5,this._displacementSprite.speed=5,this.filters=[new As(this._displacementSprite,20)],app.ticker.add(this._onUpdate,this)}},{key:"_onUpdate",value:function(){this._displacementSprite.x=-this._displacementSprite.delta*this._displacementSprite.speed,this._displacementSprite.delta+=.5}}])&&_p(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms),Tp=Object.freeze({Linear:Object.freeze({None:function(t){return t},In:function(t){return this.None(t)},Out:function(t){return this.None(t)},InOut:function(t){return this.None(t)}}),Quadratic:Object.freeze({In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}}),Cubic:Object.freeze({In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}}),Quartic:Object.freeze({In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}}),Quintic:Object.freeze({In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}}),Sinusoidal:Object.freeze({In:function(t){return 1-Math.sin((1-t)*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.sin(Math.PI*(.5-t)))}}),Exponential:Object.freeze({In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}}),Circular:Object.freeze({In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}}),Elastic:Object.freeze({In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(t){var e=1.70158;return 1===t?1:t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return 0===t?0:--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}}),Bounce:Object.freeze({In:function(t){return 1-Tp.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*Tp.Bounce.In(2*t):.5*Tp.Bounce.Out(2*t-1)+.5}}),generatePow:function(t){return void 0===t&&(t=4),t=(t=t<Number.EPSILON?Number.EPSILON:t)>1e4?1e4:t,{In:function(e){return Math.pow(e,t)},Out:function(e){return 1-Math.pow(1-e,t)},InOut:function(e){return e<.5?Math.pow(2*e,t)/2:(1-Math.pow(2-2*e,t))/2+.5}}}}),Ap=function(){return performance.now()},Sp=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=Ap()),void 0===e&&(e=!1);var r=Object.keys(this._tweens);if(0===r.length)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var s=this._tweens[r[n]],i=!e;s&&!1===s.update(t,i)&&!e&&delete this._tweens[r[n]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),Rp={Linear:function(t,e){var r=t.length-1,n=r*e,s=Math.floor(n),i=Rp.Utils.Linear;return e<0?i(t[0],t[1],n):e>1?i(t[r],t[r-1],r-n):i(t[s],t[s+1>r?r:s+1],n-s)},Bezier:function(t,e){for(var r=0,n=t.length-1,s=Math.pow,i=Rp.Utils.Bernstein,o=0;o<=n;o++)r+=s(1-e,n-o)*s(e,o)*t[o]*i(n,o);return r},CatmullRom:function(t,e){var r=t.length-1,n=r*e,s=Math.floor(n),i=Rp.Utils.CatmullRom;return t[0]===t[r]?(e<0&&(s=Math.floor(n=r*(1+e))),i(t[(s-1+r)%r],t[s],t[(s+1)%r],t[(s+2)%r],n-s)):e<0?t[0]-(i(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[r]-(i(t[r],t[r],t[r-1],t[r-1],n-r)-t[r]):i(t[s?s-1:0],t[s],t[r<s+1?r:s+1],t[r<s+2?r:s+2],n-s)},Utils:{Linear:function(t,e,r){return(e-t)*r+t},Bernstein:function(t,e){var r=Rp.Utils.Factorial;return r(t)/r(e)/r(t-e)},Factorial:function(){var t=[1];return function(e){var r=1;if(t[e])return t[e];for(var n=e;n>1;n--)r*=n;return t[e]=r,r}}(),CatmullRom:function(t,e,r,n,s){var i=.5*(r-t),o=.5*(n-e),a=s*s;return(2*e-2*r+i+o)*(s*a)+(-3*e+3*r-2*i-o)*a+i*s+e}}},Ip=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),Mp=new Sp,Pp=function(){function t(t,e){void 0===e&&(e=Mp),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Tp.Linear.None,this._interpolationFunction=Rp.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Ip.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){if(void 0===e&&(e=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=e,this},t.prototype.duration=function(t){return void 0===t&&(t=1e3),this._duration=t,this},t.prototype.dynamic=function(t){return void 0===t&&(t=!1),this._isDynamic=t,this},t.prototype.start=function(t,e){if(void 0===t&&(t=Ap()),void 0===e&&(e=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var r in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||e){if(this._propertiesAreSetUp=!0,!this._isDynamic){var n={};for(var s in this._valuesEnd)n[s]=this._valuesEnd[s];this._valuesEnd=n}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,e)}return this},t.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},t.prototype._setupProperties=function(t,e,r,n,s){for(var i in r){var o=t[i],a=Array.isArray(o),h=a?"array":typeof o,l=!a&&Array.isArray(r[i]);if("undefined"!==h&&"function"!==h){if(l){if(0===(g=r[i]).length)continue;for(var c=[o],u=0,d=g.length;u<d;u+=1){var f=this._handleRelativeValue(o,g[u]);if(isNaN(f)){l=!1,console.warn("Found invalid interpolation list. Skipping.");break}c.push(f)}l&&(r[i]=c)}if("object"!==h&&!a||!o||l)(void 0===e[i]||s)&&(e[i]=o),a||(e[i]*=1),n[i]=l?r[i].slice().reverse():e[i]||0;else{e[i]=a?[]:{};var p=o;for(var m in p)e[i][m]=p[m];n[i]=a?[]:{};var g=r[i];if(!this._isDynamic){var y={};for(var m in g)y[m]=g[m];r[i]=g=y}this._setupProperties(p,e[i],g,n[i],s)}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=Ap()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=Ap()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return void 0===t&&(t=Mp),this._group=t,this},t.prototype.delay=function(t){return void 0===t&&(t=0),this._delayTime=t,this},t.prototype.repeat=function(t){return void 0===t&&(t=0),this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return void 0===t&&(t=!1),this._yoyo=t,this},t.prototype.easing=function(t){return void 0===t&&(t=Tp.Linear.None),this._easingFunction=t,this},t.prototype.interpolation=function(t){return void 0===t&&(t=Rp.Linear),this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=Ap()),void 0===e&&(e=!0),this._isPaused)return!0;var r,n,s=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>s)return!1;e&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),n=(t-this._startTime)/this._duration,n=0===this._duration||n>1?1:n;var i=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,i),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(r in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[r]||(this._valuesStartRepeat[r]=this._valuesStartRepeat[r]+parseFloat(this._valuesEnd[r])),this._yoyo&&this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,a=this._chainedTweens.length;o<a;o++)this._chainedTweens[o].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,r,n){for(var s in r)if(void 0!==e[s]){var i=e[s]||0,o=r[s],a=Array.isArray(t[s]),h=Array.isArray(o);!a&&h?t[s]=this._interpolationFunction(o,n):"object"==typeof o&&o?this._updateProperties(t[s],i,o,n):"number"==typeof(o=this._handleRelativeValue(i,o))&&(t[s]=i+(o-i)*n)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],r=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof r?this._valuesStartRepeat[t]+parseFloat(r):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),Cp=Ip.nextId,kp=Mp,Op=kp.getAll.bind(kp),Fp=kp.removeAll.bind(kp),Np=kp.add.bind(kp),Bp=kp.remove.bind(kp),Dp=kp.update.bind(kp),Lp={Easing:Tp,Group:Sp,Interpolation:Rp,now:Ap,Sequence:Ip,nextId:Cp,Tween:Pp,VERSION:"21.0.0",getAll:Op,removeAll:Fp,add:Np,remove:Bp,update:Dp};function Vp(t){return Vp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vp(t)}function Up(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}const Xp=function(){var t=Object.create(null);return t.resolve=null,t.promise=new Promise((function(e){return t.resolve=e})),t},jp=function(t){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Up(Object(r),!0).forEach((function(e){var n,s,i;n=t,s=e,i=r[e],(s=function(t){var e=function(t,e){if("object"!==Vp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Vp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Vp(e)?e:String(e)}(s))in n?Object.defineProperty(n,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[s]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Up(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({fontFamily:"bebas",fill:0},t)},Yp=function(t){var e=t.scale.x,r=null;return function(){var n=e-.05;t.scale.set(e),r&&(r.stop(),Lp.remove(r)),r=new Lp.Tween(t).to({scale:{x:n,y:n}},100).easing(Lp.Easing.Bounce.InOut).repeat(1).yoyo(!0).start()}};function Gp(t){return Gp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gp(t)}function Wp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Gp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Gp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Gp(s)?s:String(s)),n)}var s}function Hp(t,e){return Hp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Hp(t,e)}function $p(t){return $p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$p(t)}var zp="in",qp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Hp(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$p(n);if(s){var r=$p(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Gp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,Ti.cache.get("transition").spineData))._toggleUpdateView(!1),t._addListener(),t}return e=o,(r=[{key:"_toggleUpdateView",value:function(t){this.autoUpdate=t,this.visible=t}},{key:"_addListener",value:function(){var t=this;this.state.addListener({start:function(e){(null==e?void 0:e.animation.name)===zp&&t._toggleUpdateView(!0)},complete:function(e){(null==e?void 0:e.animation.name)===zp.OPEN&&t._toggleUpdateView(!1),t._deferred&&t._deferred.resolve()}})}},{key:"open",value:function(){return this._deferred=Xp(),this.state.setAnimation(0,"out",!1),this._deferred.promise}},{key:"close",value:function(){return this._deferred=Xp(),this.state.setAnimation(0,zp,!1),this._deferred.promise}}])&&Wp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ep);function Kp(t){return Kp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kp(t)}function Zp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Kp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Kp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Kp(s)?s:String(s)),n)}var s}function Qp(t,e){return Qp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Qp(t,e)}function Jp(t){return Jp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jp(t)}var tm=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qp(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jp(n);if(s){var r=Jp(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Kp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t}return e=o,(r=[{key:"_init",value:function(){this.view=this.addChild(new ep(Ti.cache.get("bg_animations").spineData)),this.view.visible=!1}},{key:"play",value:function(){this.view.state.setAnimation(0,"animation",!0),this.view.autoUpdate=!0,this.view.visible=!0}},{key:"stop",value:function(){this.view.autoUpdate=!1}},{key:"reset",value:function(){this.view.visible=!1,this.view.skeleton.setToSetupPose(),this.view.state.tracks=[]}}])&&Zp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms),em=r(870);function rm(t){return rm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rm(t)}function nm(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==rm(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==rm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===rm(s)?s:String(s)),n)}var s}function sm(t,e){return sm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},sm(t,e)}function im(t){return im=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},im(t)}var om=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&sm(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=im(n);if(s){var r=im(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===rm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,Ti.cache.get("bonus_mine").spineData)).autoUpdate=!1,t.visible=!1,t.alpha=0,t}return e=o,(r=[{key:"show",value:function(){return this.state.setAnimation(0,"mine_expl",!0),this.autoUpdate=!0,this.visible=!0,this.tw=new Lp.Tween(this).to({alpha:1},250).start(),(0,em.F7)(2)}},{key:"reset",value:function(){this.autoUpdate=!1,this.visible=!1,this.alpha=0,this.tw&&(Lp.remove(this.tw),this.tw=null)}}])&&nm(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ep);function am(t){return am="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},am(t)}function hm(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==am(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==am(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===am(s)?s:String(s)),n)}var s}function lm(t,e){return lm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lm(t,e)}function cm(t){return cm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cm(t)}var um=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lm(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=cm(n);if(s){var r=cm(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===am(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t}return e=o,(r=[{key:"_init",value:function(){var t=this;this.popupView=this.addChild(new ep(Ti.cache.get("pop_up").spineData)),this.popupView.state.addListener({start:function(){t._toggleUpdateView(!0)},complete:function(){t._deferred&&t._deferred.resolve()}}),this.textView=this.addChild(this._createText()),this._toggleUpdateView(!1)}},{key:"_createText",value:function(){var t=this.addChild(new ta("",jp({fill:16777215,fontSize:70})));return t.scale.set(1.9),t.anchor.set(.5),t.alpha=0,t.y=50,t.show=function(){return new Lp.Tween(t).to({alpha:1},200).start()},t.hide=function(){return new Lp.Tween(t).to({alpha:0},200).start()},t}},{key:"_toggleUpdateView",value:function(t){this.popupView.autoUpdate=t,this.popupView.visible=t}},{key:"win",value:function(t){return this.textView.show(),this.textView.text="".concat(t.toFixed(1),"$"),this.popupView.state.setAnimation(0,"you_won",!1),this._deferred=Xp(),this._deferred.promise}},{key:"lose",value:function(){return this.popupView.state.setAnimation(0,"crash",!1),this._deferred=Xp(),this._deferred.promise}},{key:"hide",value:function(){var t=this;this.textView.hide();var e=new Lp.Tween(this.popupView).to({alpha:0},300).onComplete((function(){t._toggleUpdateView(!1),t.popupView.alpha=1,Lp.remove(e)})).start()}}])&&hm(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function dm(t){return dm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dm(t)}function fm(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==dm(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==dm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===dm(s)?s:String(s)),n)}var s}function pm(t,e){return pm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pm(t,e)}function mm(t){return mm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mm(t)}var gm="ballon_bonus",ym=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pm(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=mm(n);if(s){var r=mm(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===dm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,Ti.cache.get("bonus_mine").spineData))._init(),t}return e=o,(r=[{key:"_init",value:function(){var t=this;this.reset(),this._listener={complete:function(e){e.animation.name===gm&&t.reset()}},this.state.addListener(this._listener)}},{key:"show",value:function(){var t=this;this.position.y=500,this.state.setAnimation(0,"ballon_idle",!0),this.autoUpdate=!0,this.visible=!0,this.alpha=1,this.isCollect=!1,this.collectTw=new Lp.Tween(this).to({y:-150},2500).onUpdate((function(r){r.y<160&&!t.isCollect&&(t.collect(),e.resolve())})).start();var e=Xp();return e.promise}},{key:"collect",value:function(){this.isCollect=!0,this.state.setAnimation(0,gm,!1),this.hide()}},{key:"hide",value:function(){new Pp(this).to({alpha:0},300).delay(500).start()}},{key:"reset",value:function(){this.autoUpdate=!1,this.visible=!1,this.collectTw&&(Lp.remove(this.collectTw),this.collectTw=null)}}])&&fm(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ep);function bm(t){return bm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bm(t)}function xm(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==bm(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==bm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===bm(s)?s:String(s)),n)}var s}function _m(t,e){return _m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_m(t,e)}function vm(t){return vm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vm(t)}var wm=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_m(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vm(n);if(s){var r=vm(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===bm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t}return e=o,(r=[{key:"_init",value:function(){var t=this;this.view=this.addChild(new ep(Ti.cache.get("frogman").spineData)),this.view.state.addListener({start:function(){t._toggleUpdateView(!0),t._deferred=Xp()},complete:function(){var e;t._toggleUpdateView(!1),null===(e=t._deferred)||void 0===e||e.resolve()}}),this._toggleUpdateView(!1)}},{key:"_toggleUpdateView",value:function(t){this.view.autoUpdate=t,this.view.visible=t}},{key:"show",value:function(){return this.view.state.setAnimation(0,"animation",!1),this._deferred.promise}}])&&xm(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function Em(t){return Em="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Em(t)}function Tm(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Em(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Em(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Em(s)?s:String(s)),n)}var s}function Am(t,e){return Am=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Am(t,e)}function Sm(t){return Sm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Sm(t)}var Rm=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Am(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Sm(n);if(s){var r=Sm(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Em(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t}return e=o,(r=[{key:"_init",value:function(){this.scale.set(.5),this.alpha=0,this.ripperEffect=this.addChild(new Ep),this.background=this.ripperEffect.addChild(new bp),this.frogman=this.ripperEffect.addChild(new wm),this.submarine=this.ripperEffect.addChild(new ap),this.bubbleEffect=this.ripperEffect.addChild(new tm),this.mine=this.ripperEffect.addChild(new om),this.ballon=this.ripperEffect.addChild(new ym),this.transition=this.addChild(new qp),this.popup=this.addChild(new um)}},{key:"play",value:function(){this.submarine.play(),this.bubbleEffect.play(),this.background.play()}},{key:"reset",value:function(){this.background.reset(),this.submarine.reset(),this.bubbleEffect.reset(),this.mine.reset()}}])&&Tm(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function Im(t){return Im="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Im(t)}function Mm(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Im(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Im(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Im(s)?s:String(s)),n)}var s}var Pm=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this._listeners={autoTake:[],counter:[],lose:[],bonus:[]}}var e,r;return e=t,r=[{key:"listenAutoTake",value:function(t,e){this._listeners.autoTake.push(t.bind(e))}},{key:"listenLose",value:function(t,e){this._listeners.lose.push(t.bind(e))}},{key:"listenCounter",value:function(t,e){this._listeners.counter.push(t.bind(e))}},{key:"listenBonus",value:function(t,e){this._listeners.bonus.push(t.bind(e))}},{key:"addBonus",value:function(){this.counterInfo.current+=this.model.bonusMultiplier}},{key:"start",value:function(){this.counterInfo=this._counterInfo(),this.counterInfo.bonuses=this._generateBonusesForRound(),app.ticker.add(this._onUpdate,this)}},{key:"stop",value:function(){app.ticker.remove(this._onUpdate,this)}},{key:"_onUpdate",value:function(){var t=this;if(this.counterInfo.current<=this.counterInfo.max){this.counterInfo.current+=this.counterInfo.speed,this.model.multiplier=+this.counterInfo.current.toFixed(1),this.counterInfo.bonuses.length&&this._tryEmitBonus();var e=(this.model.bet*this.counterInfo.current).toFixed(1);this._listeners.counter.forEach((function(r){return r({roundWin:e,multiplier:t.model.multiplier})}))}else this.stop(),this._listeners.lose.forEach((function(t){return t()}));this.model.autoTake&&this.model.autoTakeMultiplier<=this.model.multiplier&&(this.stop(),this._listeners.autoTake.forEach((function(t){return t()})))}},{key:"_counterInfo",value:function(){return{current:0,max:this.model.maxMultiplier,speed:.002,bonuses:[]}}},{key:"_generateBonusesForRound",value:function(){for(var t=this.model.bonusMultiplier,e=~~(this.model.maxMultiplier/this.model.bonusMultiplier/2),r=[],n=0;n<e;n++)r.push({multiplier:this.model.bonusMultiplier,emitOnMultiplier:Math.random()*(n+1)+n*t*3});return r}},{key:"_tryEmitBonus",value:function(){var t=this,e=this.counterInfo.bonuses.find((function(e){return e.emitOnMultiplier<=t.counterInfo.current}));if(e){var r=this.counterInfo.bonuses.indexOf(e);this.counterInfo.bonuses.splice(r,1),this._listeners.bonus.forEach((function(t){return t()}))}}}],r&&Mm(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Cm(t){return Cm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cm(t)}function km(){km=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",h=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof y?e:y,o=Object.create(i.prototype),a=new P(n||[]);return s(o,"_invoke",{value:S(t,r,a)}),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function b(){}function x(){}var _={};l(_,o,(function(){return this}));var v=Object.getPrototypeOf,w=v&&v(v(C([])));w&&w!==r&&n.call(w,o)&&(_=w);var E=x.prototype=y.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function r(s,i,o,a){var h=u(t[s],t,i);if("throw"!==h.type){var l=h.arg,c=l.value;return c&&"object"==Cm(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(h.arg)}var i;s(this,"_invoke",{value:function(t,n){function s(){return new e((function(e,s){r(t,n,e,s)}))}return i=i?i.then(s,s):s()}})}function S(e,r,n){var s=d;return function(i,o){if(s===p)throw new Error("Generator is already running");if(s===m){if("throw"===i)throw o;return{value:t,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var h=R(a,n);if(h){if(h===g)continue;return h}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===d)throw s=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=p;var l=u(e,r,n);if("normal"===l.type){if(s=n.done?m:f,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(s=m,n.method="throw",n.arg=l.arg)}}}function R(e,r){var n=r.method,s=e.iterator[n];if(s===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,R(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=u(s,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,i=function r(){for(;++s<e.length;)if(n.call(e,s))return r.value=e[s],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Cm(e)+" is not iterable")}return b.prototype=x,s(E,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,h,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,h,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},T(A.prototype),l(A.prototype,a,(function(){return this})),e.AsyncIterator=A,e.async=function(t,r,n,s,i){void 0===i&&(i=Promise);var o=new A(c(t,r,n,s),i);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},T(E),l(E,h,"Generator"),l(E,o,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function s(n,s){return a.type="throw",a.arg=e,r.next=n,s&&(r.method="next",r.arg=t),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return s("end");if(o.tryLoc<=this.prev){var h=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(h&&l){if(this.prev<o.catchLoc)return s(o.catchLoc,!0);if(this.prev<o.finallyLoc)return s(o.finallyLoc)}else if(h){if(this.prev<o.catchLoc)return s(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return s(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&n.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var i=s;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var s=n.arg;M(r)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function Om(t,e,r,n,s,i,o){try{var a=t[i](o),h=a.value}catch(t){return void r(t)}a.done?e(h):Promise.resolve(h).then(n,s)}function Fm(t){return function(){var e=this,r=arguments;return new Promise((function(n,s){var i=t.apply(e,r);function o(t){Om(i,n,s,o,a,"next",t)}function a(t){Om(i,n,s,o,a,"throw",t)}o(void 0)}))}}function Nm(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Cm(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Cm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Cm(s)?s:String(s)),n)}var s}function Bm(t,e){return Bm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Bm(t,e)}function Dm(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Lm(t){return Lm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Lm(t)}var Vm="STATE.BET",Um="STATE.TAKE",Xm="STATE.WAITING",jm=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bm(t,e)}(l,t);var e,r,n,s,i,o,a,h=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Lm(o);if(a){var r=Lm(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Cm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Dm(t)}(this,t)});function l(t){var e,r=t.model,n=t.scene,s=t.ui,i=t.observer,o=t.sound;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),(e=h.call(this)).ui=s,e.scene=n,e.model=r,e.sound=o,e.multiplierCounter=new Pm(e.model),e.observer=i,e.observer.subscribe(Dm(e)),e.state=Vm,e._addListeners(),e}return e=l,r=[{key:"_addListeners",value:function(){this.multiplierCounter.listenAutoTake(this._take,this),this.multiplierCounter.listenLose(this._lose,this),this.multiplierCounter.listenBonus(this._bonus,this),this.multiplierCounter.listenCounter(this.ui.button.updateCounter,this.ui.button),this.multiplierCounter.listenCounter(this.ui.multiplier.updateCounter,this.ui.multiplier)}},{key:"notify",value:function(t,e){switch(t){case $a:this._bet();break;case Ka:this._take();break;case za:case qa:this._setModelBet(e);break;case Ja:this._setModelAutoBet(e);break;case Za:case Qa:this._setModelTakeMultiplier(e);break;case th:this._setModelAutoTake(e)}this.sound.emit(t)}},{key:"_bet",value:function(){this.state===Vm&&(this.state=Um,this.model.result(),this.scene.play(),this.multiplierCounter.start(),this.observer.notify(Xa))}},{key:"_take",value:(i=Fm(km().mark((function t(){return km().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state===Um){t.next=2;break}return t.abrupt("return");case 2:return this.state=Xm,this.sound.emit(Ha,0),this.multiplierCounter.stop(),this.model.update(),this.observer.notify(ja),this.scene.bubbleEffect.stop(),this.scene.ballon.reset(),this.scene.background.stop(),t.next=12,this.scene.frogman.show();case 12:return this.sound.emit(sh),t.next=15,this.scene.transition.close();case 15:return this.sound.emit(eh),t.next=18,this.scene.popup.win(this.model.roundWin);case 18:return t.next=20,this._reset();case 20:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"_lose",value:(s=Fm(km().mark((function t(){return km().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.state=Xm,this.sound.emit(Ha,0),this.observer.notify(Ya),this.scene.ballon.reset(),this.scene.background.stop(),this.scene.bubbleEffect.stop(),this.scene.submarine.lose(),t.next=9,this.scene.mine.show();case 9:return this.sound.emit(sh),t.next=12,this.scene.transition.close();case 12:return this.sound.emit(rh),t.next=15,this.scene.popup.lose();case 15:return t.next=17,this._reset();case 17:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"_reset",value:(n=Fm(km().mark((function t(){return km().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.model.reset(),this.scene.reset(),this.scene.popup.hide(),this.sound.emit(Ha,1),this.sound.emit(nh),t.next=7,this.scene.transition.open();case 7:this.state=Vm,this.observer.notify(Ga),this.model.autoBet&&this.observer.notify($a);case 10:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"_bonus",value:function(){var t=this;this.scene.ballon.show().then((function(){t.multiplierCounter.addBonus(),t.scene.submarine.collect(),t.sound.emit(ih)}))}},{key:"_setModelAutoBet",value:function(t){this.model.autoBet=t,t&&this._bet()}},{key:"_setModelBet",value:function(t){this.model.bet=t}},{key:"_setModelAutoTake",value:function(t){this.model.autoTake=t}},{key:"_setModelTakeMultiplier",value:function(t){this.model.autoTakeMultiplier=t}}],r&&Nm(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),l}(nt);function Ym(t){return Ym="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ym(t)}function Gm(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Ym(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ym(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ym(s)?s:String(s)),n)}var s}var Wm=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.listeners=[]}var e,r;return e=t,(r=[{key:"subscribe",value:function(t){this.listeners.push(t)}},{key:"notify",value:function(t,e){this.listeners.forEach((function(r){r.notify(t,e)}))}}])&&Gm(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Hm(t){return Hm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hm(t)}function $m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Hm(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Hm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Hm(s)?s:String(s)),n)}var s}function zm(t,e){return zm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zm(t,e)}function qm(t){return qm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qm(t)}var Km={bet:{texture:"button",text:"MAKE BET",style:jp({fontSize:40})},take:{texture:"button_take",text:"TAKE",style:jp({fontSize:32})},hold:{texture:"button_disable",text:"WAITING",style:jp({fontSize:40})}},Zm="BUTTON_STATE.READY_BET",Qm="BUTTON_STATE.READY_TAKE",Jm=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zm(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qm(n);if(s){var r=qm(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Hm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).state=null,t._init(),t._setReadyBetState(),t}return e=o,(r=[{key:"notify",value:function(t){switch(t){case Xa:this._setReadyTakeState();break;case Ga:this._setReadyBetState();break;case Ya:case ja:this._setHoldState()}}},{key:"updateCounter",value:function(t){var e=t.roundWin;this.counterView.text="".concat(e,"$")}},{key:"_init",value:function(){this.buttonView=this.addChild(new bs),this.buttonView.eventMode="static",this.buttonView.anchor.set(.5),this.buttonView.on("pointerdown",this._onPointerdown,this),this.buttonView.effectPressButton=Yp(this),this.textView=this.addChild(new ta("",{fontFamily:"bebas"})),this.textView.anchor.set(.5),this.textView.y=-10,this.counterView=this.addChild(new ta("",jp({fontSize:32}))),this.counterView.anchor.set(.5),this.counterView.visible=!1,this.counterView.y=-30,app.observer.subscribe(this)}},{key:"_onPointerdown",value:function(){switch(this.state){case Zm:app.observer.notify($a);break;case Qm:app.observer.notify(Ka)}}},{key:"_setReadyTakeState",value:function(){this.state=Qm,this.counterView.visible=!0,this.buttonView.texture=Ti.cache.get(Km.take.texture),this.buttonView.effectPressButton(),this.textView.text=Km.take.text,this.textView.y*=-1,Object.assign(this.textView.style,Km.take.style)}},{key:"_setReadyBetState",value:function(){this.state=Zm,this.buttonView.texture=Ti.cache.get(Km.bet.texture),this.textView.text=Km.bet.text,Object.assign(this.textView.style,Km.bet.style)}},{key:"_setHoldState",value:function(){this.state="BUTTON_STATE.HOLD",this.counterView.visible=!1,this.buttonView.texture=Ti.cache.get(Km.hold.texture),this.buttonView.effectPressButton(),this.textView.text=Km.hold.text,this.textView.y*=-1,Object.assign(this.textView.style,Km.hold.style)}}])&&$m(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function tg(t){return tg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tg(t)}function eg(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==tg(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==tg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===tg(s)?s:String(s)),n)}var s}function rg(t,e){return rg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rg(t,e)}function ng(t){return ng=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ng(t)}var sg=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rg(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ng(n);if(s){var r=ng(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===tg(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).init(e),t}return e=o,r=[{key:"init",value:function(t){var e=t.startValue,r=t.maxValue,n=t.sign;this.currValue=e,this.maxValue=r,this.signValue=n,this.autoAction=!1,this.stake=this.addChild(bs.from("stake")),this.stake.anchor.set(.5),this.textView=this.stake.addChild(this.createText("".concat(this.currValue).concat(this.signValue),{fontSize:40})),this.rightButton=this.createButton("button_stake",this.onRightTap),this.rightButton.x=80;var s=this.rightButton.addChild(this.createText("+",{fontSize:60}));s.position.y=2,this.leftButton=this.createButton("button_stake",this.onLeftTap),this.leftButton.x=-80,(s=this.leftButton.addChild(this.createText("-",{fontSize:60}))).position.y=2,this.autoActionButton=this.createButton("autotake_bet",this.onAutoActionTap),this.autoActionButton.y=-65,(s=this.autoActionButton.addChild(this.createText("AUTO",{fontSize:25}))).position.y=2,app.observer.subscribe(this)}},{key:"notify",value:function(t){switch(t){case Xa:this.toggleButtonAccess(!1);break;case Ga:this.toggleButtonAccess(!0)}}},{key:"createText",value:function(t,e){var r=new ta(t,jp(e));return r.anchor.set(.5),r}},{key:"createButton",value:function(t,e){var r=this.addChild(bs.from(t));return r.eventMode="static",r.anchor.set(.5),e&&(r.effectPressButton=Yp(r),r.on("pointerdown",e,this)),r}},{key:"onLeftTap",value:function(t){this._disabled||(this.currValue=this.currValue>1?this.currValue-1:1,this.updateView(),this.leftButton.effectPressButton(),app.observer.notify(t,this.currValue))}},{key:"onRightTap",value:function(t){this._disabled||(this.currValue=this.currValue<this.maxValue?this.currValue+1:this.maxValue,this.updateView(),this.rightButton.effectPressButton(),app.observer.notify(t,this.currValue))}},{key:"onAutoActionTap",value:function(t){this.autoAction?this.autoActionButton.texture=Ti.cache.get("autotake_bet"):this.autoActionButton.texture=Ti.cache.get("autotake_bet_active"),this.autoAction=!this.autoAction,this.autoActionButton.effectPressButton(),app.observer.notify(t,this.autoAction)}},{key:"updateView",value:function(){this.textView.text="".concat(this.currValue).concat(this.signValue)}},{key:"toggleButtonAccess",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._disabled=!t;var e=t?"":"_disable";this.stake.texture=Ti.cache.get("stake".concat(e)),this.rightButton.texture=Ti.cache.get("button_stake".concat(e)),this.leftButton.texture=Ti.cache.get("button_stake".concat(e))}}],r&&eg(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function ig(t){return ig="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ig(t)}function og(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==ig(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ig(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ig(s)?s:String(s)),n)}var s}function ag(){return ag="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=lg(t)););return t}(t,e);if(n){var s=Object.getOwnPropertyDescriptor(n,e);return s.get?s.get.call(arguments.length<3?t:r):s.value}},ag.apply(this,arguments)}function hg(t,e){return hg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},hg(t,e)}function lg(t){return lg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lg(t)}var cg=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hg(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lg(n);if(s){var r=lg(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ig(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),i.apply(this,arguments)}return e=o,(r=[{key:"onLeftTap",value:function(){ag(lg(o.prototype),"onLeftTap",this).call(this,Qa)}},{key:"onRightTap",value:function(){ag(lg(o.prototype),"onRightTap",this).call(this,Za)}},{key:"onAutoActionTap",value:function(){ag(lg(o.prototype),"onAutoActionTap",this).call(this,th)}}])&&og(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(sg);function ug(t){return ug="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ug(t)}function dg(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==ug(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ug(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ug(s)?s:String(s)),n)}var s}function fg(){return fg="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mg(t)););return t}(t,e);if(n){var s=Object.getOwnPropertyDescriptor(n,e);return s.get?s.get.call(arguments.length<3?t:r):s.value}},fg.apply(this,arguments)}function pg(t,e){return pg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pg(t,e)}function mg(t){return mg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mg(t)}var gg=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pg(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=mg(n);if(s){var r=mg(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ug(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),i.apply(this,arguments)}return e=o,(r=[{key:"onLeftTap",value:function(){fg(mg(o.prototype),"onLeftTap",this).call(this,qa)}},{key:"onRightTap",value:function(){fg(mg(o.prototype),"onRightTap",this).call(this,za)}},{key:"onAutoActionTap",value:function(){fg(mg(o.prototype),"onAutoActionTap",this).call(this,Ja)}}])&&dg(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(sg);function yg(t){return yg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yg(t)}function bg(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==yg(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==yg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===yg(s)?s:String(s)),n)}var s}function xg(t,e){return xg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},xg(t,e)}function _g(t){return _g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_g(t)}var vg=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xg(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_g(n);if(s){var r=_g(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===yg(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t._updateView(),t}return e=o,(r=[{key:"notify",value:function(t){switch(t){case Xa:case ja:this._updateView()}}},{key:"_init",value:function(){this.addChild(bs.from("balance")).anchor.set(.5),this.textView=this.addChild(new ta("",jp({fontSize:40}))),this.textView.anchor.set(.5),this.textView.y=3,app.observer.subscribe(this)}},{key:"_updateView",value:function(){this.textView.text="".concat(new Intl.NumberFormat("en-US").format(app.model.balance),"$")}}])&&bg(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function wg(t){return wg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wg(t)}function Eg(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==wg(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==wg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===wg(s)?s:String(s)),n)}var s}function Tg(t,e){return Tg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Tg(t,e)}function Ag(t){return Ag=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ag(t)}var Sg=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tg(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ag(n);if(s){var r=Ag(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===wg(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t}return e=o,(r=[{key:"notify",value:function(t){switch(t){case Xa:this._toggleAlpha(1);break;case Ya:case ja:this._toggleAlpha(0)}}},{key:"_init",value:function(){this.textView=this.addChild(new ta("",jp({fontSize:50,fill:16777215,stroke:0,strokeThickness:3}))),this.textView.anchor.set(.5),this.textView.alpha=0,app.observer.subscribe(this)}},{key:"_toggleAlpha",value:function(t){new Pp(this.textView).to({alpha:t},150).start()}},{key:"updateCounter",value:function(t){var e=t.multiplier;this.textView.text="".concat(e,"x")}}])&&Eg(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function Rg(t){return Rg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rg(t)}function Ig(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Rg(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Rg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Rg(s)?s:String(s)),n)}var s}function Mg(t,e){return Mg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Mg(t,e)}function Pg(t){return Pg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pg(t)}var Cg=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mg(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pg(n);if(s){var r=Pg(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Rg(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t}return e=o,(r=[{key:"_init",value:function(){this._addButton(),this._addStakeWidgets(),this._addBalance(),this._addMultiplier(),this.alpha=0,this.scale.set(.7),this.position.y=300}},{key:"_addStakeWidgets",value:function(){this.betWidget=this.addChild(new gg({startValue:app.model.bet,maxValue:app.model.maxBet,sign:"$"})),this.betWidget.position.set(-240,80),this.autoTakeWidget=this.addChild(new cg({startValue:app.model.autoTakeMultiplier,maxValue:app.model.autoTakeMultiplierMax,sign:"x"})),this.autoTakeWidget.position.set(240,80)}},{key:"_addButton",value:function(){this.button=this.addChild(new Jm)}},{key:"_addBalance",value:function(){this.balance=this.addChild(new vg),this.balance.y=100}},{key:"_addMultiplier",value:function(){this.multiplier=this.addChild(new Sg),this.multiplier.y=-600}}])&&Ig(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);function kg(t){return kg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kg(t)}function Og(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==kg(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==kg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===kg(s)?s:String(s)),n)}var s}var Fg=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._balance=1e4,this._bet=1,this._maxBet=30,this._bonusMultiplier=1.2,this._multiplier=0,this._maxMultiplier=0,this._autoTakeMultiplier=1,this._autoTakeMultiplierMax=10,this._maxRoundWin=0,this._autoBet=!1,this._autoTake=!1}var e,r;return e=t,r=[{key:"result",value:function(){var t=function(){for(var t=[],e=1;20!==t.length;){e=e>=7?1:++e;var r=(Math.random()*e+e).toFixed(1);t.push(+r)}return t.sort((function(){return Math.random()>.5}))}();this._balance-=this._bet,this._maxMultiplier=t[~~(t.length*Math.random())],this._maxRoundWin=this._bet*this._maxMultiplier}},{key:"update",value:function(){this._balance+=+this._bet*this._multiplier}},{key:"reset",value:function(){this._multiplier=0,this._maxRoundWin=0,this._maxMultiplier=0}},{key:"bonusMultiplier",get:function(){return this._bonusMultiplier},set:function(t){this._bonusMultiplier=t}},{key:"balance",get:function(){return this._balance}},{key:"bet",get:function(){return this._bet},set:function(t){this._bet=t}},{key:"maxBet",get:function(){return this._maxBet}},{key:"multiplier",get:function(){return this._multiplier},set:function(t){this._multiplier=t}},{key:"maxMultiplier",get:function(){return this._maxMultiplier},set:function(t){this._maxMultiplier=t}},{key:"maxRoundWin",get:function(){return this._maxRoundWin}},{key:"roundWin",get:function(){return this.bet*this.multiplier}},{key:"autoTakeMultiplier",get:function(){return this._autoTakeMultiplier},set:function(t){this._autoTakeMultiplier=t}},{key:"autoTakeMultiplierMax",get:function(){return this._autoTakeMultiplierMax}},{key:"autoTake",get:function(){return this._autoTake},set:function(t){this._autoTake=t}},{key:"autoBet",get:function(){return this._autoBet},set:function(t){this._autoBet=t}}],r&&Og(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();const Ng=JSON.parse('{"bundles":[{"name":"intro","assets":[{"name":"loading_screen","srcs":"assets/spine/loading_screen.json"},{"name":"bebas","srcs":"assets/fonts/bebas.ttf"},{"name":"back_loading_screen","srcs":"assets/common/back_loading_screen.png"},{"name":"bg_main","srcs":"assets/common/bg_main.png"},{"name":"compass_scale","srcs":"assets/common/compass_scale.png"},{"name":"logo","srcs":"assets/common/logo.png"},{"name":"port_hole","srcs":"assets/common/port_hole.png"}]},{"name":"main","assets":[{"name":"autotake_bet","srcs":"assets/ui/autotake_bet.png"},{"name":"autotake_bet_active","srcs":"assets/ui/autotake_bet_active.png"},{"name":"balance","srcs":"assets/ui/balance.png"},{"name":"button","srcs":"assets/ui/button.png"},{"name":"button_accept","srcs":"assets/ui/button_accept.png"},{"name":"button_disable","srcs":"assets/ui/button_disable.png"},{"name":"button_stake","srcs":"assets/ui/button_stake.png"},{"name":"button_stake_disable","srcs":"assets/ui/button_stake_disable.png"},{"name":"button_take","srcs":"assets/ui/button_take.png"},{"name":"stake","srcs":"assets/ui/stake.png"},{"name":"stake_disable","srcs":"assets/ui/stake_disable.png"},{"name":"bg_animations","srcs":"assets/spine/bg_animations.json"},{"name":"bonus_mine","srcs":"assets/spine/bonus_mine.json"},{"name":"frogman","srcs":"assets/spine/frogman.json"},{"name":"pop_up","srcs":"assets/spine/pop_up.json"},{"name":"submarine","srcs":"assets/spine/submarine.json"},{"name":"transition","srcs":"assets/spine/transition.json"},{"name":"autobet_button","srcs":"assets/sound/autobet_button.mp3"},{"name":"bg_main_theme","srcs":"assets/sound/bg_main_theme.mp3"},{"name":"bonus","srcs":"assets/sound/bonus.mp3"},{"name":"crash","srcs":"assets/sound/crash.mp3"},{"name":"increase_decrease_button","srcs":"assets/sound/increase_decrease_button.mp3"},{"name":"make_bet","srcs":"assets/sound/make_bet.mp3"},{"name":"pop_up_crash","srcs":"assets/sound/pop_up_crash.mp3"},{"name":"pop_up_you_won","srcs":"assets/sound/pop_up_you_won.mp3"},{"name":"take","srcs":"assets/sound/take.mp3"},{"name":"transition_close","srcs":"assets/sound/transition_close.mp3"},{"name":"transition_open","srcs":"assets/sound/transition_open.mp3"},{"name":"f_7_s_4","srcs":"assets/fishes/f_7_s_4/f_7_s_4.json"},{"name":"f_7_s_3","srcs":"assets/fishes/f_7_s_3/f_7_s_3.json"},{"name":"f_7_s_2","srcs":"assets/fishes/f_7_s_2/f_7_s_2.json"},{"name":"f_6_s_4","srcs":"assets/fishes/f_6_s_4/f_6_s_4.json"},{"name":"f_6_s_3","srcs":"assets/fishes/f_6_s_3/f_6_s_3.json"},{"name":"f_6_s_2","srcs":"assets/fishes/f_6_s_2/f_6_s_2.json"},{"name":"f_6_s_1","srcs":"assets/fishes/f_6_s_1/f_6_s_1.json"},{"name":"f_5_s_4","srcs":"assets/fishes/f_5_s_4/f_5_s_4.json"},{"name":"f_5_s_3","srcs":"assets/fishes/f_5_s_3/f_5_s_3.json"},{"name":"f_5_s_2","srcs":"assets/fishes/f_5_s_2/f_5_s_2.json"},{"name":"f_5_s_1","srcs":"assets/fishes/f_5_s_1/f_5_s_1.json"},{"name":"f_4_s_4","srcs":"assets/fishes/f_4_s_4/f_4_s_4.json"},{"name":"f_4_s_3","srcs":"assets/fishes/f_4_s_3/f_4_s_3.json"},{"name":"f_4_s_2","srcs":"assets/fishes/f_4_s_2/f_4_s_2.json"},{"name":"f_4_s_1","srcs":"assets/fishes/f_4_s_1/f_4_s_1.json"},{"name":"f_3_s_4","srcs":"assets/fishes/f_3_s_4/f_3_s_4.json"},{"name":"f_3_s_3","srcs":"assets/fishes/f_3_s_3/f_3_s_3.json"},{"name":"f_3_s_2","srcs":"assets/fishes/f_3_s_2/f_3_s_2.json"},{"name":"f_3_s_1","srcs":"assets/fishes/f_3_s_1/f_3_s_1.json"},{"name":"f_2_s_4","srcs":"assets/fishes/f_2_s_4/f_2_s_4.json"},{"name":"f_2_s_3","srcs":"assets/fishes/f_2_s_3/f_2_s_3.json"},{"name":"f_2_s_2","srcs":"assets/fishes/f_2_s_2/f_2_s_2.json"},{"name":"f_1_s_4","srcs":"assets/fishes/f_1_s_4/f_1_s_4.json"},{"name":"f_1_s_3","srcs":"assets/fishes/f_1_s_3/f_1_s_3.json"},{"name":"f_1_s_1","srcs":"assets/fishes/f_1_s_1/f_1_s_1.json"},{"name":"bg_move_1_stage","srcs":"assets/common/bg_move_1_stage.png"},{"name":"bg_move_2_stage","srcs":"assets/common/bg_move_2_stage.png"},{"name":"bg_move_3_stage","srcs":"assets/common/bg_move_3_stage.png"},{"name":"bg_move_4_stage","srcs":"assets/common/bg_move_4_stage.png"},{"name":"bg_move_5_stage","srcs":"assets/common/bg_move_5_stage.png"}]}]}');function Bg(t){return Bg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bg(t)}function Dg(){Dg=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",h=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof y?e:y,o=Object.create(i.prototype),a=new P(n||[]);return s(o,"_invoke",{value:S(t,r,a)}),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function b(){}function x(){}var _={};l(_,o,(function(){return this}));var v=Object.getPrototypeOf,w=v&&v(v(C([])));w&&w!==r&&n.call(w,o)&&(_=w);var E=x.prototype=y.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function r(s,i,o,a){var h=u(t[s],t,i);if("throw"!==h.type){var l=h.arg,c=l.value;return c&&"object"==Bg(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(h.arg)}var i;s(this,"_invoke",{value:function(t,n){function s(){return new e((function(e,s){r(t,n,e,s)}))}return i=i?i.then(s,s):s()}})}function S(e,r,n){var s=d;return function(i,o){if(s===p)throw new Error("Generator is already running");if(s===m){if("throw"===i)throw o;return{value:t,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var h=R(a,n);if(h){if(h===g)continue;return h}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===d)throw s=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=p;var l=u(e,r,n);if("normal"===l.type){if(s=n.done?m:f,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(s=m,n.method="throw",n.arg=l.arg)}}}function R(e,r){var n=r.method,s=e.iterator[n];if(s===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,R(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=u(s,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,i=function r(){for(;++s<e.length;)if(n.call(e,s))return r.value=e[s],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Bg(e)+" is not iterable")}return b.prototype=x,s(E,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,h,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,h,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},T(A.prototype),l(A.prototype,a,(function(){return this})),e.AsyncIterator=A,e.async=function(t,r,n,s,i){void 0===i&&(i=Promise);var o=new A(c(t,r,n,s),i);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},T(E),l(E,h,"Generator"),l(E,o,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function s(n,s){return a.type="throw",a.arg=e,r.next=n,s&&(r.method="next",r.arg=t),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return s("end");if(o.tryLoc<=this.prev){var h=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(h&&l){if(this.prev<o.catchLoc)return s(o.catchLoc,!0);if(this.prev<o.finallyLoc)return s(o.finallyLoc)}else if(h){if(this.prev<o.catchLoc)return s(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return s(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&n.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var i=s;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var s=n.arg;M(r)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function Lg(t,e,r,n,s,i,o){try{var a=t[i](o),h=a.value}catch(t){return void r(t)}a.done?e(h):Promise.resolve(h).then(n,s)}function Vg(t){return function(){var e=this,r=arguments;return new Promise((function(n,s){var i=t.apply(e,r);function o(t){Lg(i,n,s,o,a,"next",t)}function a(t){Lg(i,n,s,o,a,"throw",t)}o(void 0)}))}}function Ug(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Bg(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Bg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Bg(s)?s:String(s)),n)}var s}function Xg(t,e){return Xg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xg(t,e)}function jg(t){return jg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},jg(t)}var Yg=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xg(t,e)}(h,t);var e,r,n,s,i,o,a=(i=h,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=jg(i);if(o){var r=jg(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Bg(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function h(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),a.apply(this,arguments)}return e=h,r=[{key:"preload",value:(s=Vg(Dg().mark((function t(){return Dg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ti.init({manifest:Ng});case 2:return t.next=4,Ti.loadBundle("intro");case 4:case"end":return t.stop()}}),t)}))),function(){return s.apply(this,arguments)})},{key:"load",value:(n=Vg(Dg().mark((function t(){var e=this;return Dg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._deferred=Xp(),this._currProgress=0,this._needProgress=0,this._speedProgress=.01,this._initView(),this._toggleTickerUpdate(!0),t.next=8,Ti.loadBundle("main",(function(t){return e._needProgress=t}));case 8:return t.next=10,this._deferred.promise;case 10:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"_initView",value:function(){this.scale.set(.5),this.addChild(bs.from("back_loading_screen")).anchor.set(.5),this.loadingView=this.addChild(new ep(Ti.cache.get("loading_screen").spineData)),this.loadingView.state.setAnimation(0,"water_level",!0),this.loadingView.startY=1e3,this.loadingView.y=this.loadingView.startY,this.textView=this.addChild(new ta("",jp({fontSize:70,fill:16777215,stroke:0,strokeThickness:3}))),this.textView.anchor.set(.5)}},{key:"_toggleTickerUpdate",value:function(t){t?app.ticker.add(this._onSmoothLoading,this):app.ticker.remove(this._onSmoothLoading,this)}},{key:"_updateView",value:function(){this.loadingView.y=this.loadingView.startY-this.loadingView.startY*this._currProgress,this.textView.text="".concat((100*this._currProgress).toFixed(0),"%")}},{key:"_onSmoothLoading",value:function(){this._currProgress>=1&&(this._deferred.resolve(),this._toggleTickerUpdate(!1)),this._needProgress>this._currProgress&&(this._currProgress+=this._speedProgress,this._updateView())}}],r&&Ug(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),h}(ms);function Gg(t){return Gg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gg(t)}function Wg(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Gg(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Gg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Gg(s)?s:String(s)),n)}var s}function Hg(t,e){return Hg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Hg(t,e)}function $g(t){return $g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$g(t)}var zg=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Hg(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$g(n);if(s){var r=$g(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Gg(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this))._init(),t}return e=o,(r=[{key:"_init",value:function(){this.addChild(bs.from("bg_main")).anchor.set(.5);var t=this.addChild(bs.from("compass_scale"));t.scale.set(.5),t.rotation=.5*-Math.PI,t.anchor.set(.5),this.addChild(bs.from("port_hole")).anchor.set(.5);var e=this.logo=this.addChild(bs.from("logo"));e.anchor.set(.5),e.y=-280,new Lp.Tween(t).to({rotation:.5},2e4).easing(Lp.Easing.Back.InOut).repeat(1/0).yoyo(!0).start()}}])&&Wg(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ms);let qg;function Kg(){return qg}let Zg=0;const Qg=class extends nt{constructor(t){super(),this.id=Zg++,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this}get progress(){const{currentTime:t}=this._source;return t/this._duration}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(t){this._playing=!1,this._duration=t.source.duration;const e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}refresh(){const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const r=t.volume*(t.muted?0:1),n=e.volume*(e.muted?0:1),s=this._volume*(this._muted?0:1);this._source.volume=s*r*n,this._source.playbackRate=this._speed*t.speed*e.speed}refreshPaused(){const t=this._media.context,e=this._media.parent,r=this._paused||e.paused||t.paused;r!==this._pausedReal&&(this._pausedReal=r,r?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",r))}play(t){const{start:e,end:r,speed:n,loop:s,volume:i,muted:o}=t;r&&console.assert(r>e,"End time is before start time"),this._speed=n,this._volume=i,this._loop=!!s,this._muted=o,this.refresh(),this.loop&&null!==r&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=e,this._end=r||this._duration,this._start=Math.max(0,this._start-Qg.PADDING),this._end=Math.min(this._end+Qg.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=e,this._source.onloadedmetadata=null,this.emit("progress",e,this._duration),Wn.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){Wn.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){Wn.shared.remove(this._onUpdate,this),this.removeAllListeners();const t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let Jg=Qg;Jg.PADDING=.1;class ty extends nt{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new Jg(this)}get isPlayable(){return!!this._source&&4===this._source.readyState}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,r=this.parent;if(4===e.readyState){r.isLoaded=!0;const e=r.autoPlayStart();return void(t&&setTimeout((()=>{t(null,r,e)}),0))}if(!r.url)return void t(new Error("sound.url or sound.source must be set"));e.src=r.url;const n=()=>{o(),r.isLoaded=!0;const e=r.autoPlayStart();t&&t(null,r,e)},s=()=>{o(),t&&t(new Error("Sound loading has been aborted"))},i=()=>{o();const r=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(r)):console.error(r)},o=()=>{e.removeEventListener("canplaythrough",n),e.removeEventListener("load",n),e.removeEventListener("abort",s),e.removeEventListener("error",i)};e.addEventListener("canplaythrough",n,!1),e.addEventListener("load",n,!1),e.addEventListener("abort",s,!1),e.addEventListener("error",i,!1),e.load()}}class ey{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}const ry=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],ny=["audio/mpeg","audio/ogg"],sy={};!function(t){const e={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},r=document.createElement("audio"),n={},s=/^no$/;ry.forEach((t=>{const i=r.canPlayType(`audio/${t}`).replace(s,""),o=e[t]?r.canPlayType(e[t]).replace(s,""):"";n[t]=!!i||!!o})),Object.assign(sy,n)}();class iy{static setParamValue(t,e){if(t.setValueAtTime){const r=Kg().context;t.setValueAtTime(e,r.audioContext.currentTime)}else t.value=e;return e}}let oy=0;class ay extends nt{constructor(t){super(),this.id=oy++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){this._filters&&(this._filters?.filter((t=>t)).forEach((t=>t.disconnect())),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const r=t.volume*(t.muted?0:1),n=e.volume*(e.muted?0:1),s=this._volume*(this._muted?0:1);iy.setParamValue(this._gain.gain,s*n*r),iy.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){if(this._filters?.length){this._source.disconnect();let t=this._source;this._filters.forEach((e=>{t.connect(e.destination),t=e})),t.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,r=this._paused||e.paused||t.paused;r!==this._pausedReal&&(this._pausedReal=r,r?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",r))}play(t){const{start:e,end:r,speed:n,loop:s,volume:i,muted:o,filters:a}=t;r&&console.assert(r>e,"End time is before start time"),this._paused=!1;const{source:h,gain:l}=this._media.nodes.cloneBufferSource();this._source=h,this._gain=l,this._speed=n,this._volume=i,this._loop=!!s,this._muted=o,this._filters=a,this.refresh();const c=this._source.buffer.duration;this._duration=c,this._end=r,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=r,this._source.loopStart=e,this._source.start(0,e)):r?this._source.start(0,e,r-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){Wn.shared.remove(this._updateListener,this),t&&Wn.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._filters?.forEach((t=>t.disconnect())),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),r=e-this._lastUpdate;if(r>0||t){const t=this._source.playbackRate.value;this._elapsed+=r*t,this._lastUpdate=e;const n=this._duration;let s;if(this._source.loopStart){const t=this._source.loopEnd-this._source.loopStart;s=(this._source.loopStart+this._elapsed%t)/n}else s=this._elapsed%n/n;this._progress=s,this.emit("progress",this._progress,n)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}}class hy{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach((t=>{t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach((t=>{null===e?this._input.connect(t.destination):e.connect(t.destination),e=t})),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}}const ly=class extends hy{constructor(t){const e=t.audioContext,r=e.createBufferSource(),n=e.createGain(),s=e.createAnalyser();r.connect(s),s.connect(n),n.connect(t.destination),super(s,n),this.context=t,this.bufferSource=r,this.gain=n,this.analyser=s}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(ly.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,iy.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;const r=this.context.audioContext.createGain();return e.connect(r),r.connect(this.destination),{source:e,gain:r}}get bufferSize(){return this.script.bufferSize}};let cy=ly;cy.BUFFER_SIZE=0;class uy{init(t){this.parent=t,this._nodes=new cy(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new ay(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}async _loadUrl(t){const e=this.parent.url,r=await L.ADAPTER.fetch(e);this._decode(await r.arrayBuffer(),t)}_decode(t,e){const r=(t,r)=>{if(t)e&&e(t);else{this.parent.isLoaded=!0,this.buffer=r;const t=this.parent.autoPlayStart();e&&e(null,this.parent,t)}};t instanceof AudioBuffer?r(null,t):this.parent.context.decode(t,r)}}const dy=class{static from(t){let e={};"string"==typeof t?e.url=t:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?e.source=t:Array.isArray(t)?e.url=t:e=t,e={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...e},Object.freeze(e);const r=Kg().useLegacy?new ty:new uy;return new dy(r,e)}constructor(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);const r=e.complete;this._autoPlayOptions=r?{complete:r}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=Array.isArray(e.url)?this.preferUrl(e.url):e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}preferUrl(t){const[e]=t.map((t=>({url:t,ext:lt.extname(t).slice(1)}))).filter((({ext:t})=>sy[t])).sort(((t,e)=>ry.indexOf(t.ext)-ry.indexOf(e.ext)));if(!e)throw new Error("No supported file type found");return e.url}get context(){return Kg().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get filters(){return this.media.filters}set filters(t){this.media.filters=t}addSprites(t,e){if("object"==typeof t){const e={};for(const r in t)e[r]=this.addSprites(r,t[r]);return e}console.assert(!this._sprites[t],`Alias ${t} is already taken`);const r=new ey(this,e);return this._sprites[t]=r,r}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(t){if(t){const e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(const t in this._sprites)this.removeSprites(t);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this}play(t,e){let r;if("string"==typeof t?r={sprite:t,loop:this.loop,complete:e}:"function"==typeof t?(r={},r.complete=t):r=t,r={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...r||{}},r.sprite){const t=r.sprite;console.assert(!!this._sprites[t],`Alias ${t} is not available`);const e=this._sprites[t];r.start=e.start+(r.start||0),r.end=e.end,r.speed=e.speed||1,r.loop=e.loop||r.loop,delete r.sprite}if(r.offset&&(r.start=r.offset),!this.isLoaded)return this._preloadQueue?new Promise((t=>{this._preloadQueue.push((()=>{t(this.play(r))}))})):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=r,new Promise(((t,e)=>{this._preload(((n,s,i)=>{this._preloadQueue.forEach((t=>t())),this._preloadQueue=null,n?e(n):(r.loaded&&r.loaded(n,s,i),t(i))}))})));(this.singleInstance||r.singleInstance)&&this._removeInstances();const n=this._createInstance();return this._instances.push(n),this.isPlaying=!0,n.once("end",(()=>{r.complete&&r.complete(this),this._onComplete(n)})),n.once("stop",(()=>{this._onComplete(n)})),n.play(r),n}refresh(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refresh()}refreshPaused(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refreshPaused()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}_preload(t){this.media.load(t)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t}_removeInstances(){for(let t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0}_onComplete(t){if(this._instances){const e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)}_createInstance(){if(dy._pool.length>0){const t=dy._pool.pop();return t.init(this.media),t}return this.media.create()}_poolInstance(t){t.destroy(),dy._pool.indexOf(t)<0&&dy._pool.push(t)}};let fy=dy;fy._pool=[];class py extends nt{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}}class my extends hy{constructor(){const t=window,e=new my.AudioContext,r=e.createDynamicsCompressor(),n=e.createAnalyser();n.connect(r),r.connect(e.destination),super(n,r),this.autoPause=!0,this._ctx=e,this._offlineCtx=new my.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=r,this.analyser=n,this.events=new nt,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked="suspended"===e.state&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){if(!this.autoPause)return;const t=this._ctx.state;"suspended"!==t&&"interrupted"!==t&&this._locked||(this.paused=this._pausedOnBlur,this.refreshPaused())}onBlur(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))}_unlock(){this._locked&&(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;void 0!==t.close&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&"running"===this._ctx.state?this._ctx.suspend():t||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const r=t=>{e(new Error(t?.message||"Unable to decode file"))},n=this._offlineCtx.decodeAudioData(t,(t=>{e(null,t)}),r);n&&n.catch(r)}}class gy{constructor(t,e){this.init(t,e)}init(t,e){this.destination=t,this.source=e||t}connect(t){this.source?.connect(t)}disconnect(){this.source?.disconnect()}destroy(){this.disconnect(),this.destination=null,this.source=null}}const yy=class extends gy{constructor(t=0,e=0,r=0,n=0,s=0,i=0,o=0,a=0,h=0,l=0){let c=[];const u=[{f:yy.F32,type:"lowshelf",gain:t},{f:yy.F64,type:"peaking",gain:e},{f:yy.F125,type:"peaking",gain:r},{f:yy.F250,type:"peaking",gain:n},{f:yy.F500,type:"peaking",gain:s},{f:yy.F1K,type:"peaking",gain:i},{f:yy.F2K,type:"peaking",gain:o},{f:yy.F4K,type:"peaking",gain:a},{f:yy.F8K,type:"peaking",gain:h},{f:yy.F16K,type:"highshelf",gain:l}];Kg().useLegacy||(c=u.map((t=>{const e=Kg().context.audioContext.createBiquadFilter();return e.type=t.type,iy.setParamValue(e.Q,1),e.frequency.value=t.f,iy.setParamValue(e.gain,t.gain),e}))),super(c[0],c[c.length-1]),this.bands=c,this.bandsMap={};for(let t=0;t<this.bands.length;t++){const e=this.bands[t];t>0&&this.bands[t-1].connect(e),this.bandsMap[e.frequency.value]=e}}setGain(t,e=0){if(!this.bandsMap[t])throw new Error(`No band found for frequency ${t}`);iy.setParamValue(this.bandsMap[t].gain,e)}getGain(t){if(!this.bandsMap[t])throw new Error(`No band found for frequency ${t}`);return this.bandsMap[t].gain.value}set f32(t){this.setGain(yy.F32,t)}get f32(){return this.getGain(yy.F32)}set f64(t){this.setGain(yy.F64,t)}get f64(){return this.getGain(yy.F64)}set f125(t){this.setGain(yy.F125,t)}get f125(){return this.getGain(yy.F125)}set f250(t){this.setGain(yy.F250,t)}get f250(){return this.getGain(yy.F250)}set f500(t){this.setGain(yy.F500,t)}get f500(){return this.getGain(yy.F500)}set f1k(t){this.setGain(yy.F1K,t)}get f1k(){return this.getGain(yy.F1K)}set f2k(t){this.setGain(yy.F2K,t)}get f2k(){return this.getGain(yy.F2K)}set f4k(t){this.setGain(yy.F4K,t)}get f4k(){return this.getGain(yy.F4K)}set f8k(t){this.setGain(yy.F8K,t)}get f8k(){return this.getGain(yy.F8K)}set f16k(t){this.setGain(yy.F16K,t)}get f16k(){return this.getGain(yy.F16K)}reset(){this.bands.forEach((t=>{iy.setParamValue(t.gain,0)}))}destroy(){this.bands.forEach((t=>{t.disconnect()})),this.bands=null,this.bandsMap=null}};let by=yy;by.F32=32,by.F64=64,by.F125=125,by.F250=250,by.F500=500,by.F1K=1e3,by.F2K=2e3,by.F4K=4e3,by.F8K=8e3,by.F16K=16e3;const xy=t=>{const e=t.src;return t?.alias?.[0]??lt.basename(e,lt.extname(e))},_y={extension:he.Asset,detection:{test:async()=>!0,add:async t=>[...t,...ry.filter((t=>sy[t]))],remove:async t=>t.filter((e=>t.includes(e)))},loader:{extension:{type:[he.LoadParser],priority:Zs.High},test(t){const e=lt.extname(t).slice(1);return!!sy[e]||ny.some((e=>t.startsWith(`data:${e}`)))},async load(t,e){const r=await new Promise(((r,n)=>fy.from({...e.data,url:t,preload:!0,loaded(t,s){t?n(t):r(s),e.data?.loaded?.(t,s)}})));return Kg().add(xy(e),r),r},async unload(t,e){Kg().remove(xy(e))}}};ue.add(_y);const vy=function(t){return qg=t,t}(new class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new my),this._htmlAudioContext=new py,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return null!==my.AudioContext}add(t,e){if("object"==typeof t){const r={};for(const n in t){const s=this._getOptions(t[n],e);r[n]=this.add(n,s)}return r}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof fy)return this._sounds[t]=e,e;const r=this._getOptions(e),n=fy.from(r);return this._sounds[t]=n,n}_getOptions(t,e){let r;return r="string"==typeof t||Array.isArray(t)?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,r={...r,...e||{}},r}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}get disableAutoPause(){return!this._webAudioContext.autoPause}set disableAutoPause(t){this._webAudioContext.autoPause=!t}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){const r=!!this._sounds[t];return e&&console.assert(r,`No sound matching alias '${t}'.`),r}isPlaying(){for(const t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const r=this.find(t);return void 0!==e&&(r.volume=e),r.volume}speed(t,e){const r=this.find(t);return void 0!==e&&(r.speed=e),r.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}});function wy(t){return wy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wy(t)}function Ey(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==wy(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==wy(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===wy(s)?s:String(s)),n)}var s}function Ty(t,e){return Ty=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ty(t,e)}function Ay(t){return Ay=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ay(t)}var Sy=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ty(t,e)}(o,t);var e,r,n,s,i=(n=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ay(n);if(s){var r=Ay(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===wy(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),t=i.call(this),document.body.addEventListener("click",(function(){return t._init()}),{once:!0}),t}return e=o,(r=[{key:"_init",value:function(){this.on(Qa,this._playIncreaseAndDecrease,this),this.on(Za,this._playIncreaseAndDecrease,this),this.on(qa,this._playIncreaseAndDecrease,this),this.on(za,this._playIncreaseAndDecrease,this),this.on(Ja,this._playAutoTakeAndBet,this),this.on(th,this._playAutoTakeAndBet,this),this.on(nh,this._playTransitionOpen,this),this.on(sh,this._playTransitionClose,this),this.on(eh,this._playPopupWin,this),this.on(rh,this._playPopupLose,this),this.on(ih,this._playBallon,this),this.on(ja,this._playTake,this),this.on(Ya,this._playLose,this),this.on(Xa,this._playBet,this),this.on(Ha,this._toggleFadeMainSound,this),this.mainSound=vy.play("bg_main_theme",{loop:!0})}},{key:"_toggleFadeMainSound",value:function(t){new Pp(this.mainSound).to({volume:t},500).start()}},{key:"_playIncreaseAndDecrease",value:function(){vy.play("increase_decrease_button")}},{key:"_playTake",value:function(){vy.play("take")}},{key:"_playBet",value:function(){vy.play("make_bet")}},{key:"_playAutoTakeAndBet",value:function(){vy.play("autobet_button")}},{key:"_playTransitionOpen",value:function(){vy.play("transition_open")}},{key:"_playTransitionClose",value:function(){vy.play("transition_close")}},{key:"_playPopupWin",value:function(){vy.play("pop_up_you_won")}},{key:"_playPopupLose",value:function(){vy.play("pop_up_crash")}},{key:"_playBallon",value:function(){vy.play("bonus")}},{key:"_playLose",value:function(){vy.play("crash")}}])&&Ey(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(nt);function Ry(t){return Ry="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ry(t)}function Iy(){Iy=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",h=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof y?e:y,o=Object.create(i.prototype),a=new P(n||[]);return s(o,"_invoke",{value:S(t,r,a)}),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function b(){}function x(){}var _={};l(_,o,(function(){return this}));var v=Object.getPrototypeOf,w=v&&v(v(C([])));w&&w!==r&&n.call(w,o)&&(_=w);var E=x.prototype=y.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function r(s,i,o,a){var h=u(t[s],t,i);if("throw"!==h.type){var l=h.arg,c=l.value;return c&&"object"==Ry(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(h.arg)}var i;s(this,"_invoke",{value:function(t,n){function s(){return new e((function(e,s){r(t,n,e,s)}))}return i=i?i.then(s,s):s()}})}function S(e,r,n){var s=d;return function(i,o){if(s===p)throw new Error("Generator is already running");if(s===m){if("throw"===i)throw o;return{value:t,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var h=R(a,n);if(h){if(h===g)continue;return h}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===d)throw s=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=p;var l=u(e,r,n);if("normal"===l.type){if(s=n.done?m:f,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(s=m,n.method="throw",n.arg=l.arg)}}}function R(e,r){var n=r.method,s=e.iterator[n];if(s===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,R(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=u(s,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,i=function r(){for(;++s<e.length;)if(n.call(e,s))return r.value=e[s],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ry(e)+" is not iterable")}return b.prototype=x,s(E,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,h,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,h,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},T(A.prototype),l(A.prototype,a,(function(){return this})),e.AsyncIterator=A,e.async=function(t,r,n,s,i){void 0===i&&(i=Promise);var o=new A(c(t,r,n,s),i);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},T(E),l(E,h,"Generator"),l(E,o,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function s(n,s){return a.type="throw",a.arg=e,r.next=n,s&&(r.method="next",r.arg=t),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return s("end");if(o.tryLoc<=this.prev){var h=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(h&&l){if(this.prev<o.catchLoc)return s(o.catchLoc,!0);if(this.prev<o.finallyLoc)return s(o.finallyLoc)}else if(h){if(this.prev<o.catchLoc)return s(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return s(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&n.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var i=s;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var s=n.arg;M(r)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function My(t,e,r,n,s,i,o){try{var a=t[i](o),h=a.value}catch(t){return void r(t)}a.done?e(h):Promise.resolve(h).then(n,s)}function Py(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==Ry(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ry(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ry(s)?s:String(s)),n)}var s}function Cy(t,e){return Cy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Cy(t,e)}function ky(t){return ky=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ky(t)}var Oy=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cy(t,e)}(h,t);var e,r,n,s,i,o,a=(i=h,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ky(i);if(o){var r=ky(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ry(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function h(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(t=a.call(this))._addListeners(),t._onResize(),t}return e=h,r=[{key:"init",value:(n=Iy().mark((function t(){return Iy().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loader=this.stage.addChild(new Yg(this)),t.next=3,this.loader.preload();case 3:return this.foreground=this.stage.addChild(new zg),t.next=6,this.loader.load();case 6:this.model=new Fg,this.observer=new Wm,this.scene=this.stage.addChildAt(new Rm,0),this.ui=this.stage.addChildAt(new Cg,this.stage.children.length),this.sound=new Sy,this.controller=new jm(this),this._show();case 13:case"end":return t.stop()}}),t,this)})),s=function(){var t=this,e=arguments;return new Promise((function(r,s){var i=n.apply(t,e);function o(t){My(i,r,s,o,a,"next",t)}function a(t){My(i,r,s,o,a,"throw",t)}o(void 0)}))},function(){return s.apply(this,arguments)})},{key:"_show",value:function(){new Lp.Tween(this).to({loader:{alpha:0},scene:{alpha:1},ui:{alpha:1}},250).start()}},{key:"_addListeners",value:function(){var t=this;window.addEventListener("resize",(function(){return t._onResize()})),this.ticker.add((function(){return Lp.update()}))}},{key:"_onResize",value:function(){var t=window,e=t.innerWidth,r=t.innerHeight;this.renderer.resize(e,r),this.stage.scale.set(Math.min(r/this.height,e/this.width)),this.stage.position.set(.5*e,.45*r)}},{key:"width",get:function(){return 500}},{key:"height",get:function(){return 800}}],r&&Py(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),h}(js);window.app=new Oy,window.onload=function(){return window.app.init()},document.body.appendChild(window.app.view)})()})();